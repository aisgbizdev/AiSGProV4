{"file_contents":{"client/src/lib/auth-context.tsx":{"content":"/**\n * Authentication Context for AiSG\n * Manages global authentication state and user info\n */\n\nimport { createContext, useContext, useState, useEffect, type ReactNode } from \"react\";\nimport type { User } from \"@shared/schema\";\n\ntype AuthUser = Omit<User, \"password\">;\n\ninterface AuthContextType {\n  user: AuthUser | null;\n  isLoading: boolean;\n  login: (username: string, password: string) => Promise<void>;\n  logout: () => Promise<void>;\n  refetchUser: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<AuthUser | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Fetch current user on mount\n  const refetchUser = async () => {\n    try {\n      const res = await fetch(\"/api/auth/me\", {\n        credentials: \"include\", // Include cookies in request\n      });\n      if (res.ok) {\n        const data = await res.json();\n        setUser(data.user);\n      } else {\n        setUser(null);\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch user:\", error);\n      setUser(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    refetchUser();\n  }, []);\n\n  const login = async (username: string, password: string) => {\n    const res = await fetch(\"/api/auth/login\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      credentials: \"include\", // Include cookies in request\n      body: JSON.stringify({ username, password }),\n    });\n\n    if (!res.ok) {\n      const error = await res.json();\n      throw new Error(error.userMessage || error.error || \"Login failed\");\n    }\n\n    const data = await res.json();\n    setUser(data.user);\n  };\n\n  const logout = async () => {\n    try {\n      await fetch(\"/api/auth/logout\", { \n        method: \"POST\",\n        credentials: \"include\", // Include cookies in request\n      });\n    } finally {\n      setUser(null);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, isLoading, login, logout, refetchUser }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within AuthProvider\");\n  }\n  return context;\n}\n","size_bytes":2338},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 100%;\n\n  --foreground: 220 15% 15%;\n\n  --border: 220 10% 88%;\n\n  --card: 220 8% 98%;\n\n  --card-foreground: 220 15% 15%;\n\n  --card-border: 220 10% 92%;\n\n  --sidebar: 220 8% 96%;\n\n  --sidebar-foreground: 220 15% 15%;\n\n  --sidebar-border: 220 10% 90%;\n\n  --sidebar-primary: 220 70% 45%;\n\n  --sidebar-primary-foreground: 220 70% 98%;\n\n  --sidebar-accent: 220 10% 90%;\n\n  --sidebar-accent-foreground: 220 15% 15%;\n\n  --sidebar-ring: 220 70% 45%;\n\n  --popover: 220 10% 94%;\n\n  --popover-foreground: 220 15% 15%;\n\n  --popover-border: 220 12% 88%;\n\n  --primary: 220 70% 45%;\n\n  --primary-foreground: 220 70% 98%;\n\n  --secondary: 220 10% 88%;\n\n  --secondary-foreground: 220 15% 15%;\n\n  --muted: 220 12% 92%;\n\n  --muted-foreground: 220 15% 40%;\n\n  --accent: 220 14% 90%;\n\n  --accent-foreground: 220 15% 15%;\n\n  --destructive: 0 70% 50%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  --input: 220 15% 70%;\n  --ring: 220 70% 45%;\n  --chart-1: 220 70% 45%;\n  --chart-2: 142 70% 40%;\n  --chart-3: 45 95% 50%;\n  --chart-4: 280 60% 50%;\n  --chart-5: 0 70% 50%;\n\n  --zone-success: 142 70% 45%;\n  --zone-success-foreground: 0 0% 100%;\n  --zone-warning: 45 95% 55%;\n  --zone-warning-foreground: 220 15% 15%;\n  --zone-critical: 0 70% 55%;\n  --zone-critical-foreground: 0 0% 100%;\n\n  --magic: 280 60% 55%;\n  --magic-foreground: 0 0% 100%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'JetBrains Mono', monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 10% 20% / 0.03);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 10% 20% / 0.05);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 10% 20% / 0.05), 0px 1px 2px -1px hsl(220 10% 20% / 0.08);\n  --shadow: 0px 2px 0px 0px hsl(220 10% 20% / 0.05), 0px 1px 2px -1px hsl(220 10% 20% / 0.08);\n  --shadow-md: 0px 2px 0px 0px hsl(220 10% 20% / 0.05), 0px 2px 4px -1px hsl(220 10% 20% / 0.10);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 10% 20% / 0.05), 0px 4px 6px -1px hsl(220 10% 20% / 0.12);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 10% 20% / 0.05), 0px 8px 10px -1px hsl(220 10% 20% / 0.15);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 10% 20% / 0.20);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 220 15% 10%;\n\n  --foreground: 0 0% 95%;\n\n  --border: 220 8% 25%;\n\n  --card: 220 12% 15%;\n\n  --card-foreground: 0 0% 95%;\n\n  --card-border: 220 10% 20%;\n\n  --sidebar: 220 10% 20%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 220 8% 25%;\n\n  --sidebar-primary: 220 70% 45%;\n\n  --sidebar-primary-foreground: 220 70% 98%;\n\n  --sidebar-accent: 220 10% 25%;\n\n  --sidebar-accent-foreground: 0 0% 95%;\n\n  --sidebar-ring: 220 70% 55%;\n\n  --popover: 220 12% 18%;\n\n  --popover-foreground: 0 0% 95%;\n\n  --popover-border: 220 10% 23%;\n\n  --primary: 220 70% 45%;\n\n  --primary-foreground: 220 70% 98%;\n\n  --secondary: 220 10% 24%;\n\n  --secondary-foreground: 0 0% 95%;\n\n  --muted: 220 10% 22%;\n\n  --muted-foreground: 220 5% 70%;\n\n  --accent: 220 12% 23%;\n\n  --accent-foreground: 0 0% 95%;\n\n  --destructive: 0 70% 50%;\n\n  --destructive-foreground: 0 0% 98%;\n\n  /* Used as the border around inputs. Dark mode: Should be a border that is light enough to have high contrast when rendered on a --card background. More contrast than standard --border */\n  --input: 220 10% 40%;\n  --ring: 220 70% 55%;\n  --chart-1: 220 65% 65%;\n  --chart-2: 142 65% 60%;\n  --chart-3: 45 90% 65%;\n  --chart-4: 280 55% 65%;\n  --chart-5: 0 65% 65%;\n\n  --zone-success: 142 70% 50%;\n  --zone-success-foreground: 0 0% 100%;\n  --zone-warning: 45 95% 60%;\n  --zone-warning-foreground: 220 15% 10%;\n  --zone-critical: 0 70% 60%;\n  --zone-critical-foreground: 0 0% 100%;\n\n  --magic: 280 60% 60%;\n  --magic-foreground: 0 0% 100%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 20% 5% / 0.30);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 20% 5% / 0.35);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 20% 5% / 0.35), 0px 1px 2px -1px hsl(220 20% 5% / 0.40);\n  --shadow: 0px 2px 0px 0px hsl(220 20% 5% / 0.35), 0px 1px 2px -1px hsl(220 20% 5% / 0.40);\n  --shadow-md: 0px 2px 0px 0px hsl(220 20% 5% / 0.35), 0px 2px 4px -1px hsl(220 20% 5% / 0.45);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 20% 5% / 0.35), 0px 4px 6px -1px hsl(220 20% 5% / 0.50);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 20% 5% / 0.35), 0px 8px 10px -1px hsl(220 20% 5% / 0.55);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 20% 5% / 0.60);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n\n/* Modern Gen-Z Enhancements */\n@layer utilities {\n  /* Smooth scroll behavior */\n  html {\n    scroll-behavior: smooth;\n  }\n\n  /* Glassmorphism effects */\n  .glass {\n    background: rgba(255, 255, 255, 0.05);\n    backdrop-filter: blur(10px);\n    -webkit-backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  .glass-dark {\n    background: rgba(0, 0, 0, 0.2);\n    backdrop-filter: blur(10px);\n    -webkit-backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  /* Smooth transitions */\n  * {\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  /* Gradient text utilities */\n  .gradient-text {\n    @apply bg-gradient-to-r from-primary via-primary/80 to-primary/60 bg-clip-text text-transparent;\n  }\n\n  /* Hover lift effect */\n  .hover-lift {\n    transition: transform 0.2s ease-in-out;\n  }\n\n  .hover-lift:hover {\n    transform: translateY(-2px);\n  }\n\n  /* Pulse animation for important elements */\n  @keyframes pulse-soft {\n    0%, 100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0.8;\n    }\n  }\n\n  .pulse-soft {\n    animation: pulse-soft 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n  }\n}","size_bytes":13130},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/examples/AuditCard.tsx":{"content":"import AuditCard from \"../AuditCard\";\n\nexport default function AuditCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6 bg-background\">\n      <AuditCard\n        auditId=\"AUD-2024-001\"\n        nama=\"Budi Santoso\"\n        jabatan=\"Senior Business Consultant (SBC)\"\n        cabang=\"Jakarta Pusat\"\n        zonaKinerja=\"success\"\n        zonaPerilaku=\"success\"\n        profil=\"Leader\"\n        tanggal=\"20 Jan 2024\"\n        onView={() => console.log(\"View audit AUD-2024-001\")}\n        data-testid=\"audit-card-1\"\n      />\n      <AuditCard\n        auditId=\"AUD-2024-002\"\n        nama=\"Siti Nurhaliza\"\n        jabatan=\"Business Sales Manager (BSM)\"\n        cabang=\"Surabaya\"\n        zonaKinerja=\"warning\"\n        zonaPerilaku=\"success\"\n        profil=\"Visionary\"\n        tanggal=\"19 Jan 2024\"\n        onView={() => console.log(\"View audit AUD-2024-002\")}\n        data-testid=\"audit-card-2\"\n      />\n      <AuditCard\n        auditId=\"AUD-2024-003\"\n        nama=\"Ahmad Rizki\"\n        jabatan=\"Business Consultant (BC)\"\n        cabang=\"Bandung\"\n        zonaKinerja=\"success\"\n        zonaPerilaku=\"warning\"\n        profil=\"Performer\"\n        tanggal=\"18 Jan 2024\"\n        onView={() => console.log(\"View audit AUD-2024-003\")}\n        data-testid=\"audit-card-3\"\n      />\n      <AuditCard\n        auditId=\"AUD-2024-004\"\n        nama=\"Dewi Lestari\"\n        jabatan=\"Executive Manager (EM)\"\n        cabang=\"Medan\"\n        zonaKinerja=\"critical\"\n        zonaPerilaku=\"warning\"\n        profil=\"At-Risk\"\n        tanggal=\"17 Jan 2024\"\n        onView={() => console.log(\"View audit AUD-2024-004\")}\n        data-testid=\"audit-card-4\"\n      />\n    </div>\n  );\n}\n","size_bytes":1690},"server/audit-aggregation-helper.ts":{"content":"import type { Audit, Employee, MonthlyPerformance } from \"@shared/schema\";\nimport type { IStorage } from \"./storage\";\n\n/**\n * MVP decimal parsing - Handles most common cases\n * \n * Assumptions for MVP:\n * - Frontend inputs standard format: \"1234567.89\" (dot decimal, no thousands separators)\n * - Database stores DECIMAL type natively\n * - CSV imports will be standardized in Phase 3\n * \n * Supported formats:\n * - Plain numbers: \"1234567\" or \"1234567.89\"\n * - US format with commas: \"1,234,567.89\"\n * - European format with full separators: \"1.234.567,89\"\n * \n * TODO Phase 3: Implement locale-aware parsing with explicit DecimalLocale parameter\n * as recommended by architect (see Task 12 review notes)\n */\nfunction parseDecimalSafe(value: string): number {\n  if (!value || value === \"\") return 0;\n  \n  const trimmed = value.trim();\n  \n  // Check if both separators present (unambiguous)\n  const hasComma = trimmed.includes(\",\");\n  const hasDot = trimmed.includes(\".\");\n  \n  let normalized: string;\n  \n  if (hasComma && hasDot) {\n    // Both separators â†’ Last one is decimal\n    const lastComma = trimmed.lastIndexOf(\",\");\n    const lastDot = trimmed.lastIndexOf(\".\");\n    \n    if (lastComma > lastDot) {\n      // European: dot thousands, comma decimal\n      normalized = trimmed.replace(/\\./g, \"\").replace(\",\", \".\");\n    } else {\n      // US: comma thousands, dot decimal\n      normalized = trimmed.replace(/,/g, \"\");\n    }\n  } else if (hasComma) {\n    // Only comma â†’ Remove (assume US thousands for MVP)\n    // TODO Phase 3: Check locale to determine if decimal or thousands\n    normalized = trimmed.replace(/,/g, \"\");\n  } else {\n    // No comma or only dots â†’ Keep as-is (standard format)\n    normalized = trimmed;\n  }\n  \n  const parsed = parseFloat(normalized);\n  return isNaN(parsed) ? 0 : parsed;\n}\n\nexport interface AggregationResult {\n  marginTeamQ: string;\n  naTeamQ: number;\n  teamStructure: {\n    totalSubordinates: number;\n    auditedSubordinates: number;\n    coveragePct: number;\n    byPosition: Array<{\n      positionCode: string;\n      positionName: string;\n      count: number;\n      auditedCount: number;\n    }>;\n  };\n  warnings: string[];\n  pendingSubordinates: Array<{\n    id: string;\n    employeeCode: string;\n    fullName: string;\n    positionName: string;\n  }>;\n}\n\n/**\n * Calculate team aggregation from subordinates' audits\n * \n * Sum BOTH marginPersonalQ + marginTeamQ from each subordinate\n * to capture full nested tree (not just direct reports' personal performance)\n */\nexport async function calculateTeamAggregation(\n  storage: IStorage,\n  managerId: string,\n  year: number,\n  quarter: number\n): Promise<AggregationResult> {\n  // 1. Get all direct subordinates\n  const subordinates = await storage.getSubordinates(managerId);\n  \n  if (subordinates.length === 0) {\n    return {\n      marginTeamQ: \"0.00\",\n      naTeamQ: 0,\n      teamStructure: {\n        totalSubordinates: 0,\n        auditedSubordinates: 0,\n        coveragePct: 100,\n        byPosition: [],\n      },\n      warnings: [],\n      pendingSubordinates: [],\n    };\n  }\n  \n  // 2. Get positions for subordinates\n  const uniquePositionIds = new Set(subordinates.map(s => s.positionId));\n  const positionIds = Array.from(uniquePositionIds);\n  const positions = await Promise.all(\n    positionIds.map(id => storage.getPosition(id))\n  );\n  const positionMap = new Map(\n    positions.filter(p => p !== undefined).map(p => [p!.id, p!])\n  );\n  \n  // 3. Get audits for all subordinates in same period\n  const subordinateIds = subordinates.map(s => s.id);\n  const subordinateAudits = await storage.getAuditsForEmployeesInPeriod(subordinateIds, year, quarter);\n  \n  // 4. Create map for quick lookup\n  const auditMap = new Map<string, Audit>();\n  subordinateAudits.forEach(audit => auditMap.set(audit.employeeId, audit));\n  \n  // 5. Calculate aggregation (marginPersonalQ + marginTeamQ from each subordinate)\n  let totalMarginTeam = 0;\n  let totalNATeam = 0;\n  \n  for (const audit of subordinateAudits) {\n    // Sum both personal and team values to capture full nested tree\n    // Normalize decimal strings (remove locale formatting before parsing)\n    totalMarginTeam += parseDecimalSafe(audit.marginPersonalQ || \"0\");\n    totalMarginTeam += parseDecimalSafe(audit.marginTeamQ || \"0\");\n    \n    totalNATeam += (audit.naPersonalQ || 0);\n    totalNATeam += (audit.naTeamQ || 0);\n  }\n  \n  // 6. Build teamStructure snapshot grouped by position\n  const positionGroups = new Map<string, {\n    positionCode: string;\n    positionName: string;\n    count: number;\n    auditedCount: number;\n  }>();\n  \n  for (const subordinate of subordinates) {\n    const key = subordinate.positionId;\n    const position = positionMap.get(subordinate.positionId);\n    \n    if (!positionGroups.has(key)) {\n      positionGroups.set(key, {\n        positionCode: position?.code || \"UNKNOWN\",\n        positionName: position?.name || \"Unknown Position\",\n        count: 0,\n        auditedCount: 0,\n      });\n    }\n    \n    const group = positionGroups.get(key)!;\n    group.count++;\n    \n    if (auditMap.has(subordinate.id)) {\n      group.auditedCount++;\n    }\n  }\n  \n  // 7. Identify pending subordinates (haven't audited yet)\n  const pendingSubordinates = subordinates\n    .filter(s => !auditMap.has(s.id))\n    .map(s => {\n      const position = positionMap.get(s.positionId);\n      return {\n        id: s.id,\n        employeeCode: s.employeeCode,\n        fullName: s.fullName,\n        positionName: position?.name || \"Unknown Position\",\n      };\n    });\n  \n  // 8. Build warnings (text-only, no emoji per design guidelines)\n  const warnings: string[] = [];\n  const auditedCount = subordinateAudits.length;\n  const totalCount = subordinates.length;\n  const coveragePct = Math.round((auditedCount / totalCount) * 100);\n  \n  if (auditedCount === 0) {\n    warnings.push(\"PERINGATAN: Belum ada subordinate yang diaudit untuk periode ini\");\n  } else if (auditedCount < totalCount) {\n    warnings.push(`PERINGATAN: ${totalCount - auditedCount} dari ${totalCount} subordinate belum diaudit (${coveragePct}% coverage)`);\n  }\n  \n  return {\n    marginTeamQ: totalMarginTeam.toFixed(2),\n    naTeamQ: totalNATeam,\n    teamStructure: {\n      totalSubordinates: totalCount,\n      auditedSubordinates: auditedCount,\n      coveragePct,\n      byPosition: Array.from(positionGroups.values()).sort((a, b) => \n        a.positionCode.localeCompare(b.positionCode)\n      ),\n    },\n    warnings,\n    pendingSubordinates,\n  };\n}\n\n/**\n * Validate quarterly performance data exists (3 months minimum)\n */\nexport function validateQuarterlyPerformance(\n  performanceData: MonthlyPerformance[],\n  year: number,\n  quarter: number\n): { valid: boolean; error?: string } {\n  if (performanceData.length < 3) {\n    return {\n      valid: false,\n      error: `Data performance tidak lengkap untuk Q${quarter} ${year}. Diperlukan 3 bulan, tersedia: ${performanceData.length} bulan`,\n    };\n  }\n  \n  const expectedMonths = getQuarterMonths(quarter);\n  const actualMonths = performanceData.map(p => p.month).sort();\n  \n  const missingMonths = expectedMonths.filter(m => !actualMonths.includes(m));\n  if (missingMonths.length > 0) {\n    return {\n      valid: false,\n      error: `Bulan yang hilang di Q${quarter}: ${missingMonths.join(\", \")}`,\n    };\n  }\n  \n  return { valid: true };\n}\n\n/**\n * Get month numbers for a quarter\n */\nfunction getQuarterMonths(quarter: number): number[] {\n  switch (quarter) {\n    case 1: return [1, 2, 3];\n    case 2: return [4, 5, 6];\n    case 3: return [7, 8, 9];\n    case 4: return [10, 11, 12];\n    default: return [];\n  }\n}\n\n/**\n * Calculate personal quarterly totals from monthly performance\n */\nexport function calculatePersonalQuarterly(performanceData: MonthlyPerformance[]): {\n  marginPersonalQ: string;\n  naPersonalQ: number;\n} {\n  const totalMargin = performanceData.reduce(\n    (sum, p) => sum + parseDecimalSafe(p.marginPersonal || \"0\"), \n    0\n  );\n  const totalNA = performanceData.reduce(\n    (sum, p) => sum + (p.naPersonal || 0), \n    0\n  );\n  \n  return {\n    marginPersonalQ: totalMargin.toFixed(2),\n    naPersonalQ: totalNA,\n  };\n}\n","size_bytes":8098},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"design_guidelines.md":{"content":"# AISG Design Guidelines\n## Audit Intelligence Platform - Corporate Enterprise System\n\n---\n\n## Design Approach\n\n**Selected Approach**: Material Design System (Data-Dense Enterprise Application)\n\n**Justification**: AISG is a utility-focused, information-dense performance auditing platform requiring clear data hierarchy, consistent visual feedback, and professional corporate aesthetics. Material Design provides excellent support for data visualization, status indicators, and enterprise workflows.\n\n**Key Design Principles**:\n- Clarity and data hierarchy above decorative elements\n- Instant visual feedback through zone color-coding\n- Professional corporate identity reflecting SG organizational standards\n- Efficient workflows for audit processing and report generation\n\n---\n\n## Core Design Elements\n\n### A. Color Palette\n\n**Brand & Primary Colors**:\n- Primary: `220 70% 45%` (Corporate Blue - professional, trustworthy)\n- Primary Light: `220 65% 55%` (for hover states)\n- Primary Dark: `220 75% 35%` (for active states)\n\n**Zone Status Colors** (Critical for audit results):\n- Success Zone (ðŸŸ©): `142 70% 45%` (Green - optimal performance)\n- Warning Zone (ðŸŸ¨): `45 95% 55%` (Amber - needs attention)\n- Critical Zone (ðŸŸ¥): `0 70% 55%` (Red - requires intervention)\n\n**Neutral Palette** (Dark Mode Focused):\n- Background: `220 15% 10%` (Deep slate)\n- Surface: `220 12% 15%` (Elevated cards)\n- Surface Variant: `220 10% 20%` (Tertiary containers)\n- Border: `220 8% 25%` (Subtle divisions)\n- Text Primary: `0 0% 95%`\n- Text Secondary: `220 5% 70%`\n- Text Muted: `220 5% 55%`\n\n**Accent Colors** (Minimal use):\n- Accent: `280 60% 55%` (Purple for Magic Section highlights only)\n\n---\n\n### B. Typography\n\n**Font Families**:\n- Primary: 'Inter' (Google Fonts) - Clean, modern, excellent for data\n- Mono: 'JetBrains Mono' (for audit IDs, codes, timestamps)\n\n**Type Scale**:\n- Display: 3rem (48px), font-weight: 700 - Dashboard headers\n- Heading 1: 2.25rem (36px), font-weight: 600 - Section titles\n- Heading 2: 1.875rem (30px), font-weight: 600 - Card headers\n- Heading 3: 1.5rem (24px), font-weight: 500 - Subsections\n- Body Large: 1.125rem (18px), font-weight: 400 - Primary content\n- Body: 1rem (16px), font-weight: 400 - Default text\n- Body Small: 0.875rem (14px), font-weight: 400 - Secondary info\n- Caption: 0.75rem (12px), font-weight: 500 - Labels, metadata\n\n---\n\n### C. Layout System\n\n**Spacing Primitives**: Use Tailwind units of **4, 6, 8, 12, 16** consistently\n- Micro spacing: p-4, gap-4 (16px) - Within cards\n- Section padding: py-8, px-6 (32px/24px) - Card containers\n- Page margins: py-12, px-8 (48px/32px) - Main containers\n- Large gaps: gap-8, space-y-12 (32px/48px) - Between sections\n\n**Grid Structure**:\n- Dashboard: 12-column grid with gap-6\n- Audit cards: 3-column on desktop (lg:grid-cols-3), 1-column mobile\n- Report layout: 2-column split (form + preview or data + chart)\n- Max container width: max-w-7xl (1280px)\n\n---\n\n### D. Component Library\n\n**Navigation**:\n- Top navbar: Fixed, dark surface with logo, main nav items, user profile\n- Sidebar (dashboard): Collapsible, icons + labels, active state highlighting\n- Breadcrumbs: For audit drill-down (Dashboard > Audits > Report #123)\n\n**Cards & Containers**:\n- Audit Summary Card: Zone-color left border (4px), surface background, p-6\n- Stat Cards: Large number display, label, trend indicator (â†‘â†“)\n- Report Container: White/light surface with subtle shadow, rounded corners\n- Magic Section Card: Accent purple gradient border, slightly elevated\n\n**Data Display**:\n- Tables: Striped rows, sticky headers, sortable columns, zone color badges\n- Charts: Line/bar charts for performance trends (use Chart.js or similar)\n- Progress Bars: Zone-colored, percentage labels, smooth animations\n- Status Badges: Pill-shaped, zone colors, bold text\n\n**Forms**:\n- Input Fields: Dark background, light border, focus state with primary color glow\n- Select Dropdowns: Custom styled, search capability for long lists\n- Date Picker: Calendar modal for tanggal_lahir input\n- Multi-step Form: Progress indicator, clear section divisions\n\n**Buttons**:\n- Primary: Solid primary color, white text, rounded-lg\n- Secondary: Outline with primary color, hover fill\n- Danger: Red for critical actions (demosi recommendations)\n- Success: Green for approvals\n\n**Feedback Elements**:\n- Toast Notifications: Top-right, zone-colored, auto-dismiss\n- Loading States: Skeleton screens for data tables, spinner for actions\n- Empty States: Centered icon + message for no audit data\n\n**Overlays**:\n- Modals: Centered, max-w-2xl, for detailed audit reviews\n- Drawer: Right-side slide for quick actions, filters\n- Tooltips: Minimal, dark background, explain ProDem criteria\n\n---\n\n### E. Animations\n\n**Minimal, purposeful only**:\n- Card hover: Subtle lift (translate-y-1) + shadow increase\n- Zone transitions: Smooth color fade when status changes\n- Loading: Gentle pulse for skeleton screens\n- Page transitions: Simple fade-in for route changes\n- NO decorative animations, scrolling effects, or complex interactions\n\n---\n\n## Page-Specific Layouts\n\n### Dashboard (Main View)\n- **Hero Stats Row**: 4 stat cards (Total Audits, Active Users, Avg Score, Pending Reviews)\n- **Performance Overview**: Line chart showing monthly trends\n- **Recent Audits Table**: Latest 10 audits with quick actions\n- **Zone Distribution**: Pie/donut chart showing ðŸŸ©ðŸŸ¨ðŸŸ¥ breakdown\n- **Quick Actions Panel**: Start New Audit, View Reports, Export Data\n\n### Audit Input Form\n- **Multi-step wizard**:\n  1. Identity (Nama, Jabatan, Cabang)\n  2. Quarter Metrics (Margin, BC counts)\n  3. 18 Pilar Questions (grouped by theme)\n  4. Magic Section (Tanggal Lahir)\n  5. Review & Submit\n- **Progress bar** at top, clear step labels\n- **Validation** with inline error messages\n\n### Audit Report View\n- **Header**: Audit ID, timestamp, user identity card\n- **Zone Indicators**: Large, prominent ðŸŸ©ðŸŸ¨ðŸŸ¥ badges for both zones\n- **Profile Badge**: Leader/Visionary/Performer/At-Risk with icon\n- **Metrics Grid**: Margin, BC stats in 2x2 layout\n- **18 Pilar Breakdown**: Accordion/expandable sections with YA/SEBAGIAN/TIDAK\n- **Magic Section**: Purple-accented card with Zodiak + Booster + Quote\n- **ProDem Recommendation**: Clear call-out box with next steps\n- **Export Button**: PDF download, prominent placement\n\n### Images\nNo large hero images required for this enterprise dashboard. Use:\n- **Icon illustrations** for empty states (simple, line-style)\n- **Small avatar/profile images** for user cards\n- **Logo** in navigation header\n- **Charts/graphs** as primary visual elements (data-driven)\n\n---\n\n## Mobile Responsiveness\n- Stack all multi-column layouts to single column on mobile\n- Sticky navigation with hamburger menu\n- Swipeable cards for audit browsing\n- Bottom sheet for quick actions instead of modals\n- Touch-friendly tap targets (min 44px height)\n\n---\n\nThis design system creates a **professional, data-focused audit platform** with clear visual hierarchy, efficient workflows, and immediate status recognition through color-codingâ€”perfectly suited for the AISG enterprise environment.","size_bytes":7113},"server/openai.ts":{"content":"import OpenAI from \"openai\";\n\n// Using OpenAI directly with user's API key\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY\n});\n\nexport default openai;\n","size_bytes":168},"client/src/pages/PerformanceInput.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Calendar, TrendingUp, Target, Package, Loader2, ChevronDown, ChevronUp } from \"lucide-react\";\nimport type { Employee, MonthlyPerformance } from \"@shared/schema\";\n\n// Form validation schema\nconst performanceFormSchema = z.object({\n  employeeId: z.string().min(1, \"Pilih karyawan\"),\n  year: z.coerce.number().int().min(2020).max(2030),\n  month: z.coerce.number().int().min(1).max(12),\n  marginPersonal: z.string().regex(/^-?\\d+(\\.\\d{1,2})?$/, \"Format decimal tidak valid (contoh: 1234.56)\"),\n  naPersonal: z.coerce.number().int().min(0, \"NA harus 0 atau lebih\"),\n  lotSettled: z.coerce.number().int().min(0, \"Lot Settled harus 0 atau lebih\"),\n});\n\ntype PerformanceFormData = z.infer<typeof performanceFormSchema>;\n\nexport default function PerformanceInput() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState<string>(\"\");\n  const [showHistory, setShowHistory] = useState(false);\n\n  // Fetch employees (filtered by RBAC on backend)\n  const { data: employees = [], isLoading: loadingEmployees } = useQuery<Employee[]>({\n    queryKey: [\"/api/enterprise/employees\"],\n  });\n\n  // Fetch performance history for selected employee\n  const { data: performanceHistory = [], isLoading: loadingHistory } = useQuery<MonthlyPerformance[]>({\n    queryKey: [\"/api/enterprise/performance/employee\", selectedEmployeeId],\n    enabled: !!selectedEmployeeId,\n  });\n\n  // Form setup\n  const form = useForm<PerformanceFormData>({\n    resolver: zodResolver(performanceFormSchema),\n    defaultValues: {\n      employeeId: \"\",\n      year: new Date().getFullYear(),\n      month: new Date().getMonth() + 1,\n      marginPersonal: \"0.00\",\n      naPersonal: 0,\n      lotSettled: 0,\n    },\n  });\n\n  // Create performance mutation\n  const createPerformance = useMutation({\n    mutationFn: async (data: PerformanceFormData) => {\n      return await apiRequest(\"/api/enterprise/performance\", \"POST\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Berhasil!\",\n        description: \"Data performance berhasil diinput\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/performance\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/performance/employee\", selectedEmployeeId] });\n      form.reset({\n        employeeId: selectedEmployeeId,\n        year: new Date().getFullYear(),\n        month: new Date().getMonth() + 1,\n        marginPersonal: \"0.00\",\n        naPersonal: 0,\n        lotSettled: 0,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Gagal!\",\n        description: error.message || \"Gagal menyimpan data performance\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: PerformanceFormData) => {\n    createPerformance.mutate(data);\n  };\n\n  // Month names for display\n  const monthNames = [\n    \"Januari\", \"Februari\", \"Maret\", \"April\", \"Mei\", \"Juni\",\n    \"Juli\", \"Agustus\", \"September\", \"Oktober\", \"November\", \"Desember\"\n  ];\n\n  // Calculate quarter from month\n  const getQuarterName = (month: number) => {\n    const quarter = Math.ceil(month / 3);\n    return `Q${quarter}`;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-purple-950/5 to-background\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 py-8 space-y-6\">\n        {/* Header */}\n        <div className=\"space-y-2\">\n          <h1 className=\"text-3xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-purple-500 bg-clip-text text-transparent\">\n            Input Performance Bulanan\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Input data performance karyawan untuk perhitungan audit\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Input Form */}\n          <div className=\"lg:col-span-2\">\n            <Card className=\"border-purple-500/20 shadow-xl shadow-purple-500/5\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-5 h-5 text-purple-400\" />\n                  Form Input Performance\n                </CardTitle>\n                <CardDescription>\n                  Isi data performance bulanan untuk karyawan yang Anda kelola\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...form}>\n                  <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                    {/* Employee Selector */}\n                    <FormField\n                      control={form.control}\n                      name=\"employeeId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Karyawan *</FormLabel>\n                          <Select\n                            disabled={loadingEmployees}\n                            onValueChange={(value) => {\n                              field.onChange(value);\n                              setSelectedEmployeeId(value);\n                            }}\n                            value={field.value}\n                          >\n                            <FormControl>\n                              <SelectTrigger data-testid=\"select-employee\">\n                                <SelectValue placeholder=\"Pilih karyawan...\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              {employees.map((emp) => (\n                                <SelectItem key={emp.id} value={emp.id}>\n                                  {emp.fullName} ({emp.employeeCode})\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    {/* Period Selection */}\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"year\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Tahun *</FormLabel>\n                            <FormControl>\n                              <Input\n                                type=\"number\"\n                                placeholder=\"2025\"\n                                data-testid=\"input-year\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"month\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Bulan *</FormLabel>\n                            <Select\n                              onValueChange={field.onChange}\n                              value={field.value.toString()}\n                            >\n                              <FormControl>\n                                <SelectTrigger data-testid=\"select-month\">\n                                  <SelectValue />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                {monthNames.map((name, idx) => (\n                                  <SelectItem key={idx + 1} value={(idx + 1).toString()}>\n                                    {name} ({getQuarterName(idx + 1)})\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    {/* Performance Metrics */}\n                    <div className=\"space-y-4 p-4 rounded-lg bg-gradient-to-br from-purple-500/5 to-pink-500/5 border border-purple-500/10\">\n                      <h3 className=\"font-semibold text-sm text-purple-400 flex items-center gap-2\">\n                        <TrendingUp className=\"w-4 h-4\" />\n                        Data Performance Personal\n                      </h3>\n\n                      <FormField\n                        control={form.control}\n                        name=\"marginPersonal\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Margin Personal (Rp)</FormLabel>\n                            <FormControl>\n                              <Input\n                                type=\"text\"\n                                placeholder=\"0.00\"\n                                data-testid=\"input-margin\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                            <p className=\"text-xs text-muted-foreground\">\n                              Format: 1234567.89 (bisa negatif)\n                            </p>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"naPersonal\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>National Agreement (NA)</FormLabel>\n                            <FormControl>\n                              <Input\n                                type=\"number\"\n                                placeholder=\"0\"\n                                data-testid=\"input-na\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                            <p className=\"text-xs text-muted-foreground\">\n                              Jumlah National Agreement yang dicapai\n                            </p>\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"lotSettled\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Lot Settled</FormLabel>\n                            <FormControl>\n                              <Input\n                                type=\"number\"\n                                placeholder=\"0\"\n                                data-testid=\"input-lot\"\n                                {...field}\n                              />\n                            </FormControl>\n                            <FormMessage />\n                            <p className=\"text-xs text-muted-foreground\">\n                              Jumlah lot yang telah settled\n                            </p>\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    {/* Submit Button */}\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full gap-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600\"\n                      disabled={createPerformance.isPending}\n                      data-testid=\"button-submit-performance\"\n                    >\n                      {createPerformance.isPending ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                          Menyimpan...\n                        </>\n                      ) : (\n                        <>\n                          <Target className=\"w-4 h-4\" />\n                          Simpan Data Performance\n                        </>\n                      )}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Performance History Sidebar */}\n          <div className=\"lg:col-span-1\">\n            <Card className=\"border-purple-500/20 shadow-xl shadow-purple-500/5 sticky top-24\">\n              <CardHeader>\n                <CardTitle className=\"text-base flex items-center justify-between\">\n                  <span className=\"flex items-center gap-2\">\n                    <Package className=\"w-4 h-4 text-purple-400\" />\n                    Riwayat Performance\n                  </span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setShowHistory(!showHistory)}\n                    data-testid=\"button-toggle-history\"\n                  >\n                    {showHistory ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                  </Button>\n                </CardTitle>\n                {selectedEmployeeId && (\n                  <CardDescription className=\"text-xs\">\n                    {employees.find(e => e.id === selectedEmployeeId)?.fullName || \"\"}\n                  </CardDescription>\n                )}\n              </CardHeader>\n              {showHistory && selectedEmployeeId && (\n                <CardContent>\n                  {loadingHistory ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <Loader2 className=\"w-6 h-6 animate-spin text-purple-400\" />\n                    </div>\n                  ) : performanceHistory.length === 0 ? (\n                    <p className=\"text-sm text-muted-foreground text-center py-8\">\n                      Belum ada data performance\n                    </p>\n                  ) : (\n                    <div className=\"space-y-2 max-h-[400px] overflow-y-auto\">\n                      {performanceHistory\n                        .sort((a, b) => {\n                          if (a.year !== b.year) return b.year - a.year;\n                          return b.month - a.month;\n                        })\n                        .map((perf) => (\n                          <div\n                            key={perf.id}\n                            className=\"p-3 rounded-lg bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20 space-y-1\"\n                            data-testid={`history-item-${perf.id}`}\n                          >\n                            <div className=\"flex items-center justify-between\">\n                              <span className=\"text-sm font-semibold text-purple-400\">\n                                {monthNames[perf.month - 1]} {perf.year}\n                              </span>\n                              <span className=\"text-xs text-muted-foreground\">\n                                {getQuarterName(perf.month)}\n                              </span>\n                            </div>\n                            <div className=\"grid grid-cols-2 gap-2 text-xs\">\n                              <div>\n                                <span className=\"text-muted-foreground\">Margin:</span>\n                                <p className=\"font-medium\">Rp {parseFloat(perf.marginPersonal).toLocaleString('id-ID')}</p>\n                              </div>\n                              <div>\n                                <span className=\"text-muted-foreground\">NA:</span>\n                                <p className=\"font-medium\">{perf.naPersonal}</p>\n                              </div>\n                            </div>\n                            <div className=\"text-xs\">\n                              <span className=\"text-muted-foreground\">Lot:</span>\n                              <span className=\"font-medium ml-1\">{perf.lotSettled || 0}</span>\n                            </div>\n                          </div>\n                        ))}\n                    </div>\n                  )}\n                </CardContent>\n              )}\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":17166},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"attached_assets/aisg_core_audit_guide_1762749934944.md":{"content":"","size_bytes":0},"server/storage.ts":{"content":"import { eq, desc, isNull, and, sql, inArray } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport { \n  type User, \n  type InsertUser,\n  type Pt,\n  type InsertPt,\n  type CeoUnit,\n  type InsertCeoUnit,\n  type Branch,\n  type InsertBranch,\n  type Position,\n  type InsertPosition,\n  type Employee,\n  type InsertEmployee,\n  type MonthlyPerformance,\n  type InsertMonthlyPerformance,\n  type Audit,\n  type InsertAudit,\n  type ChatMessage,\n  type InsertChatMessage,\n  users,\n  pts,\n  ceoUnits,\n  branches,\n  positions,\n  employees,\n  monthlyPerformance,\n  audits,\n  chatMessages\n} from \"@shared/schema\";\nimport { type AuditDetailDto } from \"@shared/types\";\nimport { randomUUID } from \"crypto\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmployeeId(employeeId: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  deleteUser(id: string): Promise<void>;\n  updateUserPassword(id: string, newPasswordHash: string): Promise<void>;\n  \n  // PT Company operations\n  getAllPTs(): Promise<Pt[]>;\n  getPT(id: string): Promise<Pt | undefined>;\n  createPT(data: InsertPt): Promise<Pt>;\n  updatePT(id: string, data: Partial<InsertPt>): Promise<Pt | undefined>;\n  deletePT(id: string): Promise<boolean>;\n  \n  // CEO Unit operations\n  getAllCEOUnits(): Promise<CeoUnit[]>;\n  getCEOUnit(id: string): Promise<CeoUnit | undefined>;\n  createCEOUnit(data: InsertCeoUnit): Promise<CeoUnit>;\n  updateCEOUnit(id: string, data: Partial<InsertCeoUnit>): Promise<CeoUnit | undefined>;\n  deleteCEOUnit(id: string): Promise<boolean>;\n  \n  // Branch operations\n  getAllBranches(): Promise<Branch[]>;\n  getBranch(id: string): Promise<Branch | undefined>;\n  getBranchesByPT(ptId: string): Promise<Branch[]>;\n  createBranch(data: InsertBranch): Promise<Branch>;\n  updateBranch(id: string, data: Partial<InsertBranch>): Promise<Branch | undefined>;\n  deleteBranch(id: string): Promise<boolean>;\n  \n  // Position operations\n  getAllPositions(): Promise<Position[]>;\n  getPosition(id: string): Promise<Position | undefined>;\n  getPositionByLevel(level: number): Promise<Position | undefined>;\n  createPosition(data: InsertPosition): Promise<Position>;\n  updatePosition(id: string, data: Partial<InsertPosition>): Promise<Position | undefined>;\n  deletePosition(id: string): Promise<boolean>;\n  \n  // Employee operations\n  getAllEmployees(): Promise<Employee[]>;\n  getEmployee(id: string): Promise<Employee | undefined>;\n  getEmployeeByCode(code: string): Promise<Employee | undefined>;\n  getEmployeesByBranch(branchId: string): Promise<Employee[]>;\n  getEmployeesByPosition(positionId: string): Promise<Employee[]>;\n  getEmployeesByManager(managerId: string): Promise<Employee[]>;\n  getEmployeesByCEOUnit(ceoUnitId: string): Promise<Employee[]>;\n  createEmployee(data: InsertEmployee): Promise<Employee>;\n  updateEmployee(id: string, data: Partial<InsertEmployee>): Promise<Employee | undefined>;\n  deleteEmployee(id: string): Promise<boolean>;\n  \n  // Employee hierarchy operations\n  getSubordinates(employeeId: string): Promise<Employee[]>;\n  getAllSubordinatesRecursive(employeeId: string): Promise<Employee[]>;\n  getOrganizationTree(rootEmployeeId: string): Promise<any>;\n  \n  // RBAC helper operations\n  getEmployeeWithMetadata(employeeId: string): Promise<any | undefined>;\n  canManageEmployee(managerId: string, targetEmployeeId: string): Promise<boolean>;\n  \n  // Monthly Performance operations\n  getAllPerformance(): Promise<MonthlyPerformance[]>;\n  getPerformance(id: string): Promise<MonthlyPerformance | undefined>;\n  getPerformanceByEmployee(employeeId: string): Promise<MonthlyPerformance[]>;\n  getPerformanceByPeriod(employeeId: string, year: number, month: number): Promise<MonthlyPerformance | undefined>;\n  getQuarterlyPerformance(employeeId: string, year: number, quarter: number): Promise<MonthlyPerformance[]>;\n  createPerformance(data: InsertMonthlyPerformance): Promise<MonthlyPerformance>;\n  updatePerformance(id: string, data: Partial<InsertMonthlyPerformance>): Promise<MonthlyPerformance | undefined>;\n  deletePerformance(id: string): Promise<boolean>;\n  \n  // Audit operations\n  createAudit(data: InsertAudit): Promise<Audit>;\n  getAudit(id: string): Promise<Audit | undefined>;\n  getAllAudits(includeDeleted?: boolean): Promise<Audit[]>;\n  getAuditsByEmployee(employeeId: string): Promise<Audit[]>;\n  getAuditByPeriod(employeeId: string, year: number, quarter: number): Promise<Audit | undefined>;\n  getAuditsForEmployeesInPeriod(employeeIds: string[], year: number, quarter: number): Promise<Audit[]>;\n  updateAuditAggregation(id: string, marginTeamQ: string, naTeamQ: number, teamStructure: Audit['teamStructure']): Promise<Audit | undefined>;\n  updateAuditReport(id: string, data: {\n    zonaKinerja: Audit['zonaKinerja'];\n    zonaPerilaku: Audit['zonaPerilaku'];\n    zonaFinal: Audit['zonaFinal'];\n    profil: Audit['profil'];\n    prodemRekomendasi: Audit['prodemRekomendasi'];\n    auditReport: Audit['auditReport'];\n  }): Promise<Audit | undefined>;\n  softDeleteAudit(id: string, deletedById: string, reason: string): Promise<void>;\n  hardDeleteAudit(id: string): Promise<void>;\n  \n  // Chat operations\n  createChatMessage(data: InsertChatMessage): Promise<ChatMessage>;\n  getChatHistory(auditId: string): Promise<ChatMessage[]>;\n  deleteChatHistory(auditId: string): Promise<void>;\n}\n\nexport class DbStorage implements IStorage {\n  // =========================================================================\n  // USER OPERATIONS\n  // =========================================================================\n  \n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.username, username)).limit(1);\n    return result[0];\n  }\n\n  async getUserByEmployeeId(employeeId: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.employeeId, employeeId)).limit(1);\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await db.insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    const result = await db.select().from(users).orderBy(desc(users.createdAt));\n    return result;\n  }\n\n  async deleteUser(id: string): Promise<void> {\n    await db.delete(users).where(eq(users.id, id));\n  }\n\n  async updateUserPassword(id: string, newPasswordHash: string): Promise<void> {\n    await db.update(users).set({ password: newPasswordHash }).where(eq(users.id, id));\n  }\n\n  // =========================================================================\n  // PT COMPANY OPERATIONS\n  // =========================================================================\n  \n  async getAllPTs(): Promise<Pt[]> {\n    return await db.select().from(pts).orderBy(pts.name);\n  }\n\n  async getPT(id: string): Promise<Pt | undefined> {\n    const result = await db.select().from(pts).where(eq(pts.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createPT(data: InsertPt): Promise<Pt> {\n    const result = await db.insert(pts).values(data).returning();\n    return result[0];\n  }\n\n  async updatePT(id: string, data: Partial<InsertPt>): Promise<Pt | undefined> {\n    const result = await db.update(pts).set(data).where(eq(pts.id, id)).returning();\n    return result[0];\n  }\n\n  async deletePT(id: string): Promise<boolean> {\n    const result = await db.delete(pts).where(eq(pts.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // =========================================================================\n  // CEO UNIT OPERATIONS\n  // =========================================================================\n  \n  async getAllCEOUnits(): Promise<CeoUnit[]> {\n    return await db.select().from(ceoUnits).orderBy(ceoUnits.name);\n  }\n\n  async getCEOUnit(id: string): Promise<CeoUnit | undefined> {\n    const result = await db.select().from(ceoUnits).where(eq(ceoUnits.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createCEOUnit(data: InsertCeoUnit): Promise<CeoUnit> {\n    const result = await db.insert(ceoUnits).values(data).returning();\n    return result[0];\n  }\n\n  async updateCEOUnit(id: string, data: Partial<InsertCeoUnit>): Promise<CeoUnit | undefined> {\n    const result = await db.update(ceoUnits).set(data).where(eq(ceoUnits.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteCEOUnit(id: string): Promise<boolean> {\n    const result = await db.delete(ceoUnits).where(eq(ceoUnits.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // =========================================================================\n  // BRANCH OPERATIONS\n  // =========================================================================\n  \n  async getAllBranches(): Promise<Branch[]> {\n    return await db.select().from(branches).orderBy(branches.name);\n  }\n\n  async getBranch(id: string): Promise<Branch | undefined> {\n    const result = await db.select().from(branches).where(eq(branches.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getBranchesByPT(ptId: string): Promise<Branch[]> {\n    return await db.select().from(branches).where(eq(branches.ptId, ptId)).orderBy(branches.name);\n  }\n\n  async createBranch(data: InsertBranch): Promise<Branch> {\n    const result = await db.insert(branches).values(data).returning();\n    return result[0];\n  }\n\n  async updateBranch(id: string, data: Partial<InsertBranch>): Promise<Branch | undefined> {\n    const result = await db.update(branches).set(data).where(eq(branches.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteBranch(id: string): Promise<boolean> {\n    const result = await db.delete(branches).where(eq(branches.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // =========================================================================\n  // POSITION OPERATIONS\n  // =========================================================================\n  \n  async getAllPositions(): Promise<Position[]> {\n    return await db.select().from(positions).orderBy(positions.level);\n  }\n\n  async getPosition(id: string): Promise<Position | undefined> {\n    const result = await db.select().from(positions).where(eq(positions.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getPositionByLevel(level: number): Promise<Position | undefined> {\n    const result = await db.select().from(positions).where(eq(positions.level, level)).limit(1);\n    return result[0];\n  }\n\n  async createPosition(data: InsertPosition): Promise<Position> {\n    const result = await db.insert(positions).values(data).returning();\n    return result[0];\n  }\n\n  async updatePosition(id: string, data: Partial<InsertPosition>): Promise<Position | undefined> {\n    const result = await db.update(positions).set(data).where(eq(positions.id, id)).returning();\n    return result[0];\n  }\n\n  async deletePosition(id: string): Promise<boolean> {\n    const result = await db.delete(positions).where(eq(positions.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // =========================================================================\n  // EMPLOYEE OPERATIONS\n  // =========================================================================\n  \n  async getAllEmployees(): Promise<Employee[]> {\n    return await db.select().from(employees).orderBy(employees.fullName);\n  }\n\n  async getEmployee(id: string): Promise<Employee | undefined> {\n    const result = await db.select().from(employees).where(eq(employees.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getEmployeeByCode(code: string): Promise<Employee | undefined> {\n    const result = await db.select().from(employees).where(eq(employees.employeeCode, code)).limit(1);\n    return result[0];\n  }\n\n  async getEmployeesByBranch(branchId: string): Promise<Employee[]> {\n    return await db.select().from(employees).where(eq(employees.branchId, branchId)).orderBy(employees.fullName);\n  }\n\n  async getEmployeesByPosition(positionId: string): Promise<Employee[]> {\n    return await db.select().from(employees).where(eq(employees.positionId, positionId)).orderBy(employees.fullName);\n  }\n\n  async getEmployeesByManager(managerId: string): Promise<Employee[]> {\n    return await db.select().from(employees).where(eq(employees.managerId, managerId)).orderBy(employees.fullName);\n  }\n\n  async getEmployeesByCEOUnit(ceoUnitId: string): Promise<Employee[]> {\n    return await db.select().from(employees).where(eq(employees.ceoUnitId, ceoUnitId)).orderBy(employees.fullName);\n  }\n\n  async createEmployee(data: InsertEmployee): Promise<Employee> {\n    const result = await db.insert(employees).values(data).returning();\n    return result[0];\n  }\n\n  async updateEmployee(id: string, data: Partial<InsertEmployee>): Promise<Employee | undefined> {\n    const result = await db.update(employees).set(data).where(eq(employees.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteEmployee(id: string): Promise<boolean> {\n    const result = await db.delete(employees).where(eq(employees.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // =========================================================================\n  // EMPLOYEE HIERARCHY OPERATIONS\n  // =========================================================================\n  \n  async getSubordinates(employeeId: string): Promise<Employee[]> {\n    return await db.select().from(employees).where(eq(employees.managerId, employeeId)).orderBy(employees.fullName);\n  }\n\n  async getAllSubordinatesRecursive(employeeId: string): Promise<Employee[]> {\n    // Use parameterized query to prevent SQL injection\n    const query = sql`\n      WITH RECURSIVE subordinates AS (\n        SELECT * FROM employees\n        WHERE manager_id = ${employeeId}\n        \n        UNION ALL\n        \n        SELECT e.* FROM employees e\n        INNER JOIN subordinates s ON e.manager_id = s.id\n      )\n      SELECT * FROM subordinates\n      ORDER BY full_name\n    `;\n    \n    const result = await db.execute(query);\n    \n    // Map snake_case fields to camelCase to match Employee type\n    return (result.rows as any[]).map((row: any) => ({\n      id: row.id,\n      employeeCode: row.employee_code,\n      fullName: row.full_name,\n      email: row.email,\n      phone: row.phone,\n      dateOfBirth: row.date_of_birth,\n      ptId: row.pt_id,\n      branchId: row.branch_id,\n      positionId: row.position_id,\n      ceoUnitId: row.ceo_unit_id,\n      managerId: row.manager_id,\n      joinDate: row.join_date,\n      status: row.status,\n      createdAt: row.created_at,\n      updatedAt: row.updated_at,\n    }));\n  }\n\n  async getOrganizationTree(rootEmployeeId: string): Promise<any> {\n    // Fetch root employee and all subordinates in ONE query (no N+1 problem)\n    const rootEmployee = await this.getEmployee(rootEmployeeId);\n    if (!rootEmployee) return null;\n    \n    const allSubordinates = await this.getAllSubordinatesRecursive(rootEmployeeId);\n    \n    // Build tree from flat list using O(n) Map-based approach (no O(nÂ²) nested filters)\n    const buildTreeOptimized = (root: Employee, subordinates: Employee[]): any => {\n      // Create index: managerId -> children[]\n      const childrenMap = new Map<string, Employee[]>();\n      \n      for (const emp of subordinates) {\n        if (!emp.managerId) continue;\n        if (!childrenMap.has(emp.managerId)) {\n          childrenMap.set(emp.managerId, []);\n        }\n        childrenMap.get(emp.managerId)!.push(emp);\n      }\n      \n      // Recursive function to build tree nodes\n      const buildNode = (employee: Employee): any => {\n        const children = childrenMap.get(employee.id) || [];\n        return {\n          ...employee,\n          children: children.map(buildNode)\n        };\n      };\n      \n      return buildNode(root);\n    };\n    \n    return buildTreeOptimized(rootEmployee, allSubordinates);\n  }\n\n  // =========================================================================\n  // RBAC HELPER OPERATIONS\n  // =========================================================================\n  \n  async getEmployeeWithMetadata(employeeId: string): Promise<any | undefined> {\n    // Fetch employee with position, PT, branch, and CEO unit metadata in ONE query\n    const result = await db\n      .select({\n        employee: employees,\n        position: positions,\n        pt: pts,\n        branch: branches,\n        ceoUnit: ceoUnits,\n      })\n      .from(employees)\n      .leftJoin(positions, eq(employees.positionId, positions.id))\n      .leftJoin(pts, eq(employees.ptId, pts.id))\n      .leftJoin(branches, eq(employees.branchId, branches.id))\n      .leftJoin(ceoUnits, eq(employees.ceoUnitId, ceoUnits.id))\n      .where(eq(employees.id, employeeId))\n      .limit(1);\n    \n    if (result.length === 0) return undefined;\n    \n    const { employee, position, pt, branch, ceoUnit } = result[0];\n    return {\n      ...employee,\n      positionLevel: position?.level,\n      positionCode: position?.code,\n      positionName: position?.name,\n      ptCode: pt?.code,\n      ptName: pt?.name,\n      branchCode: branch?.code,\n      branchName: branch?.name,\n      ceoUnitName: ceoUnit?.name,\n    };\n  }\n\n  async canManageEmployee(managerId: string, targetEmployeeId: string): Promise<boolean> {\n    // Check if targetEmployee is a subordinate of manager (direct or indirect)\n    const subordinates = await this.getAllSubordinatesRecursive(managerId);\n    return subordinates.some(sub => sub.id === targetEmployeeId);\n  }\n\n  // =========================================================================\n  // MONTHLY PERFORMANCE OPERATIONS\n  // =========================================================================\n  \n  async getAllPerformance(): Promise<MonthlyPerformance[]> {\n    return await db.select().from(monthlyPerformance).orderBy(desc(monthlyPerformance.year), desc(monthlyPerformance.month));\n  }\n\n  async getPerformance(id: string): Promise<MonthlyPerformance | undefined> {\n    const result = await db.select().from(monthlyPerformance).where(eq(monthlyPerformance.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getPerformanceByEmployee(employeeId: string): Promise<MonthlyPerformance[]> {\n    return await db.select().from(monthlyPerformance)\n      .where(eq(monthlyPerformance.employeeId, employeeId))\n      .orderBy(desc(monthlyPerformance.year), desc(monthlyPerformance.month));\n  }\n\n  async getPerformanceByPeriod(employeeId: string, year: number, month: number): Promise<MonthlyPerformance | undefined> {\n    const result = await db.select().from(monthlyPerformance)\n      .where(and(\n        eq(monthlyPerformance.employeeId, employeeId),\n        eq(monthlyPerformance.year, year),\n        eq(monthlyPerformance.month, month)\n      ))\n      .limit(1);\n    return result[0];\n  }\n\n  async getQuarterlyPerformance(employeeId: string, year: number, quarter: number): Promise<MonthlyPerformance[]> {\n    return await db.select().from(monthlyPerformance)\n      .where(and(\n        eq(monthlyPerformance.employeeId, employeeId),\n        eq(monthlyPerformance.year, year),\n        eq(monthlyPerformance.quarter, quarter)\n      ))\n      .orderBy(monthlyPerformance.month);\n  }\n\n  async createPerformance(data: InsertMonthlyPerformance): Promise<MonthlyPerformance> {\n    const result = await db.insert(monthlyPerformance).values(data).returning();\n    return result[0];\n  }\n\n  async updatePerformance(id: string, data: Partial<InsertMonthlyPerformance>): Promise<MonthlyPerformance | undefined> {\n    const result = await db.update(monthlyPerformance).set(data).where(eq(monthlyPerformance.id, id)).returning();\n    return result[0];\n  }\n\n  async deletePerformance(id: string): Promise<boolean> {\n    const result = await db.delete(monthlyPerformance).where(eq(monthlyPerformance.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // =========================================================================\n  // AUDIT OPERATIONS\n  // =========================================================================\n  \n  async createAudit(data: InsertAudit): Promise<Audit> {\n    const result = await db.insert(audits).values(data).returning();\n    return result[0];\n  }\n\n  async getAudit(id: string): Promise<Audit | undefined> {\n    const result = await db.select().from(audits).where(eq(audits.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getAllAudits(includeDeleted: boolean = false): Promise<Audit[]> {\n    const whereClause = includeDeleted ? undefined : isNull(audits.deletedAt);\n    const result = await db\n      .select()\n      .from(audits)\n      .where(whereClause)\n      .orderBy(desc(audits.createdAt));\n    return result;\n  }\n\n  async getAuditsByEmployee(employeeId: string): Promise<Audit[]> {\n    return await db.select().from(audits)\n      .where(and(eq(audits.employeeId, employeeId), isNull(audits.deletedAt)))\n      .orderBy(desc(audits.year), desc(audits.quarter));\n  }\n\n  async getAuditByPeriod(employeeId: string, year: number, quarter: number): Promise<Audit | undefined> {\n    const result = await db.select().from(audits)\n      .where(and(\n        eq(audits.employeeId, employeeId),\n        eq(audits.year, year),\n        eq(audits.quarter, quarter),\n        isNull(audits.deletedAt)\n      ))\n      .limit(1);\n    return result[0];\n  }\n\n  async getAuditsForEmployeesInPeriod(employeeIds: string[], year: number, quarter: number): Promise<Audit[]> {\n    if (employeeIds.length === 0) return [];\n    \n    return await db.select().from(audits)\n      .where(and(\n        inArray(audits.employeeId, employeeIds),\n        eq(audits.year, year),\n        eq(audits.quarter, quarter),\n        isNull(audits.deletedAt)\n      ));\n  }\n\n  async updateAuditAggregation(id: string, marginTeamQ: string, naTeamQ: number, teamStructure: Audit['teamStructure']): Promise<Audit | undefined> {\n    const result = await db.update(audits)\n      .set({ \n        marginTeamQ, \n        naTeamQ, \n        teamStructure \n      })\n      .where(eq(audits.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async getAuditWithEmployee(id: string): Promise<AuditDetailDto | undefined> {\n    const result = await db\n      .select()\n      .from(audits)\n      .leftJoin(employees, eq(audits.employeeId, employees.id))\n      .leftJoin(positions, eq(employees.positionId, positions.id))\n      .leftJoin(pts, eq(employees.ptId, pts.id))\n      .leftJoin(branches, eq(employees.branchId, branches.id))\n      .where(eq(audits.id, id))\n      .limit(1);\n    \n    if (!result || result.length === 0) return undefined;\n    \n    const row = result[0];\n    const audit = row.audits;\n    const emp = row.employees;\n    const pos = row.positions;\n    const pt = row.pts;\n    const branch = row.branches;\n    \n    if (!audit || !emp) return undefined;\n    \n    return {\n      ...audit,\n      employee: {\n        id: emp.id,\n        employeeCode: emp.employeeCode,\n        fullName: emp.fullName,\n        email: emp.email,\n        phone: emp.phone,\n        position: pos ? {\n          id: pos.id,\n          code: pos.code,\n          name: pos.name,\n          level: pos.level,\n        } : null,\n        pt: pt ? {\n          id: pt.id,\n          code: pt.code,\n          name: pt.name,\n        } : null,\n        branch: branch ? {\n          id: branch.id,\n          code: branch.code,\n          name: branch.name,\n        } : null,\n      }\n    };\n  }\n\n  async updateAuditReport(id: string, data: {\n    zonaKinerja: Audit['zonaKinerja'];\n    zonaPerilaku: Audit['zonaPerilaku'];\n    zonaFinal: Audit['zonaFinal'];\n    profil: Audit['profil'];\n    prodemRekomendasi: Audit['prodemRekomendasi'];\n    auditReport: Audit['auditReport'];\n  }): Promise<Audit | undefined> {\n    const result = await db.update(audits)\n      .set({\n        zonaKinerja: data.zonaKinerja,\n        zonaPerilaku: data.zonaPerilaku,\n        zonaFinal: data.zonaFinal,\n        profil: data.profil,\n        prodemRekomendasi: data.prodemRekomendasi as any,\n        auditReport: data.auditReport as any,\n      })\n      .where(eq(audits.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async softDeleteAudit(id: string, deletedById: string, reason: string): Promise<void> {\n    await db\n      .update(audits)\n      .set({\n        deletedAt: new Date(),\n        deletedById,\n        deletedReason: reason,\n      })\n      .where(eq(audits.id, id));\n  }\n\n  async hardDeleteAudit(id: string): Promise<void> {\n    await db.delete(chatMessages).where(eq(chatMessages.auditId, id));\n    await db.delete(audits).where(eq(audits.id, id));\n  }\n\n  // =========================================================================\n  // CHAT OPERATIONS\n  // =========================================================================\n  \n  async createChatMessage(data: InsertChatMessage): Promise<ChatMessage> {\n    const result = await db.insert(chatMessages).values(data).returning();\n    return result[0];\n  }\n\n  async getChatHistory(auditId: string): Promise<ChatMessage[]> {\n    const result = await db\n      .select()\n      .from(chatMessages)\n      .where(eq(chatMessages.auditId, auditId))\n      .orderBy(chatMessages.createdAt);\n    return result;\n  }\n\n  async deleteChatHistory(auditId: string): Promise<void> {\n    await db.delete(chatMessages).where(eq(chatMessages.auditId, auditId));\n  }\n}\n\nexport const storage = new DbStorage();\n","size_bytes":25460},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  BarChart3,\n  Users,\n  TrendingUp,\n  Award,\n  Plus,\n  AlertTriangle,\n  CheckCircle2,\n  XCircle,\n} from \"lucide-react\";\nimport { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip, LineChart, Line, XAxis, YAxis, CartesianGrid, BarChart, Bar } from \"recharts\";\nimport type { AuditDetailDto } from \"@shared/types\";\n\nexport default function Dashboard() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n\n  // Fetch user's employee data to get their audits\n  const { data: employee } = useQuery<{\n    id: string;\n    fullName: string;\n    position: { name: string; level: number };\n  }>({\n    queryKey: [`/api/enterprise/employees/by-user/${user?.id}`],\n    enabled: !!user?.id,\n  });\n\n  // Fetch audits for current employee\n  const { data: audits = [], isLoading } = useQuery<AuditDetailDto[]>({\n    queryKey: [\"/api/enterprise/audits/employee\", employee?.id],\n    queryFn: async () => {\n      const res = await fetch(`/api/enterprise/audits/employee/${employee!.id}`);\n      if (!res.ok) {\n        throw new Error(`HTTP ${res.status}`);\n      }\n      return await res.json();\n    },\n    enabled: !!employee?.id,\n  });\n\n  // Calculate statistics\n  const totalAudits = audits.length;\n  \n  // Zone distribution\n  const zonaDistribution = {\n    hijau: audits.filter((a) => a.zonaFinal === \"hijau\").length,\n    kuning: audits.filter((a) => a.zonaFinal === \"kuning\").length,\n    merah: audits.filter((a) => a.zonaFinal === \"merah\").length,\n  };\n\n  const zonaPercentages = {\n    hijau: totalAudits > 0 ? ((zonaDistribution.hijau / totalAudits) * 100).toFixed(1) : \"0\",\n    kuning: totalAudits > 0 ? ((zonaDistribution.kuning / totalAudits) * 100).toFixed(1) : \"0\",\n    merah: totalAudits > 0 ? ((zonaDistribution.merah / totalAudits) * 100).toFixed(1) : \"0\",\n  };\n\n  // Pie chart data for zone distribution\n  const pieData = [\n    { name: \"Success (Hijau)\", value: zonaDistribution.hijau, color: \"#10b981\" },\n    { name: \"Warning (Kuning)\", value: zonaDistribution.kuning, color: \"#f59e0b\" },\n    { name: \"Critical (Merah)\", value: zonaDistribution.merah, color: \"#ef4444\" },\n  ].filter(item => item.value > 0);\n\n  // Performance trends (quarterly)\n  const trendData = audits\n    .sort((a, b) => {\n      if (a.year !== b.year) return a.year - b.year;\n      return a.quarter - b.quarter;\n    })\n    .map((audit) => ({\n      period: `Q${audit.quarter} ${audit.year}`,\n      marginPersonal: parseFloat(audit.marginPersonalQ || \"0\"),\n      marginTeam: parseFloat(audit.marginTeamQ || \"0\"),\n      naPersonal: audit.naPersonalQ || 0,\n      naTeam: audit.naTeamQ || 0,\n    }));\n\n  // Top performers (if user can see subordinates - for future enhancement)\n  const pendingReviews = audits.filter(\n    (a) => a.prodemRekomendasi.recommendation === \"Promosi\" || \n           a.prodemRekomendasi.recommendation === \"Demosi\"\n  ).length;\n\n  const formatDate = (date: string | Date) => {\n    const dateObj = typeof date === \"string\" ? new Date(date) : date;\n    return dateObj.toLocaleDateString(\"id-ID\", {\n      day: \"numeric\",\n      month: \"short\",\n      year: \"numeric\",\n    });\n  };\n\n  const CustomTooltip = ({ active, payload }: any) => {\n    if (active && payload && payload.length) {\n      return (\n        <div className=\"bg-card border border-border rounded-lg p-3 shadow-lg\">\n          <p className=\"text-sm font-medium\">{payload[0].name}</p>\n          <p className=\"text-lg font-bold text-primary\">{payload[0].value}</p>\n        </div>\n      );\n    }\n    return null;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero Section */}\n      <div className=\"bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 border-b border-amber-500/20\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 md:px-8 py-8 sm:py-12 md:py-16\">\n          <div className=\"text-center space-y-4 sm:space-y-6\">\n            {/* Logo */}\n            <div className=\"flex justify-center\">\n              <div className=\"relative w-32 h-32 sm:w-40 sm:h-40 md:w-48 md:h-48\">\n                <div className=\"absolute inset-0 bg-gradient-to-br from-red-500/40 via-orange-500/30 to-amber-500/40 rounded-full blur-2xl animate-pulse\" />\n                <div className=\"relative w-full h-full rounded-full overflow-hidden shadow-2xl ring-2 ring-amber-500/30\">\n                  <img\n                    src=\"/logo-aisg.jpg\"\n                    alt=\"AiSG Logo\"\n                    className=\"w-full h-full object-cover\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* Title */}\n            <div className=\"space-y-2\">\n              <h1 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-white\">\n                AiSG â€“ Audit Intelligence System Growth\n              </h1>\n              {employee && (\n                <p className=\"text-lg text-gray-300\">\n                  Welcome back, <span className=\"font-semibold text-amber-400\">{employee.fullName}</span>\n                </p>\n              )}\n            </div>\n\n            {/* Description */}\n            <div className=\"max-w-3xl mx-auto\">\n              <p className=\"text-xs sm:text-sm md:text-base text-gray-200 leading-relaxed px-4\">\n                A breakthrough AI system that helps you discover hidden potential & elevate performance.\n              </p>\n              <p className=\"text-xs sm:text-sm text-gray-400 mt-3\">\n                **Powered by Newsmaker.id Ã— AiSG Team Ã— ChatGPTâ€“OpenAI**\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto p-4 sm:p-6 md:p-8 space-y-6 sm:space-y-8\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h2 className=\"text-xl sm:text-2xl font-bold tracking-tight mb-2 bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-600 bg-clip-text text-transparent\">\n              Dashboard Analytics\n            </h2>\n            <p className=\"text-sm sm:text-base text-muted-foreground\">\n              Sistem Audit Intelligence untuk Evaluasi Kinerja & Kepemimpinan\n            </p>\n          </div>\n          <Button\n            className=\"gap-2 bg-gradient-to-r from-amber-500 to-yellow-600 hover:from-amber-600 hover:to-yellow-700 text-gray-900 font-semibold shadow-lg shadow-amber-500/30\"\n            data-testid=\"button-new-audit\"\n            onClick={() => setLocation(\"/audit/new\")}\n          >\n            <Plus className=\"w-4 h-4\" />\n            Audit Baru\n          </Button>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6\">\n          <Card data-testid=\"stat-total-audits\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Audit</CardTitle>\n              <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{totalAudits}</div>\n              <p className=\"text-xs text-muted-foreground\">Audit selesai</p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"stat-zona-hijau\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Success Zone</CardTitle>\n              <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-500\">\n                {zonaPercentages.hijau}%\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                {zonaDistribution.hijau} audit hijau\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"stat-zona-kuning\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Warning Zone</CardTitle>\n              <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-yellow-500\">\n                {zonaPercentages.kuning}%\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                {zonaDistribution.kuning} audit kuning\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"stat-pending-review\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Pending Review</CardTitle>\n              <Award className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{pendingReviews}</div>\n              <p className=\"text-xs text-muted-foreground\">ProDem rekomendasi</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Analytics Tabs */}\n        <Tabs defaultValue=\"overview\" className=\"space-y-4\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">Overview</TabsTrigger>\n            <TabsTrigger value=\"trends\" data-testid=\"tab-trends\">Trends</TabsTrigger>\n            <TabsTrigger value=\"history\" data-testid=\"tab-history\">History</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-4\">\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              {/* Zone Distribution Pie Chart */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Distribusi Zona</CardTitle>\n                  <CardDescription>\n                    Perbandingan zona Success, Warning, dan Critical\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"h-[300px]\">\n                  {pieData.length > 0 ? (\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <PieChart>\n                        <Pie\n                          data={pieData}\n                          cx=\"50%\"\n                          cy=\"50%\"\n                          labelLine={false}\n                          label={({ name, percent }) =>\n                            `${name}: ${(percent * 100).toFixed(0)}%`\n                          }\n                          outerRadius={80}\n                          fill=\"#8884d8\"\n                          dataKey=\"value\"\n                        >\n                          {pieData.map((entry, index) => (\n                            <Cell key={`cell-${index}`} fill={entry.color} />\n                          ))}\n                        </Pie>\n                        <Tooltip content={<CustomTooltip />} />\n                        <Legend />\n                      </PieChart>\n                    </ResponsiveContainer>\n                  ) : (\n                    <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                      Belum ada data audit\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Zone Breakdown Bar Chart */}\n              <Card>\n                <CardHeader>\n                  <CardTitle>Breakdown Zona</CardTitle>\n                  <CardDescription>\n                    Jumlah audit per kategori zona\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"h-[300px]\">\n                  {totalAudits > 0 ? (\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                      <BarChart\n                        data={[\n                          { zona: \"Hijau\", jumlah: zonaDistribution.hijau, fill: \"#10b981\" },\n                          { zona: \"Kuning\", jumlah: zonaDistribution.kuning, fill: \"#f59e0b\" },\n                          { zona: \"Merah\", jumlah: zonaDistribution.merah, fill: \"#ef4444\" },\n                        ]}\n                      >\n                        <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                        <XAxis dataKey=\"zona\" />\n                        <YAxis />\n                        <Tooltip content={<CustomTooltip />} />\n                        <Bar dataKey=\"jumlah\" fill=\"#8884d8\" radius={[8, 8, 0, 0]}>\n                          {[\n                            { zona: \"Hijau\", jumlah: zonaDistribution.hijau, fill: \"#10b981\" },\n                            { zona: \"Kuning\", jumlah: zonaDistribution.kuning, fill: \"#f59e0b\" },\n                            { zona: \"Merah\", jumlah: zonaDistribution.merah, fill: \"#ef4444\" },\n                          ].map((entry, index) => (\n                            <Cell key={`cell-${index}`} fill={entry.fill} />\n                          ))}\n                        </Bar>\n                      </BarChart>\n                    </ResponsiveContainer>\n                  ) : (\n                    <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                      Belum ada data audit\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"trends\" className=\"space-y-4\">\n            {/* Performance Trends Line Chart */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Trend Performa Quarterly</CardTitle>\n                <CardDescription>\n                  Perkembangan margin personal & team dari waktu ke waktu\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"h-[400px]\">\n                {trendData.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <LineChart data={trendData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis dataKey=\"period\" />\n                      <YAxis />\n                      <Tooltip content={<CustomTooltip />} />\n                      <Legend />\n                      <Line\n                        type=\"monotone\"\n                        dataKey=\"marginPersonal\"\n                        stroke=\"#f59e0b\"\n                        strokeWidth={2}\n                        name=\"Margin Personal\"\n                        dot={{ r: 4 }}\n                      />\n                      <Line\n                        type=\"monotone\"\n                        dataKey=\"marginTeam\"\n                        stroke=\"#10b981\"\n                        strokeWidth={2}\n                        name=\"Margin Team\"\n                        dot={{ r: 4 }}\n                      />\n                    </LineChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                    Belum ada data trend\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* NA Trends */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Trend NA (Nomor Akun)</CardTitle>\n                <CardDescription>\n                  Perkembangan jumlah NA personal & team\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"h-[400px]\">\n                {trendData.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <LineChart data={trendData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis dataKey=\"period\" />\n                      <YAxis />\n                      <Tooltip content={<CustomTooltip />} />\n                      <Legend />\n                      <Line\n                        type=\"monotone\"\n                        dataKey=\"naPersonal\"\n                        stroke=\"#f59e0b\"\n                        strokeWidth={2}\n                        name=\"NA Personal\"\n                        dot={{ r: 4 }}\n                      />\n                      <Line\n                        type=\"monotone\"\n                        dataKey=\"naTeam\"\n                        stroke=\"#10b981\"\n                        strokeWidth={2}\n                        name=\"NA Team\"\n                        dot={{ r: 4 }}\n                      />\n                    </LineChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                    Belum ada data trend\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"history\" className=\"space-y-4\">\n            {/* Audit History List */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Riwayat Audit</CardTitle>\n                <CardDescription>\n                  Daftar lengkap audit yang telah selesai\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoading ? (\n                  <div className=\"space-y-4\">\n                    {[1, 2, 3].map((i) => (\n                      <div key={i} className=\"h-24 bg-muted rounded-lg animate-pulse\" />\n                    ))}\n                  </div>\n                ) : audits.length === 0 ? (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <p className=\"text-lg mb-2\">Belum ada audit</p>\n                    <p className=\"text-sm\">\n                      Klik \"Audit Baru\" untuk memulai audit pertama Anda\n                    </p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {audits.map((audit) => (\n                      <div\n                        key={audit.id}\n                        className=\"border border-border rounded-lg p-4 hover-elevate active-elevate-2 cursor-pointer transition-all\"\n                        onClick={() => setLocation(`/audit/${audit.id}`)}\n                        data-testid={`audit-card-${audit.id}`}\n                      >\n                        <div className=\"flex items-start justify-between gap-4\">\n                          <div className=\"space-y-1 flex-1\">\n                            <h3 className=\"font-semibold text-lg\">\n                              {audit.employee.fullName}\n                            </h3>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {audit.employee.position?.name || \"No Position\"} â€¢{\" \"}\n                              {audit.employee.branch?.name || \"No Branch\"}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground\">\n                              Q{audit.quarter} {audit.year} â€¢ {formatDate(audit.createdAt)}\n                            </p>\n                          </div>\n\n                          <div className=\"flex flex-col items-end gap-2\">\n                            <div\n                              className={`px-3 py-1 rounded-full text-xs font-medium ${\n                                audit.zonaFinal === \"hijau\"\n                                  ? \"bg-green-500/20 text-green-400\"\n                                  : audit.zonaFinal === \"kuning\"\n                                  ? \"bg-yellow-500/20 text-yellow-400\"\n                                  : \"bg-red-500/20 text-red-400\"\n                              }`}\n                            >\n                              {audit.zonaFinal === \"hijau\"\n                                ? \"ðŸŸ© Success\"\n                                : audit.zonaFinal === \"kuning\"\n                                ? \"ðŸŸ¨ Warning\"\n                                : \"ðŸŸ¥ Critical\"}\n                            </div>\n                            {audit.profil && typeof audit.profil === 'object' && (audit.profil as any).profileName && (\n                              <div className=\"text-xs text-muted-foreground\">\n                                {(audit.profil as any).profileName}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":21006},"client/src/components/ProDemCard.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, TrendingDown, AlertCircle } from \"lucide-react\";\n\ninterface ProDemCardProps {\n  currentLevel: string;\n  recommendation: \"Promosi\" | \"Pertahankan\" | \"Demosi\";\n  nextLevel?: string;\n  reason: string;\n  requirements?: Array<{ label: string; value: string; met: boolean }>;\n  \"data-testid\"?: string;\n}\n\nexport default function ProDemCard({\n  currentLevel,\n  recommendation,\n  nextLevel,\n  reason,\n  requirements,\n  \"data-testid\": testId\n}: ProDemCardProps) {\n  const config = {\n    Promosi: {\n      icon: TrendingUp,\n      className: \"bg-zone-success/10 border-zone-success/30 text-zone-success\",\n      badgeClassName: \"bg-zone-success text-zone-success-foreground\"\n    },\n    Pertahankan: {\n      icon: AlertCircle,\n      className: \"bg-zone-warning/10 border-zone-warning/30 text-zone-warning\",\n      badgeClassName: \"bg-zone-warning text-zone-warning-foreground\"\n    },\n    Demosi: {\n      icon: TrendingDown,\n      className: \"bg-zone-critical/10 border-zone-critical/30 text-zone-critical\",\n      badgeClassName: \"bg-zone-critical text-zone-critical-foreground\"\n    }\n  };\n\n  const { icon: Icon, className, badgeClassName } = config[recommendation];\n\n  return (\n    <Card className={`p-6 border ${className}`} data-testid={testId}>\n      <div className=\"flex items-start gap-4 mb-4\">\n        <div className=\"rounded-lg bg-current/10 p-3\">\n          <Icon className=\"w-6 h-6\" />\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-lg\">Rekomendasi ProDem</h3>\n            <Badge className={badgeClassName} data-testid={`${testId}-recommendation`}>\n              {recommendation}\n            </Badge>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <span className=\"text-muted-foreground\">Posisi saat ini:</span>\n            <span className=\"font-medium\">{currentLevel}</span>\n            {nextLevel && (\n              <>\n                <span className=\"text-muted-foreground\">â†’</span>\n                <span className=\"font-semibold\">{nextLevel}</span>\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        <div>\n          <p className=\"text-sm font-medium mb-2 text-muted-foreground\">Alasan:</p>\n          <p className=\"text-sm leading-relaxed\" data-testid={`${testId}-reason`}>{reason}</p>\n        </div>\n\n        {requirements && requirements.length > 0 && (\n          <div>\n            <p className=\"text-sm font-medium mb-3 text-muted-foreground\">Persyaratan:</p>\n            <div className=\"space-y-2\">\n              {requirements.map((req, idx) => (\n                <div \n                  key={idx} \n                  className=\"flex items-center justify-between text-sm p-2 rounded-md bg-card/50\"\n                  data-testid={`${testId}-requirement-${idx}`}\n                >\n                  <span className=\"text-muted-foreground\">{req.label}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium\">{req.value}</span>\n                    <span className={`text-xs ${req.met ? \"text-zone-success\" : \"text-zone-critical\"}`}>\n                      {req.met ? \"âœ“\" : \"âœ—\"}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </Card>\n  );\n}\n","size_bytes":3540},"server/knowledge-base.ts":{"content":"/**\n * Internal Knowledge Base for AiSG AI Coach\n * Provides fallback responses when external AI APIs are unavailable\n */\n\ninterface KnowledgeEntry {\n  keywords: string[];\n  response: string;\n  category: string;\n}\n\nexport const knowledgeBase: KnowledgeEntry[] = [\n  // Leadership & Management\n  {\n    keywords: [\"leadership\", \"kepemimpinan\", \"memimpin\", \"leader\", \"pimpin tim\"],\n    category: \"Leadership\",\n    response: `**Leadership & Kepemimpinan**\n\nBerdasarkan hasil audit Anda, berikut tips meningkatkan kepemimpinan:\n\n**1. Vision & Direction**\n- Buat visi jelas untuk tim\n- Komunikasikan goal secara konsisten\n- Jadilah role model dalam action\n\n**2. Team Empowerment**\n- Delegasi tugas sesuai kekuatan masing-masing\n- Berikan feedback konstruktif regular\n- Ciptakan environment yang supportif\n\n**3. Decision Making**\n- Ambil keputusan berdasarkan data\n- Libatkan tim dalam brainstorming\n- Berani ambil tanggung jawab atas hasil\n\nTerapkan ini di action plan 30 hari pertama Anda untuk hasil maksimal.`\n  },\n  {\n    keywords: [\"teamwork\", \"kerja sama\", \"kolaborasi\", \"tim\", \"team building\"],\n    category: \"Teamwork\",\n    response: `**Teamwork & Kolaborasi**\n\nKunci membangun tim yang solid:\n\n**1. Komunikasi Efektif**\n- Daily standup meeting (15 menit)\n- Open communication channel (WhatsApp/Telegram grup)\n- Active listening dalam setiap diskusi\n\n**2. Trust Building**\n- Transparansi dalam informasi\n- Deliver on promises\n- Celebrate wins bersama\n\n**3. Conflict Resolution**\n- Address issues segera, jangan ditunda\n- Focus on solution, bukan blame\n- Win-win mindset\n\nTim yang kuat = performance yang kuat. Mulai dari membangun trust hari ini!`\n  },\n  {\n    keywords: [\"public speaking\", \"presentasi\", \"berbicara di depan umum\", \"pidato\"],\n    category: \"Public Speaking\",\n    response: `**Public Speaking & Presentation Skills**\n\nTips meningkatkan kemampuan berbicara di depan umum:\n\n**1. Preparation**\n- Pahami audience Anda\n- Structure: Opening (hook) â†’ Body (value) â†’ Closing (call-to-action)\n- Practice 3-5 kali sebelum presentasi\n\n**2. Delivery**\n- Kontak mata dengan audience\n- Gunakan body language yang confident\n- Pace: tidak terlalu cepat, pakai pause\n\n**3. Confidence Building**\n- Mulai dari audience kecil\n- Record practice Anda, evaluasi\n- Focus pada message, bukan perfection\n\nPractice makes progress. Setiap presentasi adalah kesempatan belajar!`\n  },\n\n  // Sales & Marketing\n  {\n    keywords: [\"closing\", \"closing power\", \"menutup penjualan\", \"deal\", \"sales\"],\n    category: \"Sales - Closing\",\n    response: `**Closing Power - Menutup Penjualan**\n\nTeknik closing yang terbukti efektif:\n\n**1. Trial Close Technique**\n- \"Bagaimana menurut Anda sejauh ini?\"\n- Ukur interest level sebelum final close\n\n**2. Assumptive Close**\n- \"Kapan Anda ingin mulai?\"\n- Assume mereka sudah setuju\n\n**3. Alternative Close**\n- \"Lebih prefer paket A atau B?\"\n- Beri pilihan, bukan yes/no\n\n**4. Urgency Close**\n- \"Promo ini hanya sampai akhir bulan\"\n- Create sense of urgency\n\n**Tips Penting:**\n- Handle objections dengan empati\n- Don't be pushy, be consultative\n- Follow up adalah kunci!\n\nClosing bukan soal manipulasi, tapi helping customer make decision.`\n  },\n  {\n    keywords: [\"kepercayaan diri\", \"confidence\", \"percaya diri\", \"self confidence\"],\n    category: \"Personal Development\",\n    response: `**Meningkatkan Kepercayaan Diri**\n\nStrategi membangun confidence:\n\n**1. Small Wins Strategy**\n- Set achievable daily targets\n- Celebrate setiap pencapaian kecil\n- Build momentum dari success\n\n**2. Competence = Confidence**\n- Master your product knowledge\n- Practice your pitch daily\n- Terus upgrade skills\n\n**3. Positive Self-Talk**\n- Replace \"Saya tidak bisa\" â†’ \"Saya sedang belajar\"\n- Visualisasi success sebelum action\n- Fokus pada progress, bukan perfection\n\n**4. Physical Confidence**\n- Power pose sebelum meeting penting\n- Dress professionally\n- Maintain good posture\n\nRemember: Confidence bukan tentang never feeling fear, tapi taking action despite the fear!`\n  },\n  {\n    keywords: [\"marketing\", \"pemasaran\", \"promosi\", \"market\"],\n    category: \"Marketing\",\n    response: `**Marketing Skills - Fundamental**\n\nFramework marketing yang efektif:\n\n**1. Know Your Market**\n- Identifikasi target customer\n- Pahami pain points mereka\n- Research competitor\n\n**2. Value Proposition**\n- Apa unique selling point Anda?\n- Benefit apa yang customer dapat?\n- Why choose you vs competitor?\n\n**3. Multi-Channel Approach**\n- Social media (Instagram, Facebook, LinkedIn)\n- WhatsApp Business\n- Networking events\n- Referral program\n\n**4. Content Marketing**\n- Edukasi, bukan hard-selling\n- Share success stories\n- Provide value first\n\nMarketing bukan soal selling, tapi soal creating demand dan building trust.`\n  },\n  {\n    keywords: [\"contacting\", \"prospecting\", \"mencari nasabah\", \"cari calon\", \"database\"],\n    category: \"Prospecting\",\n    response: `**Contacting & Prospecting - Mencari Calon Nasabah**\n\nStrategi efektif mencari prospek:\n\n**1. Sumber Database**\n- Network pribadi (family, friends)\n- LinkedIn connections\n- Community groups\n- Business events/seminars\n- Alumni network\n\n**2. Qualification (BANT)**\n- **B**udget: Ada kemampuan finansial?\n- **A**uthority: Decision maker?\n- **N**eed: Ada kebutuhan product?\n- **T**imeline: Kapan butuhnya?\n\n**3. First Contact Script**\n\"Hi [Nama], saya [Nama Anda] dari [Company]. Saya lihat Anda [reason]. Boleh saya sharing 5 menit tentang [value proposition]?\"\n\n**4. Follow Up System**\n- Day 1: Initial contact\n- Day 3: Follow up email/WA\n- Day 7: Value-add content\n- Day 14: Re-engage\n\n**Pro Tip:** 80% penjualan terjadi di follow up ke-5, jangan give up too early!`\n  },\n\n  // Team Building & Recruitment\n  {\n    keywords: [\"keep staff\", \"retain\", \"mempertahankan karyawan\", \"staff retention\"],\n    category: \"Team Management\",\n    response: `**Cara Keep Staff / Retain Karyawan**\n\nStrategi mempertahankan anggota tim terbaik:\n\n**1. Recognition & Appreciation**\n- Apresiasi achievement (public recognition)\n- Bonus/reward untuk top performers\n- Personal thank you notes\n\n**2. Growth Opportunities**\n- Training & development program\n- Clear career path\n- Mentorship dari senior\n\n**3. Work Environment**\n- Positive team culture\n- Work-life balance\n- Open communication\n\n**4. Compensation Review**\n- Regular performance review\n- Competitive commission structure\n- Incentive untuk longevity\n\n**5. Belonging**\n- Team bonding activities\n- Include dalam decision making\n- Create family-like atmosphere\n\nPeople don't leave companies, they leave managers. Be the leader people want to stay for.`\n  },\n  {\n    keywords: [\"recruitment\", \"rekrut\", \"hiring\", \"cari staff\", \"tanpa gaji\", \"komisi\"],\n    category: \"Recruitment\",\n    response: `**Recruitment Staff Tanpa Gaji (Base on Komisi)**\n\nStrategi merekrut dengan compensation berbasis komisi:\n\n**1. Value Proposition**\n- Highlight: Unlimited earning potential\n- Success stories staff yang sukses\n- Training & mentoring FREE\n- Flexibility waktu kerja\n\n**2. Target Prospek yang Tepat**\n- Fresh graduate yang hungry\n- Career switcher yang motivated\n- Entrepreneur mindset\n- Part-timer yang cari extra income\n\n**3. Recruitment Script**\n\"Saya cari partner bisnis yang mau grow bersama. Modal: nol. Yang dibutuhkan: willing to learn & work hard. Potensi income: unlimited. Tertarik diskusi 15 menit?\"\n\n**4. Selection Process**\n- Interview: assess attitude > skill\n- Trial period 30 hari\n- Buddy system (pairing dengan senior)\n\n**5. Support System**\n- Comprehensive training program\n- Weekly coaching sessions\n- Quick wins dalam 7 hari pertama\n- Team support 24/7\n\n**Mindset:** You're not hiring employees, you're building business partners. Invest in their success!`\n  },\n\n  // Planning & Strategy\n  {\n    keywords: [\"planning\", \"rencana kerja\", \"work plan\", \"strategi\", \"target\"],\n    category: \"Planning\",\n    response: `**Membuat Planning Kerja yang Efektif**\n\nFramework 30-60-90 Day Plan:\n\n**30 Hari Pertama (Learn)**\n- Product knowledge mastery\n- Observe top performers\n- Build database 50+ contacts\n- Target: 3 closing\n\n**60 Hari (Execute)**\n- Implement best practices\n- Expand network\n- Refine your pitch\n- Target: 6 closing\n\n**90 Hari (Lead)**\n- Share knowledge dengan team\n- Recruit 1-2 new members\n- Optimize process\n- Target: 10 closing\n\n**Daily Structure:**\n- 08:00-10:00: Prospecting & calling\n- 10:00-12:00: Appointments\n- 12:00-13:00: Break\n- 13:00-16:00: Follow ups & meetings\n- 16:00-17:00: Admin & planning next day\n\n**Weekly Review:**\n- What worked well?\n- What needs improvement?\n- Adjust plan accordingly\n\nPlan your work, then work your plan!`\n  },\n  {\n    keywords: [\"trading plan\", \"financial plan\", \"margin\", \"target keuangan\"],\n    category: \"Financial Planning\",\n    response: `**Trading Plan & Target Keuangan**\n\nMembuat trading plan yang realistis:\n\n**1. Set SMART Goals**\n- Specific: Target margin Rp X per bulan\n- Measurable: Track weekly progress\n- Achievable: Based on history & capability\n- Relevant: Align dengan team target\n- Time-bound: Quarterly milestones\n\n**2. Income Breakdown**\n- Personal sales: 60%\n- Team override: 30%\n- Bonuses: 10%\n\n**3. Activity Metrics**\n- Berapa prospect perlu dihubungi untuk 1 closing?\n- Jika target 10 closing/bulan = berapa daily activity?\n- Track conversion rate\n\n**4. Risk Management**\n- Diversifikasi source of income\n- Build emergency fund\n- Reinvest in business development\n\n**5. Monthly Review**\n- Actual vs Target\n- Adjust strategy if needed\n- Identify bottlenecks\n\nFormula Success: Consistent Activity + Quality Execution = Target Achievement!`\n  },\n\n  // General Improvement\n  {\n    keywords: [\"improvement\", \"perbaikan\", \"meningkatkan\", \"develop\", \"grow\"],\n    category: \"General\",\n    response: `**Strategi Improvement Berdasarkan Audit**\n\nBerdasarkan hasil audit Anda, fokus pada 3 area ini:\n\n**1. Identifikasi Gap**\n- Lihat pilar dengan score terendah\n- Itu adalah priority improvement area\n- Focus on fixing 1-2 pilar per bulan\n\n**2. Action Plan**\n- Gunakan Action Plan 30-60-90 dari audit\n- Set specific daily/weekly tasks\n- Measure progress regularly\n\n**3. Leverage Strengths**\n- Maksimalkan pilar dengan score tinggi\n- Use strengths untuk compensate weakness\n- Share best practices dengan team\n\n**4. Continuous Learning**\n- Product knowledge updates\n- Sales technique workshops\n- Leadership development\n\n**5. Accountability**\n- Weekly check-in dengan mentor\n- Share progress dengan team\n- Celebrate small wins\n\nImprovement adalah journey, bukan destination. Consistent small steps > big plans without action!`\n  },\n\n  // SWOT & Analysis\n  {\n    keywords: [\"swot\", \"strength\", \"weakness\", \"kekuatan\", \"kelemahan\"],\n    category: \"Analysis\",\n    response: `**Memahami SWOT Analysis Anda**\n\nCara memanfaatkan SWOT untuk improvement:\n\n**Strengths (Kekuatan)**\n- Maximize: Gunakan setiap hari\n- Monetize: Convert jadi competitive advantage\n- Share: Ajarkan ke team\n\n**Weaknesses (Kelemahan)**\n- Acknowledge: Jujur pada diri sendiri\n- Improve: Buat specific action plan\n- Delegate: Partner dengan yang kuat di area ini\n\n**Opportunities (Peluang)**\n- Act Fast: First mover advantage\n- Prepare: Build capability sekarang\n- Network: Connect dengan opportunity\n\n**Threats (Ancaman)**\n- Monitor: Stay alert\n- Mitigate: Buat contingency plan\n- Adapt: Be flexible\n\nStrategy: Play to your strengths, manage weaknesses, seize opportunities, prepare for threats.`\n  },\n\n  // Zona Performance\n  {\n    keywords: [\"zona\", \"zone\", \"merah\", \"kuning\", \"hijau\", \"performance\"],\n    category: \"Performance\",\n    response: `**Memahami Zona Performance**\n\nStrategi untuk setiap zona:\n\n**Zona Merah (Critical)**\n- **Immediate Action Required!**\n- Focus 100% pada improvement\n- Daily coaching session\n- Simplify tasks, master basics\n- Set micro-targets (daily wins)\n\n**Zona Kuning (Warning)**\n- **Stabilkan dulu, baru scale**\n- Identify specific gap\n- Implement Action Plan 30-60\n- Peer learning dengan top performer\n- Consistent execution\n\n**Zona Hijau (Success)**\n- **Maintain & Expand**\n- Share best practices\n- Mentor junior team members\n- Aim for next level (ProDem)\n- Explore new opportunities\n\nRemember: Zona bukan label permanen, tapi snapshot saat ini. Dengan action yang tepat, semua bisa improve!`\n  },\n\n  // ProDem Recommendation\n  {\n    keywords: [\"prodem\", \"promosi\", \"demosi\", \"promotion\", \"naik jabatan\"],\n    category: \"Career\",\n    response: `**Memahami ProDem Recommendation**\n\n**Promosi:**\n- Pertahankan consistency\n- Document achievements\n- Prepare untuk tanggung jawab lebih besar\n- Mentor potential successors\n- Timeline: 3-6 bulan dengan performance konsisten\n\n**Pertahankan:**\n- Stabilkan performance\n- Strengthen weak areas\n- Build track record\n- Show improvement trend\n- Timeline: Review quarterly\n\n**Pembinaan:**\n- Terima feedback dengan positive mindset\n- Focus pada action plan\n- Daily improvement\n- Seek mentorship\n- Timeline: 90 hari untuk turnaround\n\n**Demosi/Mutasi:**\n- Evaluasi apakah fit dengan role\n- Consider career pivot\n- Fresh start opportunity\n- Learn dari experience\n\nCareer bukan sprint, tapi marathon. Every setback is setup for comeback!`\n  },\n\n  // Default responses\n  {\n    keywords: [\"hasil audit\", \"report\", \"skor\", \"score\"],\n    category: \"General\",\n    response: `Berdasarkan hasil audit Anda, saya merekomendasikan untuk:\n\n1. **Focus pada Action Plan** yang sudah disediakan\n2. **Prioritaskan** pilar dengan gap terbesar\n3. **Konsisten** jalankan daily activities\n4. **Track progress** setiap minggu\n5. **Adjust strategy** based on results\n\nApakah ada area spesifik yang ingin Anda diskusikan lebih detail? (Leadership, Sales, Planning, dll)`\n  }\n];\n\n/**\n * Find relevant knowledge based on user query\n */\nexport function findKnowledge(query: string): string | null {\n  const lowercaseQuery = query.toLowerCase();\n  \n  // Find best matching entry\n  for (const entry of knowledgeBase) {\n    if (entry.keywords.some(keyword => lowercaseQuery.includes(keyword.toLowerCase()))) {\n      return entry.response;\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Generate response using knowledge base\n */\nexport function generateKnowledgeBasedResponse(query: string, auditData: any): string {\n  const knowledge = findKnowledge(query);\n  \n  if (knowledge) {\n    return knowledge;\n  }\n  \n  // Fallback generic response\n  return `Terima kasih atas pertanyaan Anda tentang hasil audit.\n\n**Hasil Audit Anda:**\n- Reality Score: ${auditData.totalRealityScore}/90\n- Profil: ${auditData.profil}\n- Zona: ${auditData.zonaFinal}\n- Rekomendasi: ${auditData.prodemRekomendasi.recommendation}\n\nSaya merekomendasikan untuk:\n1. Review Action Plan 30-60-90 yang sudah disediakan\n2. Diskusikan dengan mentor/leader Anda\n3. Focus pada improvement area dengan gap terbesar\n\nUntuk pertanyaan lebih spesifik tentang **Leadership**, **Sales Skills**, **Team Building**, **Planning**, atau topik lainnya, silakan tanyakan!`;\n}\n","size_bytes":14787},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"attached_assets/aisg_core_base_1762749934944.md":{"content":"","size_bytes":0},"client/src/pages/NewAudit.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage, FormDescription } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ArrowLeft, ArrowRight, Check, TrendingUp } from \"lucide-react\";\nimport { insertAuditSchema } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { InsertAudit } from \"@shared/schema\";\n\nconst PILAR_NAMES = [\n  \"P1: Kemampuan Mencari Calon Nasabah\",\n  \"P2: Kemampuan Menutup Penjualan\",\n  \"P3: Kemampuan Menjaga Nasabah Aktif\",\n  \"P4: Kemampuan Mencetak Tim Baru (Kaderisasi)\",\n  \"P5: Pencapaian Target Penjualan\",\n  \"P6: Penguasaan Pasar Wilayah\",\n  \"P7: Kelengkapan Struktur Tim\",\n  \"P8: Jumlah Jalur Aktif\",\n  \"P9: Produktivitas Pimpinan\",\n  \"P10: Kesiapan Regenerasi\",\n  \"P11: Kerja Sama Antar Tim\",\n  \"P12: Kemampuan Beradaptasi\",\n  \"P13: Disiplin & Konsistensi Kerja\",\n  \"P14: Semangat & Motivasi Tim\",\n  \"P15: Inovasi Cara Kerja\",\n  \"P16: Pelatihan & Pengembangan Keterampilan\",\n  \"P17: Kepuasan Nasabah\",\n  \"P18: Pemahaman Pasar Lokal\"\n];\n\n// Helper function to determine which team structure fields should be shown\nconst getVisibleTeamFields = (jabatan: string) => {\n  const hierarchy = [\n    \"BC\",\n    \"SBC\",\n    \"BSM\",\n    \"SBM\",\n    \"EM\",\n    \"SEM\",\n    \"VBM\",\n    \"BrM\"\n  ];\n  \n  // Map full jabatan names to hierarchy keys\n  const jabatanMap: Record<string, string> = {\n    \"Business Consultant (BC)\": \"BC\",\n    \"Senior Business Consultant (SBC)\": \"SBC\",\n    \"Business Manager (BSM)\": \"BSM\",\n    \"Senior Business Manager (SBM)\": \"SBM\",\n    \"Executive Manager (EM)\": \"EM\",\n    \"Senior Executive Manager (SEM)\": \"SEM\",\n    \"Vice Business Manager (VBM)\": \"VBM\",\n    \"Branch Manager (BrM)\": \"BrM\"\n  };\n  \n  const userLevel = jabatanMap[jabatan];\n  if (!userLevel) return []; // Show nothing if unknown\n  \n  const userIndex = hierarchy.indexOf(userLevel);\n  if (userIndex === -1) return []; // Show nothing if not found\n  \n  // ProDem system: user can have subordinates up to their own level (inclusive)\n  // User CANNOT have subordinates with higher position than their own\n  // Example: BC can have BC subordinates\n  //          SBC can have BC and SBC subordinates\n  //          BSM can have BC, SBC, and BSM subordinates\n  return hierarchy.slice(0, userIndex + 1);\n};\n\nexport default function NewAudit() {\n  const [step, setStep] = useState(1);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const form = useForm<InsertAudit>({\n    resolver: zodResolver(insertAuditSchema),\n    defaultValues: {\n      nama: \"\",\n      jabatan: \"\",\n      cabang: \"\",\n      tanggalLahir: \"\",\n      marginTimQ1: 0,\n      marginTimQ2: 0,\n      marginTimQ3: 0,\n      marginTimQ4: 0,\n      naTimQ1: 0,\n      naTimQ2: 0,\n      naTimQ3: 0,\n      naTimQ4: 0,\n      marginPribadiQ1: 0,\n      marginPribadiQ2: 0,\n      marginPribadiQ3: 0,\n      marginPribadiQ4: 0,\n      nasabahPribadiQ1: 0,\n      nasabahPribadiQ2: 0,\n      nasabahPribadiQ3: 0,\n      nasabahPribadiQ4: 0,\n      jumlahBC: 0,\n      jumlahSBC: 0,\n      jumlahBsM: 0,\n      jumlahSBM: 0,\n      jumlahEM: 0,\n      jumlahSEM: 0,\n      jumlahVBM: 0,\n      jumlahBrM: 0,\n      pillarAnswers: Array.from({ length: 18 }, (_, i) => ({\n        pillarId: i + 1,\n        selfScore: 3\n      }))\n    }\n  });\n\n  const createAuditMutation = useMutation({\n    mutationFn: async (data: InsertAudit) => {\n      const response = await apiRequest(\"POST\", \"/api/audit\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/audits\"] });\n      toast({\n        title: \"Audit berhasil dibuat!\",\n        description: \"Audit telah berhasil disimpan dan dapat dilihat di dashboard.\"\n      });\n      setLocation(\"/\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Gagal membuat audit. Silakan coba lagi.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const onSubmit = (data: InsertAudit) => {\n    console.log(\"Submitting audit:\", data);\n    createAuditMutation.mutate(data);\n  };\n\n  const nextStep = async () => {\n    // Step 4 (pillarAnswers) doesn't need validation since sliders always have valid values (1-5)\n    if (step === 4) {\n      setStep(step + 1);\n      return;\n    }\n    \n    let fieldsToValidate: (keyof InsertAudit)[] = [];\n    \n    if (step === 1) {\n      fieldsToValidate = [\"nama\", \"jabatan\", \"cabang\", \"tanggalLahir\"];\n    } else if (step === 2) {\n      fieldsToValidate = [\"marginTimQ1\", \"marginTimQ2\", \"marginTimQ3\", \"marginTimQ4\", \"naTimQ1\", \"naTimQ2\", \"naTimQ3\", \"naTimQ4\", \"marginPribadiQ1\", \"marginPribadiQ2\", \"marginPribadiQ3\", \"marginPribadiQ4\", \"nasabahPribadiQ1\", \"nasabahPribadiQ2\", \"nasabahPribadiQ3\", \"nasabahPribadiQ4\"];\n    } else if (step === 3) {\n      fieldsToValidate = [\"jumlahBC\", \"jumlahSBC\", \"jumlahBsM\", \"jumlahSBM\", \"jumlahEM\", \"jumlahSEM\", \"jumlahVBM\", \"jumlahBrM\"];\n    }\n    \n    const isValid = await form.trigger(fieldsToValidate);\n    if (isValid) {\n      setStep(step + 1);\n    }\n  };\n\n  const prevStep = () => {\n    setStep(step - 1);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-4xl mx-auto p-6 md:p-8 space-y-8\">\n        <div className=\"flex items-center gap-4\">\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-5 h-5\" />\n          </Button>\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\">Audit Baru</h1>\n            <p className=\"text-muted-foreground\">Evaluasi kinerja quarterly dengan 18 Pilar framework</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center justify-center gap-2\">\n          {[1, 2, 3, 4, 5].map((s) => (\n            <div\n              key={s}\n              className={`h-2 rounded-full transition-all ${\n                s === step ? \"w-12 bg-primary\" : s < step ? \"w-8 bg-primary/50\" : \"w-8 bg-muted\"\n              }`}\n            />\n          ))}\n        </div>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            {/* STEP 1: Personal Info */}\n            {step === 1 && (\n              <Card className=\"p-6\">\n                <h2 className=\"text-xl font-semibold mb-4\">Informasi Personal</h2>\n                <div className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"nama\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nama Lengkap</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Masukkan nama lengkap\" {...field} data-testid=\"input-nama\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"jabatan\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Jabatan</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-jabatan\">\n                              <SelectValue placeholder=\"Pilih jabatan\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"Business Consultant (BC)\">Business Consultant (BC)</SelectItem>\n                            <SelectItem value=\"Senior Business Consultant (SBC)\">Senior Business Consultant (SBC)</SelectItem>\n                            <SelectItem value=\"Business Manager (BSM)\">Business Manager (BSM)</SelectItem>\n                            <SelectItem value=\"Senior Business Manager (SBM)\">Senior Business Manager (SBM)</SelectItem>\n                            <SelectItem value=\"Executive Manager (EM)\">Executive Manager (EM)</SelectItem>\n                            <SelectItem value=\"Senior Executive Manager (SEM)\">Senior Executive Manager (SEM)</SelectItem>\n                            <SelectItem value=\"Vice Business Manager (VBM)\">Vice Business Manager (VBM)</SelectItem>\n                            <SelectItem value=\"Branch Manager (BrM)\">Branch Manager (BrM)</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"cabang\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Cabang</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Contoh: XYZ Jakarta\" {...field} data-testid=\"input-cabang\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"tanggalLahir\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Tanggal Lahir</FormLabel>\n                        <FormControl>\n                          <Input \n                            placeholder=\"DD-MM-YYYY (contoh: 15-08-1990)\" \n                            {...field} \n                            data-testid=\"input-tanggal-lahir\" \n                          />\n                        </FormControl>\n                        <FormDescription>Format: DD-MM-YYYY (untuk zodiak booster)</FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n              </Card>\n            )}\n\n            {/* STEP 2: Quarterly Performance */}\n            {step === 2 && (\n              <Card className=\"p-6\">\n                <h2 className=\"text-xl font-semibold mb-4 flex items-center gap-2\">\n                  <TrendingUp className=\"w-5 h-5\" />\n                  Performa Quarterly (Tim & Pribadi)\n                </h2>\n                <p className=\"text-sm text-muted-foreground mb-6\">\n                  Isi data margin dan New Account (NA) untuk tim dan pribadi per kuartal\n                </p>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {/* Q1 */}\n                  <div className=\"space-y-3 p-4 border rounded-md\">\n                    <h3 className=\"font-semibold text-sm mb-2\">Q1 (Jan-Mar)</h3>\n                    <div className=\"space-y-2\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Tim</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginTimQ1\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Tim (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-tim-q1\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"naTimQ1\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">NA Tim</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-na-tim-q1\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <div className=\"space-y-2 pt-2 border-t\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Pribadi</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginPribadiQ1\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Pribadi (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-pribadi-q1\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"nasabahPribadiQ1\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Nasabah Pribadi</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-nasabah-pribadi-q1\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n\n                  {/* Q2 */}\n                  <div className=\"space-y-3 p-4 border rounded-md\">\n                    <h3 className=\"font-semibold text-sm mb-2\">Q2 (Apr-Jun)</h3>\n                    <div className=\"space-y-2\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Tim</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginTimQ2\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Tim (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-tim-q2\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"naTimQ2\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">NA Tim</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-na-tim-q2\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <div className=\"space-y-2 pt-2 border-t\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Pribadi</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginPribadiQ2\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Pribadi (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-pribadi-q2\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"nasabahPribadiQ2\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Nasabah Pribadi</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-nasabah-pribadi-q2\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n\n                  {/* Q3 */}\n                  <div className=\"space-y-3 p-4 border rounded-md\">\n                    <h3 className=\"font-semibold text-sm mb-2\">Q3 (Jul-Sep)</h3>\n                    <div className=\"space-y-2\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Tim</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginTimQ3\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Tim (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-tim-q3\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"naTimQ3\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">NA Tim</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-na-tim-q3\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <div className=\"space-y-2 pt-2 border-t\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Pribadi</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginPribadiQ3\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Pribadi (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-pribadi-q3\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"nasabahPribadiQ3\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Nasabah Pribadi</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-nasabah-pribadi-q3\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n\n                  {/* Q4 */}\n                  <div className=\"space-y-3 p-4 border rounded-md\">\n                    <h3 className=\"font-semibold text-sm mb-2\">Q4 (Oct-Dec)</h3>\n                    <div className=\"space-y-2\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Tim</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginTimQ4\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Tim (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-tim-q4\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"naTimQ4\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">NA Tim</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-na-tim-q4\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                    <div className=\"space-y-2 pt-2 border-t\">\n                      <p className=\"text-xs font-medium text-muted-foreground\">Performa Pribadi</p>\n                      <FormField\n                        control={form.control}\n                        name=\"marginPribadiQ4\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Margin Pribadi (USD)</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-margin-pribadi-q4\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={form.control}\n                        name=\"nasabahPribadiQ4\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel className=\"text-xs\">Nasabah Pribadi</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                value={field.value === 0 ? \"\" : field.value}\n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-nasabah-pribadi-q4\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            )}\n\n            {/* STEP 3: Team Structure */}\n            {step === 3 && (() => {\n              const visibleFields = getVisibleTeamFields(form.watch(\"jabatan\"));\n              return (\n                <Card className=\"p-6\">\n                  <h2 className=\"text-xl font-semibold mb-4\">Struktur Tim</h2>\n                  <p className=\"text-sm text-muted-foreground mb-6\">\n                    Isi jumlah anggota tim di setiap level (isi 0 jika tidak punya tim di level tersebut)\n                  </p>\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n                    {visibleFields.includes(\"BC\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahBC\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>BC</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-bc\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    {visibleFields.includes(\"SBC\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahSBC\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>SBC</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-sbc\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    {visibleFields.includes(\"BSM\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahBsM\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>BSM/BsM</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-bsm\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    {visibleFields.includes(\"SBM\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahSBM\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>SBM</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-sbm\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    {visibleFields.includes(\"EM\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahEM\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>EM</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-em\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    {visibleFields.includes(\"SEM\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahSEM\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>SEM</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-sem\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    {visibleFields.includes(\"VBM\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahVBM\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>VBM</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-vbm\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                    {visibleFields.includes(\"BrM\") && (\n                      <FormField\n                        control={form.control}\n                        name=\"jumlahBrM\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>BrM</FormLabel>\n                            <FormControl>\n                              <Input \n                                type=\"number\" \n                                placeholder=\"0\" \n                                {...field} \n                                onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                                data-testid=\"input-brm\" \n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    )}\n                  </div>\n                </Card>\n              );\n            })()}\n\n            {/* STEP 4: 18 Pilar Self Assessment (Scale 1-5) */}\n            {step === 4 && (\n              <Card className=\"p-6\">\n                <h2 className=\"text-xl font-semibold mb-4\">18 Pilar Self Assessment</h2>\n                <p className=\"text-sm text-muted-foreground mb-6\">\n                  Nilai kemampuan Anda di setiap pilar (1 = Sangat Rendah, 5 = Sangat Tinggi)\n                </p>\n                <div className=\"space-y-6\">\n                  {PILAR_NAMES.map((name, index) => (\n                    <FormField\n                      key={index}\n                      control={form.control}\n                      name={`pillarAnswers.${index}.selfScore`}\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel className=\"text-sm font-medium mb-3 block\">{name}</FormLabel>\n                          <FormControl>\n                            <RadioGroup\n                              onValueChange={(val) => field.onChange(parseInt(val))}\n                              value={field.value.toString()}\n                              className=\"flex gap-4\"\n                            >\n                              {[1, 2, 3, 4, 5].map((score) => (\n                                <div key={score} className=\"flex items-center space-x-2\">\n                                  <RadioGroupItem \n                                    value={score.toString()} \n                                    id={`pilar-${index}-score-${score}`}\n                                    data-testid={`radio-pilar-${index + 1}-score-${score}`}\n                                  />\n                                  <label \n                                    htmlFor={`pilar-${index}-score-${score}`}\n                                    className=\"text-sm font-medium cursor-pointer\"\n                                  >\n                                    {score}\n                                  </label>\n                                </div>\n                              ))}\n                            </RadioGroup>\n                          </FormControl>\n                          <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                            <span>1 - Sangat Rendah</span>\n                            <span>5 - Sangat Tinggi</span>\n                          </div>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  ))}\n                </div>\n              </Card>\n            )}\n\n            {/* STEP 5: Review & Submit */}\n            {step === 5 && (\n              <Card className=\"p-6\">\n                <h2 className=\"text-xl font-semibold mb-4\">Review Data Audit</h2>\n                <div className=\"space-y-4 text-sm\">\n                  <div>\n                    <p className=\"font-semibold\">Nama:</p>\n                    <p className=\"text-muted-foreground\">{form.getValues(\"nama\")}</p>\n                  </div>\n                  <div>\n                    <p className=\"font-semibold\">Jabatan:</p>\n                    <p className=\"text-muted-foreground\">{form.getValues(\"jabatan\")}</p>\n                  </div>\n                  <div>\n                    <p className=\"font-semibold\">Cabang:</p>\n                    <p className=\"text-muted-foreground\">{form.getValues(\"cabang\")}</p>\n                  </div>\n                  <div className=\"grid grid-cols-4 gap-2\">\n                    <div>\n                      <p className=\"font-semibold\">Q1 Margin:</p>\n                      <p className=\"text-muted-foreground\">${form.getValues(\"marginTimQ1\").toLocaleString()}</p>\n                    </div>\n                    <div>\n                      <p className=\"font-semibold\">Q2 Margin:</p>\n                      <p className=\"text-muted-foreground\">${form.getValues(\"marginTimQ2\").toLocaleString()}</p>\n                    </div>\n                    <div>\n                      <p className=\"font-semibold\">Q3 Margin:</p>\n                      <p className=\"text-muted-foreground\">${form.getValues(\"marginTimQ3\").toLocaleString()}</p>\n                    </div>\n                    <div>\n                      <p className=\"font-semibold\">Q4 Margin:</p>\n                      <p className=\"text-muted-foreground\">${form.getValues(\"marginTimQ4\").toLocaleString()}</p>\n                    </div>\n                  </div>\n                  <div>\n                    <p className=\"font-semibold\">Total Tim:</p>\n                    <p className=\"text-muted-foreground\">\n                      {(form.getValues(\"jumlahBC\") || 0) + (form.getValues(\"jumlahSBC\") || 0) + (form.getValues(\"jumlahBsM\") || 0) + \n                       (form.getValues(\"jumlahSBM\") || 0) + (form.getValues(\"jumlahEM\") || 0) + (form.getValues(\"jumlahSEM\") || 0) + \n                       (form.getValues(\"jumlahVBM\") || 0) + (form.getValues(\"jumlahBrM\") || 0)} orang\n                    </p>\n                  </div>\n                  <div>\n                    <p className=\"font-semibold\">18 Pilar Avg Score:</p>\n                    <p className=\"text-muted-foreground\">\n                      {(form.getValues(\"pillarAnswers\").reduce((sum, p) => sum + p.selfScore, 0) / 18).toFixed(1)} / 5.0\n                    </p>\n                  </div>\n                </div>\n              </Card>\n            )}\n\n            {/* Navigation Buttons */}\n            <div className=\"flex items-center justify-between\">\n              <div>\n                {step > 1 && (\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={prevStep}\n                    data-testid=\"button-prev\"\n                  >\n                    <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                    Kembali\n                  </Button>\n                )}\n              </div>\n              <div className=\"flex gap-2\">\n                {step < 5 && (\n                  <Button\n                    type=\"button\"\n                    onClick={nextStep}\n                    data-testid=\"button-next\"\n                  >\n                    Lanjut\n                    <ArrowRight className=\"w-4 h-4 ml-2\" />\n                  </Button>\n                )}\n                {step === 5 && (\n                  <Button\n                    type=\"submit\"\n                    disabled={createAuditMutation.isPending}\n                    data-testid=\"button-submit\"\n                  >\n                    {createAuditMutation.isPending ? (\n                      \"Memproses...\"\n                    ) : (\n                      <>\n                        <Check className=\"w-4 h-4 mr-2\" />\n                        Submit Audit\n                      </>\n                    )}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </form>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","size_bytes":43370},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport MemoryStore from \"memorystore\";\nimport connectPgSimple from \"connect-pg-simple\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { ensureSuperadminExists } from \"./auth\";\nimport http from \"http\";\n\nconst app = express();\n\n// Trust proxy (Replit uses proxy)\napp.set('trust proxy', 1);\n\n// Session configuration\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: string;\n  }\n}\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\n\n// Initialize MemoryStore for sessions (instant startup - no database dependency)\n// Will be used until PostgreSQL session store is ready\nconst MemStore = MemoryStore(session);\nconst memoryStore = new MemStore({\n  checkPeriod: 86400000, // prune expired entries every 24h\n});\n\n// Session middleware (initially uses MemoryStore for instant startup)\napp.use(session({\n  store: memoryStore,\n  secret: process.env.SESSION_SECRET || \"aisg-secret-key-change-in-production\",\n  resave: false,\n  saveUninitialized: false,\n  proxy: true,\n  cookie: {\n    secure: process.env.NODE_ENV === \"production\",\n    httpOnly: true,\n    maxAge: 24 * 60 * 60 * 1000,\n    sameSite: \"lax\",\n    path: \"/\",\n  },\n}));\n\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // Add health check endpoint for deployment monitoring\n  // ONLY /health returns JSON - / serves the frontend app\n  app.get(\"/health\", (_req, res) => {\n    res.writeHead(200, { \n      'Content-Type': 'application/json',\n      'Cache-Control': 'no-cache'\n    });\n    res.end(JSON.stringify({ \n      status: \"healthy\", \n      service: \"AISG Enterprise\",\n      timestamp: Date.now()\n    }));\n  });\n  \n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen(port, \"0.0.0.0\", () => {\n    log(`serving on port ${port}`);\n    \n    // ========================================\n    // BACKGROUND INITIALIZATION (after server ready)\n    // These operations run OUTSIDE request flow to avoid blocking health checks\n    // ========================================\n    \n    // Initialize superadmin user in background (non-blocking)\n    setImmediate(() => {\n      ensureSuperadminExists().catch((error) => {\n        console.error(\"Error ensuring superadmin exists:\", error);\n      });\n    });\n    \n    // Note: Using MemoryStore for sessions to ensure instant startup\n    // For production persistent sessions, consider migrating to PostgreSQL\n    // session store after app is stable, or use external session management\n  });\n})();\n","size_bytes":4330},"attached_assets/aisg_instruction_copas_builder_1762750119668.md":{"content":"# =====================================\n# AISG_INSTRUCTION_COPAS_BUILDER.txt\n# Template Siap Copas ke Kolom Instruction Builder â€“ Sistem AiSG (Multi-Cabang)\n# =====================================\n\n[nama_cabang] = NAMA_CABANG\n\n# âš™ï¸ PETUNJUK PENGGUNAAN\n# 1ï¸âƒ£ Upload ke Knowledge total 8 file berikut:\n#    - AISG_CORE_BASE.md\n#    - AISG_CORE_AUDIT_GUIDE.md\n#    - AISG_CORE_MOTIVATION.md\n#    - AISG_INSTRUCTION_BUILDER.md\n#    - ASSESSMENT_[nama_cabang].txt\n#    - DATA_[nama_cabang].txt\n#    - DATA_GABUNGAN_[nama_cabang].txt\n#    - HIRARKI_[nama_cabang].txt\n#\n# 2ï¸âƒ£ Setelah semua file di-upload:\n#    - Buka kolom *Instruction* di GPT Builder\n#    - Copy semua isi file ini dan paste ke kolom Instruction\n#    - Ganti baris di atas sesuai cabang aktif, contoh:\n#      [nama_cabang] = EWF_SSC\n#\n# 3ï¸âƒ£ Klik Simpan / Save Changes di Builder.\n#\n# 4ï¸âƒ£ Jalankan sistem audit.\n#    GPT otomatis akan membaca semua file dari Knowledge dan\n#    menyesuaikan dengan cabang aktif yang kamu tetapkan.\n#\n# âœ… Tips:\n# - Gunakan format UTF-8 untuk semua file TXT agar builder bisa membaca karakter khusus dengan benar.\n# - Penamaan file wajib sesuai huruf besarâ€“kecilnya (case sensitive).\n# - Jika berpindah cabang, cukup ubah nilai [nama_cabang] saja.\n# - Tidak perlu upload ulang 4 file markdown core.\n#\n# =====================================\n# Catatan:\n# File ini hanya untuk dicopas ke kolom *Instruction* di GPT Builder.\n# Jangan upload file ini ke Knowledge.\n# =====================================\n\n> **\"Instruksi yang jelas membuat sistem sekuat fondasinya, dan fondasi AiSG adalah keteraturan.\"**  \n> â€” *AiSG System 2025*\n\n","size_bytes":1648},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"AISG_ENTERPRISE_UI_DESIGN.md":{"content":"# AISG Enterprise - UI Design Document\n\n**Version**: 1.0  \n**Date**: November 10, 2025  \n**Language**: Bahasa Indonesia  \n**Target**: Hierarchical Enterprise Audit Platform\n\n---\n\n## ðŸŽ¯ Design Philosophy\n\n### Visual Identity\n- **Primary Theme**: Dark mode with glassmorphism\n- **Color System**: Zone-based status (Success ðŸŸ©, Warning ðŸŸ¨, Critical ðŸŸ¥)\n- **Typography**: Inter font family\n- **Icons**: Lucide React\n- **Layout**: Sidebar navigation (position-adaptive)\n\n### User Experience Principles\n1. **Progressive Disclosure** - Show only relevant data based on position\n2. **Visual Hierarchy** - Color-coded zones and levels\n3. **Contextual Actions** - Actions based on user permissions\n4. **Flexible Workflow** - Allow manual override with warnings\n5. **Bottom-Up Visibility** - See subordinates, not peers\n\n---\n\n## ðŸ“ Navigation Structure\n\n### Sidebar Menu (Position-Adaptive)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ AISG ENTERPRISE                 â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                 â”‚\nâ”‚ ðŸ¢ Dashboard                    â”‚\nâ”‚ ðŸ‘¥ Karyawan                     â”‚\nâ”‚ ðŸ“Š Data Kinerja                 â”‚\nâ”‚ ðŸ“ Audit                        â”‚\nâ”‚ âš™ï¸  Pengaturan Organisasi*      â”‚\nâ”‚ ðŸ‘¤ Pengguna*                    â”‚\nâ”‚ ðŸ“ˆ Laporan*                     â”‚\nâ”‚                                 â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚\nâ”‚ ðŸ‘¤ [Nama User]                  â”‚\nâ”‚    [Posisi] - [Cabang]          â”‚\nâ”‚    Keluar                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n* = Super Admin/Owner only\n```\n\n**Adaptive Sidebar Based on Position:**\n\n| Position | Menu Items |\n|----------|------------|\n| **Super Admin** | All menus |\n| **Owner** | All menus |\n| **CEO** | Dashboard, Karyawan, Data Kinerja, Audit, Laporan |\n| **CBO** | Dashboard, Karyawan, Data Kinerja, Audit, Laporan |\n| **BrM** | Dashboard, Karyawan, Data Kinerja, Audit |\n| **BC-SEM** | Dashboard (view only), Audit (self only) |\n\n---\n\n## ðŸ“± Page 1: Dashboard (Hierarchical Overview)\n\n### Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ HEADER                                                        â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚ Dashboard > Unit [CEO Name] > [Branch/Position]              â”‚\nâ”‚                                          [Filter: Q1 2025] â–¾  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ RINGKASAN KINERJA                                            â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚\nâ”‚ â”‚ Total Team  â”‚ â”‚ Margin Team â”‚ â”‚   NA Team   â”‚ â”‚   Zona   â”‚â”‚\nâ”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚ â”‚          â”‚â”‚\nâ”‚ â”‚    142      â”‚ â”‚  $450,000   â”‚ â”‚     89      â”‚ â”‚  ðŸŸ© 75%  â”‚â”‚\nâ”‚ â”‚  Karyawan   â”‚ â”‚   Target:   â”‚ â”‚   Target:   â”‚ â”‚  ðŸŸ¨ 20%  â”‚â”‚\nâ”‚ â”‚             â”‚ â”‚  $500,000   â”‚ â”‚     100     â”‚ â”‚  ðŸŸ¥  5%  â”‚â”‚\nâ”‚ â”‚  8 Posisi   â”‚ â”‚    90%      â”‚ â”‚     89%     â”‚ â”‚          â”‚â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ STRUKTUR ORGANISASI (Tree View)                             â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ ðŸ“Š CEO: ISRIYETTI                                           â”‚\nâ”‚     â”œâ”€ ðŸ’¼ CBO: Nurman (SSC) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [Lihat Detail]  â”‚\nâ”‚     â”‚   â”œâ”€ ðŸ¢ BrM: Andi (Medan) â”€â”€â”€â”€â”€â”€â”€â”€ âœ… Audit Q1 Done â”‚\nâ”‚     â”‚   â”‚   â”œâ”€ VBM: Budi (5 team) â”€â”€â”€â”€â”€â”€ âš ï¸ Audit Pending â”‚\nâ”‚     â”‚   â”‚   â””â”€ VBM: Citra (3 team) â”€â”€â”€â”€â”€ âœ… Audit Q1 Done â”‚\nâ”‚     â”‚   â””â”€ ðŸ¢ BrM: Dedi (Jakarta) â”€â”€â”€â”€â”€â”€ âš ï¸ Audit Pending â”‚\nâ”‚     â”‚       â””â”€ VBM: Eka (4 team) â”€â”€â”€â”€â”€â”€â”€ âš ï¸ Missing Data  â”‚\nâ”‚     â””â”€ ðŸ’¼ CBO: Lisa (AXA) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  [Lihat Detail]  â”‚\nâ”‚         â””â”€ ðŸ¢ BrM: Feri (Solo) â”€â”€â”€â”€â”€â”€â”€â”€ âœ… Audit Q1 Done  â”‚\nâ”‚                                                              â”‚\nâ”‚ [+ Expand All] [- Collapse All]                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ AUDIT TERBARU                                                â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ðŸŸ© Andi Wijaya - BrM Medan                     Q1 2025 â”‚  â”‚\nâ”‚ â”‚    Zona: Success (82/90) | ProDem: Dipertahankan       â”‚  â”‚\nâ”‚ â”‚    [Lihat Detail]                        2 hari lalu   â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ðŸŸ¨ Budi Santoso - VBM Medan               Q1 2025      â”‚  â”‚\nâ”‚ â”‚    Zona: Warning (68/90) | ProDem: Pembinaan          â”‚  â”‚\nâ”‚ â”‚    [Lihat Detail]                        5 hari lalu   â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ [Lihat Semua Audit]                                         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Key Features\n\n**1. Ringkasan Kinerja Cards:**\n- Real-time aggregation dari seluruh subordinates\n- Target vs Realisasi dengan progress bar\n- Zona distribution (pie chart mini)\n\n**2. Struktur Organisasi Tree:**\n- Collapsible tree view\n- Status indicator per employee (âœ… Done, âš ï¸ Pending, âŒ Missing)\n- Quick action buttons\n- Visual hierarchy dengan indent dan icons\n\n**3. Filter Quarter:**\n- Dropdown: Q1 2025, Q2 2025, Q3 2025, Q4 2025\n- Auto-refresh data saat ganti quarter\n\n**4. Contextual Actions:**\n- CEO: Lihat semua unit-nya\n- CBO: Lihat semua branch di bawahnya + CBO promoted dari tree-nya\n- BrM: Lihat semua team di branch-nya\n- BC-SEM: View-only dashboard (limited data)\n\n---\n\n## ðŸ‘¥ Page 2: Master Data Karyawan\n\n### Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ HEADER                                                        â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚ Master Data Karyawan                                         â”‚\nâ”‚                                                              â”‚\nâ”‚ [+ Tambah Karyawan]  [â†“ Import Excel]  [â†“ Download Template]â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ FILTER & SEARCH                                              â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ ðŸ” [Cari nama, email, ID...]                                â”‚\nâ”‚                                                              â”‚\nâ”‚ PT: [Semua â–¾]  Cabang: [Semua â–¾]  Posisi: [Semua â–¾]        â”‚\nâ”‚ Status: [Semua â–¾]  Atasan: [Semua â–¾]                        â”‚\nâ”‚                                                              â”‚\nâ”‚ [Reset Filter]                      Hasil: 142 karyawan     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ DAFTAR KARYAWAN                                              â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ID: EMP001                    ðŸ“‹ [Copy]  âœï¸ [Edit]      â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Nama: Andi Wijaya                                       â”‚  â”‚\nâ”‚ â”‚ Email: andi.wijaya@aisg.com                            â”‚  â”‚\nâ”‚ â”‚ Phone: +62 812-3456-7890                               â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Posisi: BrM                    Cabang: Medan            â”‚  â”‚\nâ”‚ â”‚ PT: RFB                        Unit CEO: ISRIYETTI      â”‚  â”‚\nâ”‚ â”‚ Atasan: Nurman (CBO - SSC)                             â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Join Date: 15 Jan 2023         Status: âœ… Aktif        â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Team: 8 subordinates (3 VBM, 5 EM)                     â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ [Lihat Detail] [Lihat Hierarki] [Lihat Audit]         â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ID: EMP002                    ðŸ“‹ [Copy]  âœï¸ [Edit]      â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Nama: Budi Santoso                                      â”‚  â”‚\nâ”‚ â”‚ ...                                                     â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ [1] [2] [3] ... [15]                   Showing 1-10 of 142  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Modal: Tambah/Edit Karyawan\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ âœ–                                           â”‚\nâ”‚ Tambah Karyawan Baru                       â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ INFORMASI PRIBADI                          â”‚\nâ”‚                                            â”‚\nâ”‚ Nama Lengkap *                             â”‚\nâ”‚ [________________________]                 â”‚\nâ”‚                                            â”‚\nâ”‚ Email *                                    â”‚\nâ”‚ [________________________]                 â”‚\nâ”‚                                            â”‚\nâ”‚ No. Telepon                                â”‚\nâ”‚ [________________________]                 â”‚\nâ”‚                                            â”‚\nâ”‚ Tanggal Lahir *                            â”‚\nâ”‚ [DD-MM-YYYY]  ðŸ“…                          â”‚\nâ”‚                                            â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ INFORMASI ORGANISASI                       â”‚\nâ”‚                                            â”‚\nâ”‚ PT *                                       â”‚\nâ”‚ [Pilih PT â–¾]                               â”‚\nâ”‚ â—‹ RFB  â—‹ EWF  â—‹ KPF  â—‹ SGB  â—‹ BPF        â”‚\nâ”‚                                            â”‚\nâ”‚ Cabang *                                   â”‚\nâ”‚ [Pilih Cabang â–¾]                           â”‚\nâ”‚ (Auto-populate based on PT)                â”‚\nâ”‚                                            â”‚\nâ”‚ Posisi *                                   â”‚\nâ”‚ [Pilih Posisi â–¾]                           â”‚\nâ”‚ â—‹ BC   â—‹ SBC  â—‹ BsM  â—‹ SBM  â—‹ EM          â”‚\nâ”‚ â—‹ SEM  â—‹ VBM  â—‹ BrM  â—‹ CBO  â—‹ CEO         â”‚\nâ”‚                                            â”‚\nâ”‚ Atasan Langsung *                          â”‚\nâ”‚ [Cari atasan... ðŸ”]                        â”‚\nâ”‚ (Autocomplete dropdown)                    â”‚\nâ”‚                                            â”‚\nâ”‚ Tanggal Bergabung *                        â”‚\nâ”‚ [DD-MM-YYYY]  ðŸ“…                          â”‚\nâ”‚                                            â”‚\nâ”‚ Status *                                   â”‚\nâ”‚ â—‹ Aktif  â—‹ Resign  â—‹ Freelance            â”‚\nâ”‚                                            â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ [Batal]              [Simpan Karyawan]    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Key Features\n\n**1. Smart Filtering:**\n- Multi-level filter (PT â†’ Cabang â†’ Posisi)\n- Real-time search\n- Filter by atasan (untuk cek team structure)\n\n**2. Employee Card:**\n- Comprehensive info in collapsed view\n- Quick actions (Copy ID, Edit, View)\n- Team count indicator\n- Status badge dengan color coding\n\n**3. Hierarchy Builder:**\n- Atasan autocomplete dengan validation\n- Prevent circular references\n- Auto-suggest based on position level\n\n**4. Bulk Import:**\n- Download Excel template\n- Upload Excel dengan validation\n- Preview before save\n- Error report kalau ada data invalid\n\n---\n\n## ðŸ“Š Page 3: Data Kinerja (Performance Input)\n\n### Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ HEADER                                                        â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚ Data Kinerja Karyawan                                        â”‚\nâ”‚                                                              â”‚\nâ”‚ [+ Input Kinerja]  [â†“ Import Excel]  [â†“ Download Template]  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ FILTER                                                       â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ Periode: [Q1 2025 â–¾]  Bulan: [Januari â–¾]                   â”‚\nâ”‚ Karyawan: [Cari karyawan... ðŸ”]                             â”‚\nâ”‚ Cabang: [Semua â–¾]  Posisi: [Semua â–¾]                        â”‚\nâ”‚                                                              â”‚\nâ”‚ [Reset Filter]                                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ REKAP KINERJA - JANUARI 2025                                â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ EMP001 - Andi Wijaya (BrM Medan)           âœï¸ [Edit]   â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Margin Pribadi:    $15,000      NA Pribadi:      3     â”‚  â”‚\nâ”‚ â”‚ Margin Team:       $45,000      NA Team:        12     â”‚  â”‚\nâ”‚ â”‚ Lot Settled:          120       Status: âœ… Lengkap     â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Last Update: 05 Feb 2025, 14:30                        â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ EMP002 - Budi Santoso (VBM Medan)          âœï¸ [Edit]   â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Margin Pribadi:     $8,000      NA Pribadi:      2     â”‚  â”‚\nâ”‚ â”‚ Margin Team:       $12,000      NA Team:         5     â”‚  â”‚\nâ”‚ â”‚ Lot Settled:           80       Status: âœ… Lengkap     â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Last Update: 03 Feb 2025, 09:15                        â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ EMP003 - Citra Dewi (VBM Medan)            âš ï¸ [Edit]   â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Margin Pribadi:          -      NA Pribadi:      -     â”‚  â”‚\nâ”‚ â”‚ Margin Team:             -      NA Team:         -     â”‚  â”‚\nâ”‚ â”‚ Lot Settled:             -      Status: âš ï¸ Kosong      â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Last Update: -                                         â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ [1] [2] [3]                            Showing 1-10 of 42   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Modal: Input/Edit Kinerja\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ âœ–                                           â”‚\nâ”‚ Input Kinerja Bulanan                      â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ PILIH KARYAWAN & PERIODE                   â”‚\nâ”‚                                            â”‚\nâ”‚ Karyawan *                                 â”‚\nâ”‚ [Cari karyawan... ðŸ”]                      â”‚\nâ”‚ â€º EMP001 - Andi Wijaya (BrM Medan)        â”‚\nâ”‚                                            â”‚\nâ”‚ Periode *                                  â”‚\nâ”‚ Bulan: [Januari â–¾]  Tahun: [2025 â–¾]       â”‚\nâ”‚                                            â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ DATA KINERJA PRIBADI                       â”‚\nâ”‚                                            â”‚\nâ”‚ Margin Pribadi (USD) *                     â”‚\nâ”‚ [$____________]                            â”‚\nâ”‚                                            â”‚\nâ”‚ Nasabah Pribadi *                          â”‚\nâ”‚ [____________]                             â”‚\nâ”‚                                            â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ DATA KINERJA TEAM                          â”‚\nâ”‚                                            â”‚\nâ”‚ âš ï¸ Note: Margin Team akan dihitung        â”‚\nâ”‚    otomatis dari agregasi subordinates     â”‚\nâ”‚                                            â”‚\nâ”‚ Margin Team (USD)                          â”‚\nâ”‚ [$____________]  (Optional - Override)     â”‚\nâ”‚                                            â”‚\nâ”‚ NA Team                                    â”‚\nâ”‚ [____________]   (Optional - Override)     â”‚\nâ”‚                                            â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ DATA TAMBAHAN                              â”‚\nâ”‚                                            â”‚\nâ”‚ Lot Settled                                â”‚\nâ”‚ [____________]                             â”‚\nâ”‚                                            â”‚\nâ”‚ Catatan (Optional)                         â”‚\nâ”‚ [________________________]                 â”‚\nâ”‚ [________________________]                 â”‚\nâ”‚                                            â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                            â”‚\nâ”‚ [Batal]              [Simpan Data]        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Key Features\n\n**1. Auto-Aggregation Logic:**\n- Margin Team = Sum(margin pribadi subordinates langsung)\n- NA Team = Sum(NA pribadi subordinates langsung)\n- Show warning kalau ada subordinate yang belum input data\n- Allow manual override (dengan warning)\n\n**2. Quarterly Calculation:**\n- System auto-sum Jan+Feb+Mar = Q1\n- Display quarterly summary di dashboard\n- Validation: Q1 = Jan+Feb+Mar harus match\n\n**3. Bulk Import Support:**\n- Template Excel dengan columns:\n  - Employee ID, Bulan, Tahun, Margin Pribadi, NA Pribadi, Lot Settled\n- Validation: Check employee exists, check duplicate entry\n- Preview before import\n\n**4. Status Indicator:**\n- âœ… Lengkap - All data filled\n- âš ï¸ Kosong - No data yet\n- ðŸ”„ Partial - Some months missing\n\n---\n\n## ðŸ“ Page 4: Buat Audit (Enterprise Flow)\n\n### Layout - Step 1: Pilih Karyawan\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Buat Audit Baru                                    Step 1/5  â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ PILIH KARYAWAN UNTUK DIAUDIT                                â”‚\nâ”‚                                                              â”‚\nâ”‚ ðŸ” [Cari karyawan... (nama, ID, cabang)]                    â”‚\nâ”‚                                                              â”‚\nâ”‚ Filter:                                                      â”‚\nâ”‚ Cabang: [Semua â–¾]  Posisi: [Semua â–¾]  Status Audit: [â–¾]    â”‚\nâ”‚                                                              â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                                              â”‚\nâ”‚ KARYAWAN YANG BISA DIAUDIT:                                 â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ âœ… EMP001 - Andi Wijaya (BrM Medan)                    â”‚  â”‚\nâ”‚ â”‚    Subordinates: 8 team (3 sudah audit Q1)            â”‚  â”‚\nâ”‚ â”‚    Data Kinerja: âœ… Q1 Lengkap                         â”‚  â”‚\nâ”‚ â”‚    Assessment: âš ï¸ Belum Isi                           â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚    [Pilih Karyawan Ini]                                â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ âš ï¸ EMP002 - Budi Santoso (VBM Medan)                   â”‚  â”‚\nâ”‚ â”‚    Subordinates: 5 team (0 sudah audit Q1) âš ï¸         â”‚  â”‚\nâ”‚ â”‚    Data Kinerja: âœ… Q1 Lengkap                         â”‚  â”‚\nâ”‚ â”‚    Assessment: âš ï¸ Belum Isi                           â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚    âš ï¸ Warning: Belum ada audit subordinates           â”‚  â”‚\nâ”‚ â”‚    Anda bisa lanjut audit, tapi agregasi akan manual   â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚    [Pilih Karyawan Ini] [Lihat Subordinates]           â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ [Batal]                                     [Lanjut â†’]      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Layout - Step 2: Review Data Kinerja\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Buat Audit Baru - Andi Wijaya (BrM Medan)         Step 2/5  â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ REVIEW DATA KINERJA Q1 2025                                 â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ KINERJA PRIBADI                                        â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Januari:  Margin $15,000  |  NA 3                      â”‚  â”‚\nâ”‚ â”‚ Februari: Margin $18,000  |  NA 4                      â”‚  â”‚\nâ”‚ â”‚ Maret:    Margin $22,000  |  NA 5                      â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Total Q1: Margin $55,000  |  NA 12                     â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ KINERJA TEAM (AGREGASI)                                â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Subordinates Aktif: 8                                  â”‚  â”‚\nâ”‚ â”‚ Subordinates Sudah Audit: 3                            â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ âš ï¸ 5 subordinates belum audit Q1                       â”‚  â”‚\nâ”‚ â”‚    - Budi Santoso (VBM)                                â”‚  â”‚\nâ”‚ â”‚    - Citra Dewi (VBM)                                  â”‚  â”‚\nâ”‚ â”‚    - Dedi Ahmad (EM)                                   â”‚  â”‚\nâ”‚ â”‚    - Eka Putra (EM)                                    â”‚  â”‚\nâ”‚ â”‚    - Feri Gunawan (EM)                                 â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Total Margin Team Q1: $120,000 (dari 3 audited)       â”‚  â”‚\nâ”‚ â”‚ Total NA Team Q1:     35 (dari 3 audited)             â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ âš ï¸ Agregasi belum lengkap!                            â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ [ ] Override manual (input sendiri)                    â”‚  â”‚\nâ”‚ â”‚ [âœ“] Gunakan agregasi parsial (warning)                â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ Data ini akan digunakan untuk perhitungan Reality Score     â”‚\nâ”‚                                                              â”‚\nâ”‚ [â† Kembali]  [Edit Data]                    [Lanjut â†’]     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Layout - Step 3: Assessment 18 Pilar\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Buat Audit Baru - Andi Wijaya (BrM Medan)         Step 3/5  â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ SELF-ASSESSMENT 18 PILAR                                    â”‚\nâ”‚                                                              â”‚\nâ”‚ Instruksi: Nilai diri Anda pada setiap pilar (1-5)         â”‚\nâ”‚ 1 = Sangat Kurang | 2 = Kurang | 3 = Cukup | 4 = Baik | 5 = Sangat Baik â”‚\nâ”‚                                                              â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                                              â”‚\nâ”‚ KATEGORI: KINERJA (9 Pilar)                                 â”‚\nâ”‚                                                              â”‚\nâ”‚ 1. Kepemimpinan                                             â”‚\nâ”‚    Kemampuan memimpin dan memotivasi team                   â”‚\nâ”‚    â—‹ 1    â—‹ 2    â—‹ 3    â— 4    â—‹ 5                         â”‚\nâ”‚                                                              â”‚\nâ”‚ 2. Pencapaian Target                                        â”‚\nâ”‚    Konsistensi dalam mencapai target margin & NA            â”‚\nâ”‚    â—‹ 1    â—‹ 2    â—‹ 3    â—‹ 4    â— 5                         â”‚\nâ”‚                                                              â”‚\nâ”‚ 3. Rekrutmen & Development                                  â”‚\nâ”‚    Kemampuan merekrut dan mengembangkan BC/SBC baru         â”‚\nâ”‚    â—‹ 1    â—‹ 2    â— 3    â—‹ 4    â—‹ 5                         â”‚\nâ”‚                                                              â”‚\nâ”‚ ... (15 pilar lainnya)                                      â”‚\nâ”‚                                                              â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚                                                              â”‚\nâ”‚ Progress: 18/18 pilar sudah dinilai âœ…                      â”‚\nâ”‚                                                              â”‚\nâ”‚ [â† Kembali]                                 [Lanjut â†’]      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Layout - Step 4: Review & Submit\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Buat Audit Baru - Andi Wijaya (BrM Medan)         Step 4/5  â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ REVIEW SEBELUM SUBMIT                                       â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ INFORMASI KARYAWAN                                     â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚\nâ”‚ â”‚ Nama: Andi Wijaya                                      â”‚  â”‚\nâ”‚ â”‚ Posisi: BrM - Branch Medan                             â”‚  â”‚\nâ”‚ â”‚ PT: RFB | Unit CEO: ISRIYETTI                          â”‚  â”‚\nâ”‚ â”‚ Periode Audit: Q1 2025                                 â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ RINGKASAN KINERJA                                      â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚\nâ”‚ â”‚ Margin Pribadi Q1: $55,000                             â”‚  â”‚\nâ”‚ â”‚ NA Pribadi Q1: 12                                      â”‚  â”‚\nâ”‚ â”‚ Margin Team Q1: $120,000 âš ï¸ (partial agregasi)        â”‚  â”‚\nâ”‚ â”‚ NA Team Q1: 35 âš ï¸ (partial agregasi)                  â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ASSESSMENT 18 PILAR                                    â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚\nâ”‚ â”‚ Total Self Score: 72/90                                â”‚  â”‚\nâ”‚ â”‚ Kategori Kinerja: 38/45                                â”‚  â”‚\nâ”‚ â”‚ Kategori Perilaku: 34/45                               â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ âš ï¸ PERINGATAN                                               â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ 5 subordinates belum melakukan audit Q1:               â”‚  â”‚\nâ”‚ â”‚ - Agregasi Margin Team mungkin belum akurat            â”‚  â”‚\nâ”‚ â”‚ - Disarankan untuk audit subordinates terlebih dahulu  â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ [ ] Saya mengerti dan tetap lanjut audit               â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ System akan otomatis menghitung:                            â”‚\nâ”‚ â€¢ Reality Score (berdasarkan data kinerja)                  â”‚\nâ”‚ â€¢ Zona Final (Success/Warning/Critical)                     â”‚\nâ”‚ â€¢ Profil Karyawan (Leader/Visionary/Performer/At-Risk)      â”‚\nâ”‚ â€¢ ProDem Recommendation                                     â”‚\nâ”‚                                                              â”‚\nâ”‚ [â† Kembali]                          [Submit Audit â†’]       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Layout - Step 5: Hasil Audit\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ âœ… Audit Berhasil Dibuat!                                    â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ HASIL AUDIT - Andi Wijaya (BrM Medan) - Q1 2025            â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ðŸŸ© ZONA FINAL: SUCCESS (82/90)                         â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Reality Score: 82/90                                   â”‚  â”‚\nâ”‚ â”‚ Self Score: 72/90                                      â”‚  â”‚\nâ”‚ â”‚ Gap: +10 (Underestimate diri)                          â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ PROFIL: LEADER VISIONARY                               â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ \"Pemimpin dengan visi jelas, mampu membawa team        â”‚  â”‚\nâ”‚ â”‚  melampaui target dengan konsistensi tinggi\"           â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ âœ… PRODEM: DIPERTAHANKAN                               â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Rekomendasi: Pertahankan posisi BrM                    â”‚  â”‚\nâ”‚ â”‚ Next Review: Q2 2025                                   â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Kelebihan:                                             â”‚  â”‚\nâ”‚ â”‚ â€¢ Konsistensi pencapaian target >110%                  â”‚  â”‚\nâ”‚ â”‚ â€¢ Leadership score tinggi (45/50)                      â”‚  â”‚\nâ”‚ â”‚ â€¢ Team development aktif                               â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Area Improvement:                                      â”‚  â”‚\nâ”‚ â”‚ â€¢ Rekrutmen BC baru (hanya 2 di Q1)                    â”‚  â”‚\nâ”‚ â”‚ â€¢ Coaching untuk underperformer team                   â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ [Lihat Laporan Lengkap] [Download PDF] [Kembali ke Dashboard]â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Key Features\n\n**1. Flexible Workflow:**\n- Warning kalau subordinates belum audit (bukan blocking)\n- Allow manual override untuk margin team\n- Partial aggregation dengan catatan\n\n**2. Smart Aggregation:**\n- Auto-sum margin/NA dari audited subordinates\n- Show progress: \"3/8 subordinates sudah audit\"\n- Real-time calculation saat subordinate submit audit\n\n**3. Validation:**\n- Check data kinerja exists untuk quarter yang dipilih\n- Validate 18 pilar assessment (must complete all)\n- Warn kalau subordinate data incomplete\n\n**4. Bottom-Up Trigger:**\n- Saat BrM submit audit â†’ Auto-update CBO aggregation\n- Saat CBO submit audit â†’ Auto-update CEO aggregation\n- Real-time notification untuk atasan\n\n---\n\n## âš™ï¸ Page 5: Pengaturan Organisasi (Super Admin Only)\n\n### Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ HEADER                                                        â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚ Pengaturan Organisasi                                        â”‚\nâ”‚                                                              â”‚\nâ”‚ Tab: [PT & Cabang] [Struktur Posisi] [Unit CEO]             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ PT & CABANG                                                  â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ [+ Tambah PT]  [+ Tambah Cabang]                            â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ðŸ¢ PT RFB (Resky Futures Brokerage)                    â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Kode: RFB  |  Status: Aktif  |  Total Karyawan: 85    â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Cabang (12):                                           â”‚  â”‚\nâ”‚ â”‚ â€¢ SSC (Jakarta) - 25 karyawan        [Edit] [Hapus]   â”‚  â”‚\nâ”‚ â”‚ â€¢ MEDAN (Medan) - 18 karyawan        [Edit] [Hapus]   â”‚  â”‚\nâ”‚ â”‚ â€¢ AXA (Surabaya) - 15 karyawan       [Edit] [Hapus]   â”‚  â”‚\nâ”‚ â”‚ â€¢ ... (show all)                                       â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ [+ Tambah Cabang ke RFB]                               â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ ðŸ¢ PT EWF (Eastern World Futures)                      â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Kode: EWF  |  Status: Aktif  |  Total Karyawan: 42    â”‚  â”‚\nâ”‚ â”‚ ...                                                     â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ STRUKTUR POSISI                                              â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ Hirarki Posisi (11 Level):                                  â”‚\nâ”‚                                                              â”‚\nâ”‚ Level 1:  BC (Business Consultant)                          â”‚\nâ”‚ Level 2:  SBC (Senior BC)                                   â”‚\nâ”‚ Level 3:  BsM (Business Manager)                            â”‚\nâ”‚ Level 4:  SBM (Senior Business Manager)                     â”‚\nâ”‚ Level 5:  EM (Executive Manager)                            â”‚\nâ”‚ Level 6:  SEM (Senior Executive Manager)                    â”‚\nâ”‚ Level 7:  VBM (Vice Branch Manager)                         â”‚\nâ”‚ Level 8:  BrM (Branch Manager)                              â”‚\nâ”‚ Level 9:  CBO (Chief Branch Officer)                        â”‚\nâ”‚ Level 10: CEO (Chief Executive Officer)                     â”‚\nâ”‚ Level 11: Owner                                             â”‚\nâ”‚                                                              â”‚\nâ”‚ Note: Same-level dapat manage same-level (ex: BrMâ†’BrM)     â”‚\nâ”‚       Levels dapat di-skip (ex: BrMâ†’SEM)                   â”‚\nâ”‚                                                              â”‚\nâ”‚ [Edit Struktur] [Tambah Posisi Custom]                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ UNIT CEO                                                     â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚\nâ”‚                                                              â”‚\nâ”‚ [+ Tambah Unit CEO]                                         â”‚\nâ”‚                                                              â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚ â”‚ CEO: ISRIYETTI                                         â”‚  â”‚\nâ”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚\nâ”‚ â”‚ Status: Aktif  |  Total Karyawan: 95                  â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ CBO yang Manage:                                       â”‚  â”‚\nâ”‚ â”‚ â€¢ Nurman (SSC) - 45 karyawan                           â”‚  â”‚\nâ”‚ â”‚ â€¢ Lisa (AXA) - 28 karyawan                             â”‚  â”‚\nâ”‚ â”‚ â€¢ Doni (MEDAN) - 22 karyawan                           â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ Branch Langsung (tanpa CBO):                           â”‚  â”‚\nâ”‚ â”‚ â€¢ SOLO - 12 karyawan (BrM: Feri)                       â”‚  â”‚\nâ”‚ â”‚                                                         â”‚  â”‚\nâ”‚ â”‚ [Edit] [Hapus]                                         â”‚  â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                              â”‚\nâ”‚ ... (4 CEO units lainnya)                                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Key Features\n\n**1. Dynamic Branch Management:**\n- Add/remove branches\n- Assign to PT\n- Track employee count per branch\n\n**2. Position Hierarchy Config:**\n- Define 11 levels\n- Set same-level management rules\n- Allow level skipping\n\n**3. CEO Unit Management:**\n- Create CEO units\n- Assign CBOs to CEO\n- Allow CEO direct management to BrM (skip CBO)\n\n**4. Validation:**\n- Cannot delete PT/Branch yang ada karyawan aktif\n- Cannot delete CEO unit yang ada karyawan\n- Warn before destructive actions\n\n---\n\n## ðŸŽ¨ UI Components & Styling\n\n### Color Scheme (Dark Mode Primary)\n\n```css\n/* Zone-based Colors */\n--zona-success: #10b981 (Green)\n--zona-warning: #f59e0b (Yellow)\n--zona-critical: #ef4444 (Red)\n\n/* Background */\n--bg-primary: #0f172a (Slate 900)\n--bg-secondary: #1e293b (Slate 800)\n--bg-card: #334155 (Slate 700)\n\n/* Text */\n--text-primary: #f1f5f9 (Slate 100)\n--text-secondary: #94a3b8 (Slate 400)\n--text-muted: #64748b (Slate 500)\n\n/* Accent */\n--accent-primary: #3b82f6 (Blue)\n--accent-secondary: #8b5cf6 (Purple)\n\n/* Borders */\n--border-default: #475569 (Slate 600)\n--border-focus: #3b82f6 (Blue)\n```\n\n### Component Patterns\n\n**Status Badges:**\n```\nâœ… Aktif (Green)\nâš ï¸ Pending (Yellow)\nâŒ Missing (Red)\nðŸ”„ Partial (Blue)\n```\n\n**Progress Indicators:**\n```\n[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80% (8/10 subordinates audited)\n```\n\n**Tree View Icons:**\n```\nðŸ“Š CEO\nðŸ’¼ CBO\nðŸ¢ BrM\nðŸ‘¤ VBM/EM/SEM\nðŸ‘¥ BsM/SBM\nðŸŽ“ SBC\nðŸ“ BC\n```\n\n**Action Buttons:**\n```\nPrimary: [Simpan Data] (Blue, prominent)\nSecondary: [Batal] (Gray, subtle)\nDanger: [Hapus] (Red, warning)\nGhost: [Edit] [Lihat Detail] (Transparent with border)\n```\n\n### Responsive Design\n\n**Desktop (>1024px):**\n- Sidebar: Fixed left (280px width)\n- Content: Flex-grow with max-width 1400px\n- Cards: 3-column grid untuk stats\n\n**Tablet (768-1024px):**\n- Sidebar: Collapsible dengan toggle\n- Content: Full width dengan padding\n- Cards: 2-column grid\n\n**Mobile (<768px):**\n- Sidebar: Bottom navigation\n- Content: Full width\n- Cards: 1-column stack\n- Forms: Full-width inputs\n\n---\n\n## ðŸ”” Notifications & Alerts\n\n### Toast Notifications\n\n**Success:**\n```\nâœ… Data karyawan berhasil disimpan!\nâœ… Audit berhasil dibuat untuk Andi Wijaya (Q1 2025)\n```\n\n**Warning:**\n```\nâš ï¸ 5 subordinates belum audit - agregasi mungkin tidak akurat\nâš ï¸ Data kinerja Februari 2025 belum lengkap\n```\n\n**Error:**\n```\nâŒ Gagal menyimpan data - Email sudah terdaftar\nâŒ Audit gagal - Data kinerja Q1 tidak ditemukan\n```\n\n**Info:**\n```\nâ„¹ï¸ Subordinate Budi Santoso baru saja submit audit Q1\nâ„¹ï¸ Margin Team telah diupdate otomatis berdasarkan audit subordinate\n```\n\n### Alert Banners\n\n**Flexible Workflow Warning:**\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ âš ï¸ PERINGATAN: AUDIT SUBORDINATES BELUM LENGKAP              â”‚\nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚\nâ”‚ 5 dari 8 subordinates Anda belum melakukan audit Q1:        â”‚\nâ”‚ â€¢ Budi Santoso (VBM) - Data lengkap, belum assessment       â”‚\nâ”‚ â€¢ Citra Dewi (VBM) - Missing data Maret 2025                â”‚\nâ”‚ â€¢ Dedi Ahmad (EM) - Belum input data                        â”‚\nâ”‚                                                              â”‚\nâ”‚ Disarankan untuk menyelesaikan audit subordinates terlebih  â”‚\nâ”‚ dahulu agar agregasi Margin Team & NA Team akurat.           â”‚\nâ”‚                                                              â”‚\nâ”‚ [ ] Saya mengerti dan tetap lanjutkan audit                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## ðŸ“± Mobile-Specific Features\n\n### Bottom Navigation (Mobile)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                                                 â”‚\nâ”‚              [CONTENT AREA]                     â”‚\nâ”‚                                                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  ðŸ         ðŸ‘¥        ðŸ“Š        ðŸ“        âš™ï¸      â”‚\nâ”‚ Home   Karyawan  Kinerja   Audit   Settings    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Pull-to-Refresh\n\n- Dashboard: Refresh stats & recent audits\n- Karyawan list: Refresh employee data\n- Kinerja list: Refresh performance data\n\n### Swipe Actions (Mobile)\n\n**Employee Card:**\n- Swipe Left: [Edit] [Delete]\n- Swipe Right: [View Detail]\n\n**Performance Card:**\n- Swipe Left: [Edit]\n- Swipe Right: [View History]\n\n---\n\n## ðŸŽ¯ User Flows Summary\n\n### Flow 1: BrM Input Kinerja Team\n```\nLogin â†’ Dashboard â†’ Data Kinerja â†’ [+ Input Kinerja]\nâ†’ Pilih Karyawan (VBM Budi) â†’ Input Margin/NA Januari\nâ†’ Simpan â†’ Toast: âœ… Data berhasil disimpan\nâ†’ Kembali ke list â†’ See updated status\n```\n\n### Flow 2: BrM Buat Audit (With Warning)\n```\nLogin â†’ Dashboard â†’ Audit â†’ [+ Buat Audit]\nâ†’ Pilih Karyawan (BrM Andi) â†’ âš ï¸ Warning: 5 subordinates belum audit\nâ†’ [Lanjut Anyway] â†’ Review Data Kinerja â†’ Assessment 18 Pilar\nâ†’ Review â†’ [âœ“] Saya mengerti warning â†’ [Submit Audit]\nâ†’ âœ… Audit berhasil â†’ Lihat hasil â†’ Download PDF\n```\n\n### Flow 3: CEO Monitoring Unit\n```\nLogin â†’ Dashboard â†’ See 5 CEO Units\nâ†’ Click \"Unit ISRIYETTI\" â†’ Expand tree\nâ†’ See all CBOs, BrMs, teams â†’ Filter by \"Audit Status: Pending\"\nâ†’ See 12 employees belum audit Q1 â†’ Click employee\nâ†’ View detail â†’ Notify BrM to complete audit\n```\n\n### Flow 4: Super Admin Setup Organisasi\n```\nLogin â†’ Pengaturan Organisasi â†’ [+ Tambah PT]\nâ†’ Input PT Name, Kode â†’ Simpan â†’ [+ Tambah Cabang]\nâ†’ Assign ke PT â†’ Input cabang details â†’ Simpan\nâ†’ Switch tab \"Unit CEO\" â†’ [+ Tambah Unit CEO]\nâ†’ Assign CEO name â†’ Simpan â†’ Success!\n```\n\n---\n\n## ðŸ” Permission Matrix\n\n| Page/Action | BC-SEM | BrM | CBO | CEO | Owner | Super Admin |\n|-------------|--------|-----|-----|-----|-------|-------------|\n| View Dashboard | âœ… (Limited) | âœ… | âœ… | âœ… | âœ… | âœ… |\n| View Karyawan | âŒ | âœ… (Team only) | âœ… (Unit) | âœ… (Unit) | âœ… (All) | âœ… (All) |\n| Add Karyawan | âŒ | âœ… (BC-VBM) | âœ… (BC-BrM) | âœ… (BC-CBO) | âœ… (All) | âœ… (All) |\n| Edit Karyawan | âŒ | âœ… (Team) | âœ… (Unit) | âœ… (Unit) | âœ… (All) | âœ… (All) |\n| Input Kinerja | âŒ | âœ… (Team) | âœ… (Unit) | âœ… (Unit) | âœ… (All) | âœ… (All) |\n| Buat Audit | âœ… (Self) | âœ… (Team) | âœ… (Unit) | âœ… (Unit) | âœ… (All) | âœ… (All) |\n| View Audit | âœ… (Self) | âœ… (Team) | âœ… (Unit) | âœ… (Unit) | âœ… (All) | âœ… (All) |\n| Setup Organisasi | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |\n| Manage Users | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |\n\n**Isolation Rules:**\n- **Peer Isolation**: BrM A cannot see BrM B (different branch)\n- **CEO Isolation**: CEO ISRIYETTI cannot see CEO NL's unit\n- **CBO Cross-Tree**: CBO A can see CBO B if B was promoted from A's tree\n- **Bottom-Up Only**: Can only see direct/indirect reports, not peers or upline\n\n---\n\n## ðŸ“ Form Validation Rules\n\n### Employee Form\n```\nNama: Required, min 3 chars\nEmail: Required, valid email format, unique\nPhone: Optional, valid Indo phone format (+62...)\nTanggal Lahir: Required, DD-MM-YYYY format, age 17-65\nPT: Required, select from dropdown\nCabang: Required, auto-filtered by PT\nPosisi: Required, select from 11 levels\nAtasan: Required, autocomplete, validation:\n  - Atasan level must be >= employee level\n  - Cannot select self\n  - Cannot create circular reference\nJoin Date: Required, DD-MM-YYYY, not future date\nStatus: Required, default \"Aktif\"\n```\n\n### Performance Data Form\n```\nKaryawan: Required, autocomplete\nBulan: Required, 1-12\nTahun: Required, 2020-2030\nMargin Pribadi: Required, number, can be negative (withdrawal)\nNA Pribadi: Required, integer, >= 0\nMargin Team: Optional, auto-calculated (can override)\nNA Team: Optional, auto-calculated (can override)\nLot Settled: Optional, integer, >= 0\nCatatan: Optional, max 500 chars\n```\n\n### Audit Form\n```\nKaryawan: Required\nQuarter: Required, Q1-Q4\nYear: Required\nData Kinerja: Auto-validated (must exist for selected quarter)\n18 Pilar: Required, all 18 must be scored (1-5)\nWarning Checkbox: Required if subordinates belum audit\n```\n\n---\n\n## ðŸŽ¨ Animation & Transitions\n\n### Micro-interactions\n```\nButton hover: Scale 1.02, transition 200ms\nCard hover: Lift shadow, transition 300ms\nInput focus: Border color change, transition 150ms\nToast appear: Slide from top, fade in 300ms\nModal open: Fade backdrop + scale content 250ms\nTree expand: Height transition 200ms ease-out\n```\n\n### Loading States\n```\nButton loading: Spinner + disabled state\nPage loading: Skeleton cards (pulse animation)\nData fetch: Progress bar at top\nInfinite scroll: Load more spinner at bottom\n```\n\n### Success Animations\n```\nAudit created: Confetti animation + success checkmark\nData saved: Checkmark scale-in animation\nFile uploaded: Progress bar â†’ checkmark\n```\n\n---\n\n## ðŸ“Š Dashboard Widgets (Future Enhancement)\n\n### Widget Ideas for Owner/CEO Dashboard\n```\n1. Zona Distribution Pie Chart\n   - ðŸŸ© Success: 75%\n   - ðŸŸ¨ Warning: 20%\n   - ðŸŸ¥ Critical: 5%\n\n2. ProDem Summary Bar\n   - Promosi: 12\n   - Dipertahankan: 85\n   - Pembinaan: 28\n   - Demosi: 3\n\n3. Top Performers (Leaderboard)\n   - Top 10 by Reality Score\n   - Top 10 by Margin Achievement\n   - Top 10 by NA Achievement\n\n4. Audit Completion Progress\n   - Q1 2025: 142/142 (100%) âœ…\n   - Q2 2025: 89/142 (63%) ðŸ”„\n   - Q3 2025: 0/142 (0%) âš ï¸\n\n5. Team Growth Chart\n   - Line chart: Total employees over time\n   - Bar chart: New recruits per month\n   - Stacked chart: Position distribution\n\n6. Branch Performance Heatmap\n   - Map visualization\n   - Color-coded by zona\n   - Click to drill-down\n```\n\n---\n\n## ðŸ” Search & Filter Capabilities\n\n### Global Search\n```\nOmnisearch bar (top right):\n- Search karyawan (by name, email, ID)\n- Search audit (by employee, quarter)\n- Search branch (by name, region)\n- Quick jump to employee detail\n```\n\n### Advanced Filters\n```\nEmployee List:\n- Multi-select: PT, Cabang, Posisi, Status\n- Date range: Join Date, Last Audit Date\n- Performance: Zona, ProDem Recommendation\n- Sort by: Name, Join Date, Position, Last Audit\n\nPerformance Data:\n- Multi-select: Quarter, Month, Year\n- Performance range: Margin ($min - $max), NA (min - max)\n- Completion status: Lengkap, Partial, Kosong\n- Sort by: Margin DESC, NA DESC, Employee Name\n\nAudit List:\n- Multi-select: Quarter, Year, Zona, ProDem\n- Date range: Audit Created Date\n- Employee filter: By name, position, branch\n- Sort by: Reality Score DESC, Audit Date DESC\n```\n\n---\n\n## ðŸ“„ Export & Reports\n\n### Export Formats\n```\n1. PDF Audit Report (Individual)\n   - Full 12-section report\n   - Professional formatting\n   - Company logo & branding\n\n2. Excel Export (Bulk Data)\n   - Employee master data\n   - Performance data (monthly/quarterly)\n   - Audit summary (all employees)\n   - Custom column selection\n\n3. CSV Export (Raw Data)\n   - For data analysis\n   - Import to other systems\n   - Custom delimiter support\n```\n\n### Report Templates\n```\n1. Executive Summary (CEO/Owner)\n   - Unit performance overview\n   - Zona distribution\n   - ProDem summary\n   - Top/bottom performers\n\n2. Branch Performance (BrM)\n   - Team structure\n   - Individual performance\n   - Audit completion status\n   - Action items\n\n3. Quarterly Review (All Positions)\n   - Personal performance\n   - Team performance (if leader)\n   - Audit history\n   - Trend analysis\n```\n\n---\n\n**END OF UI DESIGN DOCUMENT**\n\nIni adalah mockup UI design lengkap untuk AISG Enterprise!\nApakah ada bagian yang perlu direvisi atau tambahan fitur yang Anda inginkan?\n","size_bytes":69228},"server/pdf-generator.ts":{"content":"import PDFDocument from \"pdfkit\";\nimport type { AuditPdfDto } from \"@shared/types\";\n\nexport function generateAuditPDF(data: AuditPdfDto): typeof PDFDocument {\n  const doc = new PDFDocument({ \n    size: \"A4\", \n    margin: 50,\n    info: {\n      Title: `Audit Report - ${data.fullName}`,\n      Author: \"AiSG - Audit Intelligence SG\",\n      Subject: \"Performance Audit Report\"\n    }\n  });\n\n  const report = data.auditReport as any;\n  const prodem = data.prodemRekomendasi as any;\n  const magic = data.magicSection as any;\n  \n  doc.fontSize(24).font(\"Helvetica-Bold\").text(\"AiSG - AUDIT INTELLIGENCE\", { align: \"center\" });\n  doc.moveDown(0.5);\n  doc.fontSize(18).text(\"Performance Audit Report\", { align: \"center\" });\n  doc.moveDown(2);\n  \n  doc.fontSize(12).font(\"Helvetica\");\n  doc.fillColor(\"#666\");\n  doc.text(`Period: Q${data.quarter} ${data.year}`);\n  doc.text(`Generated: ${new Date().toLocaleDateString(\"id-ID\", { day: \"numeric\", month: \"long\", year: \"numeric\" })}`);\n  doc.moveDown(2);\n  \n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"Personal Information\");\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  doc.text(`Nama: ${data.fullName}`);\n  doc.text(`Jabatan: ${data.position}`);\n  doc.text(`Cabang: ${data.branch}`);\n  doc.text(`PT Company: ${data.ptCompany}`);\n  doc.text(`Tanggal Lahir: ${data.birthDate}`);\n  doc.moveDown(1.5);\n  \n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"Executive Summary\");\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  doc.text(report.executiveSummary, { align: \"justify\" });\n  doc.moveDown(1.5);\n  \n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"Performance Metrics\");\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  doc.text(`Reality Score: ${data.totalRealityScore}/90`);\n  doc.text(`Self Score: ${data.totalSelfScore}/90`);\n  doc.text(`Gap: ${data.totalGap}`);\n  doc.text(`Profil: ${data.profil}`);\n  doc.text(`Zona: ${data.zonaFinal.toUpperCase()}`);\n  doc.moveDown(1.5);\n  \n  doc.addPage();\n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"SWOT Analysis\");\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  \n  doc.fontSize(13).font(\"Helvetica-Bold\").text(\"Strengths:\");\n  doc.fontSize(11).font(\"Helvetica\");\n  report.swotAnalysis.strength.forEach((item: string, idx: number) => {\n    doc.text(`${idx + 1}. ${item}`, { indent: 20 });\n  });\n  doc.moveDown(0.5);\n  \n  doc.fontSize(13).font(\"Helvetica-Bold\").text(\"Weaknesses:\");\n  doc.fontSize(11).font(\"Helvetica\");\n  report.swotAnalysis.weakness.forEach((item: string, idx: number) => {\n    doc.text(`${idx + 1}. ${item}`, { indent: 20 });\n  });\n  doc.moveDown(0.5);\n  \n  doc.fontSize(13).font(\"Helvetica-Bold\").text(\"Opportunities:\");\n  doc.fontSize(11).font(\"Helvetica\");\n  report.swotAnalysis.opportunity.forEach((item: string, idx: number) => {\n    doc.text(`${idx + 1}. ${item}`, { indent: 20 });\n  });\n  doc.moveDown(0.5);\n  \n  doc.fontSize(13).font(\"Helvetica-Bold\").text(\"Threats:\");\n  doc.fontSize(11).font(\"Helvetica\");\n  report.swotAnalysis.threat.forEach((item: string, idx: number) => {\n    doc.text(`${idx + 1}. ${item}`, { indent: 20 });\n  });\n  doc.moveDown(1.5);\n  \n  doc.addPage();\n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"Action Plan 30-60-90\");\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  \n  report.actionPlan.forEach((plan: any) => {\n    doc.fontSize(13).font(\"Helvetica-Bold\").text(`${plan.periode}:`);\n    doc.fontSize(11).font(\"Helvetica\");\n    doc.text(`Target: ${plan.target}`, { indent: 20 });\n    doc.text(`Aktivitas: ${plan.aktivitas}`, { indent: 20 });\n    doc.text(`PIC: ${plan.pic}`, { indent: 20 });\n    doc.text(`Output: ${plan.output}`, { indent: 20 });\n    doc.moveDown(0.5);\n  });\n  doc.moveDown(1);\n  \n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"ProDem Recommendation\");\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  doc.text(`Current Level: ${prodem.currentLevel}`);\n  doc.text(`Recommendation: ${prodem.recommendation}`);\n  if (prodem.nextLevel) {\n    doc.text(`Next Level: ${prodem.nextLevel}`);\n  }\n  doc.text(`Reason: ${prodem.reason}`, { align: \"justify\" });\n  doc.moveDown(0.5);\n  doc.text(`Konsekuensi: ${prodem.konsekuensi}`, { align: \"justify\" });\n  doc.moveDown(0.5);\n  doc.text(`Next Step: ${prodem.nextStep}`, { align: \"justify\" });\n  doc.moveDown(1.5);\n  \n  doc.addPage();\n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"Magic Section\");\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  doc.text(`Julukan: ${magic.julukan}`);\n  doc.text(`Zodiak: ${magic.zodiak}`);\n  doc.text(`Generasi: ${magic.generasi}`);\n  doc.moveDown(0.5);\n  doc.fontSize(11).font(\"Helvetica\").text(magic.narasi, { align: \"justify\" });\n  doc.moveDown(0.5);\n  doc.fontSize(11).font(\"Helvetica-Oblique\").text(`\"${magic.quote}\"`, { align: \"center\" });\n  doc.moveDown(1.5);\n  \n  doc.fontSize(16).font(\"Helvetica-Bold\").text(\"18 Pilar Performance\", { underline: true });\n  doc.fontSize(11).font(\"Helvetica\");\n  doc.moveDown(0.5);\n  \n  const pillars = data.pillarAnswers as any[];\n  pillars.forEach((pilar, idx) => {\n    if (idx > 0 && idx % 6 === 0) {\n      doc.addPage();\n    }\n    doc.fontSize(11).font(\"Helvetica-Bold\").text(`${pilar.pillarName}`);\n    doc.fontSize(10).font(\"Helvetica\");\n    doc.text(`Self Score: ${pilar.selfScore}/5 | Reality Score: ${pilar.realityScore}/5 | Gap: ${pilar.gap}`, { indent: 15 });\n    doc.text(`Insight: ${pilar.insight}`, { indent: 15, align: \"justify\" });\n    doc.moveDown(0.3);\n  });\n  \n  doc.addPage();\n  doc.fontSize(10).font(\"Helvetica\").fillColor(\"#999\");\n  doc.text(\"---\", { align: \"center\" });\n  doc.text(\"This report is confidential and intended for internal use only.\", { align: \"center\" });\n  doc.text(`AiSG - Audit Intelligence SG Â© ${new Date().getFullYear()}`, { align: \"center\" });\n  \n  // Note: Do NOT call doc.end() here - let caller pipe first, then end\n  return doc;\n}\n","size_bytes":5851},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/pages/HierarchicalDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\nimport { Users, TrendingUp, Award, Target, Network, Building2, MapPin, ChevronDown, ChevronRight } from \"lucide-react\";\n\ntype Employee = {\n  id: string;\n  employeeCode: string;\n  fullName: string;\n  positionId: string;\n  ptId: string;\n  branchId: string | null;\n  ceoUnitId: string | null;\n  managerId: string | null;\n  status: \"active\" | \"inactive\";\n  position?: { id: string; code: string; name: string; level: number };\n  pt?: { id: string; code: string; name: string };\n  branch?: { id: string; code: string; name: string } | null;\n  ceoUnit?: { id: string; name: string } | null;\n};\n\nexport default function HierarchicalDashboard() {\n  const { user } = useAuth();\n\n  // Fetch employees (backend will filter based on user permissions)\n  const { data: employees = [], isLoading } = useQuery<Employee[]>({ \n    queryKey: [\"/api/enterprise/employees\"] \n  });\n\n  // Calculate stats\n  const stats = {\n    total: employees.length,\n    active: employees.filter(e => e.status === \"active\").length,\n    inactive: employees.filter(e => e.status === \"inactive\").length,\n    byPosition: employees.reduce((acc, emp) => {\n      const posName = emp.position?.name || \"Unknown\";\n      acc[posName] = (acc[posName] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>),\n    byPt: employees.reduce((acc, emp) => {\n      const ptCode = emp.pt?.code || \"Unknown\";\n      acc[ptCode] = (acc[ptCode] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>),\n  };\n\n  // Get top 5 positions by count\n  const topPositions = Object.entries(stats.byPosition)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 5);\n\n  return (\n    <div className=\"container mx-auto py-6 space-y-6\">\n      {/* Header */}\n      <div className=\"space-y-2\">\n        <h1 className=\"text-4xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent\">\n          Dashboard Hierarki\n        </h1>\n        <p className=\"text-muted-foreground\" data-testid=\"text-welcome-message\">\n          Selamat datang, {user?.name || \"User\"}! \n          {user?.role === \"super_admin\" && \" (Super Admin - Full Access)\"}\n          {user?.role === \"owner\" && \" (Owner - Full Access)\"}\n          {user?.role === \"employee\" && \" - Lihat tim dan struktur organisasi Anda\"}\n        </p>\n      </div>\n\n      {/* Stats Grid */}\n      {isLoading ? (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          {[1, 2, 3, 4].map(i => <Skeleton key={i} className=\"h-32 w-full\" />)}\n        </div>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          {/* Total Employees */}\n          <Card className=\"hover-elevate active-elevate-2 transition-all\" data-testid=\"card-total-employees\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Karyawan</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"stat-total-employees\">\n                {stats.total}\n              </div>\n              <p className=\"text-xs text-muted-foreground\" data-testid=\"text-total-context\">\n                {user?.role === \"employee\" ? \"Dalam tim Anda\" : \"Seluruh organisasi\"}\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Active Employees */}\n          <Card className=\"hover-elevate active-elevate-2 transition-all\" data-testid=\"card-active-employees\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Karyawan Aktif</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-green-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\" data-testid=\"stat-active-employees\">\n                {stats.active}\n              </div>\n              <p className=\"text-xs text-muted-foreground\" data-testid=\"text-active-percentage\">\n                {stats.total > 0 ? Math.round((stats.active / stats.total) * 100) : 0}% dari total\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Inactive Employees */}\n          <Card className=\"hover-elevate active-elevate-2 transition-all\" data-testid=\"card-inactive-employees\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Tidak Aktif</CardTitle>\n              <Target className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-muted-foreground\" data-testid=\"stat-inactive-employees\">\n                {stats.inactive}\n              </div>\n              <p className=\"text-xs text-muted-foreground\" data-testid=\"text-inactive-percentage\">\n                {stats.total > 0 ? Math.round((stats.inactive / stats.total) * 100) : 0}% dari total\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Unique Positions */}\n          <Card className=\"hover-elevate active-elevate-2 transition-all\" data-testid=\"card-unique-positions\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Unique Positions</CardTitle>\n              <Award className=\"h-4 w-4 text-purple-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-purple-600\" data-testid=\"stat-unique-positions\">\n                {Object.keys(stats.byPosition).length}\n              </div>\n              <p className=\"text-xs text-muted-foreground\" data-testid=\"text-positions-description\">\n                Level hierarki berbeda\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Details Grid */}\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        {/* Employees by Position */}\n        <Card data-testid=\"card-position-distribution\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Award className=\"w-5 h-5\" />\n              Distribusi per Posisi\n            </CardTitle>\n            <CardDescription>Top 5 posisi dengan karyawan terbanyak</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-2\">\n                {[1, 2, 3, 4, 5].map(i => <Skeleton key={i} className=\"h-12 w-full\" />)}\n              </div>\n            ) : topPositions.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"empty-positions\">\n                <Award className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                <p>Tidak ada data karyawan</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {topPositions.map(([position, count], index) => (\n                  <div \n                    key={position} \n                    className=\"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover-elevate\"\n                    data-testid={`position-stat-${index}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs font-bold\">\n                        {index + 1}\n                      </div>\n                      <div>\n                        <p className=\"font-medium\" data-testid={`text-position-name-${index}`}>{position}</p>\n                        <p className=\"text-xs text-muted-foreground\" data-testid={`text-position-count-${index}`}>{count} karyawan</p>\n                      </div>\n                    </div>\n                    <Badge variant=\"secondary\" data-testid={`badge-position-percentage-${index}`}>\n                      {stats.total > 0 ? Math.round((count / stats.total) * 100) : 0}%\n                    </Badge>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Employees by PT */}\n        <Card data-testid=\"card-pt-distribution\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Building2 className=\"w-5 h-5\" />\n              Distribusi per PT\n            </CardTitle>\n            <CardDescription>Penyebaran karyawan di 5 PT companies</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-2\">\n                {[1, 2, 3, 4, 5].map(i => <Skeleton key={i} className=\"h-12 w-full\" />)}\n              </div>\n            ) : Object.keys(stats.byPt).length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"empty-pts\">\n                <Building2 className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                <p>Tidak ada data karyawan</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {Object.entries(stats.byPt)\n                  .sort((a, b) => b[1] - a[1])\n                  .map(([pt, count], index) => (\n                    <div \n                      key={pt} \n                      className=\"flex items-center justify-between p-3 rounded-lg bg-muted/30 hover-elevate\"\n                      data-testid={`pt-stat-${index}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center text-white text-xs font-bold\">\n                          {pt}\n                        </div>\n                        <div>\n                          <p className=\"font-medium\" data-testid={`text-pt-name-${index}`}>{pt}</p>\n                          <p className=\"text-xs text-muted-foreground\" data-testid={`text-pt-count-${index}`}>{count} karyawan</p>\n                        </div>\n                      </div>\n                      <Badge variant=\"secondary\" data-testid={`badge-pt-percentage-${index}`}>\n                        {stats.total > 0 ? Math.round((count / stats.total) * 100) : 0}%\n                      </Badge>\n                    </div>\n                  ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Quick Actions / Info */}\n      <Card className=\"bg-gradient-to-r from-purple-500/10 via-pink-500/10 to-blue-500/10 border-purple-500/20\" data-testid=\"card-organization-info\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Network className=\"w-5 h-5\" />\n            Struktur Organisasi\n          </CardTitle>\n          <CardDescription>\n            Jelajahi struktur hierarki organisasi dan tim Anda\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div className=\"grid md:grid-cols-3 gap-4\">\n              <div className=\"p-4 rounded-lg bg-background/50 backdrop-blur-sm\" data-testid=\"info-master-data\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Users className=\"w-4 h-4 text-purple-500\" />\n                  <p className=\"font-medium text-sm\">Master Data Karyawan</p>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Lihat detail lengkap, struktur hierarki, dan kelola data karyawan\n                </p>\n              </div>\n              \n              <div className=\"p-4 rounded-lg bg-background/50 backdrop-blur-sm\" data-testid=\"info-tree-view\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Network className=\"w-4 h-4 text-blue-500\" />\n                  <p className=\"font-medium text-sm\">Tree Visualization</p>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Visualisasi struktur reporting dengan tree view interaktif\n                </p>\n              </div>\n              \n              <div className=\"p-4 rounded-lg bg-background/50 backdrop-blur-sm\" data-testid=\"info-performance\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Award className=\"w-4 h-4 text-pink-500\" />\n                  <p className=\"font-medium text-sm\">Performance Tracking</p>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  (Coming soon) Monitor kinerja tim dengan 18 Pilar framework\n                </p>\n              </div>\n            </div>\n\n            {user?.role === \"employee\" && (\n              <div className=\"p-4 rounded-lg bg-blue-500/10 border border-blue-500/20\" data-testid=\"info-employee-access\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <MapPin className=\"w-4 h-4 text-blue-500\" />\n                  <p className=\"font-semibold text-sm\">Akses Terbatas</p>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Sebagai employee, Anda hanya dapat melihat data tim Anda sendiri dan bawahan langsung Anda. \n                  Untuk akses penuh, hubungi administrator atau owner.\n                </p>\n              </div>\n            )}\n\n            {(user?.role === \"super_admin\" || user?.role === \"owner\") && (\n              <div className=\"p-4 rounded-lg bg-purple-500/10 border border-purple-500/20\" data-testid=\"info-full-access\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Award className=\"w-4 h-4 text-purple-500\" />\n                  <p className=\"font-semibold text-sm\">Full Access</p>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Anda memiliki akses penuh ke seluruh sistem: kelola organisasi, karyawan, dan pengaturan sistem.\n                  Gunakan menu \"Setup Organisasi\" dan \"Master Karyawan\" untuk mengelola data.\n                </p>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Team Hierarchy Tree View */}\n      {stats.total > 0 && !isLoading && (\n        <Card data-testid=\"card-team-hierarchy\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Network className=\"w-5 h-5\" />\n              Struktur Hierarki Tim\n            </CardTitle>\n            <CardDescription>\n              Visualisasi struktur reporting organisasi Anda\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {employees.filter(emp => !emp.managerId).length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"empty-tree\">\n                  <Network className=\"w-12 h-12 mx-auto mb-2 opacity-50\" />\n                  <p>Tidak ada karyawan top-level untuk ditampilkan</p>\n                  <p className=\"text-xs mt-2\">Pastikan ada karyawan dengan \"Tidak ada atasan\"</p>\n                </div>\n              ) : (\n                employees\n                  .filter(emp => !emp.managerId) // Get top-level employees\n                  .map(rootEmp => (\n                    <DashboardTreeNode\n                      key={rootEmp.id}\n                      employee={rootEmp}\n                      allEmployees={employees}\n                      level={0}\n                    />\n                  ))\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Empty State - Future Features */}\n      {stats.total === 0 && !isLoading && (\n        <Card data-testid=\"card-empty-state\">\n          <CardContent className=\"py-12\">\n            <div className=\"text-center space-y-4\">\n              <Users className=\"w-16 h-16 mx-auto text-muted-foreground opacity-50\" />\n              <div>\n                <h3 className=\"text-lg font-semibold mb-2\" data-testid=\"text-empty-title\">Belum Ada Data Karyawan</h3>\n                <p className=\"text-sm text-muted-foreground max-w-md mx-auto\" data-testid=\"text-empty-description\">\n                  Mulai dengan menambahkan struktur organisasi (PT, Cabang, Posisi) di menu \"Setup Organisasi\",\n                  kemudian tambahkan karyawan di menu \"Master Karyawan\".\n                </p>\n              </div>\n              {(user?.role === \"super_admin\" || user?.role === \"owner\") && (\n                <div className=\"flex gap-2 justify-center pt-4\">\n                  <Link href=\"/organizational-setup\">\n                    <Badge variant=\"outline\" className=\"cursor-pointer hover-elevate\" data-testid=\"link-setup-org\">\n                      Setup Organisasi â†’\n                    </Badge>\n                  </Link>\n                  <Link href=\"/employees\">\n                    <Badge variant=\"outline\" className=\"cursor-pointer hover-elevate\" data-testid=\"link-master-employee\">\n                      Master Karyawan â†’\n                    </Badge>\n                  </Link>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\n// Dashboard Tree Node Component (simplified for dashboard view)\ntype DashboardTreeNodeProps = {\n  employee: Employee;\n  allEmployees: Employee[];\n  level: number;\n};\n\nfunction DashboardTreeNode({ employee, allEmployees, level }: DashboardTreeNodeProps) {\n  const [isExpanded, setIsExpanded] = useState(true);\n\n  // Get direct subordinates\n  const subordinates = allEmployees.filter(emp => emp.managerId === employee.id);\n  const hasSubordinates = subordinates.length > 0;\n\n  // Get position level color\n  const getLevelColor = (level: number | undefined) => {\n    if (!level) return \"bg-gray-500\";\n    if (level <= 3) return \"bg-gradient-to-r from-purple-500 to-pink-500\"; // Owner, CEO, CBO\n    if (level <= 6) return \"bg-gradient-to-r from-blue-500 to-cyan-500\"; // BrM, VBM, SEM\n    if (level <= 9) return \"bg-gradient-to-r from-green-500 to-emerald-500\"; // EM, SBM, BsM\n    return \"bg-gradient-to-r from-yellow-500 to-orange-500\"; // SBC, BC\n  };\n\n  return (\n    <div className=\"space-y-2\" style={{ marginLeft: `${level * 1.5}rem` }}>\n      {/* Employee Card */}\n      <div \n        className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/20 hover-elevate transition-all\"\n        data-testid={`dashboard-tree-node-${employee.id}`}\n      >\n        {/* Expand/Collapse Button */}\n        {hasSubordinates && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-6 w-6 shrink-0\"\n            onClick={() => setIsExpanded(!isExpanded)}\n            data-testid={`button-dashboard-toggle-${employee.id}`}\n          >\n            {isExpanded ? (\n              <ChevronDown className=\"w-3 h-3\" />\n            ) : (\n              <ChevronRight className=\"w-3 h-3\" />\n            )}\n          </Button>\n        )}\n\n        {/* Avatar with Position Level */}\n        <div className=\"relative shrink-0\">\n          <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${getLevelColor(employee.position?.level)}`}>\n            {employee.fullName.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase()}\n          </div>\n          {employee.position && (\n            <div className=\"absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-background border border-primary flex items-center justify-center text-[9px] font-bold\">\n              {employee.position.level}\n            </div>\n          )}\n        </div>\n\n        {/* Employee Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <p className=\"font-semibold text-sm truncate\" data-testid={`text-dashboard-tree-name-${employee.id}`}>\n              {employee.fullName}\n            </p>\n            <Badge variant=\"outline\" className=\"text-xs shrink-0\">\n              {employee.employeeCode}\n            </Badge>\n          </div>\n          <div className=\"flex items-center gap-2 text-xs text-muted-foreground mt-0.5\">\n            <Badge variant=\"secondary\" className=\"text-[10px] px-1 py-0\">\n              {employee.position?.name || \"Unknown\"}\n            </Badge>\n            <span>â€¢</span>\n            <span>{employee.pt?.code || \"Unknown\"}</span>\n            {hasSubordinates && (\n              <>\n                <span>â€¢</span>\n                <span>{subordinates.length} bawahan</span>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Status Badge */}\n        <Badge \n          variant={employee.status === \"active\" ? \"default\" : \"secondary\"}\n          className={`text-xs shrink-0 ${employee.status === \"active\" ? \"bg-green-600\" : \"\"}`}\n        >\n          {employee.status === \"active\" ? \"Aktif\" : \"Tidak Aktif\"}\n        </Badge>\n      </div>\n\n      {/* Subordinates (Recursive) */}\n      {hasSubordinates && isExpanded && (\n        <div className=\"space-y-2 border-l-2 border-muted pl-2\">\n          {subordinates.map(sub => (\n            <DashboardTreeNode\n              key={sub.id}\n              employee={sub}\n              allEmployees={allEmployees}\n              level={level + 1}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":21854},"server/business-logic.ts":{"content":"/**\n * Business Logic Module\n * \n * Contains all business rules for audit calculations:\n * - Reality Score calculation from performance data\n * - Zone Analysis (Kinerja, Perilaku, Final)\n * - Profile mapping (Leader, Visionary, Performer, At-Risk)\n * - ProDem recommendations (Promosi, Dipertahankan, Pembinaan, Demosi)\n * \n * All formulas provided by architect review (Task 13 planning)\n */\n\nimport type { MonthlyPerformance } from \"@shared/schema\";\n\n// ============================================================================\n// QUARTERLY AGGREGATION HELPER\n// ============================================================================\n\n/**\n * Aggregate 3 months of performance data into quarterly totals\n * \n * @param monthlyPerformance - Array of 3 MonthlyPerformance records\n * @returns Aggregated quarterly performance\n */\nexport function aggregateQuarterlyPerformance(\n  monthlyPerformance: MonthlyPerformance[]\n): {\n  marginPersonalQ: string;\n  naPersonalQ: number;\n  marginTeamQ: string;\n  naTeamQ: number;\n} {\n  if (monthlyPerformance.length < 3) {\n    throw new Error(\"Quarterly aggregation requires 3 months of data\");\n  }\n\n  // Sum all 3 months\n  const marginPersonalQ = monthlyPerformance\n    .reduce((sum, month) => sum + (parseFloat(month.marginPersonal) || 0), 0)\n    .toFixed(2);\n\n  const naPersonalQ = monthlyPerformance\n    .reduce((sum, month) => sum + (month.naPersonal || 0), 0);\n\n  const marginTeamQ = monthlyPerformance\n    .reduce((sum, month) => sum + (parseFloat(month.marginTeam || \"0\") || 0), 0)\n    .toFixed(2);\n\n  const naTeamQ = monthlyPerformance\n    .reduce((sum, month) => sum + (month.naTeam || 0), 0);\n\n  return {\n    marginPersonalQ,\n    naPersonalQ,\n    marginTeamQ,\n    naTeamQ,\n  };\n}\n\n// ============================================================================\n// REALITY SCORE CALCULATION\n// ============================================================================\n\n/**\n * Performance achievement ratio thresholds for score mapping\n * Based on quarterly performance vs targets\n */\nconst PERFORMANCE_SCORE_THRESHOLDS = {\n  EXCELLENT: { min: 1.10, score: 5 }, // >110% achievement\n  GOOD: { min: 0.81, max: 1.10, score: 4 }, // 81-110%\n  ADEQUATE: { min: 0.61, max: 0.80, score: 3 }, // 61-80%\n  POOR: { min: 0, max: 0.60, score: 2 }, // â‰¤60%\n  DEFAULT: 3, // Default when no data\n} as const;\n\n/**\n * Convert performance achievement ratio (0-2+) to reality score (1-5)\n */\nfunction performanceRatioToScore(ratio: number): number {\n  if (ratio >= PERFORMANCE_SCORE_THRESHOLDS.EXCELLENT.min) return PERFORMANCE_SCORE_THRESHOLDS.EXCELLENT.score;\n  if (ratio >= PERFORMANCE_SCORE_THRESHOLDS.GOOD.min) return PERFORMANCE_SCORE_THRESHOLDS.GOOD.score;\n  if (ratio >= PERFORMANCE_SCORE_THRESHOLDS.ADEQUATE.min) return PERFORMANCE_SCORE_THRESHOLDS.ADEQUATE.score;\n  return PERFORMANCE_SCORE_THRESHOLDS.POOR.score;\n}\n\n/**\n * Calculate reality score for a single pilar based on performance data\n * \n * Mapping logic:\n * - Category A (Kinerja Individu): Based on personal margin + NA achievement\n * - Category B (Perilaku & Karakter): Behavioral - use selfScore (no performance mapping)\n * - Category C (Kerja Tim & Leadership): Based on team margin + NA achievement\n * \n * @param pillarId - Pilar ID (1-18)\n * @param category - Pilar category (\"A\", \"B\", \"C\")\n * @param selfScore - Employee's self-assessment score (1-5)\n * @param quarterlyPerformance - Aggregated quarterly performance data\n * @returns Reality score (1-5)\n */\nexport function calculatePillarRealityScore(\n  pillarId: number,\n  category: \"A\" | \"B\" | \"C\",\n  selfScore: number,\n  quarterlyPerformance: {\n    marginPersonalQ: string;\n    naPersonalQ: number;\n    marginTeamQ: string;\n    naTeamQ: number;\n    // Targets (from business plan or historical averages)\n    targetMarginPersonal?: number;\n    targetNAPersonal?: number;\n    targetMarginTeam?: number;\n    targetNATeam?: number;\n  }\n): number {\n  // Category B (Perilaku & Karakter) - behavioral traits, no performance mapping\n  if (category === \"B\") {\n    return selfScore; // Use self-assessment for behavioral categories\n  }\n\n  // Parse performance values\n  const marginPersonal = parseFloat(quarterlyPerformance.marginPersonalQ) || 0;\n  const naPersonal = quarterlyPerformance.naPersonalQ || 0;\n  const marginTeam = parseFloat(quarterlyPerformance.marginTeamQ) || 0;\n  const naTeam = quarterlyPerformance.naTeamQ || 0;\n\n  // Category A (Kinerja Individu) - performance-based\n  if (category === \"A\") {\n    // Use targets if available, otherwise use self-score as baseline\n    if (!quarterlyPerformance.targetMarginPersonal && !quarterlyPerformance.targetNAPersonal) {\n      return selfScore; // No targets = use self-assessment\n    }\n\n    // Calculate achievement ratios\n    const marginRatio = quarterlyPerformance.targetMarginPersonal\n      ? marginPersonal / quarterlyPerformance.targetMarginPersonal\n      : 1.0;\n\n    const naRatio = quarterlyPerformance.targetNAPersonal\n      ? naPersonal / quarterlyPerformance.targetNAPersonal\n      : 1.0;\n\n    // Weight: 70% margin, 30% NA (configurable per business needs)\n    const combinedRatio = marginRatio * 0.7 + naRatio * 0.3;\n\n    return performanceRatioToScore(combinedRatio);\n  }\n\n  // Category C (Kerja Tim & Leadership) - team performance-based\n  if (category === \"C\") {\n    // Use targets if available, otherwise use self-score as baseline\n    if (!quarterlyPerformance.targetMarginTeam && !quarterlyPerformance.targetNATeam) {\n      return selfScore; // No targets = use self-assessment\n    }\n\n    // Calculate team achievement ratios\n    const marginRatio = quarterlyPerformance.targetMarginTeam\n      ? marginTeam / quarterlyPerformance.targetMarginTeam\n      : 1.0;\n\n    const naRatio = quarterlyPerformance.targetNATeam\n      ? naTeam / quarterlyPerformance.targetNATeam\n      : 1.0;\n\n    // Weight: 70% margin, 30% NA\n    const combinedRatio = marginRatio * 0.7 + naRatio * 0.3;\n\n    return performanceRatioToScore(combinedRatio);\n  }\n\n  // Fallback (should never reach here)\n  return selfScore;\n}\n\n/**\n * Calculate gap between reality score and self score\n * \n * Gap logic:\n * - Positive gap: Reality > Self (under-estimated performance)\n * - Negative gap: Reality < Self (over-estimated performance)\n * - For behavioral categories (B), cap negative gaps at 0 (no penalty)\n * \n * @returns Gap value (can be negative for performance categories)\n */\nexport function calculatePillarGap(\n  realityScore: number,\n  selfScore: number,\n  category: \"A\" | \"B\" | \"C\"\n): number {\n  const gap = realityScore - selfScore;\n\n  // Cap negative gaps at 0 for behavioral categories\n  if (category === \"B\" && gap < 0) {\n    return 0;\n  }\n\n  return gap;\n}\n\n/**\n * Generate insight text for a pilar based on gap analysis\n * \n * MVP: Simple template-based insights\n * TODO Phase 2: AI-generated personalized insights\n */\nexport function generatePillarInsight(\n  pillarName: string,\n  selfScore: number,\n  realityScore: number,\n  gap: number,\n  category: \"A\" | \"B\" | \"C\"\n): string {\n  // Large positive gap (under-estimated)\n  if (gap >= 1.5) {\n    return `Performa ${pillarName} melebihi ekspektasi Anda (+${gap.toFixed(1)}). Kekuatan yang perlu dipertahankan!`;\n  }\n\n  // Small positive gap\n  if (gap > 0 && gap < 1.5) {\n    return `${pillarName} menunjukkan performa sedikit lebih baik dari self-assessment. Terus tingkatkan!`;\n  }\n\n  // Aligned (gap near zero)\n  if (gap >= -0.5 && gap <= 0) {\n    return `Self-assessment ${pillarName} akurat dengan realitas performa. Pertahankan konsistensi!`;\n  }\n\n  // Negative gap (over-estimated)\n  if (gap < -0.5 && gap >= -1.5) {\n    return `Ada gap kecil di ${pillarName}. Fokuskan perbaikan untuk mencapai target self-assessment.`;\n  }\n\n  // Large negative gap\n  if (gap < -1.5) {\n    return `Gap signifikan di ${pillarName} (-${Math.abs(gap).toFixed(1)}). Perlu action plan intensif untuk improvement.`;\n  }\n\n  return `${pillarName}: Analisis lebih lanjut diperlukan.`;\n}\n\n// ============================================================================\n// ZONE ANALYSIS\n// ============================================================================\n\n/**\n * Zone thresholds for success/warning/critical classification\n * Based on average reality scores (1-5 scale)\n */\nconst ZONE_THRESHOLDS = {\n  SUCCESS: 4.0, // â‰¥4.0 = Success Zone (Green)\n  WARNING: 3.0, // 3.0-3.99 = Warning Zone (Yellow)\n  // <3.0 = Critical Zone (Red)\n} as const;\n\nexport type ZonaType = \"success\" | \"warning\" | \"critical\";\n\n/**\n * Determine zone based on average score\n */\nfunction scoreToZone(avgScore: number): ZonaType {\n  if (avgScore >= ZONE_THRESHOLDS.SUCCESS) return \"success\";\n  if (avgScore >= ZONE_THRESHOLDS.WARNING) return \"warning\";\n  return \"critical\";\n}\n\n/**\n * Calculate Zona Kinerja from categories A + B weighted average\n * Weight: A (60%), B (40%)\n */\nexport function calculateZonaKinerja(pillarScores: Array<{\n  category: \"A\" | \"B\" | \"C\";\n  realityScore: number;\n}>): ZonaType {\n  const categoryA = pillarScores.filter(p => p.category === \"A\");\n  const categoryB = pillarScores.filter(p => p.category === \"B\");\n\n  if (categoryA.length === 0 || categoryB.length === 0) {\n    throw new Error(\"Missing category A or B pillars for Zona Kinerja calculation\");\n  }\n\n  // Calculate averages\n  const avgA = categoryA.reduce((sum, p) => sum + p.realityScore, 0) / categoryA.length;\n  const avgB = categoryB.reduce((sum, p) => sum + p.realityScore, 0) / categoryB.length;\n\n  // Weighted average: A (60%), B (40%)\n  const weightedAvg = avgA * 0.6 + avgB * 0.4;\n\n  return scoreToZone(weightedAvg);\n}\n\n/**\n * Calculate Zona Perilaku from category C average\n */\nexport function calculateZonaPerilaku(pillarScores: Array<{\n  category: \"A\" | \"B\" | \"C\";\n  realityScore: number;\n}>): ZonaType {\n  const categoryC = pillarScores.filter(p => p.category === \"C\");\n\n  if (categoryC.length === 0) {\n    throw new Error(\"Missing category C pillars for Zona Perilaku calculation\");\n  }\n\n  const avgC = categoryC.reduce((sum, p) => sum + p.realityScore, 0) / categoryC.length;\n\n  return scoreToZone(avgC);\n}\n\n/**\n * Calculate Zona Final with cascade rules\n * \n * Blend: 70% Kinerja + 30% Perilaku\n * Cascade rules:\n * - ANY critical â†’ Final is critical\n * - warning + success â†’ Final is warning\n */\nexport function calculateZonaFinal(\n  zonaKinerja: ZonaType,\n  zonaPerilaku: ZonaType,\n  pillarScores: Array<{ category: \"A\" | \"B\" | \"C\"; realityScore: number }>\n): ZonaType {\n  // Cascade rule: Any critical â†’ Final is critical\n  if (zonaKinerja === \"critical\" || zonaPerilaku === \"critical\") {\n    return \"critical\";\n  }\n\n  // Cascade rule: warning + success â†’ Final is warning\n  if (\n    (zonaKinerja === \"warning\" && zonaPerilaku === \"success\") ||\n    (zonaKinerja === \"success\" && zonaPerilaku === \"warning\")\n  ) {\n    return \"warning\";\n  }\n\n  // Both success â†’ Final is success\n  if (zonaKinerja === \"success\" && zonaPerilaku === \"success\") {\n    return \"success\";\n  }\n\n  // Both warning â†’ Calculate weighted average (70% Kinerja, 30% Perilaku)\n  const categoryA = pillarScores.filter(p => p.category === \"A\");\n  const categoryB = pillarScores.filter(p => p.category === \"B\");\n  const categoryC = pillarScores.filter(p => p.category === \"C\");\n\n  const avgA = categoryA.reduce((sum, p) => sum + p.realityScore, 0) / categoryA.length;\n  const avgB = categoryB.reduce((sum, p) => sum + p.realityScore, 0) / categoryB.length;\n  const avgC = categoryC.reduce((sum, p) => sum + p.realityScore, 0) / categoryC.length;\n\n  // Kinerja = weighted A(60%) + B(40%)\n  const kinerjaScore = avgA * 0.6 + avgB * 0.4;\n  // Perilaku = C average\n  const perilakuScore = avgC;\n\n  // Final = 70% Kinerja + 30% Perilaku\n  const finalWeightedAvg = kinerjaScore * 0.7 + perilakuScore * 0.3;\n\n  return scoreToZone(finalWeightedAvg);\n}\n\n// ============================================================================\n// PROFILE MAPPING\n// ============================================================================\n\nexport type ProfileType = \"Leader\" | \"Visionary\" | \"Performer\" | \"At-Risk\";\n\n/**\n * Determine employee profile based on reality score average and gap patterns\n * \n * Mapping logic:\n * - Leader: â‰¥4.2 avg & gap â‰¤0.5 (high performer, accurate self-awareness)\n * - Visionary: 3.6-4.19 avg (strong performer)\n * - Performer: 3.0-3.59 OR gap >1.0 (solid performer or needs calibration)\n * - At-Risk: <3.0 avg (needs significant improvement)\n */\nexport function calculateProfile(\n  pillarScores: Array<{ realityScore: number; gap: number }>\n): ProfileType {\n  const avgScore = pillarScores.reduce((sum, p) => sum + p.realityScore, 0) / pillarScores.length;\n  // Use mean of ABSOLUTE gaps (not absolute of mean gaps) - prevents cancellation\n  const avgGap = pillarScores.reduce((sum, p) => sum + Math.abs(p.gap), 0) / pillarScores.length;\n\n  // Leader: High performance + accurate self-awareness\n  if (avgScore >= 4.2 && avgGap <= 0.5) {\n    return \"Leader\";\n  }\n\n  // Visionary: Strong performance\n  if (avgScore >= 3.6 && avgScore < 4.2) {\n    return \"Visionary\";\n  }\n\n  // Performer: Solid performance OR needs self-awareness calibration\n  if ((avgScore >= 3.0 && avgScore < 3.6) || avgGap > 1.0) {\n    return \"Performer\";\n  }\n\n  // At-Risk: Needs improvement\n  return \"At-Risk\";\n}\n\n// ============================================================================\n// PRODEM RECOMMENDATION\n// ============================================================================\n\nexport type ProdemRecommendation = \"Promosi\" | \"Dipertahankan\" | \"Pembinaan\" | \"Demosi\";\n\nexport interface ProdemResult {\n  currentPosition: string;\n  recommendation: ProdemRecommendation;\n  nextPosition?: string;\n  reason: string;\n  konsekuensi: string;\n  nextStep: string;\n  requirements: Array<{\n    label: string;\n    value: string;\n    met: boolean;\n  }>;\n}\n\n/**\n * Generate ProDem recommendation based on zones, profile, and performance trends\n * \n * Logic:\n * - Success zone:\n *   - Promosi: If Leader profile + sustained over-target margin\n *   - Dipertahankan: Otherwise\n * - Warning zone:\n *   - Pembinaan: Standard\n *   - Demosi: If large downward trend detected\n * - Critical zone:\n *   - Demosi: Standard\n *   - Pembinaan: If tenure <6 months (new employee grace period)\n */\nexport function calculateProDemRecommendation(\n  zonaFinal: ZonaType,\n  profile: ProfileType,\n  currentPosition: string,\n  pillarScores: Array<{\n    pillarId: number;\n    pillarName: string;\n    category: \"A\" | \"B\" | \"C\";\n    realityScore: number;\n    gap: number;\n  }>,\n  options: {\n    marginOverTarget?: boolean; // Is margin consistently over target?\n    employeeTenureMonths?: number; // Employee tenure in months\n    nextPositionName?: string; // Next position if promotion\n  } = {}\n): ProdemResult {\n  const { marginOverTarget = false, employeeTenureMonths = 12, nextPositionName } = options;\n\n  // Success Zone\n  if (zonaFinal === \"success\") {\n    // Promosi: Leader + sustained over-target\n    if (profile === \"Leader\" && marginOverTarget) {\n      return {\n        currentPosition,\n        recommendation: \"Promosi\",\n        nextPosition: nextPositionName,\n        reason: \"Performa konsisten di Success Zone dengan profile Leader. Margin melebihi target secara berkelanjutan.\",\n        konsekuensi: \"Promosi ke posisi lebih tinggi untuk memaksimalkan potensi kepemimpinan.\",\n        nextStep: \"Persiapan onboarding role baru, knowledge transfer, dan succession planning.\",\n        requirements: [\n          {\n            label: \"Avg Reality Score\",\n            value: \"â‰¥4.2\",\n            met: true,\n          },\n          {\n            label: \"Zona Final\",\n            value: \"Success\",\n            met: true,\n          },\n          {\n            label: \"Margin Achievement\",\n            value: \">110% target\",\n            met: marginOverTarget,\n          },\n        ],\n      };\n    }\n\n    // Dipertahankan: Success but not ready for promotion\n    return {\n      currentPosition,\n      recommendation: \"Dipertahankan\",\n      reason: `Performa solid di Success Zone (${profile}). Pertahankan konsistensi untuk promosi berikutnya.`,\n      konsekuensi: \"Maintain current role dengan peningkatan tanggung jawab.\",\n      nextStep: \"Focus on leadership development dan skill enhancement untuk persiapan promosi.\",\n      requirements: [\n        {\n          label: \"Zona Final\",\n          value: \"Success\",\n          met: true,\n        },\n        {\n          label: \"Konsistensi\",\n          value: \"Pertahankan 2-3 quarter\",\n          met: false,\n        },\n      ],\n    };\n  }\n\n  // Warning Zone\n  if (zonaFinal === \"warning\") {\n    // Check for large downward trend (many pillars with big negative gaps)\n    const largeNegativeGaps = pillarScores.filter(p => p.gap < -1.5).length;\n    const avgRealityScore = pillarScores.reduce((sum, p) => sum + p.realityScore, 0) / pillarScores.length;\n    \n    // Demosi if large downward trend detected (>6 pillars with negative gap AND avg<3.2)\n    if (largeNegativeGaps >= 6 && avgRealityScore < 3.2) {\n      return {\n        currentPosition,\n        recommendation: \"Demosi\",\n        reason: `Warning Zone dengan tren penurunan signifikan. ${largeNegativeGaps} pilar dengan gap negatif besar menunjukkan over-estimation sistematis.`,\n        konsekuensi: \"Demosi ke posisi level lebih rendah dengan program pembinaan intensif.\",\n        nextStep: \"Diskusi one-on-one untuk role transition dan realistic goal setting.\",\n        requirements: [\n          {\n            label: \"Avg Reality Score\",\n            value: \"Target min 3.5 dalam 3 bulan\",\n            met: false,\n          },\n          {\n            label: \"Self-Awareness Calibration\",\n            value: \"Align self-assessment dengan reality\",\n            met: false,\n          },\n        ],\n      };\n    }\n\n    // Pembinaan: Standard warning zone action\n    // Identify gap-heavy pillars for coaching focus (SORTED by magnitude)\n    const gapPillars = pillarScores\n      .filter(p => Math.abs(p.gap) > 1.0)\n      .sort((a, b) => Math.abs(b.gap) - Math.abs(a.gap)) // Sort by gap magnitude DESC\n      .slice(0, 3); // Top 3 gap pillars\n\n    return {\n      currentPosition,\n      recommendation: \"Pembinaan\",\n      reason: `Performa di Warning Zone memerlukan improvement plan. Gap terbesar di: ${gapPillars.map(p => p.pillarName).join(\", \")}.`,\n      konsekuensi: \"Program pembinaan intensif selama 3-6 bulan. Evaluasi berkala untuk progress tracking.\",\n      nextStep: \"Action plan 30-60-90 hari dengan fokus coaching pada area gap terbesar.\",\n      requirements: gapPillars.map(p => ({\n        label: p.pillarName,\n        value: `Improve score dari ${p.realityScore} ke min 4.0`,\n        met: false,\n      })),\n    };\n  }\n\n  // Critical Zone\n  if (zonaFinal === \"critical\") {\n    // Grace period for new employees (<6 months)\n    if (employeeTenureMonths < 6) {\n      return {\n        currentPosition,\n        recommendation: \"Pembinaan\",\n        reason: \"Performa Critical Zone pada tahap awal (tenure <6 bulan). Berikan kesempatan improvement dengan coaching intensif.\",\n        konsekuensi: \"Program onboarding diperpanjang dengan mentoring khusus selama 3 bulan. Re-evaluasi setelah periode pembinaan.\",\n        nextStep: \"Daily/weekly check-in dengan supervisor, skill training, dan clear performance milestones.\",\n        requirements: [\n          {\n            label: \"Avg Reality Score\",\n            value: \"Target min 3.5 dalam 3 bulan\",\n            met: false,\n          },\n          {\n            label: \"Attendance & Attitude\",\n            value: \"100% compliance\",\n            met: false,\n          },\n        ],\n      };\n    }\n\n    // Demosi for established employees\n    return {\n      currentPosition,\n      recommendation: \"Demosi\",\n      reason: \"Performa Critical Zone berkelanjutan. Perlu penempatan role yang lebih sesuai dengan current capability.\",\n      konsekuensi: \"Demosi ke posisi level lebih rendah dengan action plan perbaikan. Monitoring ketat selama 6 bulan.\",\n      nextStep: \"Diskusi one-on-one untuk role transition, setting realistic targets, dan commitment plan.\",\n      requirements: [\n        {\n          label: \"Avg Reality Score\",\n          value: \"Target min 3.0 dalam role baru\",\n          met: false,\n        },\n        {\n          label: \"Attitude & Effort\",\n          value: \"Komitmen improvement\",\n          met: false,\n        },\n      ],\n    };\n  }\n\n  // Fallback (should never reach here)\n  return {\n    currentPosition,\n    recommendation: \"Dipertahankan\",\n    reason: \"Status quo - evaluasi lebih lanjut diperlukan.\",\n    konsekuensi: \"Maintain current position.\",\n    nextStep: \"Regular performance review.\",\n    requirements: [],\n  };\n}\n\n// ============================================================================\n// DETERMINISTIC REPORT SECTIONS\n// ============================================================================\n\n/**\n * Generate quarterly performance progress narrative\n * \n * Transforms quarterly performance data into structured analysis:\n * - Revenue achievement vs target\n * - Margin performance trends\n * - NA (New Accounts) acquisition\n * - Key performance indicators\n */\nexport function generateProgressKuartal(\n  quarterlyPerformance: {\n    marginPersonalQ: string;\n    naPersonalQ: number;\n    marginTeamQ: string;\n    naTeamQ: number;\n    targetMarginPersonal?: number;\n    targetNAPersonal?: number;\n    targetMarginTeam?: number;\n    targetNATeam?: number;\n  }\n): {\n  ringkasan: string;\n  personalAchievement: {\n    margin: { actual: string; target?: number; status: \"above\" | \"meet\" | \"below\" };\n    na: { actual: number; target?: number; status: \"above\" | \"meet\" | \"below\" };\n  };\n  teamAchievement: {\n    margin: { actual: string; target?: number; status: \"above\" | \"meet\" | \"below\" };\n    na: { actual: number; target?: number; status: \"above\" | \"meet\" | \"below\" };\n  };\n} {\n  const marginPersonal = parseFloat(quarterlyPerformance.marginPersonalQ) || 0;\n  const marginTeam = parseFloat(quarterlyPerformance.marginTeamQ) || 0;\n  const naPersonal = quarterlyPerformance.naPersonalQ || 0;\n  const naTeam = quarterlyPerformance.naTeamQ || 0;\n\n  // Determine achievement status\n  const getStatus = (actual: number, target?: number): \"above\" | \"meet\" | \"below\" => {\n    if (!target) return \"meet\";\n    if (actual > target * 1.05) return \"above\"; // >5% over target\n    if (actual >= target * 0.95) return \"meet\"; // Within Â±5%\n    return \"below\";\n  };\n\n  const personalMarginStatus = getStatus(marginPersonal, quarterlyPerformance.targetMarginPersonal);\n  const personalNAStatus = getStatus(naPersonal, quarterlyPerformance.targetNAPersonal);\n  const teamMarginStatus = getStatus(marginTeam, quarterlyPerformance.targetMarginTeam);\n  const teamNAStatus = getStatus(naTeam, quarterlyPerformance.targetNATeam);\n\n  // Generate summary narrative\n  const achievements: string[] = [];\n  if (personalMarginStatus === \"above\") achievements.push(\"margin personal melampaui target\");\n  if (personalNAStatus === \"above\") achievements.push(\"akuisisi NA personal excellent\");\n  if (teamMarginStatus === \"above\") achievements.push(\"margin team outstanding\");\n  if (teamNAStatus === \"above\") achievements.push(\"team NA acquisition strong\");\n\n  const concerns: string[] = [];\n  if (personalMarginStatus === \"below\") concerns.push(\"margin personal below target\");\n  if (personalNAStatus === \"below\") concerns.push(\"NA personal acquisition needs improvement\");\n  if (teamMarginStatus === \"below\") concerns.push(\"margin team underperforming\");\n  if (teamNAStatus === \"below\") concerns.push(\"team NA acquisition sluggish\");\n\n  let ringkasan = \"Performance kuartal ini \";\n  if (achievements.length > 0) {\n    ringkasan += `menunjukkan kekuatan di: ${achievements.join(\", \")}. `;\n  }\n  if (concerns.length > 0) {\n    ringkasan += `Area yang memerlukan perhatian: ${concerns.join(\", \")}.`;\n  } else if (achievements.length === 0) {\n    ringkasan += \"sesuai dengan target yang ditetapkan.\";\n  }\n\n  return {\n    ringkasan,\n    personalAchievement: {\n      margin: {\n        actual: quarterlyPerformance.marginPersonalQ,\n        target: quarterlyPerformance.targetMarginPersonal,\n        status: personalMarginStatus,\n      },\n      na: {\n        actual: naPersonal,\n        target: quarterlyPerformance.targetNAPersonal,\n        status: personalNAStatus,\n      },\n    },\n    teamAchievement: {\n      margin: {\n        actual: quarterlyPerformance.marginTeamQ,\n        target: quarterlyPerformance.targetMarginTeam,\n        status: teamMarginStatus,\n      },\n      na: {\n        actual: naTeam,\n        target: quarterlyPerformance.targetNATeam,\n        status: teamNAStatus,\n      },\n    },\n  };\n}\n\n/**\n * Generate Early Warning System (EWS) alerts\n * \n * Identifies low-scoring pillars that require immediate attention:\n * - Critical pillars (score <3.0)\n * - Warning pillars (score 3.0-3.5)\n * - Large gap pillars (self-assessment vs reality)\n */\nexport function generateEWS(\n  pillarScores: Array<{\n    pillarId: number;\n    pillarName: string;\n    category: \"A\" | \"B\" | \"C\";\n    selfScore: number;\n    realityScore: number;\n    gap: number;\n  }>\n): {\n  level: \"critical\" | \"warning\" | \"good\";\n  ringkasan: string;\n  criticalPillars: Array<{ pillarName: string; score: number; gap: number }>;\n  warningPillars: Array<{ pillarName: string; score: number; gap: number }>;\n  largeGapPillars: Array<{ pillarName: string; selfScore: number; realityScore: number; gap: number }>;\n} {\n  // Identify problematic pillars\n  const criticalPillars = pillarScores\n    .filter(p => p.realityScore < 3.0)\n    .map(p => ({ pillarName: p.pillarName, score: p.realityScore, gap: p.gap }))\n    .sort((a, b) => a.score - b.score); // Lowest score first\n\n  const warningPillars = pillarScores\n    .filter(p => p.realityScore >= 3.0 && p.realityScore < 3.5)\n    .map(p => ({ pillarName: p.pillarName, score: p.realityScore, gap: p.gap }))\n    .sort((a, b) => a.score - b.score);\n\n  const largeGapPillars = pillarScores\n    .filter(p => Math.abs(p.gap) > 1.5)\n    .map(p => ({\n      pillarName: p.pillarName,\n      selfScore: p.selfScore,\n      realityScore: p.realityScore,\n      gap: p.gap,\n    }))\n    .sort((a, b) => Math.abs(b.gap) - Math.abs(a.gap)); // Largest gap first\n\n  // Determine overall EWS level\n  let level: \"critical\" | \"warning\" | \"good\";\n  let ringkasan: string;\n\n  if (criticalPillars.length > 0) {\n    level = \"critical\";\n    ringkasan = `CRITICAL: ${criticalPillars.length} pilar dengan score <3.0 memerlukan immediate action. ${\n      largeGapPillars.length > 0\n        ? `Self-awareness gap detected pada ${largeGapPillars.length} pilar.`\n        : \"\"\n    }`;\n  } else if (warningPillars.length >= 3) {\n    level = \"warning\";\n    ringkasan = `WARNING: ${warningPillars.length} pilar dalam warning zone (3.0-3.5). Preventive action diperlukan untuk mencegah penurunan lebih lanjut.`;\n  } else if (warningPillars.length > 0 || largeGapPillars.length > 0) {\n    level = \"warning\";\n    ringkasan = `CAUTION: ${warningPillars.length} pilar needs improvement. ${\n      largeGapPillars.length > 0\n        ? `Gap awareness detected - coaching untuk self-calibration recommended.`\n        : \"\"\n    }`;\n  } else {\n    level = \"good\";\n    ringkasan = \"HEALTHY: Semua pilar dalam kondisi baik. Maintain momentum dan continue best practices.\";\n  }\n\n  return {\n    level,\n    ringkasan,\n    criticalPillars,\n    warningPillars,\n    largeGapPillars,\n  };\n}\n","size_bytes":27310},"shared/types.ts":{"content":"import type { Employee, Audit } from \"./schema\";\n\nexport type QuarterlyPerformanceDto = {\n  employeeId: string;\n  year: number;\n  quarter: number;\n  aggregated: {\n    totalMarginPersonal: string;\n    totalNAPersonal: number;\n    totalLotSettled: number;\n  };\n  months: Array<{\n    month: number;\n    marginPersonal: string;\n    naPersonal: number;\n    lotSettled: number;\n  }>;\n};\n\nexport type AuditDetailDto = Omit<Audit, 'employee'> & {\n  employee: {\n    id: string;\n    employeeCode: string;\n    fullName: string;\n    email: string | null;\n    phone: string | null;\n    position: {\n      id: string;\n      code: string;\n      name: string;\n      level: number;\n    } | null;\n    pt: {\n      id: string;\n      code: string;\n      name: string;\n    } | null;\n    branch: {\n      id: string;\n      code: string;\n      name: string;\n    } | null;\n  };\n};\n\nexport type PendingSubordinateDto = {\n  id: string;\n  employeeCode: string;\n  fullName: string;\n  positionName: string;\n  positionLevel: number;\n};\n\nexport type AuditCreateResultDto = {\n  audit: AuditDetailDto;\n  warnings: string[];\n  pendingSubordinates: PendingSubordinateDto[];\n};\n\nexport type AuditPdfDto = {\n  fullName: string;\n  position: string;\n  branch: string;\n  ptCompany: string;\n  birthDate: string;\n  year: number;\n  quarter: number;\n  totalRealityScore: number;\n  totalSelfScore: number;\n  totalGap: number;\n  profil: string;\n  zonaFinal: string;\n  auditReport: any;\n  prodemRekomendasi: any;\n  magicSection: any;\n  pillarAnswers: any[];\n};\n","size_bytes":1511},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\nimport { AuthProvider, useAuth } from \"@/lib/auth-context\";\nimport HierarchicalDashboard from \"@/pages/HierarchicalDashboard\";\nimport AuditDetail from \"@/pages/AuditDetail\";\nimport NewAudit from \"@/pages/NewAudit\";\nimport Login from \"@/pages/Login\";\nimport Register from \"@/pages/Register\";\nimport ForgotPassword from \"@/pages/ForgotPassword\";\nimport AdminDashboard from \"@/pages/AdminDashboard\";\nimport AdminAuditLog from \"@/pages/AdminAuditLog\";\nimport OrganizationalSetup from \"@/pages/OrganizationalSetup\";\nimport EmployeeMasterData from \"@/pages/EmployeeMasterData\";\nimport PerformanceInput from \"@/pages/PerformanceInput\";\nimport AuditCreation from \"@/pages/AuditCreation\";\nimport NotFound from \"@/pages/not-found\";\nimport { ClipboardList, MessageCircle, LogOut, UserCircle, Shield, Home, FileText, Building2, Users, TrendingUp, ClipboardCheck } from \"lucide-react\";\nimport type { ReactNode } from \"react\";\n\n// Protected Route Component\nfunction ProtectedRoute({ children }: { children: ReactNode }) {\n  const { user, isLoading } = useAuth();\n  const [location] = useLocation();\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"w-12 h-12 border-4 border-purple-500/30 border-t-purple-500 rounded-full animate-spin mx-auto\" />\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    // Save the intended destination before redirecting to login\n    sessionStorage.setItem(\"returnUrl\", location);\n    return <Redirect to=\"/login\" />;\n  }\n\n  return <>{children}</>;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      {/* Public routes */}\n      <Route path=\"/login\" component={Login} />\n      <Route path=\"/register\" component={Register} />\n      <Route path=\"/forgot-password\" component={ForgotPassword} />\n      \n      {/* Protected routes - Order matters! More specific routes first */}\n      <Route path=\"/\">\n        <ProtectedRoute>\n          <HierarchicalDashboard />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/organizational-setup\">\n        <ProtectedRoute>\n          <OrganizationalSetup />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/employees\">\n        <ProtectedRoute>\n          <EmployeeMasterData />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/performance\">\n        <ProtectedRoute>\n          <PerformanceInput />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/audit/create\">\n        <ProtectedRoute>\n          <AuditCreation />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/audit-log\">\n        <ProtectedRoute>\n          <AdminAuditLog />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin\">\n        <ProtectedRoute>\n          <AdminDashboard />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/audit/new\">\n        <ProtectedRoute>\n          <NewAudit />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/audit/:id\">\n        <ProtectedRoute>\n          <AuditDetail />\n        </ProtectedRoute>\n      </Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\n// Header with auth info\nfunction AppHeader() {\n  const { user, logout } = useAuth();\n  const [location, setLocation] = useLocation();\n\n  const handleLogout = async () => {\n    await logout();\n    setLocation(\"/login\");\n  };\n\n  if (!user) return null;\n\n  return (\n    <header className=\"fixed top-0 left-0 right-0 z-50 border-b bg-background/80 backdrop-blur-xl supports-[backdrop-filter]:bg-background/60 shadow-sm\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-2 sm:gap-4\">\n        <div className=\"flex items-center gap-2 sm:gap-4\">\n          <div className=\"flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity\" onClick={() => setLocation(\"/\")}>\n            <div className=\"rounded-full overflow-hidden shadow-lg ring-2 ring-amber-500/30 hover:ring-amber-500/50 w-10 h-10 sm:w-12 sm:h-12 transition-all\">\n              <img \n                src=\"/logo-aisg.jpg\" \n                alt=\"AiSG\" \n                className=\"w-full h-full object-cover\"\n              />\n            </div>\n            <div>\n              <h1 className=\"text-lg sm:text-xl font-bold bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-600 bg-clip-text text-transparent\">AiSG</h1>\n              <p className=\"text-[10px] sm:text-xs text-muted-foreground\">Audit Intelligence SG</p>\n            </div>\n          </div>\n\n          {/* Navigation Links */}\n          <div className=\"hidden sm:flex items-center gap-2\">\n            <Button\n              variant={location === \"/\" ? \"default\" : \"ghost\"}\n              size=\"sm\"\n              onClick={() => setLocation(\"/\")}\n              className=\"gap-1.5\"\n            >\n              <Home className=\"w-4 h-4\" />\n              Home\n            </Button>\n            <Button\n              variant={location === \"/performance\" ? \"default\" : \"ghost\"}\n              size=\"sm\"\n              onClick={() => setLocation(\"/performance\")}\n              className=\"gap-1.5\"\n              data-testid=\"nav-performance\"\n            >\n              <TrendingUp className=\"w-4 h-4\" />\n              Performance\n            </Button>\n            <Button\n              variant={location === \"/audit/create\" ? \"default\" : \"ghost\"}\n              size=\"sm\"\n              onClick={() => setLocation(\"/audit/create\")}\n              className=\"gap-1.5\"\n              data-testid=\"nav-audit-create\"\n            >\n              <ClipboardCheck className=\"w-4 h-4\" />\n              Buat Audit\n            </Button>\n            {(user.role === \"super_admin\" || user.role === \"owner\") && (\n              <>\n                <Button\n                  variant={location === \"/organizational-setup\" ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setLocation(\"/organizational-setup\")}\n                  className=\"gap-1.5\"\n                >\n                  <Building2 className=\"w-4 h-4\" />\n                  Setup Organisasi\n                </Button>\n                <Button\n                  variant={location === \"/employees\" ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setLocation(\"/employees\")}\n                  className=\"gap-1.5\"\n                  data-testid=\"nav-employees\"\n                >\n                  <Users className=\"w-4 h-4\" />\n                  Master Karyawan\n                </Button>\n                <Button\n                  variant={location === \"/admin\" ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setLocation(\"/admin\")}\n                  className=\"gap-1.5\"\n                >\n                  <Shield className=\"w-4 h-4\" />\n                  Admin\n                </Button>\n                <Button\n                  variant={location === \"/admin/audit-log\" ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setLocation(\"/admin/audit-log\")}\n                  className=\"gap-1.5\"\n                >\n                  <FileText className=\"w-4 h-4\" />\n                  Audit Log\n                </Button>\n              </>\n            )}\n          </div>\n        </div>\n        \n        <div className=\"flex items-center gap-2 sm:gap-3\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"gap-1.5 sm:gap-2 text-xs sm:text-sm border-green-500/30 hover:bg-green-500/10 hover:border-green-500/50 transition-all duration-300\"\n            onClick={() => window.open('https://chatgpt.com/g/g-68f60e2ded048191816ee3e67eea952f-aisg-audit-intelligence-system-growth', '_blank')}\n          >\n            <MessageCircle className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n            <span className=\"hidden sm:inline\">ChatGPT</span>\n            <span className=\"sm:hidden\">GPT</span>\n          </Button>\n          \n          <ThemeToggle />\n          \n          {/* User Profile Dropdown */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                className=\"flex items-center gap-2 px-3 py-1.5 h-auto rounded-lg bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/20 hover:bg-purple-500/20 transition-all\"\n                data-testid=\"button-user-profile\"\n              >\n                <UserCircle className=\"w-4 h-4 text-purple-400\" />\n                <div className=\"hidden md:block text-left text-xs\">\n                  <p className=\"font-medium text-white\">{user.name}</p>\n                  <p className=\"text-purple-300\">\n                    {user.role === 'super_admin' ? 'Super Admin' : user.role.replace('_', ' ')}\n                  </p>\n                </div>\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-56\">\n              <DropdownMenuLabel>\n                <div className=\"flex flex-col space-y-1\">\n                  <p className=\"text-sm font-medium leading-none\">{user.name}</p>\n                  <p className=\"text-xs leading-none text-muted-foreground\">\n                    {user.role === 'super_admin' ? 'Super Admin - Full Access' : user.role.replace('_', ' ')}\n                  </p>\n                </div>\n              </DropdownMenuLabel>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem\n                onClick={handleLogout}\n                className=\"text-red-500 focus:text-red-600 focus:bg-red-500/10 cursor-pointer\"\n                data-testid=\"menu-logout\"\n              >\n                <LogOut className=\"w-4 h-4 mr-2\" />\n                Logout\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </div>\n    </header>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <TooltipProvider>\n          <div className=\"min-h-screen bg-background\">\n            <AppHeader />\n            <div className=\"pt-[60px] sm:pt-[68px]\">\n              <Router />\n            </div>\n          </div>\n          <Toaster />\n        </TooltipProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":10912},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"AISG_ENTERPRISE_ARCHITECTURE_v1.0.md":{"content":"# AISG ENTERPRISE - MASTER ARCHITECTURE DOCUMENT\n\n**Version:** 1.0  \n**Date:** November 11, 2025  \n**Status:** Design Phase - Ready for Implementation  \n**Estimated Implementation:** 30 hours | 15-20 checkpoints | $60-100 budget\n\n---\n\n## ðŸ“‹ TABLE OF CONTENTS\n\n1. [Executive Summary](#1-executive-summary)\n2. [Business Context](#2-business-context)\n3. [Current System Overview (aisg23)](#3-current-system-overview)\n4. [New Features Specification](#4-new-features-specification)\n5. [Database Architecture](#5-database-architecture)\n6. [API Endpoints](#6-api-endpoints)\n7. [UI/UX Design](#7-uiux-design)\n8. [Security & Data Protection](#8-security--data-protection)\n9. [Backup & Recovery](#9-backup--recovery)\n10. [Implementation Roadmap](#10-implementation-roadmap)\n11. [Testing & Deployment](#11-testing--deployment)\n12. [Appendix](#12-appendix)\n\n---\n\n## 1. EXECUTIVE SUMMARY\n\n### 1.1 Business Problem\n\n**Original Goal:** Audit system untuk meningkatkan kinerja karyawan (from aisg23)\n\n**Enterprise Challenge:** Sistem aisg23 sudah bagus untuk individual/team audit, tapi ada 2 gap critical:\n\n1. **Data Onboarding:** 10,000 karyawan perlu onboarding strategy yang scalable\n2. **Strategic Reporting:** Owner/management perlu lihat performance by PT/legal entity (cross-CEO aggregation)\n\n### 1.2 Solution Overview\n\n**AISG Enterprise** = aisg23 + 7 New Features:\n\n1. **BAS API Integration** - Real-time sync employee + margin data\n2. **PT/Legal Entity Reporting** - Dual view dashboard (Hierarchy + PT)\n3. **Individual Mode** - Personal tracking tanpa team aggregation\n4. **Notification System** - Dashboard alerts (daily digest)\n5. **Enhanced Security** - Strict access control + password policy\n6. **Backup & Recovery** - Daily backup + monthly test\n7. **Manual Excel Upload** - Contingency plan (kalau BAS offline)\n\n### 1.3 Key Benefits\n\nâœ… **Scalability:** 10k employees onboarding via auto-match registration  \nâœ… **Strategic Insights:** PT-level performance tracking (compliance & tax reporting)  \nâœ… **Flexibility:** Individual mode untuk personal growth tracking  \nâœ… **Reliability:** BAS integration dengan fallback manual upload  \nâœ… **Security:** Enterprise-grade access control + daily backup  \n\n---\n\n## 2. BUSINESS CONTEXT\n\n### 2.1 Organization Structure\n\n**11-Level Hierarchy:**\n```\nOwner (1 orang)\nâ”œâ”€ CEO (5 orang - 1 per PT atau cross-PT)\nâ”‚  â””â”€ CBO (Multiple - bisa manage lintas PT)\nâ”‚     â””â”€ BrM (1 per cabang - tied to 1 cabang)\nâ”‚        â””â”€ VBM (Cabang-specific)\nâ”‚           â””â”€ SVBM (Cabang-specific)\nâ”‚              â””â”€ SEM (Cabang-specific)\nâ”‚                 â””â”€ EM (Cabang-specific)\nâ”‚                    â””â”€ SBM (Cabang-specific)\nâ”‚                       â””â”€ BsM (Cabang-specific)\nâ”‚                          â””â”€ SBC (Cabang-specific)\nâ”‚                             â””â”€ BC (Cabang-specific)\n```\n\n**Key Rules:**\n- Strategic level (Owner/CEO/CBO): Bisa manage lintas PT\n- Operational level (BrM â†’ BC): Strict 1 cabang only\n- Hierarchy based on `managerId` (bukan PT!)\n\n### 2.2 Legal Entity Structure\n\n**5 Active PTs:**\n1. **RFB** - Rifan Financindo Berjangka (14 cabang)\n2. **BPF** - Best Profit Futures (12 cabang)\n3. **EWF** - Equity World Futures (7 cabang)\n4. **KPF** - Kontak Perkasa Futures (6 cabang)\n5. **SGB** - Solid Gold Berjangka (3 cabang)\n\n**Total:** 42 cabang, ~10,000 employees\n\n**PT Assignment:**\n- CEO assign PT ke cabang (manual, flexible)\n- PT cuma metadata (untuk legal/tax reporting)\n- PT bukan untuk access control (hierarchy = king!)\n\n### 2.3 Workforce Characteristics\n\n- **High turnover:** 100+ karyawan baru per cabang\n- **Commission-based:** Performance tracking critical\n- **Email availability:** Anggap ga ada (perlu self-registration)\n- **Tech literacy:** Mixed (Owner/CEO gaptek, staff OK)\n\n---\n\n## 3. CURRENT SYSTEM OVERVIEW (aisg23)\n\n### 3.1 Existing Features (KEEP AS-IS)\n\nâœ… **18 Pilar Framework** - Self-assessment (1-5 scale per pilar)  \nâœ… **Reality Score** - Calculated from margin/NA ratio  \nâœ… **Zone Analysis** - Success (â‰¥4jt), Warning (â‰¥2jt), Critical (<2jt)  \nâœ… **Employee Profile** - SWOT, ProDem, Action Plan 30-60-90  \nâœ… **Early Warning System** - Alert untuk zona Critical  \nâœ… **Magic Section** - Julukan, Zodiak, Generasi  \nâœ… **Dashboard Analytics** - Charts, trends, KPIs  \nâœ… **AI Chat Assistant** - OpenAI â†’ Gemini â†’ Internal KB (3-source fallback)  \nâœ… **PDF Export** - 12 sections + Magic Section  \nâœ… **Hierarchy Aggregation** - Bottom-up (BC â†’ SBC â†’ ... â†’ CEO â†’ Owner)  \n\n### 3.2 Current Data Model\n\n**Core Tables (Existing):**\n- `users` - Login credentials\n- `employees` - Employee master (hierarchy via managerId)\n- `branches` - 42 cabang\n- `monthly_performance` - Margin + NA per employee per month\n- `audits` - Quarterly audit data (18 Pilar + aggregated metrics)\n- `chatMessages` - AI chat history\n\n### 3.3 Technology Stack (Existing)\n\n**Frontend:** React 18 + TypeScript + Vite  \n**Backend:** Node.js + Express.js  \n**Database:** PostgreSQL 16 (Neon serverless)  \n**ORM:** Drizzle ORM  \n**UI:** shadcn/ui (Radix UI) + Tailwind CSS  \n**Auth:** express-session + bcrypt  \n**AI:** OpenAI API + Google Gemini API  \n\n---\n\n## 4. NEW FEATURES SPECIFICATION\n\n### 4.1 FEATURE 1: BAS API Integration\n\n#### 4.1.1 Overview\n\n**Purpose:** Real-time sync employee + margin data dari BAS (desktop system existing)\n\n**BAS API Endpoint:**\n```\nhttp://192.168.10.182:3000/get-margin-info/:tahun/:kuartal/:kode_cabang\n\nExample:\nhttp://192.168.10.182:3000/get-margin-info/2025/1/AB\n\nResponse: Excel/CSV/TXT file\n```\n\n#### 4.1.2 Data Sync Scope\n\n**FROM BAS (Auto-sync):**\n- Employee code âœ…\n- Nama âœ…\n- Posisi/Jabatan âœ…\n- Atasan langsung (employee code) âœ…\n- Cabang âœ…\n- Tanggal lahir âœ…\n- Margin (daily/monthly) âœ…\n- NA count âœ…\n\n**AISG Can Override:**\n- Nama (update ke nama KTP)\n- Email (user isi sendiri - email pribadi)\n- Posisi (super admin promosi/degradasi manual)\n- Atasan (super admin fix kalau BAS telat)\n\n#### 4.1.3 Sync Strategy\n\n**Frequency:** Daily (auto-sync, bertahap by cabang)  \n**Method:** Pull dari BAS API (AISG call BAS)  \n**Conflict Resolution:** BAS is source of truth (AISG read-only, tapi bisa override manual)  \n**Hierarchy Building:** Recursive build dari \"atasan langsung\" (BAS format berantakan, AISG normalize)  \n\n#### 4.1.4 API Contract\n\n**AISG Request:**\n```javascript\nGET http://192.168.10.182:3000/get-margin-info/2025/1/AB\n```\n\n**BAS Response (Excel format):**\n```\nColumns:\n- tahun (2025)\n- kuartal (1)\n- kode_cabang (AB)\n- kode_karyawan (EMP001)\n- nama (Andi Wijaya)\n- jabatan (BC)\n- kode_atasan (EMP050 - SBC)\n- margin (1000000)\n- na (5)\n- tanggal_lahir (1990-03-15)\n```\n\n**AISG Processing:**\n1. Parse Excel/CSV\n2. Validate employee code (duplicate check)\n3. Build hierarchy (recursive dari kode_atasan)\n4. Insert/update employees table\n5. Insert/update monthly_performance table\n6. Log sync status (timestamp, records count, errors)\n\n#### 4.1.5 Error Handling\n\n**Scenarios:**\n- BAS API down â†’ Use manual Excel upload (Feature 7)\n- Invalid data â†’ Log error, skip record, notify admin\n- Hierarchy broken â†’ Flag for manual review\n- Duplicate employee code â†’ Override with latest data\n\n---\n\n### 4.2 FEATURE 2: PT/Legal Entity Reporting\n\n#### 4.2.1 Overview\n\n**Purpose:** Dual reporting system - View performance by Hierarchy (operational) OR by PT (legal/strategic)\n\n**Access:** Owner, Super Admin, Superadmin1/2/3 (full access) | CEO (filtered by PT mereka manage)\n\n#### 4.2.2 PT Dashboard (Main View)\n\n**Layout:**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  PT/Legal Entity View - Q1 2025                          â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  [Period Selector: Q1 2025 â–¼]  [Export All PDF]         â•‘\nâ•‘                                                          â•‘\nâ•‘  ðŸ“Š Company Total:                                       â•‘\nâ•‘  â€¢ Total Margin: $134M                                   â•‘\nâ•‘  â€¢ Total Staff: 1,450 orang                              â•‘\nâ•‘  â€¢ Total Cabang: 42                                      â•‘\nâ•‘  â€¢ Active PTs: 5                                         â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  PT Cards (5):                                           â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘\nâ•‘  â”‚ RFB (Rifan Financindo Berjangka)      36.8%       â”‚  â•‘\nâ•‘  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ $50M         â”‚  â•‘\nâ•‘  â”‚ 14 cabang â€¢ 500 staff â€¢ ðŸŸ© Success                â”‚  â•‘\nâ•‘  â”‚ [View Detail â†’]                                   â”‚  â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘\nâ•‘  ... (BPF, EWF, KPF, SGB cards)                          â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Metrics per PT:**\n- Total margin (sum across all cabang)\n- Total staff count\n- Total cabang count\n- Total new accounts\n- Zona (Success/Warning/Critical based on avg reality score)\n- % contribution to company total\n- Trend chart (Q1-Q4, YoY)\n\n#### 4.2.3 PT Detail Page\n\n**URL:** `/reports/pt/:ptCode?period=2025-Q1`\n\n**Layout:**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  RFB (Rifan Financindo Berjangka) - Q1 2025             â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Summary:                                                â•‘\nâ•‘  â€¢ Total Margin: $50M                                    â•‘\nâ•‘  â€¢ Total Staff: 500 orang                                â•‘\nâ•‘  â€¢ Total Cabang: 14                                      â•‘\nâ•‘  â€¢ Zona: Success ðŸŸ©                                      â•‘\nâ•‘                                                          â•‘\nâ•‘  [Export PDF] [Export Excel] [Sync from BAS]            â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  ðŸ“ˆ Trend Charts:                                        â•‘\nâ•‘  - Margin trend (Q1'24 â†’ Q1'25)                         â•‘\nâ•‘  - Staff count trend                                     â•‘\nâ•‘  - New account trend                                     â•‘\nâ•‘  - YoY comparison (% growth)                             â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  ðŸ¢ Breakdown by Cabang:                                 â•‘\nâ•‘  [Sort: Margin â–¼] [Filter: Zona â–¼] [Search: ___]       â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”    â•‘\nâ•‘  â”‚Cabang â”‚ BrM â”‚ CEO â”‚Staff â”‚ Margin â”‚ NA  â”‚ Zona â”‚    â•‘\nâ•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤    â•‘\nâ•‘  â”‚ AXA 2 â”‚Andi â”‚Budi â”‚ 60   â”‚ $13.7M â”‚ 376 â”‚ ðŸŸ©   â”‚    â•‘\nâ•‘  â”‚ AXA 3 â”‚Budi â”‚Andi â”‚ 50   â”‚ $6.4M  â”‚ 66  â”‚ ðŸŸ©   â”‚    â•‘\nâ•‘  â”‚ ... (14 cabang total)                              â”‚    â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜    â•‘\nâ•‘                                                          â•‘\nâ•‘  [Click cabang â†’ Drill-down ke detail karyawan]         â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Features:**\n- Sorting (by margin, staff, zona)\n- Filtering (by zona, by CEO)\n- Search (by cabang name)\n- Drill-down (click cabang â†’ lihat all employees)\n- Export PDF/Excel\n\n#### 4.2.4 Historical Data Tracking\n\n**Snapshot Strategy:**\n- Auto-save daily (incremental snapshot)\n- Keep forever (notifikasi 5 tahun sekali untuk cleanup)\n- Store in separate `pt_snapshots` table\n\n**Queries:**\n- Quarterly trend (Q1 2024 â†’ Q1 2025)\n- YoY comparison (2024 total vs 2025 total)\n- % growth calculation (auto-display)\n- Custom date range\n\n#### 4.2.5 Permission Matrix\n\n| Role | PT View Access | Scope |\n|------|----------------|-------|\n| Owner | âœ… Full | All PTs |\n| Super Admin | âœ… Full | All PTs |\n| Superadmin1/2/3 | âœ… Full | All PTs |\n| CEO | âœ… Filtered | PT yang dia manage aja |\n| CBO/BrM/Staff | âŒ No Access | Hierarchy view only |\n\n---\n\n### 4.3 FEATURE 3: Individual Mode\n\n#### 4.3.1 Overview\n\n**Purpose:** Personal tracking untuk lihat perkembangan tiap hari (tanpa team aggregation)\n\n**Use Case:**\n- BC baru (fresh graduate) - belum punya team\n- Karyawan mau tracking personal growth\n- Practice audit sebelum real quarterly audit\n\n#### 4.3.2 Individual vs Enterprise Mode\n\n**Individual Mode:**\n- Input data: Manual margin/NA ATAU auto dari BAS\n- Self-assessment: 18 Pilar (wajib isi)\n- Output: Reality Score, Zone, Profile, PDF (pribadi)\n- **GA masuk hierarchy aggregation** (ga ngaruh atasan)\n- Data pribadi (ga di-share)\n\n**Enterprise Mode:**\n- Input data: Auto dari BAS (priority)\n- Self-assessment: 18 Pilar (wajib isi)\n- Output: Reality Score + Team aggregation\n- **Masuk hierarchy aggregation** (bottom-up ke atasan)\n- Data visible ke atasan (cascade up)\n\n#### 4.3.3 Mode Switching\n\n**Trigger:** Auto-detect (kalau punya subordinate â†’ auto switch Enterprise)\n\n**Example:**\n```\nBC (Individual) â†’ Input margin 10jt, NA 5\nâ†’ Self-assessment 18 Pilar\nâ†’ Reality Score: 2jt (10jt / 5)\nâ†’ Zona: Warning\nâ†’ PDF export (personal)\nâ†’ Atasan GA LIHAT (private)\n\nBC dipromosi jadi SBC (punya 2 BC bawahan):\nâ†’ Auto-switch ke Enterprise mode âœ…\nâ†’ Team aggregation dimulai:\n   - Personal: 5jt margin\n   - Team: 10jt + 15jt (dari 2 BC)\n   - Total: 30jt\nâ†’ Atasan LIHAT (cascade)\n```\n\n**Historical Data:**\n- Data Individual tetep disimpan (untuk tracking growth)\n- Data Enterprise dimulai fresh (new audit cycle)\n\n#### 4.3.4 UI Flow\n\n**Toggle Switch:**\n```\nDashboard Header:\n[Individual Mode ðŸ”˜] [Enterprise Mode âšª]\n\nIndividual Mode UI:\n- Input form: Margin, NA (manual/auto)\n- 18 Pilar assessment\n- Reality Score display (personal only)\n- PDF export button\n- No \"Team\" section\n\nEnterprise Mode UI:\n- Auto-sync dari BAS (margin, NA)\n- 18 Pilar assessment\n- Reality Score: Personal + Team (separated)\n- Subordinate list (drill-down)\n- PDF export (include team data)\n```\n\n---\n\n### 4.4 FEATURE 4: Notification System\n\n#### 4.4.1 Overview\n\n**Purpose:** In-app notifications (dashboard bell icon) untuk critical events\n\n**Channel:** Dashboard only (NO email, NO WhatsApp - avoid costs)  \n**Frequency:** Daily digest (kumpulin notifikasi, kirim 1x per hari)  \n**User Preference:** Wajib (ga bisa dimatiin)  \n\n#### 4.4.2 Notification Triggers\n\n**1. Karyawan Baru Register:**\n```\nTrigger: Employee submit self-registration\nRecipients: Atasan langsung (BrM/CBO)\nMessage: \"Andi Wijaya (BC - Cabang AXA2) mendaftar. Review & approve?\"\nAction: [Approve] [Reject] buttons\n```\n\n**2. Audit Deadline Reminder:**\n```\nTrigger: 7 hari sebelum end of month\nRecipients: All employees (yang belum submit audit)\nMessage: \"Reminder: Monthly audit deadline 7 hari lagi (30 Nov 2025)\"\nAction: [Mulai Audit] button\n```\n\n**3. Performance Alert (Critical Zone):**\n```\nTrigger: Reality Score < 2jt (Critical zone)\nRecipients: Employee + Atasan langsung\nMessage: \"âš ï¸ Performance Alert: Reality Score 1.8jt (Critical). Butuh action plan?\"\nAction: [Lihat Detail] button\n```\n\n#### 4.4.3 UI Design\n\n**Bell Icon (Header):**\n```\nðŸ”” (3) â† Badge count (unread notifications)\n\nClick bell â†’ Dropdown:\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Notifications (3 unread)              â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ðŸ†• Andi Wijaya mendaftar              â”‚\nâ”‚    Cabang AXA2 - BC                   â”‚\nâ”‚    [Approve] [Reject]                 â”‚\nâ”‚    2 hours ago                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â° Audit deadline 7 hari lagi         â”‚\nâ”‚    Monthly audit Nov 2025             â”‚\nâ”‚    [Mulai Audit]                      â”‚\nâ”‚    5 hours ago                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âš ï¸ Budi - Performance Critical        â”‚\nâ”‚    Reality Score: 1.8jt               â”‚\nâ”‚    [Lihat Detail]                     â”‚\nâ”‚    1 day ago                          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ [Mark All as Read] [View All]        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n#### 4.4.4 Notification Table Schema\n\n```typescript\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  type: varchar(\"type\").notNull(), // 'registration', 'deadline', 'alert'\n  title: varchar(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  actionUrl: varchar(\"action_url\"), // Link untuk action button\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n---\n\n### 4.5 FEATURE 5: Enhanced Security\n\n#### 4.5.1 Access Control Rules\n\n**Hierarchy-Based Access:**\n```\nRule: Atas lihat bawah (all levels), bawah GA BISA lihat atas\n\nCEO login:\nâ”œâ”€ Lihat: All subordinates (CBO, BrM, VBM, ..., BC)\nâ”œâ”€ Lihat: 18 Pilar assessment subordinates (read-only)\nâ”œâ”€ Edit: Promosi/degradasi subordinates (posisi)\nâ””â”€ NO ACCESS: Data CEO lain (isolation)\n\nBrM login:\nâ”œâ”€ Lihat: Staff cabang only (VBM â†’ BC)\nâ”œâ”€ Lihat: 18 Pilar assessment staff\nâ”œâ”€ Edit: Manual margin/NA input (override BAS)\nâ””â”€ NO ACCESS: Cabang lain, CEO, CBO\n\nBC login:\nâ”œâ”€ Lihat: Diri sendiri only\nâ”œâ”€ Edit: 18 Pilar assessment (self)\nâ”œâ”€ Edit: Individual mode data\nâ””â”€ NO ACCESS: Atasan data, peers data\n```\n\n**PT View Access:**\n```\nOwner/Super Admin/Superadmin1/2/3:\nâ”œâ”€ Lihat: All PTs (full access)\nâ”œâ”€ Edit: PT assignment ke cabang\nâ””â”€ Export: PDF/Excel all PTs\n\nCEO:\nâ”œâ”€ Lihat: PT yang dia manage only\nâ”œâ”€ NO EDIT: PT assignment\nâ””â”€ Export: PDF/Excel PT mereka aja\n```\n\n#### 4.5.2 Password Policy\n\n**Requirements:**\n- Minimal 8 karakter\n- Wajib: Huruf besar, kecil, angka\n- Opsional: Simbol\n- NO common passwords (123456, password, dll)\n\n**Validation:**\n```javascript\nconst passwordSchema = z.string()\n  .min(8, \"Minimal 8 karakter\")\n  .regex(/[a-z]/, \"Harus ada huruf kecil\")\n  .regex(/[A-Z]/, \"Harus ada huruf besar\")\n  .regex(/[0-9]/, \"Harus ada angka\");\n```\n\n#### 4.5.3 Session Management\n\n**Strategy:**\n- Auto-logout: 1 hari (24 jam idle)\n- NO \"remember me\" option (security priority)\n- Session storage: MemoryStore (in-memory, reset on server restart)\n\n**Session Schema:**\n```javascript\nsession: {\n  userId: string,\n  employeeId: string,\n  role: string,\n  positionLevel: string,\n  lastActivity: timestamp,\n  expiresAt: timestamp (24h from login),\n}\n```\n\n#### 4.5.4 Data Privacy - 18 Pilar\n\n**Visibility Rules:**\n```\nEmployee fills 18 Pilar (self-assessment):\nâ”œâ”€ Employee: Full access (view + edit)\nâ”œâ”€ Atasan langsung: Read-only\nâ”œâ”€ Atasan atasan: Read-only (cascade)\nâ”œâ”€ Peers: NO ACCESS\nâ””â”€ Bawahan: NO ACCESS\n\nExample:\nBC isi 18 Pilar â†’ SBC lihat (read-only) â†’ BsM lihat (cascade)\nBC isi 18 Pilar â†’ BC peers GA LIHAT\n```\n\n---\n\n### 4.6 FEATURE 6: Backup & Recovery\n\n#### 4.6.1 Backup Strategy\n\n**Frequency:** Daily (auto-backup setiap midnight)  \n**Scope:** Incremental (data yang berubah aja)  \n**Retention:** Last 7 backups (auto-delete yang lebih lama)  \n**Storage:** Separate backup folder/database  \n\n**Backup Script:**\n```bash\n#!/bin/bash\n# Daily backup script (cron job)\n\nDATE=$(date +%Y%m%d)\nBACKUP_DIR=\"/backups/aisg_enterprise\"\nBACKUP_FILE=\"$BACKUP_DIR/backup_$DATE.sql\"\n\n# Incremental backup (last 24 hours changes)\npg_dump -h $PGHOST -U $PGUSER -d $PGDATABASE \\\n  --inserts --data-only \\\n  --table=employees \\\n  --table=audits \\\n  --table=monthly_performance \\\n  --table=notifications \\\n  > $BACKUP_FILE\n\n# Compress\ngzip $BACKUP_FILE\n\n# Keep last 7 backups only\nls -t $BACKUP_DIR/backup_*.sql.gz | tail -n +8 | xargs rm -f\n\necho \"Backup completed: $BACKUP_FILE.gz\"\n```\n\n#### 4.6.2 Recovery Plan\n\n**Disaster Scenarios:**\n1. Database corrupt\n2. Data loss (accidental delete)\n3. Server crash\n\n**Recovery Steps:**\n```bash\n# 1. Stop application\npm2 stop aisg-enterprise\n\n# 2. Restore from latest backup\nLATEST_BACKUP=$(ls -t /backups/aisg_enterprise/backup_*.sql.gz | head -1)\ngunzip -c $LATEST_BACKUP | psql -h $PGHOST -U $PGUSER -d $PGDATABASE\n\n# 3. Verify data integrity\npsql -h $PGHOST -U $PGUSER -d $PGDATABASE -c \"SELECT COUNT(*) FROM employees;\"\n\n# 4. Restart application\npm2 start aisg-enterprise\n\necho \"Recovery completed from $LATEST_BACKUP\"\n```\n\n**Who Can Trigger Restore:** Super Admin only\n\n#### 4.6.3 Backup Testing\n\n**Monthly Test Plan:**\n```\nDay 1 of every month:\n1. Trigger manual backup\n2. Restore to TEST database (not production)\n3. Verify data completeness:\n   - Employee count match?\n   - Audit data intact?\n   - Performance data correct?\n4. Document test results\n5. Fix any issues found\n```\n\n**Test Checklist:**\n- [ ] Backup file created successfully\n- [ ] Restore completed without errors\n- [ ] Employee count: Expected vs Actual\n- [ ] Audit data: Sample check (5 random audits)\n- [ ] Performance data: Margin totals match\n- [ ] Notifications: Recent 10 match\n- [ ] Test database cleanup\n\n---\n\n### 4.7 FEATURE 7: Manual Excel Upload\n\n#### 4.7.1 Overview\n\n**Purpose:** Contingency plan kalau BAS API down/offline\n\n**Upload Scope:**\n- Employee master (code, nama, posisi, atasan, cabang)\n- Monthly performance (margin, NA)\n- Quarterly data (untuk audit)\n\n**Format:** Excel file (same format dari BAS API)\n\n#### 4.7.2 Upload Permissions\n\n**Who Can Upload:**\n- **Super Admin:** All cabang (upload 42 cabang sekaligus)\n- **BrM:** Cabang sendiri only (upload 1 cabang)\n- **CBO:** Cabang yang dia manage only (upload multiple cabang)\n\n**Validation:**\n- Check duplicate employee code\n- Validate hierarchy (atasan harus exist)\n- Validate cabang (harus exist di master)\n- Show preview before confirm\n\n#### 4.7.3 UI Flow\n\n**Upload Page:** `/admin/upload-excel`\n\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  Manual Excel Upload - Contingency Plan                 â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  âš ï¸ Upload manual hanya untuk backup kalau BAS offline   â•‘\nâ•‘  Data dari BAS API akan override data manual!           â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Step 1: Select Cabang (BrM: cabang sendiri only)       â•‘\nâ•‘  [Cabang: AXA 2 â–¼]                                      â•‘\nâ•‘                                                          â•‘\nâ•‘  Step 2: Upload Excel File                              â•‘\nâ•‘  [Choose File] backup_AXA2_2025Q1.xlsx                  â•‘\nâ•‘  [Upload & Preview]                                     â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Step 3: Preview Data (Before Confirm)                  â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘\nâ•‘  â”‚ Emp Code â”‚ Nama    â”‚ Posisi â”‚ Atasan  â”‚ Margin â”‚    â•‘\nâ•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â•‘\nâ•‘  â”‚ EMP001   â”‚ Andi    â”‚ BC     â”‚ EMP050  â”‚ 10jt   â”‚    â•‘\nâ•‘  â”‚ EMP002   â”‚ Budi    â”‚ SBC    â”‚ EMP100  â”‚ 15jt   â”‚    â•‘\nâ•‘  â”‚ ... (50 rows)                                    â”‚    â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘\nâ•‘                                                          â•‘\nâ•‘  âœ… Validation Results:                                 â•‘\nâ•‘  â€¢ 50 rows valid                                        â•‘\nâ•‘  â€¢ 0 errors                                             â•‘\nâ•‘  â€¢ 2 warnings: EMP003 (atasan not found - will skip)   â•‘\nâ•‘                                                          â•‘\nâ•‘  [Confirm Upload] [Cancel]                              â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n#### 4.7.4 Data Source Indicator\n\n**Icon Badges:**\n- ðŸ”„ **BAS API** (auto-sync, real-time)\n- ðŸ“¤ **Manual Upload** (uploaded by admin, temporary)\n\n**Display Locations:**\n- Employee list table (column: Data Source)\n- Dashboard cards (tooltip)\n- PT report (footer note)\n\n**Auto-Override:**\n```\nManual upload â†’ Icon: ðŸ“¤ \"Manual Upload\"\nBAS API sync (next day) â†’ Icon: ðŸ”„ \"BAS API\"\nData automatically replaced âœ…\n```\n\n---\n\n## 5. DATABASE ARCHITECTURE\n\n### 5.1 New Tables\n\n#### 5.1.1 `pts` Table (PT Master)\n\n```typescript\nexport const pts = pgTable(\"pts\", {\n  id: varchar(\"id\").primaryKey(),\n  code: varchar(\"code\", { length: 10 }).unique().notNull(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  fullLegalName: varchar(\"full_legal_name\", { length: 200 }),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Seed Data\nconst PT_SEED = [\n  { code: 'RFB', name: 'Rifan Financindo Berjangka' },\n  { code: 'BPF', name: 'Best Profit Futures' },\n  { code: 'EWF', name: 'Equity World Futures' },\n  { code: 'KPF', name: 'Kontak Perkasa Futures' },\n  { code: 'SGB', name: 'Solid Gold Berjangka' },\n];\n```\n\n#### 5.1.2 `notifications` Table\n\n```typescript\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  type: varchar(\"type\").notNull(),\n  title: varchar(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  actionUrl: varchar(\"action_url\"),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n#### 5.1.3 `pt_snapshots` Table (Historical Data)\n\n```typescript\nexport const ptSnapshots = pgTable(\"pt_snapshots\", {\n  id: varchar(\"id\").primaryKey(),\n  ptId: varchar(\"pt_id\").references(() => pts.id),\n  period: varchar(\"period\").notNull(), // '2025-Q1'\n  snapshotDate: timestamp(\"snapshot_date\").notNull(),\n  totalMargin: decimal(\"total_margin\", { precision: 15, scale: 2 }),\n  totalNA: integer(\"total_na\"),\n  totalStaff: integer(\"total_staff\"),\n  totalBranches: integer(\"total_branches\"),\n  totalNewAccounts: integer(\"total_new_accounts\"),\n  zoneDistribution: jsonb(\"zone_distribution\"), // { success: 10, warning: 3, critical: 1 }\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n#### 5.1.4 `data_sources` Table (Track Upload Source)\n\n```typescript\nexport const dataSources = pgTable(\"data_sources\", {\n  id: varchar(\"id\").primaryKey(),\n  employeeId: varchar(\"employee_id\").references(() => employees.id),\n  source: varchar(\"source\").notNull(), // 'bas_api' | 'manual_upload'\n  uploadedBy: varchar(\"uploaded_by\").references(() => users.id),\n  uploadedAt: timestamp(\"uploaded_at\").notNull(),\n  metadata: jsonb(\"metadata\"), // { fileName, rowCount, etc }\n});\n```\n\n### 5.2 Schema Updates (Existing Tables)\n\n#### 5.2.1 `branches` Table - Add PT Reference\n\n```typescript\nexport const branches = pgTable(\"branches\", {\n  // ... existing fields\n  ptId: varchar(\"pt_id\").notNull().references(() => pts.id), // NEW\n});\n\n// Migration:\n// ALTER TABLE branches ADD COLUMN pt_id VARCHAR REFERENCES pts(id);\n```\n\n#### 5.2.2 `users` Table - Add New Roles\n\n```typescript\nexport const userRoleEnum = pgEnum(\"user_role\", [\n  \"super_admin\",\n  \"superadmin1\", // NEW\n  \"superadmin2\", // NEW\n  \"superadmin3\", // NEW\n  \"owner\",\n  \"employee\",\n]);\n```\n\n#### 5.2.3 `employees` Table - Add Workspace Type\n\n```typescript\nexport const employees = pgTable(\"employees\", {\n  // ... existing fields\n  workspaceType: varchar(\"workspace_type\").default(\"enterprise\"), // NEW\n  // 'individual' | 'enterprise'\n});\n```\n\n### 5.3 Entity Relationship Diagram (ERD)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   pts   â”‚\nâ””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜\n     â”‚\n     â”‚ 1:N\n     â”‚\nâ”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  branches   â”‚\nâ””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n     â”‚\n     â”‚ 1:N\n     â”‚\nâ”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  employees   â”‚â—„â”€â”€â”€â”€â”€â”¤ data_sources â”‚\nâ””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  1:N â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n     â”‚\n     â”œâ”€ 1:N â”€â–º monthly_performance\n     â”œâ”€ 1:N â”€â–º audits\n     â”œâ”€ 1:1 â”€â–º users â”€â”€â–º notifications (1:N)\n     â””â”€ Self-reference (managerId) â†’ Hierarchy tree\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚pt_snapshots â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n     â”‚\n     â””â”€ N:1 â”€â–º pts\n```\n\n---\n\n## 6. API ENDPOINTS\n\n### 6.1 Authentication Endpoints (Enhanced)\n\n```typescript\n// Existing (Keep)\nPOST   /api/auth/register\nPOST   /api/auth/login\nPOST   /api/auth/logout\nGET    /api/auth/user\n\n// New: Self-Registration with Auto-Match\nPOST   /api/auth/register-employee\nBody: {\n  name: string,\n  email: string,\n  password: string,\n  branchId: string,\n  birthDate: string, // For auto-match\n}\nResponse: {\n  status: 'approved' | 'pending',\n  matchedEmployeeId?: string,\n}\n\n// New: Security Questions\nPOST   /api/auth/security-questions\nBody: {\n  userId: string,\n  questions: [\n    { question: string, answer: string },\n  ]\n}\n\nPOST   /api/auth/reset-password-verify\nBody: {\n  email: string,\n  answers: [{ question: string, answer: string }],\n  newPassword: string,\n}\n```\n\n### 6.2 BAS Integration Endpoints\n\n```typescript\n// Sync from BAS API\nPOST   /api/bas/sync\nBody: {\n  year: number,\n  quarter: number,\n  branchCode: string, // 'AB' or 'ALL'\n}\nResponse: {\n  syncedEmployees: number,\n  syncedPerformance: number,\n  errors: string[],\n  timestamp: string,\n}\n\n// Manual trigger sync (Super Admin only)\nPOST   /api/bas/sync-all\nBody: {\n  year: number,\n  quarter: number,\n}\n```\n\n### 6.3 PT Reporting Endpoints\n\n```typescript\n// PT Summary (All PTs)\nGET    /api/reports/pt/summary?period=2025-Q1\nResponse: {\n  companyTotal: {\n    margin: number,\n    staff: number,\n    branches: number,\n  },\n  pts: [\n    {\n      code: string,\n      name: string,\n      totalMargin: number,\n      totalStaff: number,\n      totalBranches: number,\n      zone: 'success' | 'warning' | 'critical',\n      percentageContribution: number,\n    }\n  ]\n}\n\n// PT Detail (Single PT)\nGET    /api/reports/pt/:ptCode?period=2025-Q1\nResponse: {\n  pt: { code, name, ... },\n  summary: { totalMargin, totalStaff, ... },\n  branches: [\n    {\n      code: string,\n      name: string,\n      brmName: string,\n      ceoName: string,\n      staffCount: number,\n      margin: number,\n      na: number,\n      zone: string,\n    }\n  ],\n  trend: [\n    { period: '2024-Q1', margin: number },\n    { period: '2024-Q2', margin: number },\n    ...\n  ]\n}\n\n// PT Historical Trend\nGET    /api/reports/pt/:ptCode/trend?periods=2024-Q1,2024-Q2,...\n\n// PT Export PDF\nGET    /api/reports/pt/:ptCode/export-pdf?period=2025-Q1\n\n// PT Export Excel\nGET    /api/reports/pt/:ptCode/export-excel?period=2025-Q1\n```\n\n### 6.4 Individual Mode Endpoints\n\n```typescript\n// Switch mode\nPATCH  /api/employees/:employeeId/workspace-type\nBody: { workspaceType: 'individual' | 'enterprise' }\n\n// Individual audit (no team aggregation)\nPOST   /api/audits/individual\nBody: {\n  employeeId: string,\n  period: string,\n  marginPersonal: number,\n  naPersonal: number,\n  pilarScores: { [key: string]: number },\n}\n```\n\n### 6.5 Notification Endpoints\n\n```typescript\n// Get notifications\nGET    /api/notifications?userId=xxx&limit=20\n\n// Mark as read\nPATCH  /api/notifications/:notificationId/read\n\n// Mark all as read\nPOST   /api/notifications/mark-all-read\n```\n\n### 6.6 Manual Upload Endpoints\n\n```typescript\n// Upload Excel\nPOST   /api/upload/excel\nBody: FormData {\n  file: File,\n  branchId: string,\n}\nResponse: {\n  preview: [\n    { employeeCode, name, position, ... }\n  ],\n  validation: {\n    valid: number,\n    errors: string[],\n    warnings: string[],\n  }\n}\n\n// Confirm upload\nPOST   /api/upload/confirm\nBody: {\n  uploadId: string,\n  branchId: string,\n}\n```\n\n---\n\n## 7. UI/UX DESIGN\n\n### 7.1 Navigation Structure\n\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  AISG Enterprise                      ðŸ””(3)  Admin â–¼  â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘                                                        â•‘\nâ•‘  [Dashboard] [Reports] [Audit] [Chat AI] [Settings]  â•‘\nâ•‘                                                        â•‘\nâ•‘  For Owner/Super Admin:                                â•‘\nâ•‘  Reports dropdown:                                     â•‘\nâ•‘    â”œâ”€ Business Hierarchy (existing)                   â•‘\nâ•‘    â””â”€ PT/Legal Entity (NEW!)                          â•‘\nâ•‘                                                        â•‘\nâ•‘  For CEO/CBO/BrM:                                      â•‘\nâ•‘    Only: Business Hierarchy                           â•‘\nâ•‘                                                        â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n### 7.2 Registration Flow (Auto-Match)\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ REGISTER - AISG Enterprise          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Nama Lengkap: [____________]        â”‚\nâ”‚ Email Pribadi: [___________]        â”‚\nâ”‚ Password: [********]                â”‚\nâ”‚ Konfirmasi Password: [********]     â”‚\nâ”‚ Cabang: [AXA 2 (Jakarta) â–¼]        â”‚\nâ”‚ Tanggal Lahir: [15/03/1990]        â”‚\nâ”‚                                     â”‚\nâ”‚ Security Questions (Opsional):      â”‚\nâ”‚ Q1: Nama ibu kandung?               â”‚\nâ”‚ A1: [____________]                  â”‚\nâ”‚                                     â”‚\nâ”‚ [Register] [Sudah punya akun?]     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nSystem: Auto-match dengan BAS\nâ”œâ”€ Match found (90% cases) â†’ Auto-approve âœ…\nâ”‚  \"Selamat! Akun Anda berhasil dibuat\"\nâ”‚\nâ””â”€ Not found / Multiple matches (10%)\n   \"Registrasi Anda sedang di-review oleh admin\"\n   â†’ Pending approval page\n```\n\n### 7.3 Dashboard (Dual Mode Toggle)\n\n**For Owner/Super Admin:**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  Dashboard                                             â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  View Mode:                                            â•‘\nâ•‘  â—‹ Business Hierarchy  â— PT/Legal Entity              â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  (Show PT Dashboard - Feature 2.2 layout)              â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**For Employee (Individual Mode):**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  My Dashboard                                          â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Workspace: [Individual Mode ðŸ”˜] [Enterprise âšª]       â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Personal Performance (Monthly):                       â•‘\nâ•‘  â€¢ Margin: 10jt                                        â•‘\nâ•‘  â€¢ NA: 5                                               â•‘\nâ•‘  â€¢ Reality Score: 2jt                                  â•‘\nâ•‘  â€¢ Zona: ðŸŸ¨ Warning                                    â•‘\nâ•‘                                                        â•‘\nâ•‘  [Input Data Manual] [Isi 18 Pilar] [Export PDF]     â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n### 7.4 Notification Bell\n\n```\nHeader: ðŸ”” (3) â† Badge\n\nClick â†’ Dropdown:\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ðŸ†• Andi Wijaya mendaftar              â”‚\nâ”‚    [Approve] [Reject]                 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ â° Audit deadline 7 hari lagi         â”‚\nâ”‚    [Mulai Audit]                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âš ï¸ Budi - Critical Zone               â”‚\nâ”‚    [Lihat Detail]                     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ [View All Notifications]              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 8. SECURITY & DATA PROTECTION\n\n### 8.1 Authentication Security\n\n**Password Hashing:** bcrypt (salt rounds: 10)  \n**Session Storage:** MemoryStore (HttpOnly cookies)  \n**CSRF Protection:** Enabled (express-session)  \n**SQL Injection:** Prevented (Drizzle ORM parameterized queries)  \n\n### 8.2 Access Control Implementation\n\n```typescript\n// Middleware: Check subordinate access\nasync function canAccessEmployee(currentUserId, targetEmployeeId) {\n  const current = await getEmployeeByUserId(currentUserId);\n  const subordinates = await getSubordinateTree(current.id);\n  \n  return subordinates.some(sub => sub.id === targetEmployeeId);\n}\n\n// Middleware: Check PT access\nasync function canAccessPT(currentUser, ptCode) {\n  if (['super_admin', 'owner', 'superadmin1', 'superadmin2', 'superadmin3']\n      .includes(currentUser.role)) {\n    return true; // Full access\n  }\n  \n  if (currentUser.role === 'employee' \n      && currentUser.positionLevel === 'CEO') {\n    // CEO: Check if they manage any branch in this PT\n    const managedBranches = await getBranchesManagedByCEO(currentUser.employeeId);\n    return managedBranches.some(b => b.ptId === ptCode);\n  }\n  \n  return false; // No access\n}\n```\n\n### 8.3 Data Encryption\n\n**In Transit:** HTTPS (TLS 1.2+)  \n**At Rest:** PostgreSQL encryption (Neon built-in)  \n**Sensitive Fields:** Password (bcrypt), Security answers (bcrypt)  \n\n### 8.4 Audit Logging\n\n```typescript\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: varchar(\"id\").primaryKey(),\n  userId: varchar(\"user_id\"),\n  action: varchar(\"action\"), // 'login', 'upload', 'edit_employee', etc\n  resource: varchar(\"resource\"), // 'employee:EMP001', 'pt:RFB'\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n---\n\n## 9. BACKUP & RECOVERY\n\n### 9.1 Backup Schedule\n\n**Daily Backup (Automated):**\n- Time: 00:00 (midnight)\n- Type: Incremental (last 24h changes)\n- Tables: employees, audits, monthly_performance, notifications\n- Retention: 7 days (auto-delete older)\n\n**Backup Command:**\n```bash\n# Cron job: 0 0 * * * /scripts/backup.sh\npg_dump -h $PGHOST -U $PGUSER -d $PGDATABASE \\\n  --inserts --data-only \\\n  --table=employees \\\n  --table=audits \\\n  --table=monthly_performance \\\n  --table=notifications \\\n  > /backups/backup_$(date +%Y%m%d).sql\n```\n\n### 9.2 Recovery Procedure\n\n**Manual Restore (Super Admin only):**\n```bash\n# Stop app\npm2 stop aisg-enterprise\n\n# Restore latest backup\ngunzip -c /backups/backup_latest.sql.gz | psql -h $PGHOST -U $PGUSER -d $PGDATABASE\n\n# Verify\npsql -h $PGHOST -U $PGUSER -d $PGDATABASE -c \"SELECT COUNT(*) FROM employees;\"\n\n# Restart\npm2 start aisg-enterprise\n```\n\n### 9.3 Monthly Testing\n\n**Test Plan (1st day of month):**\n1. Create test database\n2. Restore latest backup to test DB\n3. Run verification queries:\n   ```sql\n   SELECT COUNT(*) FROM employees;\n   SELECT COUNT(*) FROM audits WHERE period = '2025-Q1';\n   SELECT SUM(margin) FROM monthly_performance WHERE month = '2025-01';\n   ```\n4. Document results\n5. Drop test database\n\n---\n\n## 10. IMPLEMENTATION ROADMAP\n\n### 10.1 Phase Breakdown\n\n**PHASE 1: Foundation (8 hours | 3-4 checkpoints | $15-20)**\n```\nTasks:\n1. Database schema updates\n   - Create pts table (seed 5 PTs)\n   - Add ptId to branches table\n   - Create notifications table\n   - Add user roles (superadmin1/2/3)\n   - Create pt_snapshots table\n   - Create data_sources table\n\n2. BAS API integration - Backend only\n   - Sync service (call BAS API)\n   - Parse Excel/CSV response\n   - Insert/update employees + performance\n   - Error handling & logging\n   - Daily cron job setup\n\n3. Security enhancements\n   - Password policy validation\n   - Session timeout (24h)\n   - Access control middleware\n\nDeliverables:\nâœ… Database ready\nâœ… BAS sync working (backend)\nâœ… Security hardened\n```\n\n**PHASE 2: PT Reporting (10 hours | 4-5 checkpoints | $20-25)**\n```\nTasks:\n1. PT aggregation queries\n   - PT summary query (all PTs)\n   - PT detail query (breakdown by cabang)\n   - Historical trend queries\n   - Permission checks (CEO filtered access)\n\n2. PT Dashboard UI\n   - PT summary page (5 PT cards)\n   - PT detail page (breakdown table)\n   - Charts (trend line, pie chart)\n   - Sorting/filtering/search\n   - Export PDF/Excel\n\n3. Dual view navigation\n   - Tab switching (Hierarchy â†” PT)\n   - Permission-based routing\n\nDeliverables:\nâœ… PT reporting API working\nâœ… PT dashboard UI complete\nâœ… Export functionality\n```\n\n**PHASE 3: Individual Mode + Notifications (6 hours | 2-3 checkpoints | $10-15)**\n```\nTasks:\n1. Individual mode\n   - Workspace type toggle\n   - Individual audit API (no team aggregation)\n   - Manual data input form\n   - Auto-switch to Enterprise (if has subordinates)\n\n2. Notification system\n   - Notification API (create, read, mark read)\n   - Dashboard bell icon UI\n   - Notification dropdown\n   - Daily digest cron job\n   - Trigger events (registration, deadline, alert)\n\nDeliverables:\nâœ… Individual mode working\nâœ… Notifications functional\n```\n\n**PHASE 4: Manual Upload + Polish (6 hours | 2-3 checkpoints | $10-15)**\n```\nTasks:\n1. Manual Excel upload\n   - Upload API (parse, validate, preview)\n   - Upload UI (file input, preview table)\n   - Confirm upload\n   - Data source indicator (icons)\n\n2. Auto-match registration\n   - Registration API (fuzzy match)\n   - Pending approval queue\n   - Admin approval UI\n\n3. Testing & bug fixes\n   - Integration testing\n   - Permission testing\n   - Performance testing (10k employees)\n   - Bug fixes\n\n4. Documentation\n   - User manual (Bahasa Indonesia)\n   - Admin guide\n   - API documentation\n\nDeliverables:\nâœ… Manual upload working\nâœ… Auto-match registration\nâœ… All features tested\nâœ… Documentation complete\n```\n\n### 10.2 Timeline Estimate\n\n**Conservative:** 4 weeks (30 hours total)  \n**Optimistic:** 3 weeks (25 hours total)  \n**Realistic:** 3.5 weeks (~28 hours total)  \n\n**Weekly Breakdown:**\n```\nWeek 1: Phase 1 (Foundation) - 8 hours\nWeek 2: Phase 2 (PT Reporting) - 10 hours\nWeek 3: Phase 3 (Individual + Notifications) - 6 hours\nWeek 4: Phase 4 (Upload + Polish) - 6 hours\n```\n\n### 10.3 Budget Estimate\n\n**Total Cost:** $60-100 (15-20 checkpoints)\n\n**Breakdown by Phase:**\n- Phase 1: $15-20\n- Phase 2: $20-25\n- Phase 3: $10-15\n- Phase 4: $10-15\n\n**Monthly Subscription (Core):** $25/month  \n**Estimated Duration:** 3-4 months (if monthly credits only)  \n**Total Subscription Cost:** $75-100\n\n**Alternative:** Pay-as-you-go (buy credits on-demand)\n\n---\n\n## 11. TESTING & DEPLOYMENT\n\n### 11.1 Testing Strategy\n\n**Unit Testing:**\n- BAS API sync logic\n- PT aggregation queries\n- Auto-match algorithm\n- Password validation\n- Access control middleware\n\n**Integration Testing:**\n- BAS API â†’ Database sync\n- PT report generation\n- Notification triggers\n- Manual upload flow\n- Registration â†’ Auto-match â†’ Approval\n\n**Performance Testing:**\n- 10k employees query speed\n- PT aggregation (cross-CEO) performance\n- Dashboard load time\n- Concurrent users (100+)\n\n**User Acceptance Testing (UAT):**\n- Super Admin: Create Owner, CEO\n- Owner: View PT reports, export PDF\n- CEO: Filtered PT view\n- BrM: Upload Excel manual\n- Employee: Self-register, auto-match\n- Individual mode: Personal tracking\n\n### 11.2 Deployment Plan\n\n**Environment:** Internal server (same network dengan BAS)\n\n**Deployment Steps:**\n```bash\n# 1. Database migration\nnpm run db:push --force\n\n# 2. Seed data (5 PTs)\nnpm run seed:pts\n\n# 3. Assign PT to 42 branches (manual via UI)\n# Super Admin login â†’ Master Data â†’ Branches â†’ Assign PT\n\n# 4. BAS sync (initial load)\ncurl -X POST http://localhost:3000/api/bas/sync-all \\\n  -H \"Authorization: Bearer <admin_token>\" \\\n  -d '{ \"year\": 2025, \"quarter\": 1 }'\n\n# 5. Setup cron jobs\n# Daily backup: 0 0 * * * /scripts/backup.sh\n# Daily BAS sync: 0 1 * * * /scripts/sync-bas.sh\n# Notification digest: 0 9 * * * /scripts/send-notifications.sh\n\n# 6. Start app\npm2 start ecosystem.config.js --env production\npm2 save\n\n# 7. Monitor\npm2 logs\npm2 monit\n```\n\n**Health Check:**\n```bash\n# App running?\ncurl http://localhost:5000/api/health\n\n# Database connected?\ncurl http://localhost:5000/api/health/db\n\n# BAS API accessible?\ncurl http://localhost:5000/api/health/bas\n```\n\n### 11.3 Rollout Strategy\n\n**Phase 1: Pilot (Week 1)**\n- 1 cabang (AXA 2) - 50 employees\n- Super Admin + BrM testing\n- Identify bugs, fix quickly\n\n**Phase 2: Limited Rollout (Week 2-3)**\n- 5 cabang - 250 employees\n- Owner + CEO testing\n- PT reports validation\n\n**Phase 3: Full Rollout (Week 4)**\n- All 42 cabang - 10,000 employees\n- All roles testing\n- Monitor performance, fix issues\n\n**Phase 4: Stabilization (Month 2)**\n- Bug fixes\n- Performance optimization\n- User feedback incorporation\n\n---\n\n## 12. APPENDIX\n\n### 12.1 Glossary\n\n**BAS:** Business Automation System (desktop system existing, source of truth untuk employee + margin data)  \n**PT:** Perseroan Terbatas (legal entity, untuk compliance/tax reporting)  \n**Reality Score:** Margin / NA (ukuran performance karyawan)  \n**Zone:** Kategori performance (Success â‰¥4jt, Warning â‰¥2jt, Critical <2jt)  \n**18 Pilar:** Self-assessment framework (18 aspek kualitas karyawan)  \n**Individual Mode:** Workspace untuk personal tracking (ga ngaruh team aggregation)  \n**Enterprise Mode:** Workspace untuk team audit (bottom-up aggregation)  \n\n### 12.2 Abbreviations\n\n**BC:** Business Consultant (level paling bawah)  \n**SBC:** Senior Business Consultant  \n**BsM:** Business Manager  \n**SBM:** Senior Business Manager  \n**EM:** Executive Manager  \n**SEM:** Senior Executive Manager  \n**SVBM:** Senior Vice Business Manager  \n**VBM:** Vice Business Manager  \n**BrM:** Branch Manager (1 per cabang)  \n**CBO:** Chief Business Officer (manage multiple BrM, bisa lintas PT)  \n**CEO:** Chief Executive Officer (1 per PT atau cross-PT)  \n**Owner:** Top boss (1 orang)  \n\n### 12.3 Data Sources Priority\n\n**Priority Order:**\n1. BAS API (real-time, daily sync)\n2. Manual Upload (temporary, kalau BAS offline)\n3. Manual Edit (super admin override)\n\n**Conflict Resolution:**\n- BAS data always override manual upload (next sync)\n- Manual edit by super admin persist (until next BAS sync)\n\n### 12.4 Contact & Support\n\n**Super Admin:** [Your Name/Email]  \n**BAS Team:** [BAS contact for API support]  \n**Replit Support:** support@replit.com  \n**Documentation:** AISG_Enterprise_User_Manual.pdf (to be created)  \n\n---\n\n## ðŸ“ DOCUMENT SIGN-OFF\n\n**Prepared By:** Replit Agent  \n**Reviewed By:** [User Name]  \n**Approved By:** [User Name]  \n**Date:** November 11, 2025  \n\n**Approval Status:** â³ Awaiting User Approval\n\n**Next Steps:**\n1. User review this document (30-60 minutes)\n2. User provide feedback/approval\n3. If approved â†’ Proceed to Phase 1 implementation\n4. If revisions needed â†’ Update document, re-submit\n\n---\n\n**END OF DOCUMENT** (Total: 80 pages equivalent)\n\n**Estimated Creation Cost:** ~$5-10 (1 checkpoint)  \n**Estimated Implementation Cost:** $60-100 (15-20 checkpoints)  \n**Total Budget:** $65-110\n\n**Question for User:**  \n**\"APPROVED untuk lanjut ke Phase 1 implementation?\"**  \n**Atau ada yang perlu direvisi?**\n","size_bytes":51484},"attached_assets/aisg_core_motivation_1762749934943.md":{"content":"","size_bytes":0},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"attached_assets/aisg_core_base_1762750119665.md":{"content":"# =====================================\n# AISG_CORE_BASE.md\n# Sistem Audit AiSG â€“ File Inti 1 (BASE SYSTEM)\n# =====================================\n\n## ðŸ§­ PENDAHULUAN\nFile ini berfungsi sebagai **otak dasar sistem AiSG**, yang memuat aturan operasional utama, fallback patch, konfigurasi cabang, dan panduan lintas cabang.\nSemua variabel `[NAMA_CABANG]` akan otomatis menyesuaikan dengan nama cabang aktif yang ditetapkan di builder.\n\n---\n\n## âš™ï¸ 1. ATURAN OPERASIONAL (INSTRUKSI_AISG)\n```txt\n[ALUR_AUDIT]\n1) Audit bertingkat mengikuti struktur dari HIRARKI_[NAMA_CABANG].txt.\n   - Traversal: habiskan anak kiri â†’ geser ke anak kanan â†’ baru naik ke atas (post-order).\n   - Audit individu juga bisa dipanggil per-nama.\n2) Sumber data utama:\n   - ASSESSMENT_[NAMA_CABANG].txt â†’ hasil assessment tim.\n   - DATA_[NAMA_CABANG].txt â†’ margin & NA bulanan.\n   - DATA_GABUNGAN_[NAMA_CABANG].txt â†’ validasi status & uplineâ€“downline real.\n3) Skor 18 Pilar:\n   - Skor 1â€“5 per pilar.\n   - Jika sebagian pilar kosong â†’ rata-rata dari pilar tersedia, lalu diskalakan ke 0â€“90.\n   - Pilar kritis (auto EWS jika nilai â‰¤2): P4, P9, P13.\n4) Zona warna (total 0â€“90):\n   ðŸŸ© 75â€“90 = Hijau  |  ðŸŸ¨ 51â€“74 = Kuning  |  ðŸŸ¥ 0â€“50 = Merah.\n5) ProDem (Promosi/Demosi):\n   - Aturan diambil dari SCHEME_PRODEM (lihat file motivasi).\n6) EWS aktif jika:\n   - Total skor merah, atau pilar kritis â‰¤2, atau tidak memenuhi syarat bertahan.\n7) Output Final: wajib mengikuti format 12 bagian di `AISG_CORE_AUDIT_GUIDE.md`.\n```\n\n---\n\n## ðŸ§± 2. PROFIL & KONFIGURASI CABANG (PROFILE_INSTRUKSI_AISG)\n```txt\n[nama_cabang] = [NAMA_CABANG]\nPATH_HIRARKI      = HIRARKI_[NAMA_CABANG].txt\nFILE_ASSESS       = ASSESSMENT_[NAMA_CABANG].txt\nFILE_DATA_PROFILE = DATA_[NAMA_CABANG].txt\nFILE_DATA_BASE    = DATA_GABUNGAN_[NAMA_CABANG].txt\n\nCSV_DELIMITER = \\t\nCSV_QUOTECHAR = \"\nMAX_RETRY_READ_CSV = 3\n\nFILE_PATCH_FALLBACK = PATCH_SAFE_FALLBACK_DATA.txt\n```\n\n---\n\n## ðŸ§© 3. PATCH FALLBACK RULES\n```txt\n[FALLBACK_RULES]\nCHECK_ASSESSMENT = ON\nCHECK_DATA_PROFILE = ON\nAUTO_ALERT_IF_MISSING = TRUE\nALLOW_EMPTY_RENDER = TRUE\nDEFAULT_SELF_SCORE_IF_EMPTY = 0\nDEFAULT_REALITY_SCORE_IF_EMPTY = 0\nPLACEHOLDER_MESSAGE_IF_BOTH_EMPTY = âš ï¸ Data belum tersedia â€“ audit ditunda.\n\n[DISPLAY_ALERT]\n- Jika assessment tidak ditemukan:\n  âš ï¸ â€œAssessment belum diisi â€“ hasil audit berbasis data lapangan (Reality-only).â€\n- Jika data profil tidak ditemukan:\n  âš ï¸ â€œData margin & NA belum tersedia â€“ hasil audit berbasis self-assessment (Self-only).â€\n- Jika keduanya tidak ditemukan:\n  âš ï¸ â€œData belum tersedia untuk audit ini.â€\n```\n\n---\n\n## ðŸ“‹ 4. LOG & ALERT TEMPLATE\n```txt\n[LOG TEMPLATE]\nPercobaan 1: [OK/GAGAL - alasan/error]\nPercobaan 2: [OK/GAGAL - alasan/error]\nPercobaan 3: [OK/GAGAL - alasan/error] â†’ [BERHASIL/ABORT]\n\n[ALERT TEMPLATE]\nâš ï¸ File [nama_file] belum terbaca setelah 3 kali percobaan.\nUpload ulang file assessment terkait.\n```\n\n---\n\n## ðŸ“˜ 5. PANDUAN LINTAS CABANG\n### Upload ke Knowledge:\n1ï¸âƒ£ AISG_CORE_BASE.md (file ini)\n2ï¸âƒ£ AISG_CORE_AUDIT_GUIDE.md\n3ï¸âƒ£ AISG_CORE_MOTIVATION.md\n4ï¸âƒ£ AISG_INSTRUCTION_BUILDER.md\n5ï¸âƒ£ ASSESSMENT_[NAMA_CABANG].txt\n6ï¸âƒ£ DATA_[NAMA_CABANG].txt\n7ï¸âƒ£ DATA_GABUNGAN_[NAMA_CABANG].txt\n8ï¸âƒ£ HIRARKI_[NAMA_CABANG].txt\n\n### Di Builder:\nGunakan instruksi builder dan ubah baris:\n```\n[nama_cabang] = NAMA_CABANG\n```\n\n---\n\n> **\"Audit hebat bukan yang panjang laporannya, tapi yang tepat sasarannya.\"**  \n> â€” *AiSG System 2025*\n\n","size_bytes":3499},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, jsonb, timestamp, date, boolean, decimal, uniqueIndex, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\n// ============================================================================\n// ORGANIZATIONAL STRUCTURE TABLES\n// ============================================================================\n\n// PT Companies (5 companies: RFB, EWF, KPF, SGB, BPF)\nexport const pts = pgTable(\"pts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  code: varchar(\"code\", { length: 10 }).notNull().unique(), // RFB, EWF, KPF, SGB, BPF\n  name: text(\"name\").notNull(), // Full company name\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"active\"), // active, inactive\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertPtSchema = createInsertSchema(pts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type Pt = typeof pts.$inferSelect;\nexport type InsertPt = z.infer<typeof insertPtSchema>;\n\n// CEO Organizational Units (5 units)\nexport const ceoUnits = pgTable(\"ceo_units\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().unique(), // ISRIYETTI, NL, GS, TJANDRA, EDWIN\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"active\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertCeoUnitSchema = createInsertSchema(ceoUnits).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type CeoUnit = typeof ceoUnits.$inferSelect;\nexport type InsertCeoUnit = z.infer<typeof insertCeoUnitSchema>;\n\n// Branches (42 branches across PTs)\nexport const branches = pgTable(\"branches\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  ptId: varchar(\"pt_id\").notNull().references(() => pts.id, { onDelete: 'restrict' }),\n  code: varchar(\"code\", { length: 20 }).notNull().unique(), // SSC, MEDAN, AXA, etc.\n  name: text(\"name\").notNull(), // Full branch name\n  region: text(\"region\"), // Jakarta, Medan, Surabaya, etc.\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"active\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertBranchSchema = createInsertSchema(branches).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type Branch = typeof branches.$inferSelect;\nexport type InsertBranch = z.infer<typeof insertBranchSchema>;\n\n// Position Hierarchy (11 levels)\nexport const positions = pgTable(\"positions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  code: varchar(\"code\", { length: 10 }).notNull().unique(), // BC, SBC, BsM, etc.\n  name: text(\"name\").notNull(), // Business Consultant, etc.\n  level: integer(\"level\").notNull().unique(), // 1-11 (BC=1, Owner=11) - MUST BE UNIQUE\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertPositionSchema = createInsertSchema(positions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Position = typeof positions.$inferSelect;\nexport type InsertPosition = z.infer<typeof insertPositionSchema>;\n\n// ============================================================================\n// EMPLOYEE MASTER DATA\n// ============================================================================\n\nexport const employees = pgTable(\"employees\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // Personal Information\n  employeeCode: varchar(\"employee_code\", { length: 20 }).notNull().unique(), // EMP001, EMP002\n  fullName: text(\"full_name\").notNull(),\n  email: text(\"email\").unique(),\n  phone: varchar(\"phone\", { length: 20 }),\n  dateOfBirth: date(\"date_of_birth\").notNull(), // For zodiac calculation\n  \n  // Organizational Assignment\n  ptId: varchar(\"pt_id\").notNull().references(() => pts.id, { onDelete: 'restrict' }),\n  branchId: varchar(\"branch_id\").notNull().references(() => branches.id, { onDelete: 'restrict' }),\n  positionId: varchar(\"position_id\").notNull().references(() => positions.id, { onDelete: 'restrict' }),\n  ceoUnitId: varchar(\"ceo_unit_id\").notNull().references(() => ceoUnits.id, { onDelete: 'restrict' }),\n  \n  // Hierarchy (Self-referencing for flexible hierarchy)\n  managerId: varchar(\"manager_id\").references((): any => employees.id, { onDelete: 'set null' }), // Atasan langsung\n  \n  // Employment Details\n  joinDate: date(\"join_date\").notNull(),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"active\"), // active, resign, freelance\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n}, (table) => ({\n  // Indexes for hierarchical query performance\n  managerIdx: index(\"employees_manager_idx\").on(table.managerId),\n  branchIdx: index(\"employees_branch_idx\").on(table.branchId),\n  positionIdx: index(\"employees_position_idx\").on(table.positionId),\n  ceoUnitIdx: index(\"employees_ceo_unit_idx\").on(table.ceoUnitId),\n}));\n\nexport const insertEmployeeSchema = createInsertSchema(employees, {\n  dateOfBirth: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Format harus YYYY-MM-DD\"),\n  joinDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, \"Format harus YYYY-MM-DD\"),\n  email: z.string().email(\"Email tidak valid\").optional(),\n}).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type Employee = typeof employees.$inferSelect;\nexport type InsertEmployee = z.infer<typeof insertEmployeeSchema>;\n\n// ============================================================================\n// PERFORMANCE DATA\n// ============================================================================\n\nexport const monthlyPerformance = pgTable(\"monthly_performance\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  employeeId: varchar(\"employee_id\").notNull().references(() => employees.id, { onDelete: 'cascade' }),\n  \n  // Period\n  year: integer(\"year\").notNull(),\n  month: integer(\"month\").notNull(), // 1-12\n  quarter: integer(\"quarter\").notNull(), // 1-4 (auto-calculated)\n  \n  // Personal Performance\n  marginPersonal: decimal(\"margin_personal\", { precision: 12, scale: 2 }).notNull().default(\"0\"), // Can be negative\n  naPersonal: integer(\"na_personal\").notNull().default(0), // Can be negative (withdrawals)\n  lotSettled: integer(\"lot_settled\").default(0),\n  \n  // Team Performance (optional - can be overridden or auto-calculated)\n  marginTeam: decimal(\"margin_team\", { precision: 12, scale: 2 }).default(\"0\"),\n  naTeam: integer(\"na_team\").default(0),\n  isTeamAutoCalculated: boolean(\"is_team_auto_calculated\").notNull().default(true), // Flag for aggregation\n  \n  // Notes\n  notes: text(\"notes\"),\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n}, (table) => ({\n  // CRITICAL: Prevent duplicate entries for same employee/year/month\n  uniquePerformance: uniqueIndex(\"monthly_performance_unique\").on(table.employeeId, table.year, table.month),\n}));\n\nexport const insertMonthlyPerformanceSchema = createInsertSchema(monthlyPerformance, {\n  year: z.number().int().min(2020).max(2030),\n  month: z.number().int().min(1).max(12),\n  quarter: z.number().int().min(1).max(4),\n  marginPersonal: z.string().regex(/^-?\\d+(\\.\\d{1,2})?$/, \"Format decimal tidak valid\"),\n  naPersonal: z.number().int(),\n  lotSettled: z.number().int().nonnegative().optional(),\n  marginTeam: z.string().regex(/^-?\\d+(\\.\\d{1,2})?$/, \"Format decimal tidak valid\").optional(),\n  naTeam: z.number().int().optional(),\n}).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type MonthlyPerformance = typeof monthlyPerformance.$inferSelect;\nexport type InsertMonthlyPerformance = z.infer<typeof insertMonthlyPerformanceSchema>;\n\n// ============================================================================\n// AUDIT SYSTEM (ENTERPRISE)\n// ============================================================================\n\nexport const audits = pgTable(\"audits\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // Employee Reference\n  employeeId: varchar(\"employee_id\").notNull().references(() => employees.id, { onDelete: 'cascade' }),\n  \n  // Audit Period\n  year: integer(\"year\").notNull(),\n  quarter: integer(\"quarter\").notNull(), // 1-4\n  \n  // Quarterly Performance Summary (Aggregated from monthly_performance)\n  marginPersonalQ: decimal(\"margin_personal_q\", { precision: 12, scale: 2 }).notNull(),\n  naPersonalQ: integer(\"na_personal_q\").notNull(),\n  marginTeamQ: decimal(\"margin_team_q\", { precision: 12, scale: 2 }).notNull(),\n  naTeamQ: integer(\"na_team_q\").notNull(),\n  \n  // Team Structure Snapshot (at audit time)\n  teamStructure: jsonb(\"team_structure\").notNull().$type<{\n    totalSubordinates: number;\n    auditedSubordinates: number;\n    byPosition: Array<{\n      positionCode: string;\n      positionName: string;\n      count: number;\n      auditedCount: number;\n    }>;\n  }>(),\n  \n  // 18 Pilar Assessment\n  pillarAnswers: jsonb(\"pillar_answers\").notNull().$type<Array<{\n    pillarId: number;\n    pillarName: string;\n    category: \"A\" | \"B\" | \"C\"; // 18 Pilar categories (A: Kinerja Individu, B: Perilaku & Karakter, C: Kerja Tim & Leadership)\n    selfScore: number; // 1-5\n    realityScore: number; // 1-5\n    gap: number;\n    insight: string;\n  }>>(),\n  \n  // Calculated Scores\n  totalSelfScore: integer(\"total_self_score\").notNull(), // 0-90\n  totalRealityScore: integer(\"total_reality_score\").notNull(), // 0-90\n  totalGap: integer(\"total_gap\").notNull(),\n  \n  // Zona Analysis\n  zonaKinerja: varchar(\"zona_kinerja\", { length: 20 }).notNull(), // success, warning, critical\n  zonaPerilaku: varchar(\"zona_perilaku\", { length: 20 }).notNull(), // success, warning, critical\n  zonaFinal: varchar(\"zona_final\", { length: 20 }).notNull(), // success, warning, critical\n  \n  // Profile & ProDem\n  profil: text(\"profil\").notNull(), // Leader, Visionary, Performer, At-Risk\n  prodemRekomendasi: jsonb(\"prodem_rekomendasi\").notNull().$type<{\n    currentPosition: string;\n    recommendation: \"Promosi\" | \"Dipertahankan\" | \"Pembinaan\" | \"Demosi\";\n    nextPosition?: string;\n    reason: string;\n    konsekuensi: string;\n    nextStep: string;\n    requirements: Array<{\n      label: string;\n      value: string;\n      met: boolean;\n    }>;\n  }>(),\n  \n  // Audit Report (12 sections)\n  auditReport: jsonb(\"audit_report\").notNull().$type<{\n    executiveSummary: string;\n    insightLengkap: string;\n    swotAnalysis: {\n      strength: string[];\n      weakness: string[];\n      opportunity: string[];\n      threat: string[];\n    };\n    coachingPoints: string[];\n    actionPlan: Array<{\n      periode: string; // 30/60/90 hari\n      target: string;\n      aktivitas: string;\n      pic: string;\n      output: string;\n    }>;\n    progressKuartal: {\n      kuartalBerjalan: string;\n      sisaHari: number;\n      targetMargin: number;\n      realisasiMargin: number;\n      percentageMargin: number;\n      targetNA: number;\n      realisasiNA: number;\n      percentageNA: number;\n      catatan: string;\n    };\n    ews: Array<{\n      faktor: string;\n      indikator: string;\n      risiko: string;\n      saranCepat: string;\n    }>;\n    kesesuaianVisi: {\n      status: \"Align\" | \"Perlu Penyesuaian\" | \"Belum Sesuai\";\n      narasi: string;\n    };\n  }>(),\n  \n  // Magic Section\n  magicSection: jsonb(\"magic_section\").notNull().$type<{\n    julukan: string;\n    narasi: string;\n    zodiak: string;\n    generasi: \"Gen Z\" | \"Millennial\" | \"Gen X\" | \"Boomer\";\n    zodiakBooster: string;\n    coachingHighlight: string;\n    callToAction: string;\n    quote: string;\n  }>(),\n  \n  // Aggregation Metadata\n  aggregationWarnings: jsonb(\"aggregation_warnings\").$type<Array<{\n    type: string;\n    message: string;\n    affectedEmployeeIds: string[];\n  }>>(),\n  \n  // Audit Metadata\n  createdById: varchar(\"created_by_id\").notNull().references(() => users.id),\n  status: varchar(\"status\", { length: 20 }).notNull().default(\"completed\"), // draft, completed\n  \n  // Soft Delete\n  deletedAt: timestamp(\"deleted_at\"),\n  deletedById: varchar(\"deleted_by_id\").references(() => users.id),\n  deletedReason: text(\"deleted_reason\"),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertAuditSchema = createInsertSchema(audits, {\n  year: z.number().int().min(2020).max(2030),\n  quarter: z.number().int().min(1).max(4),\n  pillarAnswers: z.array(z.object({\n    pillarId: z.number().int().min(1).max(18),\n    selfScore: z.number().int().min(1).max(5),\n  })).length(18),\n}).omit({\n  id: true,\n  totalSelfScore: true,\n  totalRealityScore: true,\n  totalGap: true,\n  zonaKinerja: true,\n  zonaPerilaku: true,\n  zonaFinal: true,\n  profil: true,\n  auditReport: true,\n  prodemRekomendasi: true,\n  magicSection: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type Audit = typeof audits.$inferSelect;\nexport type InsertAudit = z.infer<typeof insertAuditSchema>;\n\n// ============================================================================\n// AUTHENTICATION & AUTHORIZATION\n// ============================================================================\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // Auth Credentials\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(), // bcrypt hash\n  \n  // Link to Employee (for position-based permissions)\n  employeeId: varchar(\"employee_id\").unique().references(() => employees.id, { onDelete: 'set null' }),\n  \n  // Display Info\n  name: text(\"name\").notNull(),\n  email: text(\"email\"),\n  \n  // Role (for special accounts like Super Admin, Owner)\n  role: varchar(\"role\", { length: 20 }).notNull().$type<\"super_admin\" | \"owner\" | \"employee\">().default(\"employee\"),\n  \n  // Security\n  securityQuestion: text(\"security_question\"),\n  securityAnswer: text(\"security_answer\"), // Hashed\n  \n  // Status\n  isActive: boolean(\"is_active\").notNull().default(true),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users, {\n  username: z.string().min(3, \"Username minimal 3 karakter\"),\n  password: z.string().min(6, \"Password minimal 6 karakter\"),\n  name: z.string().min(2, \"Nama minimal 2 karakter\"),\n  email: z.string().email(\"Email tidak valid\").optional(),\n}).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const loginSchema = z.object({\n  username: z.string().min(3, \"Username minimal 3 karakter\"),\n  password: z.string().min(6, \"Password minimal 6 karakter\"),\n});\n\nexport const registerSchema = z.object({\n  username: z.string().min(3, \"Username minimal 3 karakter\"),\n  password: z.string().min(6, \"Password minimal 6 karakter\"),\n  name: z.string().min(2, \"Nama minimal 2 karakter\"),\n  email: z.string().email(\"Email tidak valid\").optional().or(z.literal(\"\")),\n  employeeId: z.string().optional(),\n  securityQuestion: z.string().min(5, \"Pertanyaan keamanan minimal 5 karakter\"),\n  securityAnswer: z.string().min(2, \"Jawaban minimal 2 karakter\"),\n});\n\nexport const resetPasswordSchema = z.object({\n  username: z.string().min(3, \"Username minimal 3 karakter\"),\n  securityAnswer: z.string().min(2, \"Jawaban minimal 2 karakter\"),\n  newPassword: z.string().min(6, \"Password baru minimal 6 karakter\"),\n});\n\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type LoginCredentials = z.infer<typeof loginSchema>;\nexport type RegisterData = z.infer<typeof registerSchema>;\n\n// ============================================================================\n// CHAT MESSAGES (for AI Chat Assistant)\n// ============================================================================\n\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  auditId: varchar(\"audit_id\").notNull().references(() => audits.id, { onDelete: 'cascade' }),\n  role: text(\"role\").notNull(), // user, assistant, system\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\n\n// ============================================================================\n// DRIZZLE RELATIONS (for query convenience)\n// ============================================================================\n\nexport const ptsRelations = relations(pts, ({ many }) => ({\n  branches: many(branches),\n  employees: many(employees),\n}));\n\nexport const branchesRelations = relations(branches, ({ one, many }) => ({\n  pt: one(pts, {\n    fields: [branches.ptId],\n    references: [pts.id],\n  }),\n  employees: many(employees),\n}));\n\nexport const positionsRelations = relations(positions, ({ many }) => ({\n  employees: many(employees),\n}));\n\nexport const ceoUnitsRelations = relations(ceoUnits, ({ many }) => ({\n  employees: many(employees),\n}));\n\nexport const employeesRelations = relations(employees, ({ one, many }) => ({\n  pt: one(pts, {\n    fields: [employees.ptId],\n    references: [pts.id],\n  }),\n  branch: one(branches, {\n    fields: [employees.branchId],\n    references: [branches.id],\n  }),\n  position: one(positions, {\n    fields: [employees.positionId],\n    references: [positions.id],\n  }),\n  ceoUnit: one(ceoUnits, {\n    fields: [employees.ceoUnitId],\n    references: [ceoUnits.id],\n  }),\n  manager: one(employees, {\n    fields: [employees.managerId],\n    references: [employees.id],\n  }),\n  subordinates: many(employees),\n  monthlyPerformances: many(monthlyPerformance),\n  audits: many(audits),\n  user: one(users),\n}));\n\nexport const monthlyPerformanceRelations = relations(monthlyPerformance, ({ one }) => ({\n  employee: one(employees, {\n    fields: [monthlyPerformance.employeeId],\n    references: [employees.id],\n  }),\n}));\n\nexport const auditsRelations = relations(audits, ({ one, many }) => ({\n  employee: one(employees, {\n    fields: [audits.employeeId],\n    references: [employees.id],\n  }),\n  createdBy: one(users, {\n    fields: [audits.createdById],\n    references: [users.id],\n  }),\n  chatMessages: many(chatMessages),\n}));\n\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  employee: one(employees, {\n    fields: [users.employeeId],\n    references: [employees.id],\n  }),\n  createdAudits: many(audits),\n}));\n\nexport const chatMessagesRelations = relations(chatMessages, ({ one }) => ({\n  audit: one(audits, {\n    fields: [chatMessages.auditId],\n    references: [audits.id],\n  }),\n}));\n","size_bytes":19131},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"server/reset-database.ts":{"content":"/**\n * Reset database - Drop all old tables and push new schema\n * Run with: npx tsx server/reset-database.ts\n */\n\nimport { sql } from \"drizzle-orm\";\nimport { db } from \"./db\";\n\nasync function resetDatabase() {\n  try {\n    console.log(\"ðŸ—‘ï¸  Dropping all existing tables...\\n\");\n\n    // Drop old tables (if they exist)\n    const tablesToDrop = [\n      \"chat_messages\",\n      \"audits\",\n      \"branches\",\n      \"users\",\n      \"monthly_performance\",\n      \"employees\",\n      \"positions\",\n      \"ceo_units\",\n      \"pts\",\n      // Old tables from individual system\n      \"session\",\n    ];\n\n    for (const table of tablesToDrop) {\n      try {\n        await db.execute(sql.raw(`DROP TABLE IF EXISTS \"${table}\" CASCADE`));\n        console.log(`  âœ… Dropped table: ${table}`);\n      } catch (error) {\n        console.log(`  âš ï¸  Table ${table} doesn't exist or already dropped`);\n      }\n    }\n\n    console.log(\"\\nâœ… Database reset complete!\");\n    console.log(\"\\nNext step:\");\n    console.log(\"  Run: npm run db:push --force\");\n    console.log(\"  Then: npx tsx server/seed-enterprise.ts\");\n    \n    process.exit(0);\n  } catch (error) {\n    console.error(\"\\nâŒ Error resetting database:\", error);\n    process.exit(1);\n  }\n}\n\nresetDatabase();\n","size_bytes":1242},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/pages/AdminAuditLog.tsx":{"content":"/**\n * Admin Audit Log Page\n * Shows all audits from all users with creator info and PDF download\n */\n\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Download, FileText, User, Calendar, Building, TrendingUp, Award, Trash2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { id as indonesian } from \"date-fns/locale\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface AuditLogEntry {\n  id: string;\n  nama: string;\n  jabatan: string;\n  cabang: string;\n  zonaKinerja: string | null;\n  zonaPerilaku: string | null;\n  zonaFinal: string | null;\n  totalSelfScore: number | null;\n  totalRealityScore: number | null;\n  prodemRekomendasi: any;\n  createdAt: string;\n  updatedAt: string | null;\n  deletedAt: string | null;\n  deletedById: string | null;\n  deletedReason: string | null;\n  ownerId: string | null;\n  createdById: string | null;\n  ownerName: string | null;\n  ownerUsername: string | null;\n}\n\nexport default function AdminAuditLog() {\n  const { toast } = useToast();\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [auditToDelete, setAuditToDelete] = useState<AuditLogEntry | null>(null);\n  \n  const { data: audits = [], isLoading } = useQuery<AuditLogEntry[]>({\n    queryKey: [\"/api/admin/audit-log\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (auditId: string) => {\n      const response = await fetch(`/api/audit/${auditId}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.userMessage || \"Gagal menghapus audit\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/audit-log\"] });\n      toast({\n        title: \"Audit berhasil dihapus\",\n        description: \"Data audit telah dihapus secara permanen\",\n      });\n      setDeleteDialogOpen(false);\n      setAuditToDelete(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gagal menghapus audit\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteClick = (audit: AuditLogEntry) => {\n    setAuditToDelete(audit);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleConfirmDelete = () => {\n    if (auditToDelete) {\n      deleteMutation.mutate(auditToDelete.id);\n    }\n  };\n\n  const getZoneColor = (zone: string | null) => {\n    if (!zone) return \"bg-gray-500/20 text-gray-400\";\n    switch (zone) {\n      case \"Success\": return \"bg-green-500/20 text-green-400 border-green-500/30\";\n      case \"Warning\": return \"bg-yellow-500/20 text-yellow-400 border-yellow-500/30\";\n      case \"Critical\": return \"bg-red-500/20 text-red-400 border-red-500/30\";\n      default: return \"bg-gray-500/20 text-gray-400\";\n    }\n  };\n\n  const getProDemBadge = (prodem: any) => {\n    if (!prodem || !prodem.recommendation) return null;\n    const rec = prodem.recommendation;\n    if (rec === \"Promosi\") {\n      return <span className=\"px-2 py-1 text-xs rounded-full bg-green-500/20 text-green-400 border border-green-500/30\">ðŸš€ Promosi</span>;\n    } else if (rec === \"Demosi\") {\n      return <span className=\"px-2 py-1 text-xs rounded-full bg-red-500/20 text-red-400 border border-red-500/30\">âš ï¸ Demosi</span>;\n    } else {\n      return <span className=\"px-2 py-1 text-xs rounded-full bg-blue-500/20 text-blue-400 border border-blue-500/30\">âž¡ï¸ Stay</span>;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background p-6 md:p-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"animate-pulse space-y-4\">\n            <div className=\"h-12 bg-card rounded-lg w-1/3\" />\n            <div className=\"h-64 bg-card rounded-lg\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-6 md:p-8\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent\">\n              Audit Log\n            </h1>\n            <p className=\"text-muted-foreground mt-1\">\n              Semua aktivitas audit dari seluruh user\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-card border border-border\">\n            <FileText className=\"w-5 h-5 text-purple-400\" />\n            <span className=\"font-semibold\">{audits.length}</span>\n            <span className=\"text-sm text-muted-foreground\">Total Audits</span>\n          </div>\n        </div>\n\n        {/* Audit List */}\n        <div className=\"space-y-4\">\n          {audits.length === 0 ? (\n            <Card className=\"p-12 text-center\">\n              <FileText className=\"w-16 h-16 mx-auto text-muted-foreground opacity-50 mb-4\" />\n              <p className=\"text-muted-foreground\">Belum ada audit yang dibuat</p>\n            </Card>\n          ) : (\n            audits.map((audit) => (\n              <Card key={audit.id} className=\"p-6 hover:border-purple-500/30 transition-all\">\n                <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4\">\n                  {/* Left: Audit Info */}\n                  <div className=\"flex-1 space-y-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <h3 className=\"text-xl font-bold flex items-center gap-2\">\n                          <User className=\"w-5 h-5 text-purple-400\" />\n                          {audit.nama}\n                          {audit.deletedAt && (\n                            <span className=\"px-2 py-1 text-xs rounded-full bg-gray-500/20 text-gray-400 border border-gray-500/30\">\n                              ðŸ—‘ï¸ Deleted\n                            </span>\n                          )}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          {audit.jabatan} â€¢ {audit.cabang}\n                        </p>\n                      </div>\n                      {getProDemBadge(audit.prodemRekomendasi)}\n                    </div>\n\n                    {/* Metadata */}\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Building className=\"w-4 h-4 text-blue-400\" />\n                        <span className=\"text-muted-foreground\">User:</span>\n                        <span className=\"font-medium\">{audit.ownerUsername || \"N/A\"}</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Calendar className=\"w-4 h-4 text-green-400\" />\n                        <span className=\"text-muted-foreground\">\n                          {audit.createdAt ? format(new Date(audit.createdAt), \"dd MMM yyyy\", { locale: indonesian }) : \"-\"}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <TrendingUp className=\"w-4 h-4 text-amber-400\" />\n                        <span className={`px-2 py-0.5 rounded text-xs border ${getZoneColor(audit.zonaFinal)}`}>\n                          {audit.zonaFinal || \"N/A\"}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Award className=\"w-4 h-4 text-pink-400\" />\n                        <span className=\"text-muted-foreground\">\n                          Reality: {audit.totalRealityScore ? (audit.totalRealityScore / 18).toFixed(1) : \"N/A\"}/5.0\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Right: Actions */}\n                  <div className=\"flex flex-col sm:flex-row gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => window.location.href = `/audit/${audit.id}`}\n                      className=\"gap-2\"\n                    >\n                      <FileText className=\"w-4 h-4\" />\n                      Lihat Detail\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => window.open(`/api/audit/${audit.id}/pdf`, \"_blank\")}\n                      className=\"gap-2 bg-gradient-to-r from-amber-500 to-yellow-600 hover:from-amber-600 hover:to-yellow-700 text-gray-900 font-semibold shadow-lg shadow-amber-500/30\"\n                    >\n                      <Download className=\"w-4 h-4\" />\n                      Download PDF\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleDeleteClick(audit)}\n                      className=\"gap-2 border-red-500/30 text-red-400 hover:bg-red-500/10 hover:border-red-500/50\"\n                      disabled={deleteMutation.isPending}\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                      {audit.deletedAt ? \"Permanent Delete\" : \"Hapus\"}\n                    </Button>\n                  </div>\n                </div>\n              </Card>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent className=\"bg-gray-900 border-gray-800\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"text-xl font-bold flex items-center gap-2\">\n              <Trash2 className=\"w-5 h-5 text-red-400\" />\n              Konfirmasi Hapus Audit\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-gray-400 space-y-2\">\n              <p>\n                Apakah Anda yakin ingin menghapus audit untuk <span className=\"font-semibold text-white\">{auditToDelete?.nama}</span>?\n              </p>\n              {auditToDelete?.deletedAt ? (\n                <p className=\"text-red-400 font-medium\">\n                  âš ï¸ Audit ini sudah dihapus oleh user. Permanent delete akan menghapus data dari database secara permanen dan tidak dapat dikembalikan!\n                </p>\n              ) : (\n                <p className=\"text-red-400 font-medium\">\n                  âš ï¸ Data akan dihapus secara permanen dan tidak dapat dikembalikan!\n                </p>\n              )}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel \n              className=\"bg-gray-800 border-gray-700 hover:bg-gray-700\"\n              disabled={deleteMutation.isPending}\n            >\n              Batal\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmDelete}\n              className=\"bg-red-500 hover:bg-red-600 text-white\"\n              disabled={deleteMutation.isPending}\n            >\n              {deleteMutation.isPending ? \"Menghapus...\" : \"Ya, Hapus\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","size_bytes":11866},"server/middleware.ts":{"content":"/**\n * Authentication & Authorization Middleware for AiSG\n * Includes position-based RBAC for enterprise hierarchy\n */\n\nimport type { Request, Response, NextFunction } from \"express\";\nimport type { User } from \"@shared/schema\";\nimport { getUserById } from \"./auth\";\nimport { storage } from \"./storage\";\n\n// Extend Express Request type to include user\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: Omit<User, \"password\">;\n    }\n  }\n}\n\n/**\n * Middleware to check if user is authenticated\n * Expects user ID to be stored in session\n */\nexport async function requireAuth(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  const userId = req.session?.userId;\n  \n  if (!userId) {\n    res.status(401).json({ error: \"Unauthorized\", userMessage: \"Silakan login terlebih dahulu\" });\n    return;\n  }\n  \n  // Get user from database\n  const user = await getUserById(userId);\n  \n  if (!user) {\n    // User ID in session but user doesn't exist in DB\n    req.session.destroy(() => {});\n    res.status(401).json({ error: \"Unauthorized\", userMessage: \"Session tidak valid, silakan login kembali\" });\n    return;\n  }\n  \n  // Attach user to request\n  req.user = user;\n  next();\n}\n\n/**\n * Middleware to require specific role\n * Usage: requireRole(\"admin\") or requireRole(\"full_admin\")\n */\nexport function requireRole(...allowedRoles: Array<User[\"role\"]>) {\n  return async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    if (!req.user) {\n      res.status(401).json({ error: \"Unauthorized\", userMessage: \"Silakan login terlebih dahulu\" });\n      return;\n    }\n    \n    if (!allowedRoles.includes(req.user.role)) {\n      res.status(403).json({ \n        error: \"Forbidden\", \n        userMessage: `Akses ditolak. Diperlukan role: ${allowedRoles.join(\" atau \")}` \n      });\n      return;\n    }\n    \n    next();\n  };\n}\n\n/**\n * Middleware to check if user is Super Admin (full system access)\n */\nexport const requireFullAdmin = requireRole(\"super_admin\");\n\n/**\n * Middleware to check if user is Owner or Super Admin\n */\nexport const requireOwnerOrAdmin = requireRole(\"super_admin\", \"owner\");\n\n/**\n * Optional auth middleware - doesn't fail if not authenticated\n * Just attaches user to request if session exists\n */\nexport async function optionalAuth(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  const userId = req.session?.userId;\n  \n  if (userId) {\n    const user = await getUserById(userId);\n    if (user) {\n      req.user = user;\n    }\n  }\n  \n  next();\n}\n\n// =========================================================================\n// POSITION-BASED RBAC MIDDLEWARE\n// =========================================================================\n\n/**\n * Middleware to check if current user can view a specific employee\n * Super Admin and Owner: can view all\n * Employees: can only view employees in their hierarchy\n * \n * Usage: app.get(\"/api/employees/:id\", requireAuth, canViewEmployee, handler)\n * Employee ID should be in req.params.id or req.params.employeeId\n */\nexport async function canViewEmployee(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  if (!req.user) {\n    res.status(401).json({ error: \"Unauthorized\", userMessage: \"Silakan login terlebih dahulu\" });\n    return;\n  }\n  \n  // Super Admin and Owner can view all\n  if (req.user.role === \"super_admin\" || req.user.role === \"owner\") {\n    next();\n    return;\n  }\n  \n  // Get target employee ID from params\n  const targetEmployeeId = req.params.id || req.params.employeeId;\n  \n  if (!targetEmployeeId) {\n    res.status(400).json({ error: \"Bad Request\", userMessage: \"Employee ID tidak ditemukan\" });\n    return;\n  }\n  \n  // Check if user has employeeId linked\n  if (!req.user.employeeId) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"User tidak memiliki employee record\" \n    });\n    return;\n  }\n  \n  // Check if user can view this employee (using storage RBAC helper)\n  const canView = await storage.canManageEmployee(req.user.employeeId, targetEmployeeId);\n  \n  if (!canView) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"Anda tidak memiliki akses untuk melihat employee ini\" \n    });\n    return;\n  }\n  \n  next();\n}\n\n/**\n * Middleware to check if current user can manage (create/update/delete) an employee\n * Super Admin: can manage all\n * Owner: can manage all in their organization\n * Managers: can only manage their subordinates\n * \n * Usage: app.patch(\"/api/employees/:id\", requireAuth, canManageEmployee, handler)\n */\nexport async function canManageEmployee(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  if (!req.user) {\n    res.status(401).json({ error: \"Unauthorized\", userMessage: \"Silakan login terlebih dahulu\" });\n    return;\n  }\n  \n  // Super Admin can manage all\n  if (req.user.role === \"super_admin\") {\n    next();\n    return;\n  }\n  \n  // Owner can manage all (with CEO unit isolation enforced at storage layer)\n  if (req.user.role === \"owner\") {\n    next();\n    return;\n  }\n  \n  // Get target employee ID from params\n  const targetEmployeeId = req.params.id || req.params.employeeId;\n  \n  if (!targetEmployeeId) {\n    res.status(400).json({ error: \"Bad Request\", userMessage: \"Employee ID tidak ditemukan\" });\n    return;\n  }\n  \n  // Check if user has employeeId linked\n  if (!req.user.employeeId) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"User tidak memiliki employee record untuk manage\" \n    });\n    return;\n  }\n  \n  // Check if user can manage this employee\n  const canManage = await storage.canManageEmployee(req.user.employeeId, targetEmployeeId);\n  \n  if (!canManage) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"Anda tidak memiliki akses untuk manage employee ini\" \n    });\n    return;\n  }\n  \n  next();\n}\n\n/**\n * Middleware to check minimum position level required\n * Example: requireMinPosition(8) means only BrM (level 8) and above can access\n * \n * Usage: app.post(\"/api/branches\", requireAuth, requireMinPosition(10), handler)\n */\nexport function requireMinPosition(minLevel: number) {\n  return async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    if (!req.user) {\n      res.status(401).json({ error: \"Unauthorized\", userMessage: \"Silakan login terlebih dahulu\" });\n      return;\n    }\n    \n    // Super Admin and Owner bypass position checks\n    if (req.user.role === \"super_admin\" || req.user.role === \"owner\") {\n      next();\n      return;\n    }\n    \n    // Check if user has employeeId\n    if (!req.user.employeeId) {\n      res.status(403).json({ \n        error: \"Forbidden\", \n        userMessage: \"User tidak memiliki employee record\" \n      });\n      return;\n    }\n    \n    // Get employee with position metadata\n    const employeeMeta = await storage.getEmployeeWithMetadata(req.user.employeeId);\n    \n    if (!employeeMeta || !employeeMeta.position) {\n      res.status(403).json({ \n        error: \"Forbidden\", \n        userMessage: \"Employee position tidak ditemukan\" \n      });\n      return;\n    }\n    \n    // Check if position level is sufficient (lower number = higher position)\n    if (employeeMeta.position.level > minLevel) {\n      res.status(403).json({ \n        error: \"Forbidden\", \n        userMessage: `Akses ditolak. Diperlukan posisi level ${minLevel} atau lebih tinggi` \n      });\n      return;\n    }\n    \n    next();\n  };\n}\n\n// =========================================================================\n// PERFORMANCE DATA RBAC MIDDLEWARE\n// =========================================================================\n\n/**\n * Middleware to check if current user can view performance data\n * Extracts employeeId from:\n * - req.params.employeeId (for /performance/employee/:employeeId)\n * - req.query.employeeId (for /performance?employeeId=xxx)\n * - Performance record (for /performance/:id)\n * \n * Usage: app.get(\"/api/enterprise/performance/employee/:employeeId\", requireAuth, canViewPerformance, handler)\n */\nexport async function canViewPerformance(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  if (!req.user) {\n    res.status(401).json({ error: \"Unauthorized\", userMessage: \"Silakan login terlebih dahulu\" });\n    return;\n  }\n  \n  // Super Admin and Owner can view all\n  if (req.user.role === \"super_admin\" || req.user.role === \"owner\") {\n    next();\n    return;\n  }\n  \n  // Get target employee ID from params, query, or performance record\n  let targetEmployeeId = req.params.employeeId || req.query.employeeId as string;\n  \n  // If checking specific performance record by ID, fetch employee from record\n  if (!targetEmployeeId && req.params.id) {\n    const performance = await storage.getPerformance(req.params.id);\n    if (!performance) {\n      res.status(404).json({ error: \"Not Found\", userMessage: \"Data performance tidak ditemukan\" });\n      return;\n    }\n    targetEmployeeId = performance.employeeId;\n  }\n  \n  // If no employeeId specified, allow (will be filtered to user's scope in handler)\n  if (!targetEmployeeId) {\n    next();\n    return;\n  }\n  \n  // Check if user has employeeId linked\n  if (!req.user.employeeId) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"User tidak memiliki employee record\" \n    });\n    return;\n  }\n  \n  // Check if user can view this employee's performance\n  const canView = await storage.canManageEmployee(req.user.employeeId, targetEmployeeId);\n  \n  if (!canView) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"Anda tidak memiliki akses untuk melihat data performance employee ini\" \n    });\n    return;\n  }\n  \n  next();\n}\n\n/**\n * Middleware to check if current user can manage (create/update) performance data\n * Extracts employeeId from:\n * - req.body.employeeId (for POST/PATCH)\n * - req.params.employeeId (for param-based routes)\n * - Performance record (for PATCH /performance/:id)\n * \n * Usage: app.post(\"/api/enterprise/performance\", requireAuth, canManagePerformance, handler)\n */\nexport async function canManagePerformance(\n  req: Request,\n  res: Response,\n  next: NextFunction\n): Promise<void> {\n  if (!req.user) {\n    res.status(401).json({ error: \"Unauthorized\", userMessage: \"Silakan login terlebih dahulu\" });\n    return;\n  }\n  \n  // Super Admin can manage all\n  if (req.user.role === \"super_admin\") {\n    next();\n    return;\n  }\n  \n  // Owner can manage all (with CEO unit isolation enforced at storage layer)\n  if (req.user.role === \"owner\") {\n    next();\n    return;\n  }\n  \n  // Get target employee ID from body, params, or performance record\n  let targetEmployeeId = req.body.employeeId || req.params.employeeId;\n  \n  // If updating existing performance, fetch employeeId from record\n  if (!targetEmployeeId && req.params.id) {\n    const performance = await storage.getPerformance(req.params.id);\n    if (!performance) {\n      res.status(404).json({ error: \"Not Found\", userMessage: \"Data performance tidak ditemukan\" });\n      return;\n    }\n    targetEmployeeId = performance.employeeId;\n  }\n  \n  if (!targetEmployeeId) {\n    res.status(400).json({ error: \"Bad Request\", userMessage: \"Employee ID tidak ditemukan\" });\n    return;\n  }\n  \n  // Check if user has employeeId linked\n  if (!req.user.employeeId) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"User tidak memiliki employee record\" \n    });\n    return;\n  }\n  \n  // Check if user can manage this employee's performance\n  const canManage = await storage.canManageEmployee(req.user.employeeId, targetEmployeeId);\n  \n  if (!canManage) {\n    res.status(403).json({ \n      error: \"Forbidden\", \n      userMessage: \"Anda tidak memiliki akses untuk input data performance employee ini\" \n    });\n    return;\n  }\n  \n  next();\n}\n","size_bytes":11769},"client/src/components/StatCard.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  trend?: {\n    value: number;\n    isPositive: boolean;\n  };\n  \"data-testid\"?: string;\n}\n\nexport default function StatCard({ title, value, icon: Icon, trend, \"data-testid\": testId }: StatCardProps) {\n  return (\n    <Card className=\"p-4 sm:p-6 hover-elevate transition-all duration-300 hover:shadow-lg\" data-testid={testId}>\n      <div className=\"flex items-start justify-between gap-2 sm:gap-4\">\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-xs sm:text-sm text-muted-foreground mb-1 sm:mb-2\">{title}</p>\n          <p className=\"text-xl sm:text-2xl md:text-3xl font-bold tracking-tight\" data-testid={`${testId}-value`}>{value}</p>\n          {trend && (\n            <div className=\"flex items-center gap-1 mt-2\">\n              <span\n                className={`text-xs sm:text-sm font-medium ${\n                  trend.isPositive ? \"text-zone-success\" : \"text-zone-critical\"\n                }`}\n                data-testid={`${testId}-trend`}\n              >\n                {trend.isPositive ? \"â†‘\" : \"â†“\"} {Math.abs(trend.value)}%\n              </span>\n              <span className=\"text-xs text-muted-foreground hidden sm:inline\">vs bulan lalu</span>\n            </div>\n          )}\n        </div>\n        <div className=\"rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 p-2 sm:p-3 shadow-sm\">\n          <Icon className=\"w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 text-primary\" />\n        </div>\n      </div>\n    </Card>\n  );\n}\n","size_bytes":1637},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/examples/ProfileBadge.tsx":{"content":"import ProfileBadge from \"../ProfileBadge\";\n\nexport default function ProfileBadgeExample() {\n  return (\n    <div className=\"flex flex-col gap-6 p-6 bg-background\">\n      <div>\n        <h3 className=\"text-sm font-medium mb-3 text-muted-foreground\">All Profile Types</h3>\n        <div className=\"flex flex-wrap gap-3\">\n          <ProfileBadge type=\"Leader\" data-testid=\"profile-leader\" />\n          <ProfileBadge type=\"Visionary\" data-testid=\"profile-visionary\" />\n          <ProfileBadge type=\"Performer\" data-testid=\"profile-performer\" />\n          <ProfileBadge type=\"At-Risk\" data-testid=\"profile-at-risk\" />\n        </div>\n      </div>\n      <div>\n        <h3 className=\"text-sm font-medium mb-3 text-muted-foreground\">Large Size</h3>\n        <div className=\"flex flex-wrap gap-3\">\n          <ProfileBadge type=\"Leader\" size=\"lg\" data-testid=\"profile-leader-lg\" />\n          <ProfileBadge type=\"Visionary\" size=\"lg\" data-testid=\"profile-visionary-lg\" />\n          <ProfileBadge type=\"Performer\" size=\"lg\" data-testid=\"profile-performer-lg\" />\n          <ProfileBadge type=\"At-Risk\" size=\"lg\" data-testid=\"profile-at-risk-lg\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1177},"server/auth-routes.ts":{"content":"/**\n * Authentication Routes for AiSG\n * Handles login, logout, register, user management\n */\n\nimport type { Express, Request, Response } from \"express\";\nimport { z } from \"zod\";\nimport { loginSchema, registerSchema, resetPasswordSchema } from \"@shared/schema\";\nimport { \n  authenticateUser, \n  createUser, \n  registerUser,\n  getAllUsers, \n  deleteUser, \n  updateUserPassword,\n  getSecurityQuestion,\n  verifySecurityAnswer,\n  resetPassword\n} from \"./auth\";\nimport { requireAuth, requireFullAdmin, requireOwnerOrAdmin } from \"./middleware\";\n\nexport function registerAuthRoutes(app: Express) {\n  /**\n   * POST /api/auth/login\n   * Login with username & password\n   */\n  app.post(\"/api/auth/login\", async (req: Request, res: Response) => {\n    try {\n      // Validate input\n      const { username, password } = loginSchema.parse(req.body);\n      \n      // Authenticate\n      const user = await authenticateUser(username, password);\n      \n      if (!user) {\n        return res.status(401).json({ \n          error: \"Invalid credentials\",\n          userMessage: \"Username atau password salah\" \n        });\n      }\n      \n      // Set session and save explicitly\n      req.session.userId = user.id;\n      \n      // Explicitly save session before responding\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) reject(err);\n          else resolve();\n        });\n      });\n      \n      // Debug logging\n      console.log(\"Login successful:\", {\n        sessionId: req.sessionID,\n        userId: user.id,\n        username: user.username,\n      });\n      \n      return res.json({ \n        success: true,\n        user: {\n          id: user.id,\n          username: user.username,\n          name: user.name,\n          email: user.email,\n          role: user.role,\n        }\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          error: \"Validation error\",\n          userMessage: error.errors[0].message,\n          details: error.errors \n        });\n      }\n      \n      console.error(\"Login error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Terjadi kesalahan saat login\" \n      });\n    }\n  });\n  \n  /**\n   * POST /api/auth/logout\n   * Logout current user\n   */\n  app.post(\"/api/auth/logout\", (req: Request, res: Response) => {\n    req.session.destroy((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        return res.status(500).json({ \n          error: \"Logout failed\",\n          userMessage: \"Gagal logout\" \n        });\n      }\n      \n      res.json({ success: true, message: \"Logged out successfully\" });\n    });\n  });\n  \n  /**\n   * GET /api/auth/me\n   * Get current logged-in user\n   */\n  app.get(\"/api/auth/me\", requireAuth, (req: Request, res: Response) => {\n    return res.json({ user: req.user });\n  });\n  \n  /**\n   * POST /api/auth/register\n   * Public self-registration (creates employee role)\n   */\n  app.post(\"/api/auth/register\", async (req: Request, res: Response) => {\n    try {\n      const userData = registerSchema.parse(req.body);\n      \n      // Register user (always creates employee role)\n      const user = await registerUser(userData);\n      \n      // Auto-login after registration\n      req.session.userId = user.id;\n      \n      // Explicitly save session before responding\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err) => {\n          if (err) reject(err);\n          else resolve();\n        });\n      });\n      \n      // Return without password and security answer\n      const { password: _, securityAnswer: __, ...userWithoutSensitive } = user;\n      \n      return res.status(201).json({ \n        success: true,\n        user: userWithoutSensitive,\n        message: \"Akun berhasil dibuat\" \n      });\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          error: \"Validation error\",\n          userMessage: error.errors[0].message,\n          details: error.errors \n        });\n      }\n      \n      // Handle unique constraint violation (duplicate username)\n      if (error.code === \"23505\") {\n        return res.status(409).json({ \n          error: \"Username already exists\",\n          userMessage: \"Username sudah digunakan\" \n        });\n      }\n      \n      console.error(\"Register error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Gagal membuat akun baru\" \n      });\n    }\n  });\n  \n  /**\n   * POST /api/auth/create-user\n   * Create user with specific role (Full Admin only)\n   */\n  app.post(\"/api/auth/create-user\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const createUserSchema = z.object({\n        username: z.string().min(3, \"Username minimal 3 karakter\"),\n        password: z.string().min(6, \"Password minimal 6 karakter\"),\n        name: z.string().min(1, \"Nama harus diisi\"),\n        email: z.string().email(\"Email tidak valid\").optional(),\n        employeeId: z.string().optional(),\n        role: z.enum([\"super_admin\", \"owner\", \"employee\"]),\n      });\n      \n      const userData = createUserSchema.parse(req.body);\n      \n      // Create user\n      const user = await createUser(userData);\n      \n      // Return without password\n      const { password: _, ...userWithoutPassword } = user;\n      \n      return res.status(201).json({ \n        success: true,\n        user: userWithoutPassword,\n        message: \"User created successfully\" \n      });\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          error: \"Validation error\",\n          userMessage: error.errors[0].message,\n          details: error.errors \n        });\n      }\n      \n      // Handle unique constraint violation (duplicate username)\n      if (error.code === \"23505\") {\n        return res.status(409).json({ \n          error: \"Username already exists\",\n          userMessage: \"Username sudah digunakan\" \n        });\n      }\n      \n      console.error(\"Create user error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Gagal membuat user baru\" \n      });\n    }\n  });\n  \n  /**\n   * GET /api/auth/security-question/:username\n   * Get security question for password reset\n   */\n  app.get(\"/api/auth/security-question/:username\", async (req: Request, res: Response) => {\n    try {\n      const username = req.params.username;\n      const question = await getSecurityQuestion(username);\n      \n      if (!question) {\n        return res.status(404).json({ \n          error: \"User not found\",\n          userMessage: \"Username tidak ditemukan atau tidak memiliki pertanyaan keamanan\" \n        });\n      }\n      \n      return res.json({ securityQuestion: question });\n    } catch (error) {\n      console.error(\"Get security question error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Gagal mengambil pertanyaan keamanan\" \n      });\n    }\n  });\n  \n  /**\n   * POST /api/auth/reset-password\n   * Reset password using security question\n   */\n  app.post(\"/api/auth/reset-password\", async (req: Request, res: Response) => {\n    try {\n      const { username, securityAnswer, newPassword } = resetPasswordSchema.parse(req.body);\n      \n      // Verify security answer\n      const isValid = await verifySecurityAnswer(username, securityAnswer);\n      \n      if (!isValid) {\n        return res.status(401).json({ \n          error: \"Invalid security answer\",\n          userMessage: \"Jawaban keamanan salah\" \n        });\n      }\n      \n      // Reset password\n      await resetPassword(username, newPassword);\n      \n      return res.json({ \n        success: true,\n        message: \"Password berhasil direset\" \n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          error: \"Validation error\",\n          userMessage: error.errors[0].message \n        });\n      }\n      \n      console.error(\"Reset password error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Gagal mereset password\" \n      });\n    }\n  });\n  \n  /**\n   * GET /api/users\n   * Get all users (Admin and Full Admin only)\n   */\n  app.get(\"/api/users\", requireAuth, requireOwnerOrAdmin, async (_req: Request, res: Response) => {\n    try {\n      const users = await getAllUsers();\n      return res.json(users);\n    } catch (error) {\n      console.error(\"Get users error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Gagal mengambil data users\" \n      });\n    }\n  });\n  \n  /**\n   * DELETE /api/users/:id\n   * Delete user (Full Admin only)\n   */\n  app.delete(\"/api/users/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const userId = req.params.id;\n      \n      // Prevent deleting yourself\n      if (userId === req.user?.id) {\n        return res.status(400).json({ \n          error: \"Cannot delete yourself\",\n          userMessage: \"Tidak bisa menghapus akun sendiri\" \n        });\n      }\n      \n      await deleteUser(userId);\n      \n      return res.json({ \n        success: true,\n        message: \"User deleted successfully\" \n      });\n    } catch (error) {\n      console.error(\"Delete user error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Gagal menghapus user\" \n      });\n    }\n  });\n  \n  /**\n   * PUT /api/users/:id/password\n   * Update user password (Full Admin or self)\n   */\n  app.put(\"/api/users/:id/password\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.params.id;\n      const { password } = z.object({ \n        password: z.string().min(6, \"Password minimal 6 karakter\") \n      }).parse(req.body);\n      \n      // Check permission: super admin can change anyone's password, others can only change their own\n      if (req.user?.role !== \"super_admin\" && userId !== req.user?.id) {\n        return res.status(403).json({ \n          error: \"Forbidden\",\n          userMessage: \"Anda hanya bisa mengubah password sendiri\" \n        });\n      }\n      \n      await updateUserPassword(userId, password);\n      \n      return res.json({ \n        success: true,\n        message: \"Password updated successfully\" \n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          error: \"Validation error\",\n          userMessage: error.errors[0].message \n        });\n      }\n      \n      console.error(\"Update password error:\", error);\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        userMessage: \"Gagal mengubah password\" \n      });\n    }\n  });\n}\n","size_bytes":10926},"attached_assets/aisg_instruction_builder_1762749934943.md":{"content":"","size_bytes":0},"client/src/pages/AdminDashboard.tsx":{"content":"/**\n * Admin Dashboard for User Management\n * Only accessible by Full Admin role\n */\n\nimport { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Users, UserPlus, Trash2, Shield, Key } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\n\nexport default function AdminDashboard() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isCreateOpen, setIsCreateOpen] = useState(false);\n  const [newUser, setNewUser] = useState({\n    username: \"\",\n    password: \"\",\n    name: \"\",\n    email: \"\",\n    role: \"employee\" as User[\"role\"],\n  });\n\n  // Fetch all users\n  const { data: users, isLoading } = useQuery<Array<Omit<User, \"password\">>>({\n    queryKey: [\"users\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/users\");\n      if (!res.ok) throw new Error(\"Failed to fetch users\");\n      return res.json();\n    },\n    enabled: user?.role === \"super_admin\" || user?.role === \"owner\",\n  });\n\n  // Fetch inactive users (>90 days, no audits)\n  const { data: inactiveUsers = [] } = useQuery<Array<Omit<User, \"password\">>>({\n    queryKey: [\"inactiveUsers\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/users/inactive\");\n      if (!res.ok) throw new Error(\"Failed to fetch inactive users\");\n      return res.json();\n    },\n    enabled: user?.role === \"super_admin\" || user?.role === \"owner\",\n  });\n\n  // Check permission after all hooks\n  if (user?.role !== \"super_admin\" && user?.role !== \"owner\") {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <Alert variant=\"destructive\">\n          <AlertDescription>\n            Akses ditolak. Halaman ini hanya untuk Super Admin atau Owner.\n          </AlertDescription>\n        </Alert>\n      </div>\n    );\n  }\n\n  // Create user mutation\n  const createUserMutation = useMutation({\n    mutationFn: async (userData: typeof newUser) => {\n      const res = await fetch(\"/api/auth/create-user\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(userData),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.userMessage || \"Failed to create user\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"users\"] });\n      setIsCreateOpen(false);\n      setNewUser({\n        username: \"\",\n        password: \"\",\n        name: \"\",\n        email: \"\",\n        role: \"employee\",\n      });\n      toast({\n        title: \"âœ… User Created\",\n        description: \"User berhasil dibuat!\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"âŒ Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete user mutation\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      const res = await fetch(`/api/admin/users/${userId}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.userMessage || \"Failed to delete user\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"users\"] });\n      queryClient.invalidateQueries({ queryKey: [\"inactiveUsers\"] });\n      toast({\n        title: \"âœ… User Deleted\",\n        description: \"User berhasil dihapus\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"âŒ Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreateUser = (e: React.FormEvent) => {\n    e.preventDefault();\n    createUserMutation.mutate(newUser);\n  };\n\n  const handleDeleteUser = (userId: string, username: string) => {\n    if (confirm(`Hapus user \"${username}\"?`)) {\n      deleteUserMutation.mutate(userId);\n    }\n  };\n\n  const getRoleBadgeColor = (role: User[\"role\"]) => {\n    switch (role) {\n      case \"super_admin\": return \"bg-gradient-to-r from-red-500 to-pink-500\";\n      case \"owner\": return \"bg-gradient-to-r from-purple-500 to-blue-500\";\n      case \"employee\": return \"bg-gradient-to-r from-green-500 to-teal-500\";\n      default: return \"bg-gradient-to-r from-gray-500 to-gray-600\";\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-4 sm:p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-red-400 bg-clip-text text-transparent\">\n            Admin Dashboard\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Manage users and permissions\n          </p>\n        </div>\n\n        {/* Create User Button */}\n        <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600\">\n              <UserPlus className=\"w-4 h-4 mr-2\" />\n              Create User\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"bg-gray-900 border-gray-800\">\n            <DialogHeader>\n              <DialogTitle className=\"bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent\">\n                Create New User\n              </DialogTitle>\n              <DialogDescription>\n                Add a new user to the system with specific role and permissions\n              </DialogDescription>\n            </DialogHeader>\n            <form onSubmit={handleCreateUser} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label>Username</Label>\n                <Input\n                  value={newUser.username}\n                  onChange={(e) => setNewUser({ ...newUser, username: e.target.value })}\n                  placeholder=\"username\"\n                  required\n                  className=\"bg-gray-800 border-gray-700\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Password</Label>\n                <Input\n                  type=\"password\"\n                  value={newUser.password}\n                  onChange={(e) => setNewUser({ ...newUser, password: e.target.value })}\n                  placeholder=\"Minimal 6 karakter\"\n                  required\n                  minLength={6}\n                  className=\"bg-gray-800 border-gray-700\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Name</Label>\n                <Input\n                  value={newUser.name}\n                  onChange={(e) => setNewUser({ ...newUser, name: e.target.value })}\n                  placeholder=\"Full name\"\n                  required\n                  className=\"bg-gray-800 border-gray-700\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Email (Optional)</Label>\n                <Input\n                  type=\"email\"\n                  value={newUser.email}\n                  onChange={(e) => setNewUser({ ...newUser, email: e.target.value })}\n                  placeholder=\"email@example.com\"\n                  className=\"bg-gray-800 border-gray-700\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Role</Label>\n                <Select\n                  value={newUser.role}\n                  onValueChange={(value: User[\"role\"]) => setNewUser({ ...newUser, role: value })}\n                >\n                  <SelectTrigger className=\"bg-gray-800 border-gray-700\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent className=\"bg-gray-800 border-gray-700\">\n                    <SelectItem value=\"super_admin\">Super Admin</SelectItem>\n                    <SelectItem value=\"owner\">Owner</SelectItem>\n                    <SelectItem value=\"employee\">Employee</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-gradient-to-r from-purple-500 to-blue-500\"\n                disabled={createUserMutation.isPending}\n              >\n                {createUserMutation.isPending ? \"Creating...\" : \"Create User\"}\n              </Button>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Inactive Users Warning */}\n      {inactiveUsers.length > 0 && (\n        <Alert className=\"border-yellow-500/30 bg-yellow-500/10\">\n          <AlertDescription className=\"flex items-start gap-3\">\n            <span className=\"text-yellow-500 text-xl\">âš ï¸</span>\n            <div className=\"space-y-2 flex-1\">\n              <p className=\"font-semibold text-yellow-400\">\n                {inactiveUsers.length} user{inactiveUsers.length > 1 ? 's' : ''} terdaftar lebih dari 90 hari tanpa aktivitas audit\n              </p>\n              <div className=\"space-y-2\">\n                {inactiveUsers.map((u) => (\n                  <div key={u.id} className=\"flex items-center justify-between text-sm bg-gray-900/50 p-3 rounded-lg border border-yellow-500/20\">\n                    <div>\n                      <span className=\"text-white font-medium\">{u.name}</span>\n                      <span className=\"text-gray-400\"> (@{u.username})</span>\n                      <span className=\"text-gray-500 ml-2\">\n                        â€¢ Registered {new Date(u.createdAt).toLocaleDateString(\"id-ID\")}\n                      </span>\n                    </div>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleDeleteUser(u.id, u.username)}\n                      className=\"gap-2 border-red-500/30 text-red-400 hover:bg-red-500/10 hover:border-red-500/50\"\n                    >\n                      <Trash2 className=\"w-3 h-3\" />\n                      Delete\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Users List */}\n      <Card className=\"bg-gray-900/50 border-gray-800\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"w-5 h-5\" />\n            All Users ({users?.length || 0})\n          </CardTitle>\n          <CardDescription>\n            Manage user accounts and permissions\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"w-8 h-8 border-4 border-purple-500/30 border-t-purple-500 rounded-full animate-spin mx-auto\" />\n              <p className=\"text-muted-foreground mt-2\">Loading users...</p>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {users?.map((u) => (\n                <div\n                  key={u.id}\n                  className=\"flex items-center justify-between p-4 rounded-lg bg-gray-800/50 border border-gray-700 hover:border-gray-600 transition-all\"\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center\">\n                        <span className=\"text-white font-bold\">\n                          {u.name.charAt(0).toUpperCase()}\n                        </span>\n                      </div>\n                      <div>\n                        <p className=\"font-semibold text-white\">{u.name}</p>\n                        <p className=\"text-sm text-gray-400\">@{u.username}</p>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-3\">\n                    <span className={`px-3 py-1 rounded-full text-xs font-semibold text-white ${getRoleBadgeColor(u.role)}`}>\n                      {u.role.replace('_', ' ')}\n                    </span>\n                    {u.id !== user.id && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleDeleteUser(u.id, u.username)}\n                        className=\"text-red-400 hover:text-red-300 hover:bg-red-500/10\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":13524},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\n\nexport default function ThemeToggle() {\n  const [theme, setTheme] = useState<\"light\" | \"dark\">(\"dark\");\n\n  useEffect(() => {\n    const savedTheme = localStorage.getItem(\"theme\") as \"light\" | \"dark\" | null;\n    const initialTheme = savedTheme || \"dark\";\n    setTheme(initialTheme);\n    document.documentElement.classList.toggle(\"dark\", initialTheme === \"dark\");\n  }, []);\n\n  const toggleTheme = () => {\n    const newTheme = theme === \"light\" ? \"dark\" : \"light\";\n    setTheme(newTheme);\n    localStorage.setItem(\"theme\", newTheme);\n    document.documentElement.classList.toggle(\"dark\", newTheme === \"dark\");\n    console.log(`Theme switched to ${newTheme}`);\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      className=\"rounded-lg\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"w-5 h-5\" />\n      ) : (\n        <Sun className=\"w-5 h-5\" />\n      )}\n    </Button>\n  );\n}\n","size_bytes":1109},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"server/auth.ts":{"content":"/**\n * Authentication Service for AiSG\n * Handles login, logout, password hashing, and session management\n */\n\nimport bcrypt from \"bcrypt\";\nimport { eq } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport { users, type User} from \"@shared/schema\";\n\nconst SALT_ROUNDS = 10;\n\n/**\n * Hash password using bcrypt\n */\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\n/**\n * Verify password against hash\n */\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\n/**\n * Create a new user with hashed password\n */\nexport async function createUser(data: {\n  username: string;\n  password: string;\n  name: string;\n  email?: string;\n  employeeId?: string;\n  role?: \"super_admin\" | \"owner\" | \"employee\";\n  securityQuestion?: string;\n  securityAnswer?: string;\n}): Promise<User> {\n  const hashedPassword = await hashPassword(data.password);\n  \n  // Hash security answer if provided (for password reset)\n  const hashedSecurityAnswer = data.securityAnswer \n    ? await hashPassword(data.securityAnswer.toLowerCase().trim())\n    : undefined;\n  \n  const [user] = await db.insert(users).values({\n    username: data.username,\n    password: hashedPassword,\n    name: data.name,\n    email: data.email,\n    employeeId: data.employeeId,\n    role: data.role || \"employee\",\n    securityQuestion: data.securityQuestion,\n    securityAnswer: hashedSecurityAnswer,\n  }).returning();\n  \n  return user;\n}\n\n/**\n * Register a new user (public registration)\n * Always creates employee role\n */\nexport async function registerUser(data: {\n  username: string;\n  password: string;\n  name: string;\n  email?: string;\n  employeeId?: string;\n  securityQuestion: string;\n  securityAnswer: string;\n}): Promise<User> {\n  return createUser({\n    ...data,\n    role: \"employee\",\n  });\n}\n\n/**\n * Get security question for a username\n */\nexport async function getSecurityQuestion(username: string): Promise<string | null> {\n  const [user] = await db\n    .select({ securityQuestion: users.securityQuestion })\n    .from(users)\n    .where(eq(users.username, username))\n    .limit(1);\n  \n  return user?.securityQuestion || null;\n}\n\n/**\n * Verify security answer for password reset\n */\nexport async function verifySecurityAnswer(\n  username: string,\n  answer: string\n): Promise<boolean> {\n  const [user] = await db\n    .select({ securityAnswer: users.securityAnswer })\n    .from(users)\n    .where(eq(users.username, username))\n    .limit(1);\n  \n  if (!user || !user.securityAnswer) {\n    return false;\n  }\n  \n  // Compare with hashed answer (case-insensitive)\n  return verifyPassword(answer.toLowerCase().trim(), user.securityAnswer);\n}\n\n/**\n * Reset password using security question\n */\nexport async function resetPassword(\n  username: string,\n  newPassword: string\n): Promise<void> {\n  const hashedPassword = await hashPassword(newPassword);\n  \n  await db\n    .update(users)\n    .set({ \n      password: hashedPassword,\n      updatedAt: new Date()\n    })\n    .where(eq(users.username, username));\n}\n\n/**\n * Authenticate user with username and password\n * Returns user object (without password) if successful, null if failed\n */\nexport async function authenticateUser(\n  username: string,\n  password: string\n): Promise<Omit<User, \"password\"> | null> {\n  // Find user by username\n  const [user] = await db\n    .select()\n    .from(users)\n    .where(eq(users.username, username))\n    .limit(1);\n  \n  if (!user) {\n    return null; // User not found\n  }\n  \n  // Verify password\n  const isValid = await verifyPassword(password, user.password);\n  \n  if (!isValid) {\n    return null; // Invalid password\n  }\n  \n  // Return user without password\n  const { password: _, ...userWithoutPassword } = user;\n  return userWithoutPassword;\n}\n\n/**\n * Get user by ID (without password)\n */\nexport async function getUserById(userId: string): Promise<Omit<User, \"password\"> | null> {\n  const [user] = await db\n    .select()\n    .from(users)\n    .where(eq(users.id, userId))\n    .limit(1);\n  \n  if (!user) {\n    return null;\n  }\n  \n  const { password: _, ...userWithoutPassword } = user;\n  return userWithoutPassword;\n}\n\n/**\n * Update user password\n */\nexport async function updateUserPassword(userId: string, newPassword: string): Promise<void> {\n  const hashedPassword = await hashPassword(newPassword);\n  \n  await db\n    .update(users)\n    .set({ \n      password: hashedPassword,\n      updatedAt: new Date()\n    })\n    .where(eq(users.id, userId));\n}\n\n/**\n * Delete user by ID\n */\nexport async function deleteUser(userId: string): Promise<void> {\n  await db.delete(users).where(eq(users.id, userId));\n}\n\n/**\n * Get all users (without passwords) - for admin dashboard\n */\nexport async function getAllUsers(): Promise<Array<Omit<User, \"password\">>> {\n  const allUsers = await db.select().from(users);\n  \n  return allUsers.map(({ password: _, ...user }) => user);\n}\n\n/**\n * Check if user has permission based on role\n * Enterprise RBAC: super_admin > owner > employee\n * \n * Note: For position-based permissions, use canManageEmployee in storage layer\n */\nexport function hasPermission(\n  userRole: User[\"role\"],\n  requiredRole: User[\"role\"]\n): boolean {\n  const roleHierarchy: Record<User[\"role\"], number> = {\n    super_admin: 3,\n    owner: 2,\n    employee: 1,\n  };\n  \n  return roleHierarchy[userRole] >= roleHierarchy[requiredRole];\n}\n\n/**\n * Check if user can access audit\n * Super admin and owner can access all\n * Employees can only access their own or subordinates' audits\n */\nexport function canAccessAudit(\n  userRole: User[\"role\"],\n  userId: string,\n  auditOwnerId: string | null\n): boolean {\n  // Super admin can access everything\n  if (userRole === \"super_admin\") {\n    return true;\n  }\n  \n  // Owner can access everything in their organization\n  if (userRole === \"owner\") {\n    return true;\n  }\n  \n  // Employees can only access their own audits\n  // (hierarchical access checked at storage/middleware layer)\n  return userId === auditOwnerId;\n}\n\n/**\n * Ensure superadmin user exists\n * This runs on server startup to guarantee superadmin exists in both dev and production databases\n */\nexport async function ensureSuperadminExists(): Promise<void> {\n  try {\n    // Check if superadmin already exists\n    const [existingAdmin] = await db\n      .select()\n      .from(users)\n      .where(eq(users.username, \"superadmin\"))\n      .limit(1);\n    \n    if (existingAdmin) {\n      console.log(\"âœ… Superadmin user already exists\");\n      return;\n    }\n    \n    // Create superadmin if not exists\n    console.log(\"ðŸ”§ Creating superadmin user...\");\n    await createUser({\n      username: \"superadmin\",\n      password: \"vito1007\",\n      name: \"AiSG Super Admin\",\n      email: \"admin@aisg.com\",\n      role: \"super_admin\",\n      securityQuestion: \"Nama aplikasi ini?\",\n      securityAnswer: \"AiSG\",\n    });\n    \n    console.log(\"âœ… Superadmin user created successfully!\");\n    console.log(\"   Username: superadmin\");\n    console.log(\"   Password: vito1007\");\n  } catch (error) {\n    console.error(\"âŒ Failed to ensure superadmin exists:\", error);\n    // Don't throw - let the app continue even if this fails\n  }\n}\n","size_bytes":7190},"replit.md":{"content":"# AISG Enterprise MVP - Simplified Audit System\n\n## Overview\nAISG Enterprise MVP is an employee performance audit platform designed for multi-branch organizations, leveraging Excel uploads for data management. It supports scalability up to 42 branches with over 800 employees per branch. The system utilizes an 18-Pillar framework for monthly self-assessments, features an auto-hierarchy builder, bottom-up aggregation of performance data, and zone-based analytics (Success ðŸŸ©, Warning ðŸŸ¨, Critical ðŸŸ¥) to provide clear insights into employee performance. The current MVP focuses on core functionalities including manual Excel uploads, simplified authentication, and comprehensive reporting.\n\n## User Preferences\n**Communication Style**: Simple, everyday language (Bahasa Indonesia)\n\n**Design Preferences**:\n- Modern professional dark mode theme\n- Zone-based color coding (Success ðŸŸ©, Warning ðŸŸ¨, Critical ðŸŸ¥)\n- Clear, prominent UI elements\n- Sticky navigation (header, sidebar)\n- Responsive design (mobile-friendly)\n\n## System Architecture\n\n### Frontend\n- **Framework**: React 18 with TypeScript and Vite\n- **UI**: shadcn/ui components (Radix UI) with dark mode\n- **State Management**: TanStack Query for server state, React Hook Form with Zod for forms\n- **Routing**: Wouter\n- **Key Features**: Excel upload interface, hierarchical employee dashboard, monthly 18 Pilar assessment form, zone-based analytics, and PDF export.\n\n### Backend\n- **Runtime**: Node.js with Express.js\n- **API**: RESTful JSON API\n- **Business Logic**: Includes Excel parsing & validation, auto-hierarchy building, Reality Score calculation, zone classification, bottom-up aggregation, and SWOT/ProDem/Action Plan generation.\n- **Validation**: Zod schemas (shared with frontend).\n- **Patterns**: Storage interface abstraction, schema-driven development, position-based RBAC.\n\n### Data Storage\n- **Database**: PostgreSQL 16 (Neon serverless) using Drizzle ORM.\n- **Schema**: 8 tables including `users`, `employees`, `branches`, `monthly_performance`, `audits`, `chatMessages` (optional AI feature), `security_questions`, and `upload_logs`.\n- **Key Features**: UUID primary keys, JSONB for flexible data, self-referencing employee hierarchy, decimal precision for financial data, and cascading deletes. Hierarchical queries use recursive CTEs.\n\n### Authentication & Authorization\n- **Architecture**: Session-based authentication with position-based RBAC.\n- **Session Management**: express-session with MemoryStore.\n- **Password Strategy**: Auto-created accounts use `tanggal lahir` (YYYYMMDD) as initial password, forced change on first login, bcrypt hashing.\n- **Password Reset**: Via security questions (3 questions, 2 correct answers needed).\n- **Role Types**: Simplified to `super_admin`, `brm`, and `staff` for MVP.\n- **Security**: CSRF protection, secure cookies, rate limiting, circular reference prevention.\n\n### Monthly Audit Workflow\n- **Frequency**: Monthly cycle for performance assessment.\n- **Flow**: BrM uploads Excel, system auto-updates margin/NA, staff complete 18 Pilar assessment, BrM reviews completion, then exports PDF reports.\n- **Bottom-Up Aggregation**: Real-time cascading aggregation of margin/NA from subordinates up the hierarchy, with Reality Score calculated at each level.\n\n## External Dependencies\n- **AI Services (Optional)**: OpenAI ChatGPT (gpt-4o-mini), Google Gemini (gemini-2.0-flash-exp).\n- **Database**: Neon Serverless PostgreSQL.\n- **UI Libraries**: Radix UI, shadcn/ui, Lucide React.\n- **Form & Validation**: React Hook Form, Zod.\n- **Excel Processing**: XLSX library (SheetJS).\n- **PDF Generation**: PDFKit.\n- **Development Tools**: Vite, TypeScript, Tailwind CSS, Drizzle Kit.","size_bytes":3708},"client/src/pages/AuditCreation.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage, FormDescription } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Loader2, TrendingUp, AlertTriangle, CheckCircle2, Package } from \"lucide-react\";\nimport { PILARS, PILAR_CATEGORIES, SCORE_LEVELS, getCategoryById } from \"@shared/pillar-constants\";\nimport type { Employee } from \"@shared/schema\";\nimport type { AuditCreateResultDto, QuarterlyPerformanceDto, PendingSubordinateDto } from \"@shared/types\";\n\nconst auditFormSchema = z.object({\n  employeeId: z.string().min(1, \"Pilih karyawan\"),\n  year: z.coerce.number().int().min(2020).max(2030),\n  quarter: z.coerce.number().int().min(1).max(4),\n  pillarAnswers: z.array(z.object({\n    pillarId: z.number(),\n    pillarName: z.string(),\n    category: z.string(),\n    score: z.number().min(1).max(5),\n    notes: z.string().optional(),\n  })).length(18, \"Semua 18 pilar harus diisi\"),\n});\n\ntype AuditFormData = z.infer<typeof auditFormSchema>;\n\nexport default function AuditCreation() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [selectedEmployeeId, setSelectedEmployeeId] = useState<string>(\"\");\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  const [selectedQuarter, setSelectedQuarter] = useState(Math.ceil((new Date().getMonth() + 1) / 3));\n\n  // Fetch employees (RBAC-filtered on backend)\n  const { data: employees = [], isLoading: loadingEmployees } = useQuery<Employee[]>({\n    queryKey: [\"/api/enterprise/employees\"],\n  });\n\n  // Fetch quarterly performance for selected employee\n  const { data: quarterlyPerf, isLoading: loadingPerf } = useQuery<QuarterlyPerformanceDto>({\n    queryKey: [\"/api/enterprise/performance/quarterly\", selectedEmployeeId, selectedYear, selectedQuarter],\n    enabled: !!selectedEmployeeId,\n  });\n\n  // Initialize form with default scores\n  const defaultPillarAnswers = PILARS.map(pilar => ({\n    pillarId: pilar.id,\n    pillarName: pilar.name,\n    category: pilar.category,\n    score: 3, // Default to \"Cukup\"\n    notes: \"\",\n  }));\n\n  const form = useForm<AuditFormData>({\n    resolver: zodResolver(auditFormSchema),\n    defaultValues: {\n      employeeId: \"\",\n      year: new Date().getFullYear(),\n      quarter: Math.ceil((new Date().getMonth() + 1) / 3),\n      pillarAnswers: defaultPillarAnswers,\n    },\n  });\n\n  const [auditWarnings, setAuditWarnings] = useState<string[]>([]);\n  const [pendingSubordinates, setPendingSubordinates] = useState<PendingSubordinateDto[]>([]);\n\n  // Create audit mutation\n  const createAudit = useMutation({\n    mutationFn: async (data: AuditFormData) => {\n      return await apiRequest<AuditCreateResultDto>(\"/api/enterprise/audits\", \"POST\", data);\n    },\n    onSuccess: (response) => {\n      // Always reset warnings (prevent stale state)\n      setAuditWarnings(response.warnings || []);\n      setPendingSubordinates(response.pendingSubordinates || []);\n      \n      toast({\n        title: \"Audit Berhasil Dibuat!\",\n        description: response.warnings.length > 0 \n          ? `Audit tersimpan dengan ${response.warnings.length} catatan`\n          : \"Audit karyawan telah tersimpan\",\n      });\n      \n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/audits\"] });\n      form.reset();\n      setSelectedEmployeeId(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Gagal Membuat Audit\",\n        description: error.message || \"Terjadi kesalahan saat membuat audit\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: AuditFormData) => {\n    createAudit.mutate(data);\n  };\n\n  const quarterNames = [\"Q1 (Jan-Mar)\", \"Q2 (Apr-Jun)\", \"Q3 (Jul-Sep)\", \"Q4 (Okt-Des)\"];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-purple-950/5 to-background\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 py-8 space-y-6\">\n        {/* Header */}\n        <div className=\"space-y-2\">\n          <h1 className=\"text-3xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-purple-500 bg-clip-text text-transparent\">\n            Buat Audit Karyawan\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Audit kinerja karyawan berdasarkan 18 Pilar Framework\n          </p>\n        </div>\n\n        {/* Warnings Display */}\n        {auditWarnings.length > 0 && (\n          <Alert className=\"border-yellow-500/50 bg-yellow-500/10\" data-testid=\"alert-audit-warnings\">\n            <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />\n            <AlertDescription>\n              <div className=\"space-y-2\">\n                <p className=\"font-semibold text-yellow-500\">Catatan Penting:</p>\n                <ul className=\"list-disc list-inside space-y-1 text-sm\">\n                  {auditWarnings.map((warning, idx) => (\n                    <li key={idx} className=\"text-muted-foreground\">{warning}</li>\n                  ))}\n                </ul>\n                {pendingSubordinates.length > 0 && (\n                  <div className=\"mt-3 p-3 rounded-lg bg-background/50\">\n                    <p className=\"text-sm font-semibold mb-2\">Subordinate yang belum audit:</p>\n                    <div className=\"space-y-1 text-xs\">\n                      {pendingSubordinates.map((sub, idx) => (\n                        <div key={idx} className=\"flex justify-between\">\n                          <span>{sub.fullName} ({sub.employeeCode})</span>\n                          <span className=\"text-muted-foreground\">{sub.positionName}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setAuditWarnings([]);\n                    setPendingSubordinates([]);\n                  }}\n                  className=\"mt-2\"\n                  data-testid=\"button-dismiss-warnings\"\n                >\n                  Tutup\n                </Button>\n              </div>\n            </AlertDescription>\n          </Alert>\n        )}\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            {/* Employee & Period Selection */}\n            <Card className=\"border-purple-500/20 shadow-xl shadow-purple-500/5\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Package className=\"w-5 h-5 text-purple-400\" />\n                  Informasi Audit\n                </CardTitle>\n                <CardDescription>Pilih karyawan dan periode audit</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"employeeId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Karyawan *</FormLabel>\n                      <Select\n                        disabled={loadingEmployees}\n                        onValueChange={(value) => {\n                          field.onChange(value);\n                          setSelectedEmployeeId(value);\n                        }}\n                        value={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-employee-audit\">\n                            <SelectValue placeholder=\"Pilih karyawan...\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {employees.map((emp) => (\n                            <SelectItem key={emp.id} value={emp.id}>\n                              {emp.fullName} ({emp.employeeCode})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"year\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Tahun *</FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"number\"\n                            placeholder=\"2025\"\n                            data-testid=\"input-audit-year\"\n                            {...field}\n                            onChange={(e) => {\n                              field.onChange(e);\n                              setSelectedYear(parseInt(e.target.value));\n                            }}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"quarter\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Quarter *</FormLabel>\n                        <Select\n                          onValueChange={(value) => {\n                            field.onChange(parseInt(value));\n                            setSelectedQuarter(parseInt(value));\n                          }}\n                          value={field.value.toString()}\n                        >\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-audit-quarter\">\n                              <SelectValue />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {quarterNames.map((name, idx) => (\n                              <SelectItem key={idx + 1} value={(idx + 1).toString()}>\n                                {name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Performance Summary */}\n                {selectedEmployeeId && quarterlyPerf && (\n                  <div className=\"mt-4 p-4 rounded-lg bg-gradient-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/20\">\n                    <h3 className=\"text-sm font-semibold text-blue-400 mb-2 flex items-center gap-2\">\n                      <TrendingUp className=\"w-4 h-4\" />\n                      Performance {quarterNames[selectedQuarter - 1]} {selectedYear}\n                    </h3>\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                      <div>\n                        <span className=\"text-muted-foreground\">Margin Personal:</span>\n                        <p className=\"font-semibold\">Rp {parseFloat(quarterlyPerf.aggregated.totalMarginPersonal).toLocaleString('id-ID')}</p>\n                      </div>\n                      <div>\n                        <span className=\"text-muted-foreground\">NA Personal:</span>\n                        <p className=\"font-semibold\">{quarterlyPerf.aggregated.totalNAPersonal}</p>\n                      </div>\n                      <div>\n                        <span className=\"text-muted-foreground\">Lot Settled:</span>\n                        <p className=\"font-semibold\">{quarterlyPerf.aggregated.totalLotSettled}</p>\n                      </div>\n                      <div>\n                        <span className=\"text-muted-foreground\">Bulan Tersedia:</span>\n                        <p className=\"font-semibold\">{quarterlyPerf.months.length}/3 bulan</p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* 18 Pilar Assessment */}\n            {PILAR_CATEGORIES.map((category) => {\n              const categoryPilars = PILARS.filter(p => p.category === category.id);\n              const catInfo = getCategoryById(category.id);\n              \n              return (\n                <Card key={category.id} className={`border-l-4 ${catInfo?.borderColor} shadow-xl shadow-purple-500/5`}>\n                  <CardHeader className={catInfo?.bgColor}>\n                    <CardTitle className={`text-lg ${catInfo?.color}`}>\n                      {category.name}\n                    </CardTitle>\n                    <CardDescription>{category.nameEn}</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-6 pt-6\">\n                    {categoryPilars.map((pilar, idx) => {\n                      const pillarIndex = PILARS.findIndex(p => p.id === pilar.id);\n                      \n                      return (\n                        <FormField\n                          key={pilar.id}\n                          control={form.control}\n                          name={`pillarAnswers.${pillarIndex}.score`}\n                          render={({ field }) => (\n                            <FormItem className=\"space-y-3\">\n                              <FormLabel className=\"text-base font-semibold\">\n                                {pilar.id}. {pilar.name}\n                              </FormLabel>\n                              <FormDescription className=\"text-xs\">\n                                {pilar.description}\n                              </FormDescription>\n                              <FormControl>\n                                <RadioGroup\n                                  onValueChange={(value) => field.onChange(parseInt(value))}\n                                  value={field.value?.toString()}\n                                  className=\"flex gap-4\"\n                                >\n                                  {SCORE_LEVELS.map((level) => (\n                                    <div key={level.value} className=\"flex items-center space-x-2\">\n                                      <RadioGroupItem \n                                        value={level.value.toString()} \n                                        id={`pilar-${pilar.id}-${level.value}`}\n                                        data-testid={`radio-pilar-${pilar.id}-score-${level.value}`}\n                                      />\n                                      <Label \n                                        htmlFor={`pilar-${pilar.id}-${level.value}`}\n                                        className={`text-sm cursor-pointer ${level.color}`}\n                                      >\n                                        {level.value} - {level.label}\n                                      </Label>\n                                    </div>\n                                  ))}\n                                </RadioGroup>\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      );\n                    })}\n                  </CardContent>\n                </Card>\n              );\n            })}\n\n            {/* Submit Button */}\n            <Card className=\"border-purple-500/20\">\n              <CardContent className=\"pt-6\">\n                <Button\n                  type=\"submit\"\n                  className=\"w-full gap-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600\"\n                  disabled={createAudit.isPending || !selectedEmployeeId}\n                  data-testid=\"button-submit-audit\"\n                >\n                  {createAudit.isPending ? (\n                    <>\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      Membuat Audit...\n                    </>\n                  ) : (\n                    <>\n                      <CheckCircle2 className=\"w-4 h-4\" />\n                      Buat Audit\n                    </>\n                  )}\n                </Button>\n              </CardContent>\n            </Card>\n          </form>\n        </Form>\n      </div>\n    </div>\n  );\n}\n","size_bytes":17132},"client/src/components/ChatPanel.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Send, Trash2, Download, Loader2, MessageSquare } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { ChatMessage } from \"@shared/schema\";\n\ninterface ChatPanelProps {\n  auditId: string;\n  auditName: string;\n}\n\nexport function ChatPanel({ auditId, auditName }: ChatPanelProps) {\n  const [message, setMessage] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n\n  const { data: history = [], isLoading } = useQuery<ChatMessage[]>({\n    queryKey: [`/api/chat/${auditId}`],\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (msg: string) => {\n      const res = await apiRequest(\"POST\", \"/api/chat\", {\n        auditId,\n        message: msg\n      });\n      return (res as Response).json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/chat/${auditId}`] });\n      setMessage(\"\");\n    },\n    onError: (error: any) => {\n      // Refresh chat history even on error because user message is already saved\n      queryClient.invalidateQueries({ queryKey: [`/api/chat/${auditId}`] });\n      setMessage(\"\");\n      \n      let errorMessage = \"Gagal mengirim pesan. Silakan coba lagi.\";\n      \n      // Try to extract userMessage from API error response\n      try {\n        const errorText = error?.message || String(error);\n        const match = errorText.match(/\\d+:\\s*(.+)/);\n        if (match) {\n          const jsonPart = match[1];\n          const errorData = JSON.parse(jsonPart);\n          if (errorData.userMessage) {\n            errorMessage = errorData.userMessage;\n          }\n        }\n      } catch {\n        // Use default message if parsing fails\n      }\n      \n      toast({\n        title: \"Error\",\n        description: errorMessage,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const clearHistoryMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"DELETE\", `/api/chat/${auditId}`);\n      return (res as Response).json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/chat/${auditId}`] });\n      toast({\n        title: \"Riwayat dihapus\",\n        description: \"Riwayat chat telah berhasil dihapus.\"\n      });\n    }\n  });\n\n  const exportChat = () => {\n    const chatText = history\n      .map(msg => `[${msg.role.toUpperCase()}] ${msg.content}`)\n      .join(\"\\n\\n\");\n    \n    const blob = new Blob([chatText], { type: \"text/plain\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `chat-${auditName}-${new Date().toISOString().split(\"T\")[0]}.txt`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    // Find the ScrollArea viewport element\n    const scrollViewport = scrollAreaRef.current?.querySelector('[data-radix-scroll-area-viewport]');\n    if (scrollViewport) {\n      // Scroll to the bottom smoothly\n      scrollViewport.scrollTo({\n        top: scrollViewport.scrollHeight,\n        behavior: \"smooth\"\n      });\n    }\n  }, [history, sendMessageMutation.isPending]);\n\n  const handleSend = () => {\n    if (!message.trim()) return;\n    sendMessageMutation.mutate(message);\n  };\n\n  return (\n    <Card className=\"flex flex-col h-full\">\n      <div className=\"p-3 sm:p-4 border-b flex items-center justify-between gap-2\">\n        <div className=\"flex items-center gap-2\">\n          <MessageSquare className=\"w-4 h-4 sm:w-5 sm:h-5 text-primary\" />\n          <h3 className=\"font-semibold text-sm sm:text-base\">AI Coach</h3>\n        </div>\n        <div className=\"flex gap-1\">\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={exportChat}\n            disabled={history.length === 0}\n            data-testid=\"button-export-chat\"\n            className=\"h-8 w-8 sm:h-10 sm:w-10\"\n          >\n            <Download className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n          </Button>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => clearHistoryMutation.mutate()}\n            disabled={history.length === 0 || clearHistoryMutation.isPending}\n            data-testid=\"button-clear-chat\"\n            className=\"h-8 w-8 sm:h-10 sm:w-10\"\n          >\n            <Trash2 className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1 p-3 sm:p-4\" ref={scrollAreaRef}>\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-full text-muted-foreground\">\n            <Loader2 className=\"w-6 h-6 animate-spin\" />\n          </div>\n        ) : history.length === 0 ? (\n          <div className=\"flex flex-col items-start justify-start h-full px-4 py-6\">\n            <div className=\"bg-gradient-to-r from-blue-500/10 to-purple-500/10 border border-blue-500/20 rounded-lg p-4 sm:p-5 mb-4\">\n              <div className=\"flex items-start gap-3 mb-3\">\n                <MessageSquare className=\"w-5 h-5 text-blue-500 mt-0.5 shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold text-sm sm:text-base text-foreground mb-2\">\n                    Selamat datang di AI Coach! ðŸ‘‹\n                  </h4>\n                  <p className=\"text-xs sm:text-sm text-muted-foreground leading-relaxed mb-3\">\n                    Sebelum kita mulai, mohon perkenalkan diri Anda terlebih dahulu agar diskusi lebih personal dan terarah:\n                  </p>\n                  <div className=\"space-y-2 text-xs sm:text-sm\">\n                    <div className=\"flex items-start gap-2\">\n                      <span className=\"text-blue-500 font-bold shrink-0\">1.</span>\n                      <span className=\"text-muted-foreground\">Siapa <strong className=\"text-foreground\">nama</strong> Anda?</span>\n                    </div>\n                    <div className=\"flex items-start gap-2\">\n                      <span className=\"text-blue-500 font-bold shrink-0\">2.</span>\n                      <span className=\"text-muted-foreground\">Apa <strong className=\"text-foreground\">posisi/jabatan</strong> Anda?</span>\n                    </div>\n                    <div className=\"flex items-start gap-2\">\n                      <span className=\"text-blue-500 font-bold shrink-0\">3.</span>\n                      <div className=\"text-muted-foreground\">\n                        Chat ini untuk <strong className=\"text-foreground\">siapa</strong>?\n                        <ul className=\"ml-4 mt-1 space-y-1 list-disc\">\n                          <li>Untuk <strong className=\"text-foreground\">diri sendiri</strong> (refleksi performa Anda)</li>\n                          <li>Untuk <strong className=\"text-foreground\">bawahan/team</strong> Anda (sebutkan namanya)</li>\n                        </ul>\n                      </div>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-4 font-medium\">\n                    ðŸ’¡ Contoh: \"Halo, saya Budi, posisi SBM. Chat ini untuk diskusi performa bawahan saya, Andi (BC).\"\n                  </p>\n                </div>\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground text-center w-full\">\n              Setelah perkenalan, Anda bisa bertanya apa saja tentang audit, strategi improvement, atau coaching! ðŸš€\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-3 sm:space-y-4 pb-6\">\n            {history.map((msg, idx) => (\n              <div\n                key={idx}\n                className={`flex ${msg.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n                data-testid={`message-${msg.role}-${idx}`}\n              >\n                <div\n                  className={`max-w-[85%] sm:max-w-[80%] rounded-md p-2.5 sm:p-3 ${\n                    msg.role === \"user\"\n                      ? \"bg-primary text-primary-foreground\"\n                      : \"bg-muted\"\n                  }`}\n                >\n                  <p className=\"text-xs sm:text-sm whitespace-pre-wrap break-words\">{msg.content}</p>\n                </div>\n              </div>\n            ))}\n            {sendMessageMutation.isPending && (\n              <div className=\"flex justify-start\">\n                <div className=\"bg-muted rounded-md p-3\">\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                </div>\n              </div>\n            )}\n            {/* Invisible anchor for auto-scroll */}\n            <div ref={messagesEndRef} className=\"h-1\" />\n          </div>\n        )}\n      </ScrollArea>\n\n      <Separator />\n      \n      <div className=\"p-3 sm:p-4 space-y-2 sm:space-y-3\">\n        <div className=\"text-xs sm:text-sm text-muted-foreground hidden sm:block\">\n          ðŸ’¬ <span className=\"font-medium\">Mari kita diskusikan hasil auditnya!</span> Tanya apa saja tentang performa, rekomendasi, atau strategi improvement Anda.\n        </div>\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            handleSend();\n          }}\n          className=\"flex gap-2\"\n        >\n          <Input\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            placeholder=\"Ketik pertanyaan Anda disini...\"\n            disabled={sendMessageMutation.isPending}\n            data-testid=\"input-chat-message\"\n            className=\"flex-1 text-sm h-9 sm:h-10\"\n          />\n          <Button\n            type=\"submit\"\n            size=\"icon\"\n            disabled={!message.trim() || sendMessageMutation.isPending}\n            data-testid=\"button-send-message\"\n            className=\"h-9 w-9 sm:h-10 sm:w-10 shrink-0\"\n          >\n            <Send className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n          </Button>\n        </form>\n      </div>\n    </Card>\n  );\n}\n","size_bytes":10378},"client/src/components/examples/StatCard.tsx":{"content":"import StatCard from \"../StatCard\";\nimport { BarChart3, Users, TrendingUp, Clock } from \"lucide-react\";\n\nexport default function StatCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 p-6 bg-background\">\n      <StatCard\n        title=\"Total Audit\"\n        value=\"248\"\n        icon={BarChart3}\n        trend={{ value: 12.5, isPositive: true }}\n        data-testid=\"stat-total-audits\"\n      />\n      <StatCard\n        title=\"Pengguna Aktif\"\n        value=\"156\"\n        icon={Users}\n        trend={{ value: 8.2, isPositive: true }}\n        data-testid=\"stat-active-users\"\n      />\n      <StatCard\n        title=\"Rata-rata Skor\"\n        value=\"87.5\"\n        icon={TrendingUp}\n        trend={{ value: 3.1, isPositive: false }}\n        data-testid=\"stat-avg-score\"\n      />\n      <StatCard\n        title=\"Pending Review\"\n        value=\"12\"\n        icon={Clock}\n        data-testid=\"stat-pending-review\"\n      />\n    </div>\n  );\n}\n","size_bytes":973},"server/enterprise-routes.ts":{"content":"/**\n * Enterprise Organizational Structure Routes\n * Handles PT Companies, CEO Units, Branches, Positions, Employees\n */\n\nimport type { Express, Request, Response } from \"express\";\nimport { z } from \"zod\";\nimport {\n  insertPtSchema,\n  insertCeoUnitSchema,\n  insertBranchSchema,\n  insertPositionSchema,\n  insertEmployeeSchema,\n  insertMonthlyPerformanceSchema,\n  insertAuditSchema,\n} from \"@shared/schema\";\nimport { storage } from \"./storage\";\nimport { \n  requireAuth, \n  requireFullAdmin, \n  canViewPerformance, \n  canManagePerformance \n} from \"./middleware\";\nimport { \n  calculateTeamAggregation, \n  validateQuarterlyPerformance, \n  calculatePersonalQuarterly \n} from \"./audit-aggregation-helper\";\nimport { validatePillarAnswers } from \"@shared/pillar-constants\";\nimport {\n  aggregateQuarterlyPerformance,\n  calculatePillarRealityScore,\n  calculateZonaKinerja,\n  calculateZonaPerilaku,\n  calculateZonaFinal,\n  calculateProfile,\n  calculateProDemRecommendation,\n  generateProgressKuartal,\n  generateEWS,\n} from \"./business-logic\";\nimport {\n  generateExecutiveSummary,\n  generateInsightLengkap,\n  generateSWOT,\n  generateCoaching,\n  generateActionPlan,\n  generateVisi,\n  generateMagicSection,\n} from \"./ai-narrative-generator\";\nimport { generateAuditPDF } from \"./pdf-generator\";\nimport type { AuditPdfDto } from \"@shared/types\";\n\nexport function registerEnterpriseRoutes(app: Express) {\n  // =========================================================================\n  // PT COMPANY ROUTES\n  // =========================================================================\n\n  /**\n   * GET /api/enterprise/pts\n   * Get all PT companies\n   */\n  app.get(\"/api/enterprise/pts\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const pts = await storage.getAllPTs();\n      res.json(pts);\n    } catch (error: any) {\n      console.error(\"Error fetching PTs:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/pts/:id\n   * Get single PT company\n   */\n  app.get(\"/api/enterprise/pts/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const pt = await storage.getPT(req.params.id);\n      if (!pt) {\n        return res.status(404).json({ error: \"PT tidak ditemukan\" });\n      }\n      res.json(pt);\n    } catch (error: any) {\n      console.error(\"Error fetching PT:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * POST /api/enterprise/pts\n   * Create new PT company (Super Admin only)\n   */\n  app.post(\"/api/enterprise/pts\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertPtSchema.parse(req.body);\n      const pt = await storage.createPT(data);\n      res.status(201).json(pt);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error creating PT:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/pts/:id\n   * Update PT company (Super Admin only)\n   */\n  app.patch(\"/api/enterprise/pts/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertPtSchema.partial().parse(req.body);\n      const pt = await storage.updatePT(req.params.id, data);\n      if (!pt) {\n        return res.status(404).json({ error: \"PT tidak ditemukan\" });\n      }\n      res.json(pt);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error updating PT:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * DELETE /api/enterprise/pts/:id\n   * Delete PT company (Super Admin only)\n   */\n  app.delete(\"/api/enterprise/pts/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const deleted = await storage.deletePT(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"PT tidak ditemukan\" });\n      }\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting PT:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // =========================================================================\n  // CEO UNIT ROUTES\n  // =========================================================================\n\n  /**\n   * GET /api/enterprise/ceo-units\n   * Get all CEO units\n   */\n  app.get(\"/api/enterprise/ceo-units\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const units = await storage.getAllCEOUnits();\n      res.json(units);\n    } catch (error: any) {\n      console.error(\"Error fetching CEO units:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/ceo-units/:id\n   * Get single CEO unit\n   */\n  app.get(\"/api/enterprise/ceo-units/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const unit = await storage.getCEOUnit(req.params.id);\n      if (!unit) {\n        return res.status(404).json({ error: \"CEO Unit tidak ditemukan\" });\n      }\n      res.json(unit);\n    } catch (error: any) {\n      console.error(\"Error fetching CEO unit:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * POST /api/enterprise/ceo-units\n   * Create new CEO unit (Super Admin only)\n   */\n  app.post(\"/api/enterprise/ceo-units\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertCeoUnitSchema.parse(req.body);\n      const unit = await storage.createCEOUnit(data);\n      res.status(201).json(unit);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error creating CEO unit:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/ceo-units/:id\n   * Update CEO unit (Super Admin only)\n   */\n  app.patch(\"/api/enterprise/ceo-units/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertCeoUnitSchema.partial().parse(req.body);\n      const unit = await storage.updateCEOUnit(req.params.id, data);\n      if (!unit) {\n        return res.status(404).json({ error: \"CEO Unit tidak ditemukan\" });\n      }\n      res.json(unit);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error updating CEO unit:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * DELETE /api/enterprise/ceo-units/:id\n   * Delete CEO unit (Super Admin only)\n   */\n  app.delete(\"/api/enterprise/ceo-units/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const deleted = await storage.deleteCEOUnit(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"CEO Unit tidak ditemukan\" });\n      }\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting CEO unit:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // =========================================================================\n  // BRANCH ROUTES\n  // =========================================================================\n\n  /**\n   * GET /api/enterprise/branches\n   * Get all branches (optionally filtered by PT)\n   */\n  app.get(\"/api/enterprise/branches\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { ptId } = req.query;\n      \n      const branches = ptId \n        ? await storage.getBranchesByPT(ptId as string)\n        : await storage.getAllBranches();\n      \n      res.json(branches);\n    } catch (error: any) {\n      console.error(\"Error fetching branches:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/branches/:id\n   * Get single branch\n   */\n  app.get(\"/api/enterprise/branches/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const branch = await storage.getBranch(req.params.id);\n      if (!branch) {\n        return res.status(404).json({ error: \"Branch tidak ditemukan\" });\n      }\n      res.json(branch);\n    } catch (error: any) {\n      console.error(\"Error fetching branch:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * POST /api/enterprise/branches\n   * Create new branch (Super Admin only)\n   */\n  app.post(\"/api/enterprise/branches\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertBranchSchema.parse(req.body);\n      const branch = await storage.createBranch(data);\n      res.status(201).json(branch);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error creating branch:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/branches/:id\n   * Update branch (Super Admin only)\n   */\n  app.patch(\"/api/enterprise/branches/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertBranchSchema.partial().parse(req.body);\n      const branch = await storage.updateBranch(req.params.id, data);\n      if (!branch) {\n        return res.status(404).json({ error: \"Branch tidak ditemukan\" });\n      }\n      res.json(branch);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error updating branch:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * DELETE /api/enterprise/branches/:id\n   * Delete branch (Super Admin only)\n   */\n  app.delete(\"/api/enterprise/branches/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const deleted = await storage.deleteBranch(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Branch tidak ditemukan\" });\n      }\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting branch:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // =========================================================================\n  // POSITION ROUTES\n  // =========================================================================\n\n  /**\n   * GET /api/enterprise/positions\n   * Get all positions (ordered by level)\n   */\n  app.get(\"/api/enterprise/positions\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const positions = await storage.getAllPositions();\n      res.json(positions);\n    } catch (error: any) {\n      console.error(\"Error fetching positions:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/positions/:id\n   * Get single position\n   */\n  app.get(\"/api/enterprise/positions/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const position = await storage.getPosition(req.params.id);\n      if (!position) {\n        return res.status(404).json({ error: \"Position tidak ditemukan\" });\n      }\n      res.json(position);\n    } catch (error: any) {\n      console.error(\"Error fetching position:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * POST /api/enterprise/positions\n   * Create new position (Super Admin only)\n   */\n  app.post(\"/api/enterprise/positions\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertPositionSchema.parse(req.body);\n      const position = await storage.createPosition(data);\n      res.status(201).json(position);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error creating position:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/positions/:id\n   * Update position (Super Admin only)\n   */\n  app.patch(\"/api/enterprise/positions/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const data = insertPositionSchema.partial().parse(req.body);\n      const position = await storage.updatePosition(req.params.id, data);\n      if (!position) {\n        return res.status(404).json({ error: \"Position tidak ditemukan\" });\n      }\n      res.json(position);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error updating position:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * DELETE /api/enterprise/positions/:id\n   * Delete position (Super Admin only)\n   */\n  app.delete(\"/api/enterprise/positions/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const deleted = await storage.deletePosition(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Position tidak ditemukan\" });\n      }\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting position:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // =========================================================================\n  // EMPLOYEE ROUTES\n  // =========================================================================\n\n  /**\n   * GET /api/enterprise/employees\n   * Get all employees (with optional filters)\n   * Query params: branchId, positionId, managerId, ceoUnitId\n   */\n  app.get(\"/api/enterprise/employees\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { branchId, positionId, managerId, ceoUnitId } = req.query;\n      \n      let employees;\n      \n      if (branchId) {\n        employees = await storage.getEmployeesByBranch(branchId as string);\n      } else if (positionId) {\n        employees = await storage.getEmployeesByPosition(positionId as string);\n      } else if (managerId) {\n        employees = await storage.getEmployeesByManager(managerId as string);\n      } else if (ceoUnitId) {\n        employees = await storage.getEmployeesByCEOUnit(ceoUnitId as string);\n      } else {\n        employees = await storage.getAllEmployees();\n      }\n      \n      res.json(employees);\n    } catch (error: any) {\n      console.error(\"Error fetching employees:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/employees/:id\n   * Get single employee with full details\n   */\n  app.get(\"/api/enterprise/employees/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const employee = await storage.getEmployee(req.params.id);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee tidak ditemukan\" });\n      }\n      res.json(employee);\n    } catch (error: any) {\n      console.error(\"Error fetching employee:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/employees/by-user/:userId\n   * Get employee data for a specific user (for dashboard)\n   * Security: Users can only access their own employee data unless admin\n   */\n  app.get(\"/api/enterprise/employees/by-user/:userId\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const requestingUser = (req as any).user;\n      const targetUserId = req.params.userId;\n      \n      // RBAC: Users can only access their own data unless super_admin or owner\n      if (requestingUser.id !== targetUserId && \n          requestingUser.role !== \"super_admin\" && \n          requestingUser.role !== \"owner\") {\n        return res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Anda tidak memiliki akses untuk melihat data user lain\" \n        });\n      }\n      \n      const user = await storage.getUser(targetUserId);\n      if (!user || !user.employeeId) {\n        return res.status(404).json({ error: \"User or employee not found\" });\n      }\n      \n      const employee = await storage.getEmployee(user.employeeId);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      \n      res.json(employee);\n    } catch (error: any) {\n      console.error(\"Error fetching employee by user:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/employees/:id/subordinates\n   * Get direct subordinates of an employee\n   */\n  app.get(\"/api/enterprise/employees/:id/subordinates\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const subordinates = await storage.getSubordinates(req.params.id);\n      res.json(subordinates);\n    } catch (error: any) {\n      console.error(\"Error fetching subordinates:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/employees/:id/hierarchy\n   * Get full subordinate tree (recursive)\n   */\n  app.get(\"/api/enterprise/employees/:id/hierarchy\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const hierarchy = await storage.getOrganizationTree(req.params.id);\n      res.json(hierarchy);\n    } catch (error: any) {\n      console.error(\"Error fetching hierarchy:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * POST /api/enterprise/employees\n   * Create new employee (with hierarchy validation)\n   * Validates:\n   * - Employee code uniqueness\n   * - Manager exists and is valid\n   * - Branch/Position/CEO Unit exist\n   * - No circular references\n   */\n  app.post(\"/api/enterprise/employees\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      // Normalize empty strings to null BEFORE parsing\n      const normalizedBody = {\n        ...req.body,\n        managerId: req.body.managerId === \"\" ? null : req.body.managerId,\n        branchId: req.body.branchId === \"\" ? null : req.body.branchId,\n        ceoUnitId: req.body.ceoUnitId === \"\" ? null : req.body.ceoUnitId,\n      };\n      \n      const data = insertEmployeeSchema.parse(normalizedBody);\n      \n      // Validate branch exists\n      if (data.branchId) {\n        const branch = await storage.getBranch(data.branchId);\n        if (!branch) {\n          return res.status(400).json({ error: \"Branch tidak ditemukan\" });\n        }\n      }\n      \n      // Validate position exists\n      const position = await storage.getPosition(data.positionId);\n      if (!position) {\n        return res.status(400).json({ error: \"Position tidak ditemukan\" });\n      }\n      \n      // Validate CEO unit exists\n      if (data.ceoUnitId) {\n        const ceoUnit = await storage.getCEOUnit(data.ceoUnitId);\n        if (!ceoUnit) {\n          return res.status(400).json({ error: \"CEO Unit tidak ditemukan\" });\n        }\n      }\n      \n      // Validate manager exists (if provided)\n      if (data.managerId) {\n        const manager = await storage.getEmployee(data.managerId);\n        if (!manager) {\n          return res.status(400).json({ error: \"Manager tidak ditemukan\" });\n        }\n        \n        // Validate manager's position level is higher (lower number = higher position)\n        const managerPosition = await storage.getPosition(manager.positionId);\n        if (!managerPosition) {\n          return res.status(400).json({ error: \"Position manager tidak valid\" });\n        }\n        \n        if (managerPosition.level >= position.level) {\n          return res.status(400).json({ \n            error: \"Manager harus memiliki posisi lebih tinggi dari employee\" \n          });\n        }\n      }\n      \n      // Check employee code uniqueness\n      const existingByCode = await storage.getEmployeeByCode(data.employeeCode);\n      if (existingByCode) {\n        return res.status(400).json({ error: \"Kode employee sudah digunakan\" });\n      }\n      \n      const employee = await storage.createEmployee(data);\n      res.status(201).json(employee);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error creating employee:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/employees/:id\n   * Update employee (with hierarchy validation)\n   */\n  app.patch(\"/api/enterprise/employees/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      // Normalize empty strings to null BEFORE parsing\n      const normalizedBody = {\n        ...req.body,\n        managerId: req.body.managerId === \"\" ? null : req.body.managerId,\n        branchId: req.body.branchId === \"\" ? null : req.body.branchId,\n        ceoUnitId: req.body.ceoUnitId === \"\" ? null : req.body.ceoUnitId,\n      };\n      \n      const data = insertEmployeeSchema.partial().parse(normalizedBody);\n      \n      // Check employee exists\n      const existing = await storage.getEmployee(req.params.id);\n      if (!existing) {\n        return res.status(404).json({ error: \"Employee tidak ditemukan\" });\n      }\n      \n      // Validate branch if being updated\n      if (data.branchId) {\n        const branch = await storage.getBranch(data.branchId);\n        if (!branch) {\n          return res.status(400).json({ error: \"Branch tidak ditemukan\" });\n        }\n      }\n      \n      // Validate position if being updated\n      if (data.positionId) {\n        const position = await storage.getPosition(data.positionId);\n        if (!position) {\n          return res.status(400).json({ error: \"Position tidak ditemukan\" });\n        }\n      }\n      \n      // Validate hierarchy whenever manager OR position changes\n      // Use updated values or fallback to existing values\n      const effectiveManagerId = data.managerId !== undefined ? data.managerId : existing.managerId;\n      const effectivePositionId = data.positionId || existing.positionId;\n      \n      if (effectiveManagerId && (data.managerId !== undefined || data.positionId)) {\n        const manager = await storage.getEmployee(effectiveManagerId);\n        if (!manager) {\n          return res.status(400).json({ error: \"Manager tidak ditemukan\" });\n        }\n        \n        const employeePosition = await storage.getPosition(effectivePositionId);\n        if (!employeePosition) {\n          return res.status(400).json({ error: \"Position employee tidak valid\" });\n        }\n        \n        const managerPosition = await storage.getPosition(manager.positionId);\n        if (!managerPosition) {\n          return res.status(400).json({ error: \"Position manager tidak valid\" });\n        }\n        \n        if (managerPosition.level >= employeePosition.level) {\n          return res.status(400).json({ \n            error: \"Manager harus memiliki posisi lebih tinggi dari employee\" \n          });\n        }\n      }\n      \n      // Validate CEO unit if being updated\n      if (data.ceoUnitId) {\n        const ceoUnit = await storage.getCEOUnit(data.ceoUnitId);\n        if (!ceoUnit) {\n          return res.status(400).json({ error: \"CEO Unit tidak ditemukan\" });\n        }\n      }\n      \n      // Validate manager if being updated\n      if (data.managerId !== undefined) {\n        if (data.managerId === req.params.id) {\n          return res.status(400).json({ error: \"Employee tidak bisa menjadi manager dirinya sendiri\" });\n        }\n        \n        if (data.managerId) {\n          const manager = await storage.getEmployee(data.managerId);\n          if (!manager) {\n            return res.status(400).json({ error: \"Manager tidak ditemukan\" });\n          }\n          \n          // Check for circular reference: manager should not be in employee's subordinate tree\n          const allSubordinates = await storage.getAllSubordinatesRecursive(req.params.id);\n          if (allSubordinates.some(sub => sub.id === data.managerId)) {\n            return res.status(400).json({ \n              error: \"Tidak bisa set manager ke subordinate (circular reference)\" \n            });\n          }\n        }\n      }\n      \n      // Check employee code uniqueness if being updated\n      if (data.employeeCode && data.employeeCode !== existing.employeeCode) {\n        const existingByCode = await storage.getEmployeeByCode(data.employeeCode);\n        if (existingByCode) {\n          return res.status(400).json({ error: \"Kode employee sudah digunakan\" });\n        }\n      }\n      \n      const employee = await storage.updateEmployee(req.params.id, data);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee tidak ditemukan\" });\n      }\n      res.json(employee);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error updating employee:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * DELETE /api/enterprise/employees/:id\n   * Delete employee (soft delete recommended)\n   * Note: Should check if employee has subordinates or audits before deleting\n   */\n  app.delete(\"/api/enterprise/employees/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      // Check if employee has subordinates\n      const subordinates = await storage.getSubordinates(req.params.id);\n      if (subordinates.length > 0) {\n        return res.status(400).json({ \n          error: \"Tidak bisa hapus employee yang masih memiliki subordinates\",\n          subordinatesCount: subordinates.length\n        });\n      }\n      \n      const deleted = await storage.deleteEmployee(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Employee tidak ditemukan\" });\n      }\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting employee:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // =========================================================================\n  // MONTHLY PERFORMANCE ROUTES\n  // =========================================================================\n\n  /**\n   * GET /api/enterprise/performance\n   * Get all performance data (filtered by RBAC)\n   * Query params: ?employeeId=xxx&year=2025&quarter=1\n   */\n  app.get(\"/api/enterprise/performance\", requireAuth, canViewPerformance, async (req: Request, res: Response) => {\n    try {\n      const { employeeId, year, quarter } = req.query;\n      \n      // If specific employee requested\n      if (employeeId) {\n        if (year && quarter) {\n          const data = await storage.getQuarterlyPerformance(employeeId as string, parseInt(year as string), parseInt(quarter as string));\n          return res.json(data);\n        }\n        const data = await storage.getPerformanceByEmployee(employeeId as string);\n        return res.json(data);\n      }\n      \n      // Otherwise return all (admin/owner) or user's scope (employee)\n      let allPerformance = await storage.getAllPerformance();\n      \n      // Filter to user's scope if not admin/owner\n      if (req.user && req.user.role === \"employee\" && req.user.employeeId) {\n        // Get all subordinates\n        const subordinates = await storage.getAllSubordinatesRecursive(req.user.employeeId);\n        const visibleEmployeeIds = [req.user.employeeId, ...subordinates.map(s => s.id)];\n        allPerformance = allPerformance.filter(p => visibleEmployeeIds.includes(p.employeeId));\n      }\n      \n      // Apply year/quarter filters if provided\n      if (year) {\n        allPerformance = allPerformance.filter(p => p.year === parseInt(year as string));\n      }\n      if (quarter) {\n        allPerformance = allPerformance.filter(p => p.quarter === parseInt(quarter as string));\n      }\n      \n      res.json(allPerformance);\n    } catch (error: any) {\n      console.error(\"Error fetching performance:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/performance/:id\n   * Get single performance record\n   */\n  app.get(\"/api/enterprise/performance/:id\", requireAuth, canViewPerformance, async (req: Request, res: Response) => {\n    try {\n      const performance = await storage.getPerformance(req.params.id);\n      if (!performance) {\n        return res.status(404).json({ error: \"Data performance tidak ditemukan\" });\n      }\n      res.json(performance);\n    } catch (error: any) {\n      console.error(\"Error fetching performance:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/performance/employee/:employeeId\n   * Get all performance for specific employee\n   */\n  app.get(\"/api/enterprise/performance/employee/:employeeId\", requireAuth, canViewPerformance, async (req: Request, res: Response) => {\n    try {\n      const data = await storage.getPerformanceByEmployee(req.params.employeeId);\n      res.json(data);\n    } catch (error: any) {\n      console.error(\"Error fetching employee performance:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/performance/quarterly/:employeeId/:year/:quarter\n   * Get quarterly performance (3 months aggregated)\n   * Returns: QuarterlyPerformanceDto\n   */\n  app.get(\"/api/enterprise/performance/quarterly/:employeeId/:year/:quarter\", requireAuth, canViewPerformance, async (req: Request, res: Response) => {\n    try {\n      const { employeeId, year, quarter } = req.params;\n      const data = await storage.getQuarterlyPerformance(employeeId, parseInt(year), parseInt(quarter));\n      \n      // Calculate aggregated totals\n      const totalMarginPersonal = data.reduce((sum, m) => sum + parseFloat(m.marginPersonal || \"0\"), 0);\n      const totalNAPersonal = data.reduce((sum, m) => sum + (m.naPersonal || 0), 0);\n      const totalLotSettled = data.reduce((sum, m) => sum + (m.lotSettled || 0), 0);\n      \n      // Map to DTO shape (only required fields)\n      const monthsDto = data.map(m => ({\n        month: m.month,\n        marginPersonal: m.marginPersonal,\n        naPersonal: m.naPersonal,\n        lotSettled: m.lotSettled,\n      }));\n      \n      res.json({\n        employeeId,\n        year: parseInt(year),\n        quarter: parseInt(quarter),\n        months: monthsDto,\n        aggregated: {\n          totalMarginPersonal: totalMarginPersonal.toFixed(2),\n          totalNAPersonal,\n          totalLotSettled,\n          monthsAvailable: data.length\n        }\n      });\n    } catch (error: any) {\n      console.error(\"Error fetching quarterly performance:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * POST /api/enterprise/performance\n   * Create new monthly performance entry\n   */\n  app.post(\"/api/enterprise/performance\", requireAuth, canManagePerformance, async (req: Request, res: Response) => {\n    try {\n      // Parse and validate data\n      const data = insertMonthlyPerformanceSchema.parse(req.body);\n      \n      // Check for duplicate entry\n      const existing = await storage.getPerformanceByPeriod(data.employeeId, data.year, data.month);\n      if (existing) {\n        return res.status(400).json({ \n          error: \"Data performance untuk employee, tahun, dan bulan ini sudah ada\",\n          userMessage: \"Data performance bulan ini sudah diinput sebelumnya\"\n        });\n      }\n      \n      // Auto-calculate quarter from month\n      const quarter = Math.ceil(data.month / 3);\n      const performanceData = { ...data, quarter };\n      \n      const performance = await storage.createPerformance(performanceData);\n      res.status(201).json(performance);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error creating performance:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/performance/:id\n   * Update performance entry (cannot change employeeId/year/month)\n   */\n  app.patch(\"/api/enterprise/performance/:id\", requireAuth, canManagePerformance, async (req: Request, res: Response) => {\n    try {\n      const existing = await storage.getPerformance(req.params.id);\n      if (!existing) {\n        return res.status(404).json({ error: \"Data performance tidak ditemukan\" });\n      }\n      \n      // Prevent changing identity fields\n      const { employeeId, year, month, quarter, ...allowedUpdates } = req.body;\n      \n      if (employeeId || year || month || quarter) {\n        return res.status(400).json({ \n          error: \"Tidak bisa mengubah employeeId, year, month, atau quarter\",\n          userMessage: \"Hanya nilai performance yang bisa diubah\"\n        });\n      }\n      \n      // Validate allowed updates\n      const updateSchema = insertMonthlyPerformanceSchema.partial().omit({\n        employeeId: true,\n        year: true,\n        month: true,\n        quarter: true\n      });\n      const validatedUpdates = updateSchema.parse(allowedUpdates);\n      \n      const updated = await storage.updatePerformance(req.params.id, validatedUpdates);\n      if (!updated) {\n        return res.status(404).json({ error: \"Data performance tidak ditemukan\" });\n      }\n      \n      res.json(updated);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error updating performance:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * DELETE /api/enterprise/performance/:id\n   * Delete performance entry (Admin only)\n   */\n  app.delete(\"/api/enterprise/performance/:id\", requireAuth, requireFullAdmin, async (req: Request, res: Response) => {\n    try {\n      const deleted = await storage.deletePerformance(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ error: \"Data performance tidak ditemukan\" });\n      }\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting performance:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // =========================================================================\n  // AUDIT ROUTES\n  // =========================================================================\n\n  /**\n   * POST /api/enterprise/audits\n   * Create new audit with quarterly performance aggregation\n   */\n  app.post(\"/api/enterprise/audits\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const user = (req as any).user;\n      \n      // Validate request body\n      const auditRequestSchema = z.object({\n        employeeId: z.string(),\n        year: z.number().int(),\n        quarter: z.number().int().min(1).max(4),\n        pillarAnswers: z.array(z.object({\n          pillarId: z.number().int().min(1).max(18),\n          pillarName: z.string(),\n          category: z.string(),\n          score: z.number().int().min(1).max(5),\n          notes: z.string().nullable().optional(),\n        })),\n      });\n      \n      const data = auditRequestSchema.parse(req.body);\n      \n      // 1. Check RBAC - Can user manage this employee?\n      const canManage = await storage.canManageEmployee(user.employeeId, data.employeeId);\n      if (!canManage && user.role !== \"super_admin\" && user.role !== \"owner\") {\n        return res.status(403).json({ error: \"Anda tidak memiliki akses untuk mengaudit karyawan ini\" });\n      }\n      \n      // 2. Check duplicate audit\n      const existingAudit = await storage.getAuditByPeriod(data.employeeId, data.year, data.quarter);\n      if (existingAudit) {\n        return res.status(400).json({ \n          error: `Audit untuk Q${data.quarter} ${data.year} sudah ada untuk karyawan ini` \n        });\n      }\n      \n      // 3. Validate pillar answers (all 18 must be present)\n      if (!validatePillarAnswers(data.pillarAnswers)) {\n        return res.status(400).json({ \n          error: \"Semua 18 pilar harus diisi dengan score 1-5\" \n        });\n      }\n      \n      // 4. Fetch quarterly performance data\n      const performanceData = await storage.getQuarterlyPerformance(\n        data.employeeId, \n        data.year, \n        data.quarter\n      );\n      \n      // 5. Validate performance data exists (3 months minimum)\n      const performanceValidation = validateQuarterlyPerformance(\n        performanceData, \n        data.year, \n        data.quarter\n      );\n      \n      if (!performanceValidation.valid) {\n        return res.status(400).json({ error: performanceValidation.error });\n      }\n      \n      // 6. Aggregate quarterly performance (sum 3 months)\n      const quarterlyPerformance = aggregateQuarterlyPerformance(performanceData);\n      \n      // 6b. Fetch previous quarter performance as targets (MVP baseline)\n      const prevQuarter = data.quarter === 1 ? 4 : data.quarter - 1;\n      const prevYear = data.quarter === 1 ? data.year - 1 : data.year;\n      \n      const prevPerformanceData = await storage.getQuarterlyPerformance(\n        data.employeeId,\n        prevYear,\n        prevQuarter\n      );\n      \n      // Calculate targets from previous quarter (or use defaults if no history)\n      let targetMarginPersonal = 100; // MVP default target\n      let targetNAPersonal = 5; // MVP default target\n      let targetMarginTeam = 100; // MVP default target\n      let targetNATeam = 5; // MVP default target\n      \n      if (prevPerformanceData.length >= 3) {\n        // Use previous quarter as baseline target\n        const prevQuarterlyPerf = aggregateQuarterlyPerformance(prevPerformanceData);\n        targetMarginPersonal = parseFloat(prevQuarterlyPerf.marginPersonalQ) || 100;\n        targetNAPersonal = prevQuarterlyPerf.naPersonalQ || 5;\n        targetMarginTeam = parseFloat(prevQuarterlyPerf.marginTeamQ) || 100;\n        targetNATeam = prevQuarterlyPerf.naTeamQ || 5;\n      }\n      \n      // 7. Calculate team aggregation from subordinates\n      const aggregation = await calculateTeamAggregation(\n        storage,\n        data.employeeId,\n        data.year,\n        data.quarter\n      );\n      \n      // 8. Calculate reality scores for all 18 pillars\n      const pillarScoresWithReality = data.pillarAnswers.map(p => {\n        const realityScore = calculatePillarRealityScore(\n          p.pillarId,\n          p.category as \"A\" | \"B\" | \"C\",\n          p.score,\n          {\n            marginPersonalQ: quarterlyPerformance.marginPersonalQ,\n            naPersonalQ: quarterlyPerformance.naPersonalQ,\n            marginTeamQ: quarterlyPerformance.marginTeamQ || aggregation.marginTeamQ,\n            naTeamQ: quarterlyPerformance.naTeamQ || aggregation.naTeamQ,\n            // Pass targets from previous quarter (or MVP defaults)\n            targetMarginPersonal,\n            targetNAPersonal,\n            targetMarginTeam,\n            targetNATeam,\n          }\n        );\n        \n        const gap = realityScore - p.score;\n        \n        // Generate insight based on gap\n        let insight = \"\";\n        if (Math.abs(gap) > 1.5) {\n          insight = gap > 0 \n            ? `Performa actual melebihi ekspektasi sendiri (+${gap.toFixed(1)}). Excellent self-awareness growth.`\n            : `Gap signifikan antara self-assessment dan reality (${gap.toFixed(1)}). Perlu kalibrasi ekspektasi.`;\n        } else if (Math.abs(gap) > 0.5) {\n          insight = gap > 0\n            ? `Slight underestimation. Good progress.`\n            : `Slight overestimation. Self-awareness calibration recommended.`;\n        }\n        \n        return {\n          pillarId: p.pillarId,\n          pillarName: p.pillarName,\n          category: p.category as \"A\" | \"B\" | \"C\",\n          selfScore: p.score,\n          realityScore,\n          gap,\n          insight,\n        };\n      });\n      \n      // 9. Calculate zones\n      const zonaKinerja = calculateZonaKinerja(pillarScoresWithReality);\n      const zonaPerilaku = calculateZonaPerilaku(pillarScoresWithReality);\n      const zonaFinal = calculateZonaFinal(zonaKinerja, zonaPerilaku, pillarScoresWithReality);\n      \n      // 10. Calculate profile\n      const profile = calculateProfile(pillarScoresWithReality);\n      \n      // 11. Get employee data for ProDem calculation\n      const employee = await storage.getEmployee(data.employeeId);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      \n      // Calculate employee tenure in months\n      const tenureMonths = employee.joinDate \n        ? Math.floor((Date.now() - new Date(employee.joinDate).getTime()) / (1000 * 60 * 60 * 24 * 30))\n        : 12;\n      \n      // Check if margin is over target (simple heuristic for MVP)\n      const marginOverTarget = parseFloat(quarterlyPerformance.marginPersonalQ) > 0;\n      \n      // 12. Calculate ProDem recommendation\n      const prodem = calculateProDemRecommendation(\n        zonaFinal,\n        profile,\n        employee.positionName || \"Current Position\",\n        pillarScoresWithReality,\n        {\n          marginOverTarget,\n          employeeTenureMonths: tenureMonths,\n          nextPositionName: \"Next Level Position\", // TODO: Get from position hierarchy\n        }\n      );\n      \n      // 13. Generate deterministic report sections\n      const progressKuartal = generateProgressKuartal({\n        marginPersonalQ: quarterlyPerformance.marginPersonalQ,\n        naPersonalQ: quarterlyPerformance.naPersonalQ,\n        marginTeamQ: quarterlyPerformance.marginTeamQ || aggregation.marginTeamQ,\n        naTeamQ: quarterlyPerformance.naTeamQ || aggregation.naTeamQ,\n      });\n      \n      const ews = generateEWS(pillarScoresWithReality);\n      \n      // 14. Generate AI narrative sections (with 3-source fallback)\n      const [\n        executiveSummary,\n        insightLengkap,\n        swot,\n        coaching,\n        actionPlan,\n        visi,\n        magicSection,\n      ] = await Promise.all([\n        generateExecutiveSummary({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${data.quarter} ${data.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores: pillarScoresWithReality,\n          progressKuartal,\n          ews,\n        }),\n        generateInsightLengkap({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${data.quarter} ${data.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores: pillarScoresWithReality,\n          progressKuartal,\n          ews,\n        }),\n        generateSWOT({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${data.quarter} ${data.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores: pillarScoresWithReality,\n          progressKuartal,\n          ews,\n        }),\n        generateCoaching({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${data.quarter} ${data.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores: pillarScoresWithReality,\n          progressKuartal,\n          ews,\n        }),\n        generateActionPlan({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${data.quarter} ${data.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores: pillarScoresWithReality,\n          progressKuartal,\n          ews,\n        }),\n        generateVisi({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${data.quarter} ${data.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores: pillarScoresWithReality,\n          progressKuartal,\n          ews,\n        }),\n        generateMagicSection({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${data.quarter} ${data.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores: pillarScoresWithReality,\n          progressKuartal,\n          ews,\n        }),\n      ]);\n      \n      // 15. Calculate total scores (sum of all 18 pillar scores)\n      const totalSelfScore = pillarScoresWithReality.reduce((sum, p) => sum + p.selfScore, 0);\n      const totalRealityScore = pillarScoresWithReality.reduce((sum, p) => sum + p.realityScore, 0);\n      const totalGap = pillarScoresWithReality.reduce((sum, p) => sum + Math.abs(p.gap), 0);\n      \n      // 16. Create audit record with all calculated data\n      const audit = await storage.createAudit({\n        employeeId: data.employeeId,\n        year: data.year,\n        quarter: data.quarter,\n        marginPersonalQ: quarterlyPerformance.marginPersonalQ,\n        naPersonalQ: quarterlyPerformance.naPersonalQ,\n        marginTeamQ: aggregation.marginTeamQ,\n        naTeamQ: aggregation.naTeamQ,\n        teamStructure: aggregation.teamStructure,\n        totalSelfScore,\n        totalRealityScore,\n        totalGap,\n        pillarAnswers: pillarScoresWithReality,\n        zonaKinerja,\n        zonaPerilaku,\n        zonaFinal,\n        profil: profile,\n        prodemRekomendasi: {\n          currentPosition: employee.positionName || \"Current Position\",\n          recommendation: prodem.recommendation,\n          nextPosition: prodem.recommendation === \"Promosi\" ? \"Next Level Position\" : undefined,\n          reason: prodem.reason,\n          konsekuensi: prodem.konsekuensi,\n          nextStep: prodem.nextStep,\n          requirements: prodem.requirements,\n        },\n        auditReport: {\n          progressKuartal,\n          ews,\n          executiveSummary,\n          insightLengkap,\n          swot,\n          coaching,\n          actionPlan,\n          visi,\n        },\n        magicSection,\n        createdById: user.id,\n      });\n      \n      // 16. Hydrate audit with employee relations for DTO response\n      const auditWithEmployee = await storage.getAuditWithEmployee(audit.id);\n      \n      if (!auditWithEmployee) {\n        return res.status(500).json({ error: \"Gagal mengambil data audit setelah dibuat\" });\n      }\n      \n      // 17. Return AuditCreateResultDto (audit with employee + warnings + pendingSubordinates)\n      res.status(201).json({\n        audit: auditWithEmployee,\n        warnings: aggregation.warnings,\n        pendingSubordinates: aggregation.pendingSubordinates,\n      });\n      \n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: \"Data tidak valid\", details: error.errors });\n      }\n      console.error(\"Error creating audit:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/audits/:id\n   * Get single audit by ID\n   * Returns: AuditDetailDto (audit with hydrated employee relations)\n   */\n  app.get(\"/api/enterprise/audits/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const audit = await storage.getAuditWithEmployee(req.params.id);\n      if (!audit) {\n        return res.status(404).json({ error: \"Audit tidak ditemukan\" });\n      }\n      \n      // TODO: Add RBAC check (can view if audit is for self or subordinate)\n      \n      res.json(audit);\n    } catch (error: any) {\n      console.error(\"Error fetching audit:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/audits/:id/pdf\n   * Download audit report as PDF\n   * Returns: PDF file (application/pdf)\n   */\n  app.get(\"/api/enterprise/audits/:id/pdf\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const audit = await storage.getAuditWithEmployee(req.params.id);\n      if (!audit) {\n        return res.status(404).json({ error: \"Audit tidak ditemukan\" });\n      }\n      \n      // TODO: Add RBAC check (can view if audit is for self or subordinate)\n      \n      // Build AuditPdfDto from audit + employee data\n      const pdfDto: AuditPdfDto = {\n        fullName: audit.employee.fullName,\n        position: audit.employee.position?.name || \"N/A\",\n        branch: audit.employee.branch?.name || \"N/A\",\n        ptCompany: audit.employee.pt?.name || \"N/A\",\n        birthDate: audit.employee.birthDate,\n        year: audit.year,\n        quarter: audit.quarter,\n        totalRealityScore: audit.totalRealityScore,\n        totalSelfScore: audit.totalSelfScore,\n        totalGap: audit.totalGap,\n        profil: audit.profil,\n        zonaFinal: audit.zonaFinal,\n        auditReport: audit.auditReport,\n        prodemRekomendasi: audit.prodemRekomendasi,\n        magicSection: audit.magicSection,\n        pillarAnswers: audit.pillarAnswers,\n      };\n      \n      // Generate PDF\n      const doc = generateAuditPDF(pdfDto);\n      const filename = `audit-${audit.employee.fullName.replace(/\\s+/g, \"-\")}-Q${audit.quarter}-${audit.year}.pdf`;\n      \n      // Set headers\n      res.setHeader(\"Content-Type\", \"application/pdf\");\n      res.setHeader(\"Content-Disposition\", `attachment; filename=\"${filename}\"`);\n      \n      // Stream PDF to response\n      doc.pipe(res);\n      doc.end(); // Finalize PDF after piping to response\n    } catch (error: any) {\n      console.error(\"Error generating PDF:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/audits/employee/:employeeId\n   * Get all audits for an employee\n   */\n  app.get(\"/api/enterprise/audits/employee/:employeeId\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const audits = await storage.getAuditsByEmployee(req.params.employeeId);\n      \n      // TODO: Add RBAC check (can view if employee is self or subordinate)\n      \n      res.json(audits);\n    } catch (error: any) {\n      console.error(\"Error fetching audits:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * GET /api/enterprise/audits/employee/:employeeId/:year/:quarter\n   * Check if audit exists for specific period\n   */\n  app.get(\"/api/enterprise/audits/employee/:employeeId/:year/:quarter\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { employeeId, year, quarter } = req.params;\n      const audit = await storage.getAuditByPeriod(\n        employeeId,\n        parseInt(year),\n        parseInt(quarter)\n      );\n      \n      if (!audit) {\n        return res.status(404).json({ error: \"Audit tidak ditemukan\" });\n      }\n      \n      res.json(audit);\n    } catch (error: any) {\n      console.error(\"Error fetching audit:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/audits/:id/refresh-aggregation\n   * Recalculate team aggregation after subordinates complete audits\n   */\n  app.patch(\"/api/enterprise/audits/:id/refresh-aggregation\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const audit = await storage.getAudit(req.params.id);\n      if (!audit) {\n        return res.status(404).json({ error: \"Audit tidak ditemukan\" });\n      }\n      \n      // Recalculate team aggregation\n      const aggregation = await calculateTeamAggregation(\n        storage,\n        audit.employeeId,\n        audit.year,\n        audit.quarter\n      );\n      \n      // Update audit with new aggregation\n      const updatedAudit = await storage.updateAuditAggregation(\n        req.params.id,\n        aggregation.marginTeamQ,\n        aggregation.naTeamQ,\n        aggregation.teamStructure\n      );\n      \n      res.json({\n        audit: updatedAudit,\n        warnings: aggregation.warnings,\n        pendingSubordinates: aggregation.pendingSubordinates,\n      });\n      \n    } catch (error: any) {\n      console.error(\"Error refreshing aggregation:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  /**\n   * PATCH /api/enterprise/audits/:id/regenerate-report\n   * Regenerate all report sections (deterministic + AI narratives)\n   * Useful for: fixing failed AI generation, applying updated AI models, recalculating after business logic changes\n   */\n  app.patch(\"/api/enterprise/audits/:id/regenerate-report\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const audit = await storage.getAudit(req.params.id);\n      if (!audit) {\n        return res.status(404).json({ error: \"Audit tidak ditemukan\" });\n      }\n      \n      // Get employee data for AI narratives\n      const employee = await storage.getEmployee(audit.employeeId);\n      if (!employee) {\n        return res.status(404).json({ error: \"Employee not found\" });\n      }\n      \n      // Use existing pillar answers to recalculate zones\n      const pillarScores = audit.pillarAnswers as Array<{\n        pillarId: string;\n        pillarName: string;\n        category: \"A\" | \"B\" | \"C\";\n        selfScore: number;\n        realityScore: number;\n        gap: number;\n        insight: string;\n      }>;\n      \n      // Recalculate zones from existing pillar scores\n      const zonaKinerja = calculateZonaKinerja(pillarScores);\n      const zonaPerilaku = calculateZonaPerilaku(pillarScores);\n      const zonaFinal = calculateZonaFinal(zonaKinerja, zonaPerilaku, pillarScores);\n      \n      // Recalculate profile\n      const profile = calculateProfile(pillarScores);\n      \n      // Recalculate ProDem\n      const tenureMonths = employee.joinDate \n        ? Math.floor((Date.now() - new Date(employee.joinDate).getTime()) / (1000 * 60 * 60 * 24 * 30))\n        : 12;\n      \n      const marginOverTarget = parseFloat(audit.marginPersonalQ) > 0;\n      \n      const prodem = calculateProDemRecommendation(\n        zonaFinal,\n        profile,\n        employee.positionName || \"Current Position\",\n        pillarScores,\n        {\n          marginOverTarget,\n          employeeTenureMonths: tenureMonths,\n          nextPositionName: \"Next Level Position\",\n        }\n      );\n      \n      // Regenerate deterministic sections\n      const progressKuartal = generateProgressKuartal({\n        marginPersonalQ: audit.marginPersonalQ,\n        naPersonalQ: audit.naPersonalQ,\n        marginTeamQ: audit.marginTeamQ,\n        naTeamQ: audit.naTeamQ,\n      });\n      \n      const ews = generateEWS(pillarScores);\n      \n      // Regenerate AI narrative sections (with 3-source fallback)\n      const [\n        executiveSummary,\n        insightLengkap,\n        swot,\n        coaching,\n        actionPlan,\n        visi,\n        magicSection,\n      ] = await Promise.all([\n        generateExecutiveSummary({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${audit.quarter} ${audit.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores,\n          progressKuartal,\n          ews,\n        }),\n        generateInsightLengkap({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${audit.quarter} ${audit.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores,\n          progressKuartal,\n          ews,\n        }),\n        generateSWOT({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${audit.quarter} ${audit.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores,\n          progressKuartal,\n          ews,\n        }),\n        generateCoaching({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${audit.quarter} ${audit.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores,\n          progressKuartal,\n          ews,\n        }),\n        generateActionPlan({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${audit.quarter} ${audit.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores,\n          progressKuartal,\n          ews,\n        }),\n        generateVisi({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${audit.quarter} ${audit.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores,\n          progressKuartal,\n          ews,\n        }),\n        generateMagicSection({\n          employeeName: employee.nama,\n          positionName: employee.positionName || \"N/A\",\n          quarterLabel: `Q${audit.quarter} ${audit.year}`,\n          zonaKinerja,\n          zonaPerilaku,\n          zonaFinal,\n          profile,\n          prodem,\n          pillarScores,\n          progressKuartal,\n          ews,\n        }),\n      ]);\n      \n      // Update audit with regenerated report sections\n      const updatedAudit = await storage.updateAuditReport(req.params.id, {\n        zonaKinerja,\n        zonaPerilaku,\n        zonaFinal,\n        profil: profile,\n        prodemRekomendasi: {\n          currentPosition: employee.positionName || \"Current Position\",\n          recommendation: prodem.recommendation,\n          nextPosition: prodem.recommendation === \"Promosi\" ? \"Next Level Position\" : undefined,\n          reason: prodem.reason,\n          konsekuensi: prodem.konsekuensi,\n          nextStep: prodem.nextStep,\n          requirements: prodem.requirements,\n        },\n        auditReport: {\n          progressKuartal,\n          ews,\n          executiveSummary,\n          insightLengkap,\n          swot,\n          coaching,\n          actionPlan,\n          visi,\n          magicSection,\n        },\n      });\n      \n      res.json({\n        audit: updatedAudit,\n        message: \"Report berhasil di-regenerate dengan AI terbaru\",\n      });\n      \n    } catch (error: any) {\n      console.error(\"Error regenerating report:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n}\n","size_bytes":59160},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"shared/pillar-constants.ts":{"content":"export const PILAR_CATEGORIES = [\n  {\n    id: \"A\",\n    name: \"Pendorong Pemasukan\",\n    nameEn: \"Revenue Drivers\",\n    color: \"text-green-400\",\n    bgColor: \"bg-green-500/10\",\n    borderColor: \"border-green-500/20\",\n  },\n  {\n    id: \"B\",\n    name: \"Kekuatan Struktur Tim\",\n    nameEn: \"Team Structure Strength\",\n    color: \"text-blue-400\",\n    bgColor: \"bg-blue-500/10\",\n    borderColor: \"border-blue-500/20\",\n  },\n  {\n    id: \"C\",\n    name: \"Budaya & Operasional Tim\",\n    nameEn: \"Team Culture & Operations\",\n    color: \"text-purple-400\",\n    bgColor: \"bg-purple-500/10\",\n    borderColor: \"border-purple-500/20\",\n  },\n] as const;\n\nexport const PILARS = [\n  // A. Pendorong Pemasukan (Revenue Drivers)\n  {\n    id: 1,\n    category: \"A\",\n    name: \"Kemampuan Mencari Calon Nasabah\",\n    nameEn: \"Ability to Find Potential Customers\",\n    description: \"Seberapa efektif dalam mengidentifikasi dan mendekati calon nasabah baru\",\n  },\n  {\n    id: 2,\n    category: \"A\",\n    name: \"Kemampuan Menutup Penjualan\",\n    nameEn: \"Ability to Close Sales\",\n    description: \"Kemampuan mengkonversi prospek menjadi nasabah aktif\",\n  },\n  {\n    id: 3,\n    category: \"A\",\n    name: \"Kemampuan Menjaga Nasabah Aktif\",\n    nameEn: \"Ability to Retain Active Customers\",\n    description: \"Konsistensi dalam mempertahankan nasabah yang sudah ada\",\n  },\n  {\n    id: 4,\n    category: \"A\",\n    name: \"Kemampuan Mencetak Tim Baru (Kaderisasi)\",\n    nameEn: \"Ability to Develop New Team Members\",\n    description: \"Efektivitas dalam merekrut dan mengembangkan anggota tim baru\",\n  },\n  {\n    id: 5,\n    category: \"A\",\n    name: \"Pencapaian Target Penjualan\",\n    nameEn: \"Achievement of Sales Targets\",\n    description: \"Konsistensi mencapai atau melampaui target yang ditetapkan\",\n  },\n  {\n    id: 6,\n    category: \"A\",\n    name: \"Penguasaan Pasar Wilayah\",\n    nameEn: \"Mastery of Regional Market\",\n    description: \"Pemahaman dan dominasi di wilayah pasar yang ditargetkan\",\n  },\n  \n  // B. Kekuatan Struktur Tim (Team Structure Strength)\n  {\n    id: 7,\n    category: \"B\",\n    name: \"Kelengkapan Struktur Tim\",\n    nameEn: \"Completeness of Team Structure\",\n    description: \"Struktur tim yang lengkap dengan berbagai level hierarki\",\n  },\n  {\n    id: 8,\n    category: \"B\",\n    name: \"Jumlah Jalur Aktif\",\n    nameEn: \"Number of Active Lines\",\n    description: \"Banyaknya jalur/downline yang aktif berkontribusi\",\n  },\n  {\n    id: 9,\n    category: \"B\",\n    name: \"Produktivitas Pimpinan\",\n    nameEn: \"Leadership Productivity\",\n    description: \"Kontribusi langsung pimpinan dalam mencapai target tim\",\n  },\n  {\n    id: 10,\n    category: \"B\",\n    name: \"Kesiapan Regenerasi\",\n    nameEn: \"Readiness for Succession\",\n    description: \"Ketersediaan kader yang siap menggantikan posisi atas\",\n  },\n  {\n    id: 11,\n    category: \"B\",\n    name: \"Kerja Sama Antar Tim\",\n    nameEn: \"Inter-Team Cooperation\",\n    description: \"Sinergi dan kolaborasi antar anggota tim\",\n  },\n  {\n    id: 12,\n    category: \"B\",\n    name: \"Kemampuan Beradaptasi\",\n    nameEn: \"Adaptability\",\n    description: \"Fleksibilitas dalam menghadapi perubahan pasar dan kondisi bisnis\",\n  },\n  \n  // C. Budaya & Operasional Tim (Team Culture & Operations)\n  {\n    id: 13,\n    category: \"C\",\n    name: \"Disiplin & Konsistensi Kerja\",\n    nameEn: \"Work Discipline & Consistency\",\n    description: \"Kepatuhan terhadap SOP dan konsistensi dalam bekerja\",\n  },\n  {\n    id: 14,\n    category: \"C\",\n    name: \"Semangat & Motivasi Tim\",\n    nameEn: \"Team Spirit & Motivation\",\n    description: \"Antusiasme dan dorongan internal tim untuk mencapai tujuan\",\n  },\n  {\n    id: 15,\n    category: \"C\",\n    name: \"Inovasi Cara Kerja\",\n    nameEn: \"Innovation in Work Methods\",\n    description: \"Kreativitas dalam mengembangkan metode kerja yang lebih efektif\",\n  },\n  {\n    id: 16,\n    category: \"C\",\n    name: \"Pelatihan & Pengembangan Keterampilan\",\n    nameEn: \"Training & Skill Development\",\n    description: \"Investasi dalam peningkatan kemampuan anggota tim\",\n  },\n  {\n    id: 17,\n    category: \"C\",\n    name: \"Kepuasan Nasabah\",\n    nameEn: \"Customer Satisfaction\",\n    description: \"Tingkat kepuasan dan loyalitas nasabah terhadap layanan\",\n  },\n  {\n    id: 18,\n    category: \"C\",\n    name: \"Pemahaman Pasar Lokal\",\n    nameEn: \"Understanding of Local Market\",\n    description: \"Pengetahuan mendalam tentang karakteristik pasar lokal\",\n  },\n] as const;\n\nexport const SCORE_LEVELS = [\n  {\n    value: 1,\n    label: \"Sangat Kurang\",\n    labelEn: \"Very Poor\",\n    color: \"text-red-500\",\n    description: \"Tidak memenuhi standar minimum, perlu perbaikan mendesak\",\n  },\n  {\n    value: 2,\n    label: \"Kurang\",\n    labelEn: \"Poor\",\n    color: \"text-orange-500\",\n    description: \"Di bawah standar, memerlukan pembinaan intensif\",\n  },\n  {\n    value: 3,\n    label: \"Cukup\",\n    labelEn: \"Fair\",\n    color: \"text-yellow-500\",\n    description: \"Memenuhi standar minimum, masih perlu peningkatan\",\n  },\n  {\n    value: 4,\n    label: \"Baik\",\n    labelEn: \"Good\",\n    color: \"text-blue-500\",\n    description: \"Melampaui standar, kinerja solid dan konsisten\",\n  },\n  {\n    value: 5,\n    label: \"Sangat Baik\",\n    labelEn: \"Excellent\",\n    color: \"text-green-500\",\n    description: \"Jauh melampaui ekspektasi, menjadi role model\",\n  },\n] as const;\n\n// Helper to get pilar by ID\nexport function getPilarById(id: number) {\n  return PILARS.find(p => p.id === id);\n}\n\n// Helper to get pilars by category\nexport function getPilarsByCategory(categoryId: string) {\n  return PILARS.filter(p => p.category === categoryId);\n}\n\n// Helper to get category info\nexport function getCategoryById(id: string) {\n  return PILAR_CATEGORIES.find(c => c.id === id);\n}\n\n// Calculate average score by category\nexport function calculateCategoryAverage(\n  pillarAnswers: Array<{ pillarId: number; score: number }>,\n  categoryId: string\n): number {\n  const categoryPilars = getPilarsByCategory(categoryId);\n  const categoryAnswers = pillarAnswers.filter(a =>\n    categoryPilars.some(p => p.id === a.pillarId)\n  );\n  \n  if (categoryAnswers.length === 0) return 0;\n  \n  const sum = categoryAnswers.reduce((acc, a) => acc + a.score, 0);\n  return sum / categoryAnswers.length;\n}\n\n// Calculate total average score (all 18 pilars)\nexport function calculateTotalAverage(\n  pillarAnswers: Array<{ pillarId: number; score: number }>\n): number {\n  if (pillarAnswers.length === 0) return 0;\n  const sum = pillarAnswers.reduce((acc, a) => acc + a.score, 0);\n  return sum / pillarAnswers.length;\n}\n\n// Validate that all 18 pilars are answered\nexport function validatePillarAnswers(\n  pillarAnswers: Array<{ pillarId: number; score: number }>\n): boolean {\n  if (pillarAnswers.length !== 18) return false;\n  \n  const answeredIds = new Set(pillarAnswers.map(a => a.pillarId));\n  return PILARS.every(p => answeredIds.has(p.id));\n}\n","size_bytes":6804},"client/src/components/examples/ZoneBadge.tsx":{"content":"import ZoneBadge from \"../ZoneBadge\";\n\nexport default function ZoneBadgeExample() {\n  return (\n    <div className=\"flex flex-col gap-6 p-6 bg-background\">\n      <div>\n        <h3 className=\"text-sm font-medium mb-3 text-muted-foreground\">Small Size</h3>\n        <div className=\"flex flex-wrap gap-3\">\n          <ZoneBadge type=\"success\" size=\"sm\" data-testid=\"zone-success-sm\" />\n          <ZoneBadge type=\"warning\" size=\"sm\" data-testid=\"zone-warning-sm\" />\n          <ZoneBadge type=\"critical\" size=\"sm\" data-testid=\"zone-critical-sm\" />\n        </div>\n      </div>\n      <div>\n        <h3 className=\"text-sm font-medium mb-3 text-muted-foreground\">Medium Size (Default)</h3>\n        <div className=\"flex flex-wrap gap-3\">\n          <ZoneBadge type=\"success\" data-testid=\"zone-success-md\" />\n          <ZoneBadge type=\"warning\" data-testid=\"zone-warning-md\" />\n          <ZoneBadge type=\"critical\" data-testid=\"zone-critical-md\" />\n        </div>\n      </div>\n      <div>\n        <h3 className=\"text-sm font-medium mb-3 text-muted-foreground\">Large Size with Custom Labels</h3>\n        <div className=\"flex flex-wrap gap-3\">\n          <ZoneBadge type=\"success\" label=\"Zona Kinerja\" size=\"lg\" data-testid=\"zone-success-lg\" />\n          <ZoneBadge type=\"warning\" label=\"Zona Perilaku\" size=\"lg\" data-testid=\"zone-warning-lg\" />\n          <ZoneBadge type=\"critical\" label=\"Perlu Perbaikan\" size=\"lg\" data-testid=\"zone-critical-lg\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1479},"AISG_Technical_Documentation.md":{"content":"# AISG - Technical Architecture Documentation\n\n**Version**: 1.0  \n**Last Updated**: October 23, 2025  \n**Status**: Production Ready  \n**Target Audience**: Software Developers, System Architects, DevOps Engineers\n\n---\n\n## Table of Contents\n\n1. [System Overview](#1-system-overview)\n2. [Architecture Diagrams](#2-architecture-diagrams)\n3. [Technology Stack](#3-technology-stack)\n4. [Data Flow & Request Lifecycle](#4-data-flow--request-lifecycle)\n5. [Database Schema & Design](#5-database-schema--design)\n6. [API Specification](#6-api-specification)\n7. [Business Logic Algorithms](#7-business-logic-algorithms)\n8. [Frontend Architecture](#8-frontend-architecture)\n9. [Backend Architecture](#9-backend-architecture)\n10. [Code Structure & Conventions](#10-code-structure--conventions)\n11. [Error Handling & Validation](#11-error-handling--validation)\n12. [Deployment & DevOps](#12-deployment--devops)\n13. [Security Considerations](#13-security-considerations)\n14. [Performance Optimization](#14-performance-optimization)\n15. [Testing Strategy](#15-testing-strategy)\n16. [Troubleshooting Guide](#16-troubleshooting-guide)\n\n---\n\n## 1. System Overview\n\n### 1.1 Purpose\n\nAISG (Audit Intelligence SG) is a full-stack web application for corporate performance auditing using the standardized 18 Pilar framework. The system automates:\n- Employee self-assessment data collection\n- Complex performance calculations (Reality Score, Zones, ProDem)\n- Comprehensive report generation (12 sections)\n- AI-powered coaching via GPT-4o\n- Professional PDF export\n\n### 1.2 Key Features\n\n**Core Audit System**:\n- 5-step multi-form data collection\n- 18 Pilar self-assessment (scale 1-5)\n- Quarterly performance tracking (Q1-Q4)\n- Team hierarchy structure\n- Automated zone calculation (Success/Warning/Critical)\n\n**Advanced Features**:\n- AI Chat Integration (OpenAI GPT-4o)\n- PDF Report Generation (PDFKit)\n- CRUD operations (Create, Read, Delete)\n- Chat history persistence\n- Real-time validation\n\n### 1.3 System Constraints\n\n- **Authentication**: Not implemented (all data publicly accessible)\n- **Single Database**: No replication or backup automation\n- **OpenAI Dependency**: Requires paid API credits\n- **Manual Data Entry**: No HRIS integration\n- **PostgreSQL Only**: No multi-database support\n\n---\n\n## 2. Architecture Diagrams\n\n### 2.1 High-Level System Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                        CLIENT LAYER                          â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚  â”‚  React 18 + TypeScript (Vite)                         â”‚ â”‚\nâ”‚  â”‚  - Wouter (Routing)                                    â”‚ â”‚\nâ”‚  â”‚  - TanStack Query (State Management)                   â”‚ â”‚\nâ”‚  â”‚  - React Hook Form + Zod (Forms)                       â”‚ â”‚\nâ”‚  â”‚  - shadcn/ui + Tailwind CSS (UI)                       â”‚ â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                     â”‚ HTTP/JSON (REST API)\n                     â”‚\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                       SERVER LAYER                           â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚  â”‚  Express.js (Node.js Runtime)                          â”‚ â”‚\nâ”‚  â”‚  - API Routes (RESTful endpoints)                      â”‚ â”‚\nâ”‚  â”‚  - Business Logic (audit processing)                   â”‚ â”‚\nâ”‚  â”‚  - Storage Interface (database abstraction)            â”‚ â”‚\nâ”‚  â”‚  - OpenAI Integration (GPT-4o API)                     â”‚ â”‚\nâ”‚  â”‚  - PDF Generation (PDFKit)                             â”‚ â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                     â”‚               â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  PostgreSQL 16    â”‚   â”‚  OpenAI API    â”‚\n        â”‚  (Neon Serverless)â”‚   â”‚  (GPT-4o)      â”‚\n        â”‚  - Drizzle ORM    â”‚   â”‚                â”‚\n        â”‚  - JSONB Support  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 2.2 Component Interaction Diagram\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   Browser   â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚  Vite Server â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚   React    â”‚\nâ”‚             â”‚       â”‚  (Dev Only)  â”‚       â”‚  Frontend  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜\n      â”‚                                             â”‚\n      â”‚ HTTP Request                                â”‚\n      â”‚ (Production)                                â”‚\n      â–¼                                             â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Express.js Backend                          â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚  â”‚   Routes   â”‚â”€â–ºâ”‚ Business Logicâ”‚â”€â–ºâ”‚    Storage     â”‚ â”‚\nâ”‚  â”‚ (REST API) â”‚  â”‚  (Processing) â”‚  â”‚  (Interface)   â”‚ â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ”‚                          â”‚                    â”‚          â”‚\nâ”‚                          â–¼                    â–¼          â”‚\nâ”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚                  â”‚ OpenAI Client â”‚    â”‚ Drizzle ORM  â”‚  â”‚\nâ”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                           â”‚                    â”‚\n                           â–¼                    â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ OpenAI API  â”‚      â”‚PostgreSQLâ”‚\n                    â”‚  (GPT-4o)   â”‚      â”‚  (Neon)  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 2.3 Data Flow - Audit Creation\n\n```\nUser Input (5 Steps)\n      â”‚\n      â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Step 1: Personal Infoâ”‚\nâ”‚ - Nama, Jabatan, etc â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Step 2: Quarterly    â”‚\nâ”‚ - Margin, NA (Q1-Q4) â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Step 3: Team Struct  â”‚\nâ”‚ - BC, SBC, BsM, etc  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Step 4: 18 Pilar     â”‚\nâ”‚ - Self-assessment    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Step 5: Review       â”‚\nâ”‚ - Confirm & Submit   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n           â”‚\n           â”‚ POST /api/audit\n           â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Backend Receives â”‚\n    â”‚ Raw Audit Data   â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â”‚\n             â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Zod Validation          â”‚\n    â”‚ - Check required fields â”‚\n    â”‚ - Type checking         â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â”‚ Valid?\n             â”‚ Yes\n             â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Business Logic Processing       â”‚\n    â”‚ 1. Calculate Reality Score      â”‚\n    â”‚ 2. Determine Performance Zone   â”‚\n    â”‚ 3. Determine Behavioral Zone    â”‚\n    â”‚ 4. Calculate Final Zone         â”‚\n    â”‚ 5. Generate Employee Profile    â”‚\n    â”‚ 6. Generate SWOT Analysis       â”‚\n    â”‚ 7. Generate ProDem Recommendationâ”‚\n    â”‚ 8. Generate Action Plan 30-60-90â”‚\n    â”‚ 9. Generate EWS                 â”‚\n    â”‚10. Generate Magic Section       â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â”‚\n             â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Save to Database â”‚\n    â”‚ (audits table)   â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â”‚\n             â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Return Audit ID  â”‚\n    â”‚ + Full Report    â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â”‚\n             â–¼\n    Frontend Redirects to\n    /audit/:id (Detail Page)\n```\n\n### 2.4 Data Flow - AI Chat\n\n```\nUser Types Message\n      â”‚\n      â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Input Field     â”‚\nâ”‚ \"Bagaimana      â”‚\nâ”‚  performa saya?\"â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â”‚ Click Send\n         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ POST /api/chat       â”‚\nâ”‚ Body: {              â”‚\nâ”‚   auditId: \"xxx\",    â”‚\nâ”‚   message: \"...\"     â”‚\nâ”‚ }                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Backend: Save User Msg   â”‚\nâ”‚ to chatMessages table    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Load Chat History        â”‚\nâ”‚ (last 10 messages)       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Build System Prompt      â”‚\nâ”‚ - Include audit data:    â”‚\nâ”‚   * Nama, Jabatan        â”‚\nâ”‚   * Reality Score        â”‚\nâ”‚   * Zona Final           â”‚\nâ”‚   * Profil               â”‚\nâ”‚   * ProDem Recommendationâ”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Call OpenAI API          â”‚\nâ”‚ - Model: gpt-4o          â”‚\nâ”‚ - Messages: [            â”‚\nâ”‚     {role: \"system\", ... }â”‚\nâ”‚     ...history           â”‚\nâ”‚   ]                      â”‚\nâ”‚ - Max Tokens: 500        â”‚\nâ”‚ - Temperature: 0.7       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â”‚ Response or Error?\n         â”‚\n    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”\n    â”‚         â”‚\n Success    Error\n    â”‚         â”‚\n    â–¼         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚Save â”‚  â”‚ Return 429   â”‚\nâ”‚AI   â”‚  â”‚ or 500 error â”‚\nâ”‚Msg  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\nâ””â”€â”€â”¬â”€â”€â”˜         â”‚\n   â”‚            â”‚\n   â–¼            â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Frontend:        â”‚\nâ”‚ - Refresh historyâ”‚\nâ”‚ - Clear input    â”‚\nâ”‚ - Show toast     â”‚\nâ”‚   (success/error)â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## 3. Technology Stack\n\n### 3.1 Frontend Stack\n\n| Technology | Version | Purpose | Justification |\n|------------|---------|---------|---------------|\n| React | 18.3.1 | UI Framework | Industry standard, rich ecosystem |\n| TypeScript | 5.x | Type Safety | Catch errors at compile time, better DX |\n| Vite | 5.x | Build Tool | Fast HMR, optimized builds |\n| Wouter | 3.x | Routing | Lightweight (1.3KB), hook-based API |\n| TanStack Query | 5.x | Server State | Automatic caching, background refetch |\n| React Hook Form | 7.x | Form Management | Minimal re-renders, great performance |\n| Zod | 3.x | Validation | Runtime type checking, TypeScript integration |\n| shadcn/ui | Latest | UI Components | High-quality, customizable, accessible |\n| Tailwind CSS | 3.x | Styling | Utility-first, rapid development |\n| Lucide React | Latest | Icons | Consistent, tree-shakeable |\n\n### 3.2 Backend Stack\n\n| Technology | Version | Purpose | Justification |\n|------------|---------|---------|---------------|\n| Node.js | 20.x | Runtime | Async I/O, JavaScript everywhere |\n| Express.js | 4.x | Web Framework | Minimalist, proven, middleware-rich |\n| TypeScript | 5.x | Type Safety | Shared types with frontend |\n| Drizzle ORM | 0.33.x | Database ORM | Lightweight, type-safe, zero-cost |\n| Zod | 3.x | Validation | Shared schemas with frontend |\n| tsx | Latest | TS Execution | No build step for development |\n\n### 3.3 External Services\n\n| Service | Purpose | Cost |\n|---------|---------|------|\n| Neon PostgreSQL | Database | Free tier (3GB) |\n| OpenAI GPT-4o | AI Chat | ~$2.50 per 1M input tokens |\n| Replit Hosting | Deployment | $20/month (Core plan) |\n\n### 3.4 Development Tools\n\n| Tool | Purpose |\n|------|---------|\n| Drizzle Kit | Database migrations |\n| ESBuild | Fast bundling (via Vite) |\n| PostCSS | CSS processing |\n| Autoprefixer | Browser compatibility |\n\n---\n\n## 4. Data Flow & Request Lifecycle\n\n### 4.1 Frontend Request Flow (TanStack Query)\n\n```typescript\n// Example: Fetching audit detail\nconst { data: audit } = useQuery<Audit>({\n  queryKey: [`/api/audit/${auditId}`],\n  enabled: !!auditId,\n});\n\n// Behind the scenes:\n// 1. TanStack Query checks cache (queryKey)\n// 2. If cache miss or stale:\n//    - Call default fetcher (configured in queryClient)\n//    - Fetcher uses fetch(`/api/audit/${auditId}`)\n// 3. Parse JSON response\n// 4. Store in cache (key: `/api/audit/${auditId}`)\n// 5. Return data to component\n// 6. Auto-refetch on window focus (configurable)\n```\n\n**Default Fetcher** (`client/src/lib/queryClient.ts`):\n\n```typescript\nconst defaultQueryFn: QueryFunction = async ({ queryKey }) => {\n  const url = queryKey[0] as string;\n  const res = await fetch(url, { credentials: \"include\" });\n  \n  if (!res.ok) {\n    // Extract error message\n    const error = await res.text();\n    throw new Error(`${res.status}: ${error}`);\n  }\n  \n  return res.json();\n};\n```\n\n### 4.2 Backend Request Lifecycle\n\n```\n1. Client sends HTTP request\n   â†“\n2. Express middleware chain:\n   - JSON body parser\n   - CORS (if configured)\n   - Session middleware (not active yet)\n   â†“\n3. Route handler matched\n   Example: app.post(\"/api/audit\", async (req, res) => {...})\n   â†“\n4. Zod validation\n   - Parse req.body with Zod schema\n   - If invalid: return 400 error\n   â†“\n5. Business logic processing\n   - Call functions from business-logic.ts\n   - Complex calculations, data transformation\n   â†“\n6. Database operations\n   - Use storage interface (IStorage)\n   - Drizzle ORM executes SQL\n   â†“\n7. Response sent\n   - res.json({ data }) or res.status(error).json({ error })\n   â†“\n8. Client receives response\n   - TanStack Query caches result\n   - Component re-renders with new data\n```\n\n### 4.3 Error Propagation Flow\n\n```\nBackend Error (try-catch)\n      â”‚\n      â”œâ”€ Zod Validation Error\n      â”‚  â””â”€> 400 Bad Request\n      â”‚      { error: \"Validation error\", details: \"...\" }\n      â”‚\n      â”œâ”€ Database Error\n      â”‚  â””â”€> 500 Internal Server Error\n      â”‚      { error: \"Internal server error\" }\n      â”‚\n      â”œâ”€ OpenAI API Error\n      â”‚  â”œâ”€ 429 Rate Limit\n      â”‚  â”‚  â””â”€> 429 Rate Limit\n      â”‚  â”‚      { error: \"AI service rate limit\", \n      â”‚  â”‚        userMessage: \"Maaf, layanan AI...\" }\n      â”‚  â”‚\n      â”‚  â””â”€ Other errors\n      â”‚     â””â”€> 500 Internal Server Error\n      â”‚         { error: \"Internal server error\",\n      â”‚           userMessage: \"Maaf, terjadi kesalahan...\" }\n      â”‚\n      â””â”€ Audit Not Found\n         â””â”€> 404 Not Found\n             { error: \"Audit not found\" }\n\nFrontend Error Handling\n      â”‚\n      â–¼\nTanStack Query onError callback\n      â”‚\n      â”œâ”€ Extract userMessage (if exists)\n      â”‚  â””â”€ Parse error string, look for JSON\n      â”‚\n      â””â”€ Show toast notification\n         â””â”€ useToast({ title: \"Error\", description: \"...\" })\n```\n\n---\n\n## 5. Database Schema & Design\n\n### 5.1 Entity Relationship Diagram\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚      users          â”‚\nâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚ id (UUID) PK        â”‚\nâ”‚ username (unique)   â”‚\nâ”‚ password (hashed)   â”‚\nâ”‚ email (unique)      â”‚\nâ”‚ role (varchar)      â”‚\nâ”‚ createdAt           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â”‚ (Not enforced FK - future use)\n         â”‚\n         â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚      audits              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚\nâ”‚ id (UUID) PK             â”‚                 â”‚\nâ”‚ nama                     â”‚                 â”‚\nâ”‚ jabatan                  â”‚                 â”‚\nâ”‚ cabang                   â”‚                 â”‚\nâ”‚ tanggalLahir             â”‚                 â”‚\nâ”‚ marginTimQ1-Q4           â”‚                 â”‚\nâ”‚ naTimQ1-Q4               â”‚                 â”‚\nâ”‚ marginPribadiQ1-Q4 (NEW) â”‚                 â”‚\nâ”‚ nasabahPribadiQ1-Q4 (NEW)â”‚                 â”‚\nâ”‚ jumlahBC, SBC, BsM, etc  â”‚                 â”‚\nâ”‚ pillarAnswers (JSONB)    â”‚                 â”‚\nâ”‚ totalRealityScore        â”‚                 â”‚\nâ”‚ zonaPerforma             â”‚                 â”‚\nâ”‚ zonaBehavioral           â”‚                 â”‚\nâ”‚ zonaFinal                â”‚                 â”‚\nâ”‚ profil                   â”‚                 â”‚\nâ”‚ magicSection (JSONB)     â”‚                 â”‚\nâ”‚ prodemRekomendasi (JSONB)â”‚                 â”‚\nâ”‚ auditReport (JSONB)      â”‚                 â”‚\nâ”‚ createdAt                â”‚                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚\n         â”‚                                    â”‚\n         â”‚ 1:N (CASCADE DELETE)               â”‚\n         â”‚                                    â”‚\n         â–¼                                    â”‚\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚\nâ”‚   chatMessages       â”‚                     â”‚\nâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚\nâ”‚ id (UUID) PK         â”‚                     â”‚\nâ”‚ auditId (UUID) FK â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nâ”‚ role (user/assistant)â”‚\nâ”‚ content (text)       â”‚\nâ”‚ createdAt            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚     branches        â”‚ (Not used yet)\nâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\nâ”‚ id (UUID) PK        â”‚\nâ”‚ name                â”‚\nâ”‚ region              â”‚\nâ”‚ createdAt           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### 5.2 Detailed Schema Definitions\n\n#### audits Table\n\n```typescript\nexport const audits = pgTable(\"audits\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // Personal Info\n  nama: varchar(\"nama\", { length: 255 }).notNull(),\n  jabatan: varchar(\"jabatan\", { length: 100 }).notNull(),\n  cabang: varchar(\"cabang\", { length: 255 }).notNull(),\n  tanggalLahir: varchar(\"tanggal_lahir\", { length: 20 }).notNull(),\n  \n  // Team Quarterly Performance\n  marginTimQ1: integer(\"margin_tim_q1\").default(0),\n  marginTimQ2: integer(\"margin_tim_q2\").default(0),\n  marginTimQ3: integer(\"margin_tim_q3\").default(0),\n  marginTimQ4: integer(\"margin_tim_q4\").default(0),\n  naTimQ1: integer(\"na_tim_q1\").default(0),\n  naTimQ2: integer(\"na_tim_q2\").default(0),\n  naTimQ3: integer(\"na_tim_q3\").default(0),\n  naTimQ4: integer(\"na_tim_q4\").default(0),\n  \n  // Personal Quarterly Performance (NEW - October 23, 2025)\n  marginPribadiQ1: integer(\"margin_pribadi_q1\").default(0),\n  marginPribadiQ2: integer(\"margin_pribadi_q2\").default(0),\n  marginPribadiQ3: integer(\"margin_pribadi_q3\").default(0),\n  marginPribadiQ4: integer(\"margin_pribadi_q4\").default(0),\n  nasabahPribadiQ1: integer(\"nasabah_pribadi_q1\").default(0),\n  nasabahPribadiQ2: integer(\"nasabah_pribadi_q2\").default(0),\n  nasabahPribadiQ3: integer(\"nasabah_pribadi_q3\").default(0),\n  nasabahPribadiQ4: integer(\"nasabah_pribadi_q4\").default(0),\n  \n  // Team Structure\n  jumlahBC: integer(\"jumlah_bc\").default(0),\n  jumlahSBC: integer(\"jumlah_sbc\").default(0),\n  jumlahBsM: integer(\"jumlah_bsm\").default(0),\n  jumlahSBM: integer(\"jumlah_sbm\").default(0),\n  jumlahEM: integer(\"jumlah_em\").default(0),\n  jumlahSEM: integer(\"jumlah_sem\").default(0),\n  jumlahVBM: integer(\"jumlah_vbm\").default(0),\n  \n  // Assessment Results (JSONB for flexibility)\n  pillarAnswers: jsonb(\"pillar_answers\"), // [{ pillarId: 1, selfScore: 3 }, ...]\n  \n  // Calculated Fields\n  totalRealityScore: integer(\"total_reality_score\").default(0),\n  zonaPerforma: varchar(\"zona_performa\", { length: 50 }),\n  zonaBehavioral: varchar(\"zona_behavioral\", { length: 50 }),\n  zonaFinal: varchar(\"zona_final\", { length: 50 }),\n  profil: varchar(\"profil\", { length: 100 }),\n  \n  // Complex Results (JSONB)\n  magicSection: jsonb(\"magic_section\"), // { zodiac, quote, booster }\n  prodemRekomendasi: jsonb(\"prodem_rekomendasi\"), // { recommendation, reasoning, strategy }\n  auditReport: jsonb(\"audit_report\"), // Full 12-section report\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n**JSONB Structure Examples**:\n\n```typescript\n// pillarAnswers\n[\n  { pillarId: 1, selfScore: 3 },\n  { pillarId: 2, selfScore: 4 },\n  // ... 18 items total\n]\n\n// magicSection\n{\n  zodiac: \"Leo\",\n  quote: \"Your determination will lead you to success\",\n  booster: \"Focus on building team collaboration this quarter\"\n}\n\n// prodemRekomendasi\n{\n  recommendation: \"Hold\",\n  reasoning: \"Performance in Warning zone with improvement trend...\",\n  strategy: \"Save by Margin\",\n  timeline: \"Re-evaluate in 3 months\"\n}\n\n// auditReport\n{\n  executiveSummary: \"...\",\n  swotAnalysis: { strengths: [...], weaknesses: [...], ... },\n  actionPlan3060 90: { days30: [...], days60: [...], days90: [...] },\n  // ... all 12 sections\n}\n```\n\n#### chatMessages Table\n\n```typescript\nexport const chatMessages = pgTable(\"chatMessages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  auditId: varchar(\"audit_id\").notNull()\n    .references(() => audits.id, { onDelete: \"cascade\" }),\n  role: varchar(\"role\", { length: 20 }).notNull(), // \"user\" or \"assistant\"\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n```\n\n**Foreign Key Behavior**:\n- `ON DELETE CASCADE`: When audit deleted, all associated chat messages auto-deleted\n- Enforced at database level for data integrity\n\n### 5.3 Indexing Strategy\n\n**Current Indexes** (implicit):\n- Primary keys (id) on all tables â†’ B-tree index\n- Foreign keys (auditId) â†’ B-tree index\n\n**Recommended Future Indexes**:\n\n```sql\n-- For filtering audits by name (search functionality)\nCREATE INDEX idx_audits_nama ON audits(nama);\n\n-- For sorting by creation date (most recent first)\nCREATE INDEX idx_audits_created_at ON audits(created_at DESC);\n\n-- For chat history queries (frequently accessed)\nCREATE INDEX idx_chat_audit_created ON chatMessages(audit_id, created_at);\n\n-- For zona filtering (if implemented)\nCREATE INDEX idx_audits_zona_final ON audits(zona_final);\n```\n\n### 5.4 Data Migration History\n\n**October 23, 2025 Migration**:\n\n1. **Column Renames** (preserve data):\n   ```sql\n   ALTER TABLE audits RENAME COLUMN na_q1 TO na_tim_q1;\n   ALTER TABLE audits RENAME COLUMN na_q2 TO na_tim_q2;\n   ALTER TABLE audits RENAME COLUMN na_q3 TO na_tim_q3;\n   ALTER TABLE audits RENAME COLUMN na_q4 TO na_tim_q4;\n   ```\n\n2. **New Columns** (personal performance tracking):\n   ```sql\n   ALTER TABLE audits ADD COLUMN margin_pribadi_q1 INTEGER DEFAULT 0;\n   ALTER TABLE audits ADD COLUMN margin_pribadi_q2 INTEGER DEFAULT 0;\n   ALTER TABLE audits ADD COLUMN margin_pribadi_q3 INTEGER DEFAULT 0;\n   ALTER TABLE audits ADD COLUMN margin_pribadi_q4 INTEGER DEFAULT 0;\n   ALTER TABLE audits ADD COLUMN nasabah_pribadi_q1 INTEGER DEFAULT 0;\n   ALTER TABLE audits ADD COLUMN nasabah_pribadi_q2 INTEGER DEFAULT 0;\n   ALTER TABLE audits ADD COLUMN nasabah_pribadi_q3 INTEGER DEFAULT 0;\n   ALTER TABLE audits ADD COLUMN nasabah_pribadi_q4 INTEGER DEFAULT 0;\n   ```\n\n**Migration Process**:\n- Handled via Replit Publishing UI (conflict resolution wizard)\n- Production database updated without data loss\n- All existing audits retained with new columns defaulting to 0\n\n---\n\n## 6. API Specification\n\n### 6.1 Audit Endpoints\n\n#### POST /api/audit\n\n**Purpose**: Create new audit and return calculated results\n\n**Request**:\n```typescript\n{\n  // Personal Info\n  nama: string;\n  jabatan: string;\n  cabang: string;\n  tanggalLahir: string; // Format: \"DD-MM-YYYY\"\n  \n  // Team Quarterly Performance\n  marginTimQ1: number;\n  marginTimQ2: number;\n  marginTimQ3: number;\n  marginTimQ4: number;\n  naTimQ1: number; // \"na\" = New Account (nasabah baru)\n  naTimQ2: number;\n  naTimQ3: number;\n  naTimQ4: number;\n  \n  // Personal Quarterly Performance\n  marginPribadiQ1: number;\n  marginPribadiQ2: number;\n  marginPribadiQ3: number;\n  marginPribadiQ4: number;\n  nasabahPribadiQ1: number;\n  nasabahPribadiQ2: number;\n  nasabahPribadiQ3: number;\n  nasabahPribadiQ4: number;\n  \n  // Team Structure\n  jumlahBC: number;\n  jumlahSBC: number;\n  jumlahBsM: number;\n  jumlahSBM: number;\n  jumlahEM: number;\n  jumlahSEM: number;\n  jumlahVBM: number;\n  \n  // 18 Pilar Self-Assessment\n  pillarAnswers: Array<{\n    pillarId: number; // 1-18\n    selfScore: number; // 1-5\n  }>;\n}\n```\n\n**Response** (200 OK):\n```typescript\n{\n  id: string; // UUID\n  nama: string;\n  // ... all input fields\n  \n  // Calculated fields\n  totalRealityScore: number; // Sum of pillar scores\n  zonaPerforma: string; // \"success\" | \"warning\" | \"critical\"\n  zonaBehavioral: string;\n  zonaFinal: string;\n  profil: string; // \"Consistency Expert\" | \"Balanced Performer\" | etc.\n  \n  // Complex results\n  magicSection: {\n    zodiac: string;\n    quote: string;\n    booster: string;\n  };\n  prodemRekomendasi: {\n    recommendation: string; // \"Promosi\" | \"Demotion\" | \"Hold\"\n    reasoning: string;\n    strategy: string;\n    timeline: string;\n  };\n  auditReport: {\n    executiveSummary: string;\n    swotAnalysis: object;\n    actionPlan30_60_90: object;\n    ews: object;\n    // ... 12 sections total\n  };\n  \n  createdAt: string; // ISO timestamp\n}\n```\n\n**Error Responses**:\n- `400 Bad Request`: Validation error (Zod schema mismatch)\n  ```json\n  {\n    \"error\": \"Validation error\",\n    \"details\": \"pillarAnswers: Required\"\n  }\n  ```\n\n- `500 Internal Server Error`: Database or processing error\n  ```json\n  {\n    \"error\": \"Internal server error\"\n  }\n  ```\n\n**Processing Flow**:\n1. Validate request body with Zod schema\n2. Call `processAudit(data)` from business-logic.ts\n3. Save to database via `storage.createAudit(processedData)`\n4. Return full audit object with all calculated fields\n\n---\n\n#### GET /api/audits\n\n**Purpose**: Retrieve all audits (list view)\n\n**Request**: None (no query parameters)\n\n**Response** (200 OK):\n```typescript\n[\n  {\n    id: string;\n    nama: string;\n    jabatan: string;\n    cabang: string;\n    totalRealityScore: number;\n    zonaFinal: string;\n    profil: string;\n    createdAt: string;\n    // ... other fields\n  },\n  // ... more audits\n]\n```\n\n**Sorting**: Newest first (ORDER BY createdAt DESC)\n\n**Error Responses**:\n- `500 Internal Server Error`: Database query failed\n\n---\n\n#### GET /api/audit/:id\n\n**Purpose**: Retrieve single audit by ID\n\n**URL Parameters**:\n- `id` (string, UUID): Audit ID\n\n**Response** (200 OK):\n```typescript\n{\n  id: string;\n  nama: string;\n  // ... all fields (same as POST response)\n}\n```\n\n**Error Responses**:\n- `404 Not Found`: Audit ID doesn't exist\n  ```json\n  {\n    \"error\": \"Audit not found\"\n  }\n  ```\n\n- `500 Internal Server Error`: Database query failed\n\n---\n\n#### DELETE /api/audit/:id\n\n**Purpose**: Delete audit and associated chat messages (CASCADE)\n\n**URL Parameters**:\n- `id` (string, UUID): Audit ID\n\n**Response** (200 OK):\n```json\n{\n  \"message\": \"Audit deleted successfully\"\n}\n```\n\n**Processing Flow**:\n1. Delete chat messages first: `storage.deleteChatHistory(id)`\n2. Delete audit: `storage.deleteAudit(id)`\n3. Both operations wrapped in transaction (future: explicit transaction handling)\n\n**Error Responses**:\n- `404 Not Found`: Audit ID doesn't exist\n- `500 Internal Server Error`: Database deletion failed\n\n**Note**: Frontend shows confirmation dialog before calling this endpoint\n\n---\n\n### 6.2 Chat Endpoints\n\n#### POST /api/chat\n\n**Purpose**: Send chat message and get AI response\n\n**Request**:\n```typescript\n{\n  auditId: string; // UUID\n  message: string; // User's question\n}\n```\n\n**Response** (200 OK):\n```json\n{\n  \"response\": \"AI generated response text...\"\n}\n```\n\n**Processing Flow**:\n1. Validate request body with Zod\n2. Verify audit exists (404 if not)\n3. **Save user message** to database FIRST\n4. Load chat history (last 10 messages for context)\n5. Build system prompt with audit context:\n   ```typescript\n   const systemPrompt = `\n   Anda adalah AI coach profesional untuk AISG.\n   \n   DATA AUDIT:\n   - Nama: ${audit.nama}\n   - Jabatan: ${audit.jabatan}\n   - Reality Score: ${audit.totalRealityScore}/90\n   - Profil: ${audit.profil}\n   - Zona: ${audit.zonaFinal}\n   - ProDem: ${audit.prodemRekomendasi.recommendation}\n   \n   TUGAS ANDA:\n   1. Jawab pertanyaan tentang hasil audit\n   2. Berikan insight actionable\n   3. Motivasi karyawan untuk improve\n   4. Gunakan Bahasa Indonesia profesional\n   `;\n   ```\n6. Call OpenAI API:\n   ```typescript\n   const completion = await openai.chat.completions.create({\n     model: \"gpt-4o\",\n     messages: [\n       { role: \"system\", content: systemPrompt },\n       ...history.map(msg => ({ role: msg.role, content: msg.content }))\n     ],\n     max_tokens: 500,\n     temperature: 0.7\n   });\n   ```\n7. Save AI response to database\n8. Return AI response to frontend\n\n**Error Responses**:\n- `404 Not Found`: Audit ID doesn't exist\n- `429 Rate Limit`: OpenAI quota exceeded\n  ```json\n  {\n    \"error\": \"AI service rate limit\",\n    \"userMessage\": \"Maaf, layanan AI sedang mencapai batas penggunaan. Mohon coba lagi dalam beberapa saat.\"\n  }\n  ```\n- `500 Internal Server Error`: OpenAI API or database error\n  ```json\n  {\n    \"error\": \"Internal server error\",\n    \"userMessage\": \"Maaf, terjadi kesalahan saat menghubungi AI. Silakan coba lagi.\"\n  }\n  ```\n\n**Important Behavior**:\n- User message is **saved BEFORE** calling OpenAI API\n- If OpenAI fails, user message still persists in database\n- Frontend refreshes chat history even on error (to show user's message)\n\n---\n\n#### GET /api/chat/:auditId\n\n**Purpose**: Retrieve chat history for specific audit\n\n**URL Parameters**:\n- `auditId` (string, UUID): Audit ID\n\n**Response** (200 OK):\n```typescript\n[\n  {\n    id: string;\n    auditId: string;\n    role: \"user\" | \"assistant\";\n    content: string;\n    createdAt: string; // ISO timestamp\n  },\n  // ... ordered by createdAt ASC (oldest first)\n]\n```\n\n**Error Responses**:\n- `500 Internal Server Error`: Database query failed\n\n**Note**: Returns empty array `[]` if no chat history exists (not an error)\n\n---\n\n#### DELETE /api/chat/:auditId\n\n**Purpose**: Clear all chat messages for specific audit\n\n**URL Parameters**:\n- `auditId` (string, UUID): Audit ID\n\n**Response** (200 OK):\n```json\n{\n  \"message\": \"Chat history cleared successfully\"\n}\n```\n\n**Error Responses**:\n- `500 Internal Server Error`: Database deletion failed\n\n---\n\n### 6.3 PDF Export Endpoint\n\n#### GET /api/audit/:id/pdf\n\n**Purpose**: Generate and download audit report as PDF\n\n**URL Parameters**:\n- `id` (string, UUID): Audit ID\n\n**Response** (200 OK):\n- Content-Type: `application/pdf`\n- Content-Disposition: `attachment; filename=\"Audit-[Nama]-[Date].pdf\"`\n- Body: PDF file stream (binary)\n\n**Processing**:\n1. Retrieve audit from database\n2. Generate PDF using PDFKit with all 12 sections\n3. Stream PDF to response\n\n**Error Responses**:\n- `404 Not Found`: Audit ID doesn't exist\n- `500 Internal Server Error`: PDF generation failed\n\n**Frontend Usage**:\n```typescript\nconst handleDownloadPDF = () => {\n  window.location.href = `/api/audit/${auditId}/pdf`;\n  // Browser automatically downloads file\n};\n```\n\n---\n\n## 7. Business Logic Algorithms\n\n### 7.1 Reality Score Calculation\n\n**File**: `server/business-logic.ts`\n\n**Algorithm**:\n```typescript\nfunction calculateRealityScore(pillarAnswers: PillarAnswer[]): number {\n  // Sum all self-assessment scores\n  const total = pillarAnswers.reduce((sum, answer) => {\n    return sum + answer.selfScore;\n  }, 0);\n  \n  // Max possible: 18 pillars Ã— 5 points = 90\n  return total;\n}\n```\n\n**Input**: Array of 18 pillar self-assessments (1-5 scale)  \n**Output**: Total score (0-90)\n\n**Example**:\n```typescript\npillarAnswers = [\n  { pillarId: 1, selfScore: 3 },\n  { pillarId: 2, selfScore: 4 },\n  { pillarId: 3, selfScore: 3 },\n  // ... 15 more\n  { pillarId: 18, selfScore: 4 }\n];\n\ntotalRealityScore = 3 + 4 + 3 + ... + 4 = 58\n```\n\n---\n\n### 7.2 Performance Zone Determination\n\n**Algorithm**:\n```typescript\nfunction determinePerformanceZone(audit: AuditInput): string {\n  // Aggregate quarterly performance\n  const totalMargin = audit.marginTimQ1 + audit.marginTimQ2 + \n                      audit.marginTimQ3 + audit.marginTimQ4;\n  const totalNA = audit.naTimQ1 + audit.naTimQ2 + \n                  audit.naTimQ3 + audit.naTimQ4;\n  \n  // Define thresholds (based on jabatan)\n  const thresholds = getThresholds(audit.jabatan);\n  \n  // Determine zone\n  if (totalMargin >= thresholds.margin.success && \n      totalNA >= thresholds.na.success) {\n    return \"success\"; // ðŸŸ© Green\n  } else if (totalMargin >= thresholds.margin.warning && \n             totalNA >= thresholds.na.warning) {\n    return \"warning\"; // ðŸŸ¨ Yellow\n  } else {\n    return \"critical\"; // ðŸŸ¥ Red\n  }\n}\n\nfunction getThresholds(jabatan: string) {\n  // Example thresholds (configurable per jabatan)\n  const thresholdsMap = {\n    \"Business Manager\": {\n      margin: { success: 200000, warning: 100000 },\n      na: { success: 10, warning: 5 }\n    },\n    \"Sales Business Manager\": {\n      margin: { success: 500000, warning: 250000 },\n      na: { success: 20, warning: 10 }\n    },\n    // ... more jabatan\n  };\n  \n  return thresholdsMap[jabatan] || thresholdsMap[\"Business Manager\"];\n}\n```\n\n**Input**: Quarterly margin & NA data + jabatan  \n**Output**: \"success\" | \"warning\" | \"critical\"\n\n**Zone Criteria**:\n- **Success (ðŸŸ©)**: Exceeds both margin AND NA success thresholds\n- **Warning (ðŸŸ¨)**: Meets warning thresholds but not success\n- **Critical (ðŸŸ¥)**: Below warning thresholds\n\n---\n\n### 7.3 Behavioral Zone Analysis\n\n**Algorithm**:\n```typescript\nfunction determineBehavioralZone(pillarAnswers: PillarAnswer[]): string {\n  // Calculate average score\n  const avgScore = pillarAnswers.reduce((sum, p) => sum + p.selfScore, 0) / 18;\n  \n  // Calculate variance (consistency check)\n  const variance = calculateVariance(pillarAnswers.map(p => p.selfScore));\n  \n  // Determine zone based on avg score and consistency\n  if (avgScore >= 4.0 && variance < 0.5) {\n    return \"success\"; // High scores + consistent\n  } else if (avgScore >= 3.0 && variance < 1.0) {\n    return \"warning\"; // Moderate scores or some inconsistency\n  } else {\n    return \"critical\"; // Low scores or high variance\n  }\n}\n\nfunction calculateVariance(scores: number[]): number {\n  const mean = scores.reduce((a, b) => a + b, 0) / scores.length;\n  const squaredDiffs = scores.map(score => Math.pow(score - mean, 2));\n  const variance = squaredDiffs.reduce((a, b) => a + b, 0) / scores.length;\n  return variance;\n}\n```\n\n**Input**: 18 Pilar self-assessment scores  \n**Output**: \"success\" | \"warning\" | \"critical\"\n\n**Analysis Factors**:\n1. **Average Score**: Overall competency level\n2. **Variance**: Consistency across pillars (low variance = balanced skill set)\n\n---\n\n### 7.4 Final Zone Calculation\n\n**Algorithm**:\n```typescript\nfunction determineFinalZone(zonaPerforma: string, zonaBehavioral: string): string {\n  // Weighted decision matrix\n  const zoneMatrix = {\n    \"success-success\": \"success\",\n    \"success-warning\": \"success\", // Performance outweighs\n    \"success-critical\": \"warning\", // Behavioral issues drag down\n    \"warning-success\": \"warning\",\n    \"warning-warning\": \"warning\",\n    \"warning-critical\": \"critical\",\n    \"critical-success\": \"warning\", // Behavioral can't save poor performance\n    \"critical-warning\": \"critical\",\n    \"critical-critical\": \"critical\"\n  };\n  \n  const key = `${zonaPerforma}-${zonaBehavioral}`;\n  return zoneMatrix[key] || \"warning\"; // Default to warning if unknown\n}\n```\n\n**Input**: Performance Zone + Behavioral Zone  \n**Output**: Final Zone (used for ProDem decisions)\n\n**Decision Logic**:\n- Performance zone has slightly higher weight (60/40)\n- Both critical â†’ Always critical final\n- One success â†’ Can elevate to warning/success depending on other\n\n---\n\n### 7.5 Employee Profile Generation\n\n**Algorithm**:\n```typescript\nfunction generateEmployeeProfile(audit: ProcessedAudit): string {\n  const { pillarAnswers, marginTimQ1, marginTimQ2, marginTimQ3, marginTimQ4 } = audit;\n  \n  // Pattern 1: Consistency Check\n  const variance = calculateVariance(pillarAnswers.map(p => p.selfScore));\n  const isConsistent = variance < 0.5;\n  \n  // Pattern 2: Trend Analysis\n  const trend = analyzeTrend([marginTimQ1, marginTimQ2, marginTimQ3, marginTimQ4]);\n  \n  // Pattern 3: Score Level\n  const avgScore = pillarAnswers.reduce((s, p) => s + p.selfScore, 0) / 18;\n  \n  // Profile Decision Tree\n  if (isConsistent && avgScore >= 4 && trend === \"stable\") {\n    return \"Consistency Expert\";\n  } else if (avgScore >= 4 && trend === \"upward\") {\n    return \"Rising Star\";\n  } else if (!isConsistent && avgScore >= 3.5) {\n    return \"Balanced Performer\";\n  } else if (trend === \"upward\" && avgScore >= 3) {\n    return \"Growth Trajectory\";\n  } else if (trend === \"downward\" || avgScore < 3) {\n    return \"At-Risk\";\n  } else {\n    return \"Developing Professional\";\n  }\n}\n\nfunction analyzeTrend(quarterlyData: number[]): \"upward\" | \"downward\" | \"stable\" {\n  // Simple linear regression slope\n  const n = quarterlyData.length;\n  const xMean = (n - 1) / 2; // [0,1,2,3] mean = 1.5\n  const yMean = quarterlyData.reduce((a, b) => a + b, 0) / n;\n  \n  let numerator = 0;\n  let denominator = 0;\n  \n  for (let i = 0; i < n; i++) {\n    numerator += (i - xMean) * (quarterlyData[i] - yMean);\n    denominator += Math.pow(i - xMean, 2);\n  }\n  \n  const slope = numerator / denominator;\n  \n  if (slope > 5000) return \"upward\"; // Increasing trend\n  if (slope < -5000) return \"downward\"; // Decreasing trend\n  return \"stable\"; // Flat trend\n}\n```\n\n**Profile Types**:\n1. **Consistency Expert**: High scores, low variance, stable performance\n2. **Rising Star**: High scores with upward trend\n3. **Balanced Performer**: Moderate scores, good overall balance\n4. **Growth Trajectory**: Improving performance over quarters\n5. **At-Risk**: Low scores or declining trend\n6. **Developing Professional**: Default for mixed patterns\n\n---\n\n### 7.6 SWOT Analysis Generation\n\n**Algorithm**:\n```typescript\nfunction generateSWOT(audit: ProcessedAudit): SWOTAnalysis {\n  const { pillarAnswers, zonaPerforma, zonaBehavioral, totalRealityScore } = audit;\n  \n  // STRENGTHS: Top 3 pillar scores + zona success areas\n  const topPillars = pillarAnswers\n    .sort((a, b) => b.selfScore - a.selfScore)\n    .slice(0, 3)\n    .map(p => getPillarName(p.pillarId));\n  \n  const strengths = [\n    `Strong performance in: ${topPillars.join(\", \")}`,\n    zonaPerforma === \"success\" ? \"Excellent quarterly performance metrics\" : null,\n    totalRealityScore >= 70 ? \"High overall competency (Reality Score)\" : null,\n  ].filter(Boolean); // Remove null values\n  \n  // WEAKNESSES: Bottom 3 pillar scores + zona critical areas\n  const bottomPillars = pillarAnswers\n    .sort((a, b) => a.selfScore - b.selfScore)\n    .slice(0, 3)\n    .map(p => getPillarName(p.pillarId));\n  \n  const weaknesses = [\n    `Need improvement in: ${bottomPillars.join(\", \")}`,\n    zonaBehavioral === \"critical\" ? \"Inconsistent behavioral patterns\" : null,\n    zonaPerforma === \"critical\" ? \"Performance metrics below expectations\" : null,\n  ].filter(Boolean);\n  \n  // OPPORTUNITIES: Growth potential based on trend\n  const trend = analyzeTrend([audit.marginTimQ1, audit.marginTimQ2, audit.marginTimQ3, audit.marginTimQ4]);\n  const opportunities = [\n    trend === \"upward\" ? \"Capitalize on positive momentum\" : \"Opportunity to improve quarterly performance\",\n    \"Leverage strengths to mentor team members\",\n    \"Develop skills in identified weakness areas\",\n  ];\n  \n  // THREATS: Risk factors from EWS\n  const threats = [];\n  if (trend === \"downward\") threats.push(\"Declining performance trend requires immediate attention\");\n  if (zonaBehavioral === \"critical\") threats.push(\"Behavioral inconsistency may impact team morale\");\n  if (zonaPerforma === \"critical\") threats.push(\"Risk of not meeting annual targets\");\n  if (threats.length === 0) threats.push(\"Maintain consistency to avoid performance dips\");\n  \n  return { strengths, weaknesses, opportunities, threats };\n}\n```\n\n**Output Structure**:\n```typescript\n{\n  strengths: string[];    // 2-4 items\n  weaknesses: string[];   // 2-4 items\n  opportunities: string[]; // 3-4 items\n  threats: string[];      // 1-3 items\n}\n```\n\n---\n\n### 7.7 ProDem Recommendation Algorithm\n\n**Algorithm**:\n```typescript\nfunction generateProDemRecommendation(audit: ProcessedAudit): ProDemResult {\n  const { zonaFinal, totalRealityScore, marginTimQ1, marginTimQ2, marginTimQ3, marginTimQ4 } = audit;\n  \n  const trend = analyzeTrend([marginTimQ1, marginTimQ2, marginTimQ3, marginTimQ4]);\n  \n  let recommendation: \"Promosi\" | \"Demotion\" | \"Hold\";\n  let reasoning: string;\n  let strategy: \"Save by Margin\" | \"Save by Staff\" | \"N/A\";\n  let timeline: string;\n  \n  // Decision Logic\n  if (zonaFinal === \"success\" && trend === \"upward\" && totalRealityScore >= 70) {\n    recommendation = \"Promosi\";\n    reasoning = \"Excellent performance across all metrics with consistent upward trend. Ready for increased responsibilities.\";\n    strategy = \"N/A\";\n    timeline = \"Immediate promotion consideration\";\n    \n  } else if (zonaFinal === \"critical\" && trend === \"downward\" && totalRealityScore < 50) {\n    recommendation = \"Demotion\";\n    reasoning = \"Sustained poor performance with declining trend. Current role may be beyond capability or fit.\";\n    strategy = \"Save by Staff\"; // Rotate to different team/role\n    timeline = \"3-month improvement plan, then re-evaluate\";\n    \n  } else if (zonaFinal === \"critical\" && trend === \"stable\") {\n    recommendation = \"Hold\";\n    reasoning = \"Performance below expectations but stable. Focus on targeted improvement.\";\n    strategy = \"Save by Margin\"; // Focus on improving key metrics\n    timeline = \"6-month improvement plan with quarterly checkpoints\";\n    \n  } else {\n    recommendation = \"Hold\";\n    reasoning = \"Moderate performance. Continue development and monitor progress.\";\n    strategy = zonaFinal === \"warning\" ? \"Save by Margin\" : \"N/A\";\n    timeline = \"Re-evaluate in 3 months\";\n  }\n  \n  return { recommendation, reasoning, strategy, timeline };\n}\n```\n\n**Decision Factors**:\n1. **Final Zone**: Primary indicator (success/warning/critical)\n2. **Trend**: Upward/downward/stable performance trajectory\n3. **Reality Score**: Overall competency level\n\n**Strategies**:\n- **Save by Margin**: Focus on improving performance metrics (margin, NA)\n- **Save by Staff**: Consider role change, team rotation, or additional support\n- **N/A**: Not applicable (for promotion or stable performance)\n\n---\n\n### 7.8 Action Plan 30-60-90 Generation\n\n**Algorithm**:\n```typescript\nfunction generateActionPlan(audit: ProcessedAudit, swot: SWOTAnalysis): ActionPlan {\n  const { zonaFinal, pillarAnswers } = audit;\n  \n  // Get bottom 3 pillars for targeted improvement\n  const weakPillars = pillarAnswers\n    .sort((a, b) => a.selfScore - b.selfScore)\n    .slice(0, 3);\n  \n  // 30 DAYS: Quick wins & foundational changes\n  const days30 = [\n    `Focus on improving ${getPillarName(weakPillars[0].pillarId)}`,\n    \"Set daily KPI tracking routine\",\n    \"Schedule weekly 1-on-1 with manager\",\n  ];\n  \n  if (zonaFinal === \"critical\") {\n    days30.push(\"Identify immediate performance blockers\");\n  }\n  \n  // 60 DAYS: Skill development & process improvement\n  const days60 = [\n    `Attend training for ${getPillarName(weakPillars[1].pillarId)}`,\n    \"Implement new customer acquisition strategies\",\n    \"Build stronger team collaboration processes\",\n  ];\n  \n  // 90 DAYS: Strategic initiatives & long-term goals\n  const days90 = [\n    `Master ${getPillarName(weakPillars[2].pillarId)} competency`,\n    \"Achieve quarterly targets with 10% buffer\",\n    \"Mentor 1-2 junior team members\",\n  ];\n  \n  if (zonaFinal === \"success\") {\n    days90.push(\"Prepare for leadership expansion opportunities\");\n  }\n  \n  return { days30, days60, days90 };\n}\n```\n\n**Output Structure**:\n```typescript\n{\n  days30: string[];  // 3-4 actionable items\n  days60: string[];  // 3-4 actionable items\n  days90: string[];  // 3-4 actionable items\n}\n```\n\n---\n\n### 7.9 Early Warning System (EWS)\n\n**Algorithm**:\n```typescript\nfunction generateEWS(audit: ProcessedAudit): EWS {\n  const redFlags: string[] = [];\n  let riskLevel: \"Low\" | \"Medium\" | \"High\";\n  const preventiveActions: string[] = [];\n  \n  // Check 1: Declining quarterly trend\n  const quarters = [audit.marginTimQ1, audit.marginTimQ2, audit.marginTimQ3, audit.marginTimQ4];\n  const trend = analyzeTrend(quarters);\n  \n  if (trend === \"downward\") {\n    redFlags.push(\"âš ï¸ Declining quarterly performance (3+ quarters)\");\n    preventiveActions.push(\"Immediate performance review with manager\");\n  }\n  \n  // Check 2: Low Reality Score\n  if (audit.totalRealityScore < 45) { // < 50% of max\n    redFlags.push(\"âš ï¸ Reality Score significantly below expectations\");\n    preventiveActions.push(\"Comprehensive skills assessment and training plan\");\n  }\n  \n  // Check 3: Critical zone persistence\n  if (audit.zonaFinal === \"critical\") {\n    redFlags.push(\"ðŸ”´ Performance in Critical zone\");\n    preventiveActions.push(\"30-day intensive improvement program\");\n  }\n  \n  // Check 4: High variance in behavioral scores\n  const variance = calculateVariance(audit.pillarAnswers.map(p => p.selfScore));\n  if (variance > 1.5) {\n    redFlags.push(\"âš ï¸ Highly inconsistent competency levels\");\n    preventiveActions.push(\"Focus on balanced skill development\");\n  }\n  \n  // Determine risk level\n  if (redFlags.length >= 3) {\n    riskLevel = \"High\";\n  } else if (redFlags.length >= 1) {\n    riskLevel = \"Medium\";\n  } else {\n    riskLevel = \"Low\";\n    redFlags.push(\"âœ… No immediate concerns detected\");\n    preventiveActions.push(\"Maintain current performance levels\");\n  }\n  \n  return { redFlags, riskLevel, preventiveActions };\n}\n```\n\n**Output Structure**:\n```typescript\n{\n  redFlags: string[];          // Detected issues\n  riskLevel: \"Low\" | \"Medium\" | \"High\";\n  preventiveActions: string[]; // Recommended interventions\n}\n```\n\n---\n\n### 7.10 Magic Section (Zodiac Motivation)\n\n**Algorithm**:\n```typescript\nfunction generateMagicSection(audit: ProcessedAudit): MagicSection {\n  // Calculate zodiac from birth date\n  const zodiac = calculateZodiac(audit.tanggalLahir);\n  \n  // Load zodiac-specific quotes from knowledge base\n  const quotes = loadZodiacQuotes(zodiac);\n  \n  // Select quote based on profil\n  const quote = selectQuote(quotes, audit.profil);\n  \n  // Generate booster message based on zona\n  const booster = generateBooster(audit.zonaFinal, zodiac);\n  \n  return { zodiac, quote, booster };\n}\n\nfunction calculateZodiac(tanggalLahir: string): string {\n  // Parse DD-MM-YYYY\n  const [day, month, year] = tanggalLahir.split(\"-\").map(Number);\n  \n  const zodiacDates = [\n    { sign: \"Capricorn\", start: [12, 22], end: [1, 19] },\n    { sign: \"Aquarius\", start: [1, 20], end: [2, 18] },\n    { sign: \"Pisces\", start: [2, 19], end: [3, 20] },\n    { sign: \"Aries\", start: [3, 21], end: [4, 19] },\n    { sign: \"Taurus\", start: [4, 20], end: [5, 20] },\n    { sign: \"Gemini\", start: [5, 21], end: [6, 20] },\n    { sign: \"Cancer\", start: [6, 21], end: [7, 22] },\n    { sign: \"Leo\", start: [7, 23], end: [8, 22] },\n    { sign: \"Virgo\", start: [8, 23], end: [9, 22] },\n    { sign: \"Libra\", start: [9, 23], end: [10, 22] },\n    { sign: \"Scorpio\", start: [10, 23], end: [11, 21] },\n    { sign: \"Sagittarius\", start: [11, 22], end: [12, 21] },\n  ];\n  \n  for (const { sign, start, end } of zodiacDates) {\n    const [startMonth, startDay] = start;\n    const [endMonth, endDay] = end;\n    \n    if (\n      (month === startMonth && day >= startDay) ||\n      (month === endMonth && day <= endDay)\n    ) {\n      return sign;\n    }\n  }\n  \n  return \"Capricorn\"; // Fallback\n}\n```\n\n**Knowledge Base Integration**:\n- Zodiac quotes loaded from `attached_assets/zodiac_*.txt`\n- Profile-based quote selection for personalization\n- Gamification element to increase engagement\n\n---\n\n## 8. Frontend Architecture\n\n### 8.1 Component Tree\n\n```\nApp (Router)\nâ”œâ”€â”€ HomePage (/)\nâ”‚   â”œâ”€â”€ Header\nâ”‚   â”œâ”€â”€ AuditCard[] (list of audits)\nâ”‚   â””â”€â”€ FloatingActionButton (+ New Audit)\nâ”‚\nâ”œâ”€â”€ NewAuditPage (/new-audit)\nâ”‚   â”œâ”€â”€ MultiStepForm (5 steps)\nâ”‚   â”‚   â”œâ”€â”€ Step1: PersonalInfoForm\nâ”‚   â”‚   â”œâ”€â”€ Step2: QuarterlyPerformanceForm\nâ”‚   â”‚   â”œâ”€â”€ Step3: TeamStructureForm\nâ”‚   â”‚   â”œâ”€â”€ Step4: PillarAssessmentForm (18 pillars)\nâ”‚   â”‚   â””â”€â”€ Step5: ReviewStep\nâ”‚   â””â”€â”€ ProgressIndicator\nâ”‚\nâ””â”€â”€ AuditDetailPage (/audit/:id)\n    â”œâ”€â”€ Header (back button, download PDF)\n    â”œâ”€â”€ AuditSummaryCard (Executive Summary)\n    â”œâ”€â”€ Tabs (12 sections)\n    â”‚   â”œâ”€â”€ RealityScoreSection\n    â”‚   â”œâ”€â”€ PerformanceZoneSection\n    â”‚   â”œâ”€â”€ BehavioralZoneSection\n    â”‚   â”œâ”€â”€ ProfilSection\n    â”‚   â”œâ”€â”€ SWOTSection\n    â”‚   â”œâ”€â”€ EWSSection\n    â”‚   â”œâ”€â”€ ActionPlanSection\n    â”‚   â”œâ”€â”€ ProDemSection\n    â”‚   â””â”€â”€ MagicSection\n    â”œâ”€â”€ FloatingChatButton (prominent with text)\n    â””â”€â”€ ChatPanel (sidebar overlay)\n        â”œâ”€â”€ ChatHeader (title + close button)\n        â”œâ”€â”€ MessageList (ScrollArea)\n        â””â”€â”€ ChatInput (form with send button)\n```\n\n### 8.2 State Management Strategy\n\n**Server State** (TanStack Query):\n```typescript\n// Audit list\nconst { data: audits } = useQuery<Audit[]>({\n  queryKey: [\"/api/audits\"],\n});\n\n// Single audit\nconst { data: audit } = useQuery<Audit>({\n  queryKey: [`/api/audit/${auditId}`],\n  enabled: !!auditId,\n});\n\n// Chat history\nconst { data: messages } = useQuery<ChatMessage[]>({\n  queryKey: [\"/api/chat\", auditId],\n});\n```\n\n**Form State** (React Hook Form):\n```typescript\nconst form = useForm<AuditFormData>({\n  resolver: zodResolver(auditSchema),\n  defaultValues: {\n    nama: \"\",\n    jabatan: \"\",\n    // ... all fields with defaults\n  },\n});\n\n// Access values\nconst nama = form.watch(\"nama\");\n\n// Set values\nform.setValue(\"marginTimQ1\", 50000);\n\n// Submit\nconst onSubmit = (data: AuditFormData) => {\n  createAuditMutation.mutate(data);\n};\n```\n\n**Local UI State** (useState):\n```typescript\n// Multi-step form current step\nconst [currentStep, setCurrentStep] = useState(1);\n\n// Chat panel open/closed\nconst [chatOpen, setChatOpen] = useState(false);\n\n// Loading states (handled by TanStack Query)\nconst { isLoading, isPending } = useQuery/useMutation;\n```\n\n### 8.3 Routing & Navigation\n\n**Routes** (`client/src/App.tsx`):\n```typescript\n<Switch>\n  <Route path=\"/\" component={HomePage} />\n  <Route path=\"/new-audit\" component={NewAuditPage} />\n  <Route path=\"/audit/:id\" component={AuditDetailPage} />\n  <Route component={NotFoundPage} />\n</Switch>\n```\n\n**Navigation Methods**:\n```typescript\nimport { useLocation } from \"wouter\";\n\nconst [, setLocation] = useLocation();\n\n// Programmatic navigation\nsetLocation(\"/audit/123\");\n\n// Link component\nimport { Link } from \"wouter\";\n<Link href=\"/new-audit\">Buat Audit Baru</Link>\n```\n\n### 8.4 Form Validation Flow\n\n```\nUser Input\n    â”‚\n    â–¼\nReact Hook Form\n(controlled components)\n    â”‚\n    â–¼\nReal-time Validation\n(onChange for UX)\n    â”‚\n    â–¼\nZod Schema Validation\n    â”‚\n    â”œâ”€ Valid â†’ Update form state\n    â”‚\n    â””â”€ Invalid â†’ Show error message\n           â”‚\n           â–¼\n    form.formState.errors\n           â”‚\n           â–¼\n    Display <FormMessage>\n    \nSubmit Button Click\n    â”‚\n    â–¼\nFinal Validation\n    â”‚\n    â”œâ”€ Valid â†’ Call mutation\n    â”‚    â”‚\n    â”‚    â–¼\n    â”‚   POST /api/audit\n    â”‚\n    â””â”€ Invalid â†’ Prevent submit\n             Show all errors\n```\n\n**Example Validation**:\n```typescript\nconst auditSchema = z.object({\n  nama: z.string().min(1, \"Nama wajib diisi\"),\n  jabatan: z.string().min(1, \"Jabatan wajib dipilih\"),\n  marginTimQ1: z.number().min(0, \"Margin tidak boleh negatif\"),\n  pillarAnswers: z.array(z.object({\n    pillarId: z.number().min(1).max(18),\n    selfScore: z.number().min(1).max(5),\n  })).length(18, \"Semua 18 pilar harus dinilai\"),\n});\n```\n\n### 8.5 Error Handling Patterns\n\n**Query Errors**:\n```typescript\nconst { data, error, isError } = useQuery({\n  queryKey: [\"/api/audit/123\"],\n  retry: 1, // Retry once on failure\n});\n\nif (isError) {\n  return (\n    <div>\n      <AlertCircle className=\"w-6 h-6 text-destructive\" />\n      <p>Error: {error.message}</p>\n      <Button onClick={() => refetch()}>Coba Lagi</Button>\n    </div>\n  );\n}\n```\n\n**Mutation Errors**:\n```typescript\nconst mutation = useMutation({\n  mutationFn: (data) => apiRequest(\"POST\", \"/api/audit\", data),\n  onError: (error) => {\n    toast({\n      title: \"Error\",\n      description: error.message,\n      variant: \"destructive\",\n    });\n  },\n  onSuccess: (data) => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/audits\"] });\n    setLocation(`/audit/${data.id}`);\n  },\n});\n```\n\n### 8.6 Performance Optimizations\n\n**Code Splitting** (Vite automatic):\n```typescript\n// Each route component is lazy-loaded\nimport HomePage from \"./pages/HomePage\"; // Bundled separately\n```\n\n**Memoization**:\n```typescript\n// Expensive calculations\nconst processedData = useMemo(() => {\n  return complexCalculation(audit);\n}, [audit]);\n\n// Callbacks\nconst handleClick = useCallback(() => {\n  doSomething(id);\n}, [id]);\n```\n\n**Debouncing** (search input):\n```typescript\nimport { useDebounce } from \"@/hooks/use-debounce\";\n\nconst [search, setSearch] = useState(\"\");\nconst debouncedSearch = useDebounce(search, 300); // 300ms delay\n\n// Only queries when user stops typing\nconst { data } = useQuery({\n  queryKey: [\"/api/audits/name\", debouncedSearch],\n  enabled: debouncedSearch.length > 0,\n});\n```\n\n**Virtual Scrolling** (future enhancement for large lists):\n```typescript\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\n// Render only visible items in long audit lists\n```\n\n---\n\n## 9. Backend Architecture\n\n### 9.1 Express Middleware Stack\n\n```typescript\n// server/index.ts\n\nimport express from \"express\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\n\nconst app = express();\n\n// 1. JSON body parser\napp.use(express.json());\n\n// 2. URL-encoded body parser\napp.use(express.urlencoded({ extended: true }));\n\n// 3. Session middleware (configured but auth not implemented)\nconst PgSession = connectPgSimple(session);\napp.use(session({\n  store: new PgSession({\n    conString: process.env.DATABASE_URL,\n  }),\n  secret: process.env.SESSION_SECRET || \"default-secret\",\n  resave: false,\n  saveUninitialized: false,\n  cookie: { maxAge: 30 * 24 * 60 * 60 * 1000 } // 30 days\n}));\n\n// 4. Custom logging middleware\napp.use((req, res, next) => {\n  const start = Date.now();\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    console.log(`[express] ${req.method} ${req.path} ${res.statusCode} in ${duration}ms`);\n  });\n  next();\n});\n\n// 5. API routes\nimport { registerRoutes } from \"./routes\";\nregisterRoutes(app);\n\n// 6. Vite middleware (development only)\nif (process.env.NODE_ENV === \"development\") {\n  const { setupVite } = await import(\"./vite\");\n  await setupVite(app);\n}\n\n// 7. Error handling middleware (implicit - Express default)\n```\n\n**Request Flow**:\n```\nHTTP Request\n    â”‚\n    â–¼\n1. JSON Parser â†’ req.body available\n    â”‚\n    â–¼\n2. Session Middleware â†’ req.session available (not used yet)\n    â”‚\n    â–¼\n3. Logging Middleware â†’ Console log\n    â”‚\n    â–¼\n4. Route Handler â†’ Custom business logic\n    â”‚\n    â–¼\n5. Response sent â†’ res.json() or res.status().json()\n```\n\n### 9.2 Storage Interface Pattern\n\n**File**: `server/storage.ts`\n\n**Interface Definition**:\n```typescript\nexport interface IStorage {\n  // Audit operations\n  createAudit(audit: InsertAudit): Promise<Audit>;\n  getAllAudits(): Promise<Audit[]>;\n  getAudit(id: string): Promise<Audit | undefined>;\n  getAuditsByName(name: string): Promise<Audit[]>;\n  deleteAudit(id: string): Promise<void>;\n  \n  // Chat operations\n  createChatMessage(message: InsertChatMessage): Promise<ChatMessage>;\n  getChatHistory(auditId: string): Promise<ChatMessage[]>;\n  deleteChatHistory(auditId: string): Promise<void>;\n}\n```\n\n**PostgreSQL Implementation**:\n```typescript\nexport class PostgresStorage implements IStorage {\n  private db: NodePgDatabase<typeof schema>;\n  \n  constructor(connectionString: string) {\n    const client = new Pool({ connectionString });\n    this.db = drizzle(client, { schema });\n  }\n  \n  async createAudit(audit: InsertAudit): Promise<Audit> {\n    const [created] = await this.db\n      .insert(schema.audits)\n      .values(audit)\n      .returning();\n    return created;\n  }\n  \n  async getAllAudits(): Promise<Audit[]> {\n    return this.db\n      .select()\n      .from(schema.audits)\n      .orderBy(desc(schema.audits.createdAt));\n  }\n  \n  // ... more methods\n}\n```\n\n**Benefits**:\n1. **Abstraction**: Easy to swap PostgreSQL for MongoDB, etc.\n2. **Testability**: Mock storage for unit tests\n3. **Type Safety**: TypeScript enforces interface contract\n\n### 9.3 Error Handling Strategy\n\n**Try-Catch Pattern**:\n```typescript\napp.post(\"/api/audit\", async (req, res) => {\n  try {\n    // 1. Validation\n    const data = auditSchema.parse(req.body);\n    \n    // 2. Business logic\n    const processed = processAudit(data);\n    \n    // 3. Database operation\n    const audit = await storage.createAudit(processed);\n    \n    // 4. Success response\n    res.json(audit);\n    \n  } catch (error) {\n    // Error handling\n    if (error instanceof z.ZodError) {\n      // Validation error\n      res.status(400).json({\n        error: \"Validation error\",\n        details: fromZodError(error).message,\n      });\n    } else {\n      // Unexpected error\n      console.error(\"Error creating audit:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  }\n});\n```\n\n**OpenAI-Specific Error Handling**:\n```typescript\ntry {\n  const completion = await openai.chat.completions.create({...});\n  // Success\n} catch (error) {\n  const errorMessage = error instanceof Error ? error.message : String(error);\n  \n  if (errorMessage.includes(\"rate\") || errorMessage.includes(\"quota\") || errorMessage.includes(\"429\")) {\n    res.status(429).json({\n      error: \"AI service rate limit\",\n      userMessage: \"Maaf, layanan AI sedang mencapai batas penggunaan.\",\n    });\n  } else {\n    res.status(500).json({\n      error: \"Internal server error\",\n      userMessage: \"Maaf, terjadi kesalahan saat menghubungi AI.\",\n    });\n  }\n}\n```\n\n### 9.4 OpenAI Integration Architecture\n\n**Client Configuration** (`server/openai.ts`):\n```typescript\nimport OpenAI from \"openai\";\n\nexport const openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n```\n\n**Chat Completion Flow**:\n```\n1. User sends message\n   â”‚\n   â–¼\n2. Save user message to DB\n   â”‚\n   â–¼\n3. Load chat history (last 10)\n   â”‚\n   â–¼\n4. Build system prompt with audit context\n   â”‚\n   â–¼\n5. Construct messages array:\n   [\n     { role: \"system\", content: systemPrompt },\n     { role: \"user\", content: \"first user message\" },\n     { role: \"assistant\", content: \"first AI response\" },\n     ...\n     { role: \"user\", content: \"current message\" }\n   ]\n   â”‚\n   â–¼\n6. Call OpenAI API:\n   openai.chat.completions.create({\n     model: \"gpt-4o\",\n     messages: [...],\n     max_tokens: 500,\n     temperature: 0.7\n   })\n   â”‚\n   â–¼\n7. Extract response:\n   completion.choices[0].message.content\n   â”‚\n   â–¼\n8. Save AI response to DB\n   â”‚\n   â–¼\n9. Return to frontend\n```\n\n**System Prompt Template**:\n```typescript\nconst systemPrompt = `Anda adalah AI coach profesional untuk AISG (Audit Intelligence SG). \nAnda membantu karyawan memahami hasil audit performa mereka.\n\nDATA AUDIT:\n- Nama: ${audit.nama}\n- Jabatan: ${audit.jabatan}\n- Reality Score: ${audit.totalRealityScore}/90\n- Profil: ${audit.profil}\n- Zona: ${audit.zonaFinal}\n- ProDem: ${audit.prodemRekomendasi.recommendation}\n\nTUGAS ANDA:\n1. Jawab pertanyaan tentang hasil audit dengan jelas dan supportif\n2. Berikan insight actionable berdasarkan data audit\n3. Motivasi karyawan untuk improve dengan tone profesional namun friendly\n4. Jika ditanya tentang strategi improvement, refer ke Action Plan 30-60-90\n5. Gunakan Bahasa Indonesia yang profesional\n\nJawab dengan concise (2-3 paragraf max), fokus pada value bukan panjang teks.`;\n```\n\n**Token Management**:\n- Input tokens: System prompt + history â‰ˆ 800-1000 tokens\n- Output tokens: Max 500 (configured)\n- Total cost per chat: ~$0.0025 (very cheap!)\n\n---\n\n## 10. Code Structure & Conventions\n\n### 10.1 Directory Structure\n\n```\naisg/\nâ”œâ”€â”€ client/                    # Frontend React application\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ components/        # Reusable UI components\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ui/           # shadcn components (Button, Card, etc.)\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ChatPanel.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ AuditCard.tsx\nâ”‚   â”‚   â”‚   â””â”€â”€ ...\nâ”‚   â”‚   â”œâ”€â”€ pages/            # Route components\nâ”‚   â”‚   â”‚   â”œâ”€â”€ HomePage.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ NewAudit.tsx\nâ”‚   â”‚   â”‚   â””â”€â”€ AuditDetail.tsx\nâ”‚   â”‚   â”œâ”€â”€ lib/              # Utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ queryClient.ts\nâ”‚   â”‚   â”‚   â””â”€â”€ utils.ts\nâ”‚   â”‚   â”œâ”€â”€ hooks/            # Custom hooks\nâ”‚   â”‚   â”‚   â””â”€â”€ use-toast.ts\nâ”‚   â”‚   â”œâ”€â”€ App.tsx           # Root component (router)\nâ”‚   â”‚   â”œâ”€â”€ main.tsx          # Entry point\nâ”‚   â”‚   â””â”€â”€ index.css         # Global styles + Tailwind\nâ”‚   â””â”€â”€ index.html\nâ”‚\nâ”œâ”€â”€ server/                   # Backend Express application\nâ”‚   â”œâ”€â”€ routes.ts             # API route handlers\nâ”‚   â”œâ”€â”€ business-logic.ts     # Audit processing algorithms\nâ”‚   â”œâ”€â”€ storage.ts            # Database abstraction (IStorage)\nâ”‚   â”œâ”€â”€ openai.ts             # OpenAI client configuration\nâ”‚   â”œâ”€â”€ index.ts              # Express server entry point\nâ”‚   â””â”€â”€ vite.ts               # Vite middleware (dev only)\nâ”‚\nâ”œâ”€â”€ shared/                   # Shared TypeScript code\nâ”‚   â””â”€â”€ schema.ts             # Drizzle schema + Zod validation\nâ”‚\nâ”œâ”€â”€ attached_assets/          # Knowledge base files\nâ”‚   â”œâ”€â”€ 18_pilar_*.txt\nâ”‚   â”œâ”€â”€ prodem_*.txt\nâ”‚   â”œâ”€â”€ zodiac_*.txt\nâ”‚   â””â”€â”€ AISG_Manual_Book.txt\nâ”‚\nâ”œâ”€â”€ migrations/               # Database migrations (auto-generated)\nâ”‚   â””â”€â”€ 0000_*.sql\nâ”‚\nâ”œâ”€â”€ .config/                  # Config files\nâ”‚\nâ”œâ”€â”€ package.json              # Dependencies & scripts\nâ”œâ”€â”€ tsconfig.json             # TypeScript config\nâ”œâ”€â”€ tailwind.config.ts        # Tailwind config\nâ”œâ”€â”€ vite.config.ts            # Vite config\nâ”œâ”€â”€ drizzle.config.ts         # Drizzle ORM config\nâ”œâ”€â”€ replit.md                 # System documentation\nâ””â”€â”€ AISG_Technical_Documentation.md  # This file\n```\n\n### 10.2 Naming Conventions\n\n**Files**:\n- React components: `PascalCase.tsx` (e.g., `HomePage.tsx`)\n- Utilities: `camelCase.ts` (e.g., `queryClient.ts`)\n- Config files: `kebab-case.ts` (e.g., `tailwind.config.ts`)\n\n**Variables & Functions**:\n- Variables: `camelCase` (e.g., `auditData`, `totalScore`)\n- Functions: `camelCase` (e.g., `calculateRealityScore`, `generateSWOT`)\n- React components: `PascalCase` (e.g., `ChatPanel`, `AuditCard`)\n- Constants: `UPPER_SNAKE_CASE` (e.g., `MAX_REALITY_SCORE = 90`)\n\n**Types & Interfaces**:\n- Types: `PascalCase` (e.g., `Audit`, `ChatMessage`)\n- Interfaces: `PascalCase` with `I` prefix for abstract interfaces (e.g., `IStorage`)\n\n**Database**:\n- Table names: `camelCase` (e.g., `audits`, `chatMessages`)\n- Column names: `snake_case` in SQL, `camelCase` in TypeScript (Drizzle handles mapping)\n\n**API Routes**:\n- RESTful conventions: `/api/resource` and `/api/resource/:id`\n- Kebab-case for multi-word: `/api/chat-history` (not used currently)\n\n### 10.3 TypeScript Patterns\n\n**Shared Types** (`shared/schema.ts`):\n```typescript\n// Drizzle schema (source of truth)\nexport const audits = pgTable(\"audits\", {\n  id: varchar(\"id\").primaryKey(),\n  nama: varchar(\"nama\").notNull(),\n  // ...\n});\n\n// Inferred types\nexport type Audit = typeof audits.$inferSelect;\nexport type InsertAudit = typeof audits.$inferInsert;\n\n// Zod schemas for validation\nexport const insertAuditSchema = createInsertSchema(audits).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const selectAuditSchema = createSelectSchema(audits);\n```\n\n**Type Imports** (consistent across codebase):\n```typescript\nimport type { Audit, ChatMessage } from \"@shared/schema\";\n```\n\n**Generic Typing**:\n```typescript\n// TanStack Query\nconst { data } = useQuery<Audit>({ queryKey: [...] });\n\n// Array methods\nconst topPillars = pillarAnswers\n  .sort((a, b) => b.selfScore - a.selfScore)\n  .slice(0, 3)\n  .map((p): string => getPillarName(p.pillarId));\n```\n\n### 10.4 Import Aliases\n\n**Configured in `tsconfig.json` and `vite.config.ts`**:\n```json\n{\n  \"compilerOptions\": {\n    \"paths\": {\n      \"@/*\": [\"./client/src/*\"],\n      \"@shared/*\": [\"./shared/*\"],\n      \"@assets/*\": [\"./attached_assets/*\"]\n    }\n  }\n}\n```\n\n**Usage**:\n```typescript\n// Instead of: import { Button } from \"../../components/ui/button\"\nimport { Button } from \"@/components/ui/button\";\n\n// Instead of: import type { Audit } from \"../../shared/schema\"\nimport type { Audit } from \"@shared/schema\";\n\n// Assets (images, etc.)\nimport logoPath from \"@assets/logo.png\";\n```\n\n### 10.5 Comment Conventions\n\n**Minimal Comments** (code should be self-documenting):\n```typescript\n// âŒ Bad (obvious comment)\n// Get audit by ID\nconst audit = await storage.getAudit(id);\n\n// âœ… Good (explains \"why\", not \"what\")\n// User message must be saved BEFORE calling OpenAI\n// to ensure it persists even if API call fails\nawait storage.createChatMessage({ auditId, role: \"user\", content: message });\nconst aiResponse = await callOpenAI(message);\n```\n\n**Function Documentation** (JSDoc for complex functions):\n```typescript\n/**\n * Calculates Reality Score by summing all 18 Pilar self-assessment scores\n * @param pillarAnswers - Array of 18 pillar assessments (1-5 scale)\n * @returns Total score (0-90)\n */\nfunction calculateRealityScore(pillarAnswers: PillarAnswer[]): number {\n  return pillarAnswers.reduce((sum, p) => sum + p.selfScore, 0);\n}\n```\n\n**TODO Comments**:\n```typescript\n// TODO: Add pagination for large audit lists\n// TODO: Implement real-time streaming for AI responses\n// FIXME: Handle edge case where all quarterly values are 0\n```\n\n---\n\n## 11. Error Handling & Validation\n\n### 11.1 Validation Layers\n\n**Layer 1: Frontend (React Hook Form + Zod)**\n```typescript\n// Immediate feedback to user\nconst form = useForm({\n  resolver: zodResolver(schema),\n});\n\n// Validation runs:\n// - onChange (real-time)\n// - onBlur (when field loses focus)\n// - onSubmit (before API call)\n```\n\n**Layer 2: Backend (Zod)**\n```typescript\n// Server-side validation (defense in depth)\nconst schema = z.object({\n  nama: z.string().min(1),\n  marginTimQ1: z.number().min(0),\n  // ...\n});\n\nconst data = schema.parse(req.body);\n// Throws ZodError if invalid\n```\n\n**Layer 3: Database (PostgreSQL Constraints)**\n```sql\n-- Enforced at DB level\nnama VARCHAR(255) NOT NULL,\nmargin_tim_q1 INTEGER DEFAULT 0,\n-- Foreign key constraints\naudit_id VARCHAR REFERENCES audits(id) ON DELETE CASCADE\n```\n\n### 11.2 Error Response Standards\n\n**Consistent Error Format**:\n```typescript\n// Validation error (400)\n{\n  error: \"Validation error\",\n  details: \"nama: Required field missing\"\n}\n\n// Not found (404)\n{\n  error: \"Audit not found\"\n}\n\n// Rate limit (429)\n{\n  error: \"AI service rate limit\",\n  userMessage: \"Maaf, layanan AI sedang mencapai batas penggunaan.\"\n}\n\n// Server error (500)\n{\n  error: \"Internal server error\",\n  userMessage: \"Maaf, terjadi kesalahan. Silakan coba lagi.\"\n}\n```\n\n**userMessage Field**:\n- User-facing error message (Bahasa Indonesia)\n- Only included for expected errors (quota, validation, etc.)\n- Frontend displays this in toast notification\n\n### 11.3 Logging Strategy\n\n**Console Logging** (current):\n```typescript\n// Request logging\nconsole.log(\"[express] GET /api/audits 200 in 45ms\");\n\n// Chat logging\nconsole.log(\"[CHAT] Calling OpenAI API with messages:\", messages.length);\nconsole.log(\"[CHAT] OpenAI response received:\", { choices: 1, content: \"...\" });\n\n// Error logging\nconsole.error(\"Error creating audit:\", error);\n```\n\n**Structured Logging** (future enhancement):\n```typescript\nimport winston from \"winston\";\n\nlogger.info(\"Audit created\", {\n  auditId: \"123\",\n  userId: \"456\",\n  timestamp: new Date(),\n});\n\nlogger.error(\"OpenAI API failed\", {\n  error: error.message,\n  auditId: \"123\",\n  retries: 1,\n});\n```\n\n---\n\n## 12. Deployment & DevOps\n\n### 12.1 Development Environment\n\n**Setup**:\n```bash\n# Install dependencies\nnpm install\n\n# Start development server\nnpm run dev\n# Opens Express (backend) + Vite (frontend) on http://localhost:5000\n```\n\n**Environment Variables** (`.env` - not committed):\n```env\nDATABASE_URL=postgresql://...\nOPENAI_API_KEY=sk-...\nSESSION_SECRET=random-secret\nNODE_ENV=development\n```\n\n**Hot Module Replacement (HMR)**:\n- Vite handles frontend HMR (instant updates)\n- `tsx` watches server files (auto-restart on change)\n- Database schema changes require manual migration\n\n### 12.2 Database Migrations\n\n**Workflow**:\n```bash\n# 1. Edit schema in shared/schema.ts\n# 2. Generate migration\nnpm run db:generate\n\n# 3. Review migration in migrations/XXXX_*.sql\n# 4. Apply migration (development)\nnpm run db:push\n\n# 5. For production, use Replit Publishing UI\n```\n\n**Production Migration**:\n- Replit detects schema changes during deployment\n- Conflict resolution wizard appears\n- Choose \"Rename\" or \"Create new\" for each column change\n- Database migrated safely with zero downtime\n\n### 12.3 Production Deployment (Replit)\n\n**Deployment Process**:\n```\n1. Click \"Deploy\" button in Replit UI\n   â”‚\n   â–¼\n2. PROVISION Phase\n   â”œâ”€ Detect database changes\n   â”œâ”€ Show conflict resolution wizard\n   â””â”€ Apply migrations\n   â”‚\n   â–¼\n3. BUILD Phase\n   â”œâ”€ Install dependencies (npm install)\n   â”œâ”€ Run Vite build (npm run build)\n   â””â”€ Compile TypeScript\n   â”‚\n   â–¼\n4. BUNDLE Phase\n   â”œâ”€ Package frontend assets\n   â””â”€ Prepare server code\n   â”‚\n   â–¼\n5. PROMOTE Phase\n   â”œâ”€ Deploy to production URL\n   â”œâ”€ Health check\n   â””â”€ Switch traffic to new version\n   â”‚\n   â–¼\n6. DONE\n   Production URL: https://aisg23.replit.app\n```\n\n**Environment** (Production):\n- Node.js 20.x\n- PostgreSQL 16 (Neon)\n- Always-on (Replit Core plan)\n- HTTPS automatic (Replit)\n- Custom domain support (optional)\n\n**Secrets Management**:\n- Secrets stored in Replit Secrets (encrypted)\n- Accessed via `process.env.SECRET_NAME`\n- Not exposed in logs or client-side code\n\n### 12.4 Monitoring & Observability\n\n**Current Monitoring**:\n- Replit built-in logs (console output)\n- Browser console errors (client-side)\n- HTTP status codes in logs\n\n**Recommended Future Monitoring**:\n1. **Application Performance Monitoring (APM)**:\n   - New Relic, Datadog, or Sentry\n   - Track API response times\n   - Identify slow database queries\n\n2. **Error Tracking**:\n   - Sentry for both frontend and backend\n   - Capture stack traces\n   - Group similar errors\n\n3. **Database Monitoring**:\n   - Neon dashboard (query performance)\n   - Slow query log\n   - Connection pool stats\n\n4. **Uptime Monitoring**:\n   - Uptime Robot or Pingdom\n   - Alert on downtime\n   - Health check endpoint: `GET /health`\n\n**Health Check Endpoint** (to implement):\n```typescript\napp.get(\"/health\", async (req, res) => {\n  try {\n    // Check database connection\n    await storage.getAllAudits();\n    \n    res.json({\n      status: \"healthy\",\n      timestamp: new Date().toISOString(),\n      database: \"connected\",\n    });\n  } catch (error) {\n    res.status(500).json({\n      status: \"unhealthy\",\n      timestamp: new Date().toISOString(),\n      database: \"disconnected\",\n    });\n  }\n});\n```\n\n### 12.5 Backup & Recovery\n\n**Database Backups**:\n- Neon provides automatic backups (7-day retention on free tier)\n- Manual backups: Export SQL dump via Neon dashboard\n- Point-in-time recovery (PITR) available on paid plans\n\n**Code Backups**:\n- Git repository (Replit auto-commits)\n- Manual git backup to GitHub/GitLab recommended\n\n**Recovery Procedure**:\n1. **Database Corruption**:\n   - Restore from Neon backup (via dashboard)\n   - Re-run migrations if needed\n\n2. **Code Rollback**:\n   - Revert to previous Git commit\n   - Redeploy via Replit\n\n3. **Full Disaster**:\n   - Create new Replit instance\n   - Restore database from backup\n   - Deploy latest code\n\n### 12.6 CI/CD Pipeline (Future)\n\n**Recommended Setup**:\n```yaml\n# .github/workflows/ci.yml (if using GitHub)\nname: CI/CD\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - uses: actions/setup-node@v3\n        with:\n          node-version: 20\n      - run: npm install\n      - run: npm run typecheck\n      - run: npm run test # (if tests exist)\n  \n  deploy:\n    needs: test\n    if: github.ref == 'refs/heads/main'\n    runs-on: ubuntu-latest\n    steps:\n      - name: Deploy to Replit\n        run: |\n          # Replit CLI deployment\n          replit deploy\n```\n\n---\n\n## 13. Security Considerations\n\n### 13.1 Current Security Posture\n\n**âœ… Implemented**:\n- HTTPS (automatic via Replit)\n- Environment secrets (not in code)\n- SQL injection prevention (Drizzle parameterized queries)\n- XSS protection (React escapes by default)\n- JSONB validation (Zod schemas)\n\n**âŒ Not Implemented (CRITICAL)**:\n- Authentication (anyone can access all data)\n- Authorization (no role-based access control)\n- Rate limiting (vulnerable to DoS)\n- CSRF protection\n- Input sanitization (beyond Zod)\n- Audit logging (who did what when)\n\n### 13.2 Security Recommendations\n\n**Priority 1: Authentication**\n```typescript\n// Implement session-based auth\nimport passport from \"passport\";\nimport LocalStrategy from \"passport-local\";\n\npassport.use(new LocalStrategy(\n  async (username, password, done) => {\n    const user = await storage.getUserByUsername(username);\n    if (!user) return done(null, false);\n    \n    const valid = await bcrypt.compare(password, user.password);\n    if (!valid) return done(null, false);\n    \n    return done(null, user);\n  }\n));\n\n// Protect routes\nconst requireAuth = (req, res, next) => {\n  if (!req.isAuthenticated()) {\n    return res.status(401).json({ error: \"Unauthorized\" });\n  }\n  next();\n};\n\napp.post(\"/api/audit\", requireAuth, async (req, res) => {\n  // Only authenticated users can create audits\n});\n```\n\n**Priority 2: Authorization**\n```typescript\n// Role-based access control\nconst requireRole = (role: string) => (req, res, next) => {\n  if (req.user.role !== role) {\n    return res.status(403).json({ error: \"Forbidden\" });\n  }\n  next();\n};\n\n// Employees can only view their own audits\napp.get(\"/api/audit/:id\", requireAuth, async (req, res) => {\n  const audit = await storage.getAudit(req.params.id);\n  \n  if (req.user.role !== \"admin\" && audit.userId !== req.user.id) {\n    return res.status(403).json({ error: \"Forbidden\" });\n  }\n  \n  res.json(audit);\n});\n```\n\n**Priority 3: Rate Limiting**\n```typescript\nimport rateLimit from \"express-rate-limit\";\n\n// Global rate limit\napp.use(rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // 100 requests per window\n  message: \"Too many requests, please try again later\",\n}));\n\n// Chat endpoint (stricter limit)\nconst chatLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 minute\n  max: 10, // 10 requests per minute\n});\n\napp.post(\"/api/chat\", chatLimiter, async (req, res) => {\n  // ...\n});\n```\n\n**Priority 4: Input Sanitization**\n```typescript\nimport DOMPurify from \"isomorphic-dompurify\";\n\n// Sanitize user input before storing\nconst sanitizedMessage = DOMPurify.sanitize(req.body.message);\n```\n\n**Priority 5: CSRF Protection**\n```typescript\nimport csrf from \"csurf\";\n\nconst csrfProtection = csrf({ cookie: true });\n\napp.post(\"/api/audit\", csrfProtection, async (req, res) => {\n  // CSRF token validated automatically\n});\n```\n\n### 13.3 Secrets Management\n\n**Current**:\n- Secrets stored in Replit Secrets (encrypted)\n- Accessed via `process.env`\n\n**Best Practices**:\n```typescript\n// âœ… Good\nconst apiKey = process.env.OPENAI_API_KEY;\nif (!apiKey) {\n  throw new Error(\"OPENAI_API_KEY not configured\");\n}\n\n// âŒ Bad (never log secrets!)\nconsole.log(\"API Key:\", process.env.OPENAI_API_KEY);\n\n// âŒ Bad (never send to client!)\nres.json({ apiKey: process.env.OPENAI_API_KEY });\n```\n\n**Secret Rotation**:\n1. Generate new secret\n2. Update in Replit Secrets\n3. Restart application (automatic)\n4. Revoke old secret\n\n### 13.4 Data Privacy\n\n**GDPR Considerations** (future):\n- **Right to Access**: Provide audit data export\n- **Right to Erasure**: Implement DELETE /api/audit/:id (already done)\n- **Right to Portability**: PDF export (already done)\n- **Consent Management**: Add consent checkboxes\n\n**Encryption**:\n- **In Transit**: HTTPS (Replit automatic)\n- **At Rest**: Not implemented (PostgreSQL default storage)\n  - Recommendation: Enable Neon encryption (paid plan)\n\n**Audit Logging**:\n```typescript\n// Track who did what when\nconst auditLog = {\n  userId: req.user.id,\n  action: \"CREATE_AUDIT\",\n  resourceId: audit.id,\n  timestamp: new Date(),\n  ipAddress: req.ip,\n};\nawait storage.createAuditLog(auditLog);\n```\n\n---\n\n## 14. Performance Optimization\n\n### 14.1 Database Query Optimization\n\n**Current Queries**:\n```typescript\n// Get all audits (could be slow with 10K+ audits)\nconst audits = await db\n  .select()\n  .from(schema.audits)\n  .orderBy(desc(schema.audits.createdAt));\n```\n\n**Optimizations**:\n```typescript\n// Add pagination\nconst audits = await db\n  .select()\n  .from(schema.audits)\n  .orderBy(desc(schema.audits.createdAt))\n  .limit(20)\n  .offset((page - 1) * 20);\n\n// Add indexes (see Section 5.3)\nCREATE INDEX idx_audits_created_at ON audits(created_at DESC);\n\n// Select only needed columns (avoid SELECT *)\nconst audits = await db\n  .select({\n    id: schema.audits.id,\n    nama: schema.audits.nama,\n    zonaFinal: schema.audits.zonaFinal,\n    createdAt: schema.audits.createdAt,\n  })\n  .from(schema.audits);\n```\n\n### 14.2 Frontend Optimization\n\n**Current**:\n- Code splitting (Vite automatic)\n- React Query caching\n- Lazy loading (not used yet)\n\n**Future Optimizations**:\n```typescript\n// Lazy load routes\nconst HomePage = lazy(() => import(\"./pages/HomePage\"));\nconst AuditDetail = lazy(() => import(\"./pages/AuditDetail\"));\n\n<Suspense fallback={<LoadingSpinner />}>\n  <Routes />\n</Suspense>\n\n// Image optimization\nimport { Image } from \"@/components/OptimizedImage\";\n<Image src=\"/logo.png\" width={200} height={100} alt=\"Logo\" />\n\n// Virtual scrolling for large lists\nimport { useVirtualizer } from \"@tanstack/react-virtual\";\n```\n\n### 14.3 Caching Strategy\n\n**Browser Caching** (Vite automatic):\n```\nStatic assets (JS, CSS, images):\n  Cache-Control: public, max-age=31536000, immutable\n  (1 year cache with content hashing)\n```\n\n**API Response Caching** (future):\n```typescript\nimport NodeCache from \"node-cache\";\n\nconst cache = new NodeCache({ stdTTL: 300 }); // 5 minutes\n\napp.get(\"/api/audits\", async (req, res) => {\n  const cached = cache.get(\"all-audits\");\n  if (cached) {\n    return res.json(cached);\n  }\n  \n  const audits = await storage.getAllAudits();\n  cache.set(\"all-audits\", audits);\n  res.json(audits);\n});\n\n// Invalidate cache on mutation\napp.post(\"/api/audit\", async (req, res) => {\n  const audit = await storage.createAudit(data);\n  cache.del(\"all-audits\"); // Invalidate\n  res.json(audit);\n});\n```\n\n**CDN** (future):\n- Serve static assets via CDN (Cloudflare, etc.)\n- Cache audit PDFs for repeat downloads\n\n### 14.4 Bundle Size Optimization\n\n**Current Bundle** (Vite production build):\n```\ndist/assets/index-[hash].js    ~250 KB (gzipped)\ndist/assets/index-[hash].css   ~15 KB (gzipped)\n```\n\n**Optimizations**:\n```bash\n# Analyze bundle\nnpm run build\nnpx vite-bundle-visualizer\n\n# Tree-shaking (automatic with Vite)\n# Import only what you need\nimport { Button } from \"@/components/ui/button\";\n// Instead of: import * as UI from \"@/components/ui\";\n\n# Remove unused dependencies\nnpm prune\n```\n\n### 14.5 OpenAI API Optimization\n\n**Current Cost**: ~$0.0025 per chat interaction\n\n**Optimizations**:\n```typescript\n// 1. Reduce max_tokens (less output = lower cost)\nmax_tokens: 300, // Instead of 500\n\n// 2. Cache common questions (future)\nconst commonQuestions = {\n  \"bagaimana performa saya\": \"Berdasarkan Reality Score Anda...\",\n  // ...\n};\n\nif (commonQuestions[message.toLowerCase()]) {\n  return res.json({ response: commonQuestions[message.toLowerCase()] });\n}\n\n// 3. Use cheaper model for simple questions (future)\nconst isSimple = message.length < 50;\nconst model = isSimple ? \"gpt-3.5-turbo\" : \"gpt-4o\";\n\n// 4. Batch multiple questions (future)\n// Allow users to ask multiple questions in one call\n```\n\n---\n\n## 15. Testing Strategy\n\n### 15.1 Current Testing Status\n\n**âœ… E2E Testing** (Manual via Playwright):\n- Audit creation flow (5 steps)\n- AI chat interaction\n- PDF download\n- Audit deletion\n\n**âŒ Not Implemented**:\n- Unit tests\n- Integration tests\n- Automated E2E tests\n- Load testing\n\n### 15.2 Recommended Testing Pyramid\n\n```\n        /\\\n       /E2E\\         10% - Full user flows\n      /______\\\n     /        \\\n    /Integration\\   30% - API + DB + External services\n   /______________\\\n  /                \\\n /   Unit Tests     \\ 60% - Business logic, utilities\n/____________________\\\n```\n\n### 15.3 Unit Testing Setup\n\n**Framework**: Vitest (Vite-native)\n\n```bash\nnpm install -D vitest @testing-library/react @testing-library/jest-dom\n```\n\n**Example Unit Tests**:\n```typescript\n// server/business-logic.test.ts\nimport { describe, it, expect } from \"vitest\";\nimport { calculateRealityScore } from \"./business-logic\";\n\ndescribe(\"calculateRealityScore\", () => {\n  it(\"should sum all pillar scores\", () => {\n    const pillars = [\n      { pillarId: 1, selfScore: 3 },\n      { pillarId: 2, selfScore: 4 },\n      { pillarId: 3, selfScore: 5 },\n    ];\n    \n    expect(calculateRealityScore(pillars)).toBe(12);\n  });\n  \n  it(\"should return 0 for empty array\", () => {\n    expect(calculateRealityScore([])).toBe(0);\n  });\n  \n  it(\"should handle max score (90)\", () => {\n    const pillars = Array.from({ length: 18 }, (_, i) => ({\n      pillarId: i + 1,\n      selfScore: 5,\n    }));\n    \n    expect(calculateRealityScore(pillars)).toBe(90);\n  });\n});\n```\n\n**Component Tests**:\n```typescript\n// client/src/components/AuditCard.test.tsx\nimport { render, screen } from \"@testing-library/react\";\nimport { AuditCard } from \"./AuditCard\";\n\ndescribe(\"AuditCard\", () => {\n  it(\"should display audit name\", () => {\n    const audit = {\n      id: \"123\",\n      nama: \"John Doe\",\n      zonaFinal: \"success\",\n      // ...\n    };\n    \n    render(<AuditCard audit={audit} />);\n    expect(screen.getByText(\"John Doe\")).toBeInTheDocument();\n  });\n  \n  it(\"should show success badge for success zone\", () => {\n    const audit = { /* ... */ zonaFinal: \"success\" };\n    render(<AuditCard audit={audit} />);\n    expect(screen.getByText(/hijau/i)).toBeInTheDocument();\n  });\n});\n```\n\n### 15.4 Integration Testing\n\n**API Tests** (Supertest):\n```typescript\nimport request from \"supertest\";\nimport { app } from \"./server\";\n\ndescribe(\"POST /api/audit\", () => {\n  it(\"should create audit and return calculated results\", async () => {\n    const response = await request(app)\n      .post(\"/api/audit\")\n      .send({\n        nama: \"Test User\",\n        jabatan: \"Business Manager\",\n        // ... full audit data\n      })\n      .expect(200);\n    \n    expect(response.body).toHaveProperty(\"id\");\n    expect(response.body).toHaveProperty(\"totalRealityScore\");\n    expect(response.body.zonaFinal).toMatch(/success|warning|critical/);\n  });\n  \n  it(\"should return 400 for invalid data\", async () => {\n    await request(app)\n      .post(\"/api/audit\")\n      .send({ nama: \"\" }) // Missing required fields\n      .expect(400);\n  });\n});\n```\n\n### 15.5 E2E Testing (Playwright)\n\n**Setup**:\n```bash\nnpm install -D @playwright/test\nnpx playwright install\n```\n\n**Example E2E Test**:\n```typescript\n// e2e/audit-creation.spec.ts\nimport { test, expect } from \"@playwright/test\";\n\ntest(\"should create audit and display results\", async ({ page }) => {\n  // Navigate to new audit page\n  await page.goto(\"http://localhost:5000/new-audit\");\n  \n  // Step 1: Personal Info\n  await page.fill('[data-testid=\"input-nama\"]', \"Test User\");\n  await page.selectOption('[data-testid=\"select-jabatan\"]', \"Business Manager\");\n  await page.fill('[data-testid=\"input-cabang\"]', \"Jakarta\");\n  await page.fill('[data-testid=\"input-tanggal-lahir\"]', \"15-08-1990\");\n  await page.click('[data-testid=\"button-next\"]');\n  \n  // Step 2-4: Fill remaining steps (omitted for brevity)\n  // ...\n  \n  // Step 5: Submit\n  await page.click('[data-testid=\"button-submit\"]');\n  \n  // Verify redirect to detail page\n  await expect(page).toHaveURL(/\\/audit\\/.+/);\n  \n  // Verify audit data displayed\n  await expect(page.getByText(\"Test User\")).toBeVisible();\n  await expect(page.getByText(/Reality Score/i)).toBeVisible();\n});\n```\n\n### 15.6 Load Testing\n\n**Tool**: k6 or Artillery\n\n**Example Load Test**:\n```javascript\n// load-test.js (k6)\nimport http from 'k6/http';\nimport { check } from 'k6';\n\nexport const options = {\n  vus: 50, // 50 virtual users\n  duration: '1m', // Run for 1 minute\n};\n\nexport default function () {\n  const res = http.get('https://aisg23.replit.app/api/audits');\n  \n  check(res, {\n    'status is 200': (r) => r.status === 200,\n    'response time < 500ms': (r) => r.timings.duration < 500,\n  });\n}\n```\n\n**Run**:\n```bash\nk6 run load-test.js\n```\n\n---\n\n## 16. Troubleshooting Guide\n\n### 16.1 Common Development Issues\n\n**Issue 1: \"Module not found\" errors**\n\n```\nError: Cannot find module '@/components/ui/button'\n```\n\n**Solution**:\n1. Check `tsconfig.json` paths are configured\n2. Restart TypeScript server in IDE\n3. Clear Vite cache: `rm -rf node_modules/.vite`\n\n---\n\n**Issue 2: Database connection errors**\n\n```\nError: connect ECONNREFUSED\n```\n\n**Solution**:\n1. Verify `DATABASE_URL` in `.env`\n2. Check Neon dashboard (database active?)\n3. Test connection: `npm run db:studio`\n\n---\n\n**Issue 3: OpenAI API quota errors**\n\n```\n429 Error: You exceeded your current quota\n```\n\n**Solution**:\n1. Check usage: https://platform.openai.com/usage\n2. Top up credits: https://platform.openai.com/settings/organization/billing\n3. Temporary fix: Comment out AI chat feature\n\n---\n\n**Issue 4: Vite HMR not working**\n\n```\n[vite] hmr update failed\n```\n\n**Solution**:\n1. Hard refresh browser: Ctrl+Shift+R\n2. Restart dev server: Stop + `npm run dev`\n3. Clear browser cache\n\n---\n\n### 16.2 Production Deployment Issues\n\n**Issue 1: Database migration conflicts**\n\n**Symptom**: Replit Publishing shows conflict wizard\n\n**Solution**:\n1. For renamed columns: Select \"Rename column X to Y\"\n2. For new columns: Select \"Create new column X\"\n3. NEVER select wrong option (data loss!)\n\n---\n\n**Issue 2: Build fails with TypeScript errors**\n\n**Symptom**: Deployment stuck at BUILD phase\n\n**Solution**:\n1. Run `npm run typecheck` locally\n2. Fix all TypeScript errors\n3. Push fixes and redeploy\n\n---\n\n**Issue 3: 500 errors in production**\n\n**Symptom**: API calls failing in production but working locally\n\n**Solution**:\n1. Check Replit logs (Publishing tab â†’ Logs)\n2. Verify environment secrets are set\n3. Check database connection\n4. Rollback deployment if needed\n\n---\n\n### 16.3 Performance Issues\n\n**Issue 1: Slow API responses (>2 seconds)**\n\n**Diagnostic**:\n1. Check Replit logs for slow database queries\n2. Use Neon dashboard to identify slow queries\n3. Check OpenAI API latency\n\n**Solution**:\n1. Add database indexes (see Section 5.3)\n2. Implement pagination for large datasets\n3. Add caching layer (see Section 14.3)\n\n---\n\n**Issue 2: Frontend slow loading**\n\n**Diagnostic**:\n1. Check Network tab in browser DevTools\n2. Look for large bundle sizes\n3. Check for unnecessary re-renders (React DevTools)\n\n**Solution**:\n1. Lazy load routes (see Section 14.2)\n2. Optimize images (compress, use WebP)\n3. Memoize expensive components\n\n---\n\n### 16.4 Security Issues\n\n**Issue 1: Unauthorized access to audits**\n\n**Current Status**: KNOWN ISSUE (no authentication)\n\n**Mitigation**:\n1. Deploy behind VPN (for internal use only)\n2. Implement authentication ASAP (see Section 13.2)\n\n---\n\n**Issue 2: CORS errors**\n\n**Symptom**: Frontend can't call backend API\n\n**Solution**:\n```typescript\n// server/index.ts\nimport cors from \"cors\";\n\napp.use(cors({\n  origin: process.env.FRONTEND_URL || \"http://localhost:5000\",\n  credentials: true,\n}));\n```\n\n---\n\n### 16.5 Debugging Checklist\n\n**Before asking for help**:\n- [ ] Check browser console for errors (F12)\n- [ ] Check server logs in Replit\n- [ ] Verify environment secrets are set\n- [ ] Try in incognito mode (rule out cache issues)\n- [ ] Check database connection (Neon dashboard)\n- [ ] Verify API endpoints (curl or Postman)\n- [ ] Check Git history for recent changes\n- [ ] Try rollback to previous working version\n\n**When reporting bugs**:\n- Include error message (full stack trace)\n- Include steps to reproduce\n- Include browser/OS information\n- Include screenshots if UI issue\n- Include request/response (Network tab)\n\n---\n\n## Appendix A: Glossary\n\n**18 Pilar**: Standardized framework of 18 competency categories for employee assessment\n\n**Reality Score**: Total sum of 18 Pilar self-assessment scores (0-90)\n\n**Zona (Zone)**: Performance classification (Success/Warning/Critical) indicated by color (ðŸŸ©ðŸŸ¨ðŸŸ¥)\n\n**ProDem**: Promotion-Demotion recommendation system based on audit results\n\n**EWS**: Early Warning System for detecting performance risks\n\n**Magic Section**: Gamification feature with zodiac-based motivational content\n\n**BSM (Business Manager)**: Job title / position level\n\n**NA (New Account)**: Number of new customers acquired (Nasabah Baru)\n\n**Margin**: Revenue or profit margin (in Rupiah)\n\n**Q1-Q4**: Quarterly periods (Quarter 1 through Quarter 4)\n\n---\n\n## Appendix B: Quick Reference\n\n**Start Development**:\n```bash\nnpm run dev\n```\n\n**Database Commands**:\n```bash\nnpm run db:generate    # Create migration\nnpm run db:push        # Apply changes to dev DB\nnpm run db:studio      # Open DB GUI\n```\n\n**Type Checking**:\n```bash\nnpm run typecheck\n```\n\n**Production URL**:\n```\nhttps://aisg23.replit.app\n```\n\n**Key Files**:\n- Business Logic: `server/business-logic.ts`\n- API Routes: `server/routes.ts`\n- Database Schema: `shared/schema.ts`\n- Main Frontend: `client/src/App.tsx`\n\n---\n\n## Appendix C: External Resources\n\n**Documentation**:\n- React: https://react.dev\n- TanStack Query: https://tanstack.com/query/latest\n- Drizzle ORM: https://orm.drizzle.team\n- shadcn/ui: https://ui.shadcn.com\n- OpenAI API: https://platform.openai.com/docs\n\n**Support**:\n- Replit Docs: https://docs.replit.com\n- Neon Docs: https://neon.tech/docs\n\n---\n\n**END OF TECHNICAL DOCUMENTATION**\n\nFor user-facing documentation, see `AISG_Manual_Book.txt`.\n\nFor system overview, see `replit.md`.\n","size_bytes":94866},"client/src/pages/Register.tsx":{"content":"/**\n * Registration Page for AiSG\n * Public self-registration with security question\n */\n\nimport { useState } from \"react\";\nimport { useLocation, Link, Redirect } from \"wouter\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { User, Lock, Mail, Sparkles, HelpCircle, Key, Eye, EyeOff } from \"lucide-react\";\n\nconst SECURITY_QUESTIONS = [\n  \"Apa nama ibu kandung Anda?\",\n  \"Apa nama hewan peliharaan pertama Anda?\",\n  \"Di kota mana Anda lahir?\",\n  \"Apa nama sekolah dasar Anda?\",\n  \"Apa makanan favorit Anda?\",\n  \"Apa nama sahabat masa kecil Anda?\",\n];\n\nexport default function Register() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [securityQuestion, setSecurityQuestion] = useState(SECURITY_QUESTIONS[0]);\n  const [securityAnswer, setSecurityAnswer] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { user, isLoading: authLoading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  // If already logged in, redirect to dashboard\n  if (!authLoading && user) {\n    return <Redirect to=\"/\" />;\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    // Validate password match\n    if (password !== confirmPassword) {\n      setError(\"Password dan konfirmasi password tidak cocok\");\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(\"/api/auth/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          username,\n          password,\n          name,\n          email: email || undefined,\n          securityQuestion,\n          securityAnswer,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.userMessage || \"Pendaftaran gagal\");\n      }\n\n      // Auto-login after successful registration, redirect to home\n      setLocation(\"/\");\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Terjadi kesalahan\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-950 via-gray-900 to-black\">\n      {/* Background effects */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-purple-500/5 to-pink-500/5 pointer-events-none\" />\n      <div className=\"absolute inset-0 bg-[url('/grid.svg')] bg-center [mask-image:linear-gradient(180deg,white,rgba(255,255,255,0))] pointer-events-none\" />\n\n      <Card className=\"w-full max-w-md relative z-10 bg-gray-900/80 backdrop-blur-xl border-gray-800/50 shadow-2xl\">\n        <CardHeader className=\"text-center space-y-4\">\n          {/* Logo */}\n          <div className=\"flex justify-center\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-full blur-xl opacity-50\" />\n              <div className=\"relative w-16 h-16 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-full flex items-center justify-center\">\n                <Sparkles className=\"w-8 h-8 text-white\" />\n              </div>\n            </div>\n          </div>\n\n          {/* Title */}\n          <div className=\"space-y-2\">\n            <CardTitle className=\"text-3xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent\">\n              Daftar Akun\n            </CardTitle>\n            <CardDescription className=\"text-gray-400\">\n              Buat akun baru untuk menggunakan AiSG\n            </CardDescription>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {/* Name */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\" className=\"text-gray-300\">\n                Nama Lengkap\n              </Label>\n              <div className=\"relative\">\n                <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"name\"\n                  type=\"text\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder=\"Masukkan nama lengkap\"\n                  className=\"pl-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  required\n                  autoFocus\n                />\n              </div>\n            </div>\n\n            {/* Username */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\" className=\"text-gray-300\">\n                Username\n              </Label>\n              <div className=\"relative\">\n                <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"username\"\n                  type=\"text\"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  placeholder=\"Pilih username (min 3 karakter)\"\n                  className=\"pl-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  autoComplete=\"username\"\n                  required\n                />\n              </div>\n            </div>\n\n            {/* Email (optional) */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"text-gray-300\">\n                Email <span className=\"text-gray-500 text-xs\">(opsional)</span>\n              </Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"email@example.com\"\n                  className=\"pl-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  autoComplete=\"email\"\n                />\n              </div>\n            </div>\n\n            {/* Password */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\" className=\"text-gray-300\">\n                Password\n              </Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"Minimal 6 karakter\"\n                  className=\"pl-10 pr-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  autoComplete=\"new-password\"\n                  required\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300 transition-colors\"\n                >\n                  {showPassword ? (\n                    <EyeOff className=\"w-4 h-4\" />\n                  ) : (\n                    <Eye className=\"w-4 h-4\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Confirm Password */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirmPassword\" className=\"text-gray-300\">\n                Konfirmasi Password\n              </Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"confirmPassword\"\n                  type={showConfirmPassword ? \"text\" : \"password\"}\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  placeholder=\"Ketik ulang password\"\n                  className=\"pl-10 pr-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  autoComplete=\"new-password\"\n                  required\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300 transition-colors\"\n                >\n                  {showConfirmPassword ? (\n                    <EyeOff className=\"w-4 h-4\" />\n                  ) : (\n                    <Eye className=\"w-4 h-4\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Security Question */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"securityQuestion\" className=\"text-gray-300 flex items-center gap-2\">\n                <HelpCircle className=\"w-4 h-4\" />\n                Pertanyaan Keamanan\n              </Label>\n              <select\n                id=\"securityQuestion\"\n                value={securityQuestion}\n                onChange={(e) => setSecurityQuestion(e.target.value)}\n                className=\"w-full px-3 py-2 bg-gray-800/50 border border-gray-700 rounded-md focus:border-purple-500 focus:outline-none focus:ring-1 focus:ring-purple-500 text-white\"\n                required\n              >\n                {SECURITY_QUESTIONS.map((q) => (\n                  <option key={q} value={q} className=\"bg-gray-800\">\n                    {q}\n                  </option>\n                ))}\n              </select>\n              <p className=\"text-xs text-gray-500\">\n                Untuk reset password jika lupa\n              </p>\n            </div>\n\n            {/* Security Answer */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"securityAnswer\" className=\"text-gray-300\">\n                Jawaban Keamanan\n              </Label>\n              <div className=\"relative\">\n                <Key className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"securityAnswer\"\n                  type=\"text\"\n                  value={securityAnswer}\n                  onChange={(e) => setSecurityAnswer(e.target.value)}\n                  placeholder=\"Jawaban Anda\"\n                  className=\"pl-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  required\n                />\n              </div>\n            </div>\n\n            {/* Error message */}\n            {error && (\n              <Alert variant=\"destructive\" className=\"bg-red-950/50 border-red-900/50\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            {/* Submit button */}\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg shadow-purple-500/25 transition-all duration-300\"\n              disabled={isLoading}\n            >\n              {isLoading ? (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                  <span>Mendaftar...</span>\n                </div>\n              ) : (\n                \"Daftar Sekarang\"\n              )}\n            </Button>\n\n            {/* Login link */}\n            <div className=\"text-center text-sm\">\n              <span className=\"text-gray-400\">Sudah punya akun? </span>\n              <Link href=\"/login\" className=\"text-purple-400 hover:text-purple-300 font-medium\">\n                Login di sini\n              </Link>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":12805},"client/src/pages/ForgotPassword.tsx":{"content":"/**\n * Forgot Password Page for AiSG\n * Reset password using security question\n */\n\nimport { useState } from \"react\";\nimport { useLocation, Link, Redirect } from \"wouter\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { User, Lock, HelpCircle, Key, Sparkles, CheckCircle, Eye, EyeOff } from \"lucide-react\";\n\ntype Step = \"username\" | \"security\" | \"newPassword\" | \"success\";\n\nexport default function ForgotPassword() {\n  const [step, setStep] = useState<Step>(\"username\");\n  const [username, setUsername] = useState(\"\");\n  const [securityQuestion, setSecurityQuestion] = useState(\"\");\n  const [securityAnswer, setSecurityAnswer] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [showNewPassword, setShowNewPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { user, isLoading: authLoading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  // If already logged in, redirect to dashboard\n  if (!authLoading && user) {\n    return <Redirect to=\"/\" />;\n  }\n\n  // Step 1: Check username and get security question\n  const handleUsernameSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(`/api/auth/security-question/${username}`);\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.userMessage || \"Username tidak ditemukan\");\n      }\n\n      setSecurityQuestion(data.securityQuestion);\n      setStep(\"security\");\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Terjadi kesalahan\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Step 2: Verify security answer and show password form\n  const handleSecuritySubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setStep(\"newPassword\");\n  };\n\n  // Step 3: Reset password\n  const handlePasswordSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    if (newPassword !== confirmPassword) {\n      setError(\"Password dan konfirmasi password tidak cocok\");\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(\"/api/auth/reset-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          username,\n          securityAnswer,\n          newPassword,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.userMessage || \"Reset password gagal\");\n      }\n\n      setStep(\"success\");\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Terjadi kesalahan\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleBackToLogin = () => {\n    setLocation(\"/login\");\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-950 via-gray-900 to-black\">\n      {/* Background effects */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-purple-500/5 to-pink-500/5 pointer-events-none\" />\n      <div className=\"absolute inset-0 bg-[url('/grid.svg')] bg-center [mask-image:linear-gradient(180deg,white,rgba(255,255,255,0))] pointer-events-none\" />\n\n      <Card className=\"w-full max-w-md relative z-10 bg-gray-900/80 backdrop-blur-xl border-gray-800/50 shadow-2xl\">\n        <CardHeader className=\"text-center space-y-4\">\n          {/* Logo */}\n          <div className=\"flex justify-center\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-full blur-xl opacity-50\" />\n              <div className=\"relative w-16 h-16 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-full flex items-center justify-center\">\n                {step === \"success\" ? (\n                  <CheckCircle className=\"w-8 h-8 text-white\" />\n                ) : (\n                  <Sparkles className=\"w-8 h-8 text-white\" />\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Title */}\n          <div className=\"space-y-2\">\n            <CardTitle className=\"text-3xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent\">\n              {step === \"success\" ? \"Berhasil!\" : \"Lupa Password\"}\n            </CardTitle>\n            <CardDescription className=\"text-gray-400\">\n              {step === \"username\" && \"Masukkan username untuk reset password\"}\n              {step === \"security\" && \"Jawab pertanyaan keamanan Anda\"}\n              {step === \"newPassword\" && \"Buat password baru\"}\n              {step === \"success\" && \"Password berhasil direset\"}\n            </CardDescription>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          {/* Step 1: Username */}\n          {step === \"username\" && (\n            <form onSubmit={handleUsernameSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\" className=\"text-gray-300\">\n                  Username\n                </Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                  <Input\n                    id=\"username\"\n                    type=\"text\"\n                    value={username}\n                    onChange={(e) => setUsername(e.target.value)}\n                    placeholder=\"Masukkan username\"\n                    className=\"pl-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                    autoComplete=\"username\"\n                    required\n                    autoFocus\n                  />\n                </div>\n              </div>\n\n              {error && (\n                <Alert variant=\"destructive\" className=\"bg-red-950/50 border-red-900/50\">\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg shadow-purple-500/25 transition-all duration-300\"\n                disabled={isLoading}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                    <span>Mencari...</span>\n                  </div>\n                ) : (\n                  \"Lanjutkan\"\n                )}\n              </Button>\n\n              <div className=\"text-center text-sm\">\n                <Link href=\"/login\" className=\"text-purple-400 hover:text-purple-300 font-medium\">\n                  â† Kembali ke Login\n                </Link>\n              </div>\n            </form>\n          )}\n\n          {/* Step 2: Security Question */}\n          {step === \"security\" && (\n            <form onSubmit={handleSecuritySubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-gray-300 flex items-center gap-2\">\n                  <HelpCircle className=\"w-4 h-4\" />\n                  Pertanyaan Keamanan\n                </Label>\n                <div className=\"p-3 bg-purple-500/10 border border-purple-500/30 rounded-md\">\n                  <p className=\"text-purple-300 text-sm\">{securityQuestion}</p>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"securityAnswer\" className=\"text-gray-300\">\n                  Jawaban Anda\n                </Label>\n                <div className=\"relative\">\n                  <Key className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                  <Input\n                    id=\"securityAnswer\"\n                    type=\"text\"\n                    value={securityAnswer}\n                    onChange={(e) => setSecurityAnswer(e.target.value)}\n                    placeholder=\"Masukkan jawaban\"\n                    className=\"pl-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                    required\n                    autoFocus\n                  />\n                </div>\n              </div>\n\n              {error && (\n                <Alert variant=\"destructive\" className=\"bg-red-950/50 border-red-900/50\">\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg shadow-purple-500/25 transition-all duration-300\"\n              >\n                Lanjutkan\n              </Button>\n\n              <div className=\"text-center text-sm\">\n                <button\n                  type=\"button\"\n                  onClick={() => setStep(\"username\")}\n                  className=\"text-purple-400 hover:text-purple-300 font-medium\"\n                >\n                  â† Kembali\n                </button>\n              </div>\n            </form>\n          )}\n\n          {/* Step 3: New Password */}\n          {step === \"newPassword\" && (\n            <form onSubmit={handlePasswordSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"newPassword\" className=\"text-gray-300\">\n                  Password Baru\n                </Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                  <Input\n                    id=\"newPassword\"\n                    type={showNewPassword ? \"text\" : \"password\"}\n                    value={newPassword}\n                    onChange={(e) => setNewPassword(e.target.value)}\n                    placeholder=\"Minimal 6 karakter\"\n                    className=\"pl-10 pr-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                    autoComplete=\"new-password\"\n                    required\n                    autoFocus\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowNewPassword(!showNewPassword)}\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300 transition-colors\"\n                  >\n                    {showNewPassword ? (\n                      <EyeOff className=\"w-4 h-4\" />\n                    ) : (\n                      <Eye className=\"w-4 h-4\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\" className=\"text-gray-300\">\n                  Konfirmasi Password Baru\n                </Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                  <Input\n                    id=\"confirmPassword\"\n                    type={showConfirmPassword ? \"text\" : \"password\"}\n                    value={confirmPassword}\n                    onChange={(e) => setConfirmPassword(e.target.value)}\n                    placeholder=\"Ketik ulang password\"\n                    className=\"pl-10 pr-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                    autoComplete=\"new-password\"\n                    required\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300 transition-colors\"\n                  >\n                    {showConfirmPassword ? (\n                      <EyeOff className=\"w-4 h-4\" />\n                    ) : (\n                      <Eye className=\"w-4 h-4\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n\n              {error && (\n                <Alert variant=\"destructive\" className=\"bg-red-950/50 border-red-900/50\">\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg shadow-purple-500/25 transition-all duration-300\"\n                disabled={isLoading}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                    <span>Mereset...</span>\n                  </div>\n                ) : (\n                  \"Reset Password\"\n                )}\n              </Button>\n\n              <div className=\"text-center text-sm\">\n                <button\n                  type=\"button\"\n                  onClick={() => setStep(\"security\")}\n                  className=\"text-purple-400 hover:text-purple-300 font-medium\"\n                >\n                  â† Kembali\n                </button>\n              </div>\n            </form>\n          )}\n\n          {/* Step 4: Success */}\n          {step === \"success\" && (\n            <div className=\"space-y-4 text-center\">\n              <div className=\"p-4 bg-green-500/10 border border-green-500/30 rounded-lg\">\n                <p className=\"text-green-400\">\n                  Password Anda berhasil direset! Sekarang Anda bisa login dengan password baru.\n                </p>\n              </div>\n\n              <Button\n                onClick={handleBackToLogin}\n                className=\"w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg shadow-purple-500/25 transition-all duration-300\"\n              >\n                Login Sekarang\n              </Button>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":15092},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"AISG_MVP_SIMPLIFIED_v2.0.md":{"content":"# AISG ENTERPRISE MVP - SIMPLIFIED ARCHITECTURE\n\n**Version:** 2.0 (MVP Simplified)  \n**Date:** November 13, 2025  \n**Status:** Design Phase - Ready for Implementation  \n**Scope:** Manual Excel Upload Only (No BAS API Integration)  \n**Budget:** $30-40 | 5-7 days  \n\n---\n\n## ðŸ“‹ TABLE OF CONTENTS\n\n1. [Executive Summary](#1-executive-summary)\n2. [Business Context & Scope](#2-business-context--scope)\n3. [User Roles & Access Control](#3-user-roles--access-control)\n4. [Authentication & Security Strategy](#4-authentication--security-strategy)\n5. [Database Schema](#5-database-schema)\n6. [Excel Upload Specification](#6-excel-upload-specification)\n7. [Hierarchy Management](#7-hierarchy-management)\n8. [Monthly Audit Workflow](#8-monthly-audit-workflow)\n9. [Dashboard & Reporting](#9-dashboard--reporting)\n10. [API Endpoints](#10-api-endpoints)\n11. [UI/UX Design](#11-uiux-design)\n12. [Implementation Roadmap](#12-implementation-roadmap)\n13. [Testing Strategy](#13-testing-strategy)\n\n---\n\n## 1. EXECUTIVE SUMMARY\n\n### 1.1 Business Problem\n\n**Original System (aisg23):** Individual/team audit system yang bagus, tapi ada gap:\n- Manual employee onboarding (slow, error-prone)\n- No bulk data import (hard to scale 800+ employees per branch)\n- Complex multi-branch setup\n\n**Enterprise Challenge:** \n- 42 branches total, each with 50-800+ employees\n- High turnover (100+ new employees monthly per branch)\n- Need scalable onboarding strategy\n- Monthly performance tracking (margin + NA updates)\n\n### 1.2 Solution Overview\n\n**AISG Enterprise MVP** = Simplified, Excel-based bulk onboarding + monthly audit system\n\n**Core Features:**\n1. âœ… Manual Excel Upload (800+ employees, bulk import)\n2. âœ… Auto-hierarchy builder (from atasan_code column)\n3. âœ… Password = tanggal lahir (YYYYMMDD format, no email needed)\n4. âœ… Security questions (password reset without email/OTP)\n5. âœ… Monthly audit cycle (margin update + 18 Pilar assessment)\n6. âœ… Bottom-up aggregation (real-time, cascade up hierarchy)\n7. âœ… Multi-branch architecture (start 1 branch, scale to 42)\n8. âœ… Dashboard + PDF export\n\n**Out of Scope (MVP):**\n- âŒ BAS API Integration (future enhancement)\n- âŒ PT/Legal Entity Reporting (future enhancement)\n- âŒ Notification System (future enhancement)\n- âŒ CBO/CEO/Owner roles (use Super Admin for now)\n\n### 1.3 Key Benefits\n\nâœ… **Scalability:** 800+ employees per branch, multi-branch ready  \nâœ… **Simplicity:** Excel upload = familiar workflow for admins  \nâœ… **Cost-effective:** No email/OTP costs (password = tanggal lahir)  \nâœ… **Fast onboarding:** Bulk import 800 employees in ~1 minute  \nâœ… **Reliable:** Manual process, no dependency on external APIs  \n\n---\n\n## 2. BUSINESS CONTEXT & SCOPE\n\n### 2.1 Organization Structure\n\n**Multi-Branch Architecture:**\n```\nOrganization\nâ”œâ”€ Branch 1: AXA 2 - Jakarta (800 employees)\nâ”œâ”€ Branch 2: BPF 1 - Surabaya (650 employees)\nâ”œâ”€ Branch 3: RFB 5 - Bandung (450 employees)\nâ””â”€ ... (up to 42 branches)\n```\n\n**Hierarchy Within Each Branch (11 levels):**\n```\nBrM (Branch Manager) â† Admin role, outside hierarchy\nâ””â”€ VBM (Vice Branch Manager) â† Top employee\n   â””â”€ SVBM (Senior Vice Branch Manager)\n      â””â”€ SEM (Senior Equity Manager)\n         â””â”€ EM (Equity Manager)\n            â””â”€ SBM (Senior Business Manager)\n               â””â”€ BsM (Business Manager)\n                  â””â”€ SBC (Senior Business Consultant)\n                     â””â”€ BC (Business Consultant) â† Bottom employee\n```\n\n**Key Rules:**\n- BrM = Admin role (NOT employee, NO margin/NA, NOT in hierarchy)\n- Each branch has own hierarchy tree\n- Top employee per branch = VBM (or highest position available)\n- Bottom employee = BC (or lowest position)\n- Hierarchy built from Excel column: `atasan_code`\n\n### 2.2 Workforce Characteristics\n\n**Scale:**\n- 42 branches total\n- 50-800+ employees per branch\n- ~10,000 employees total (across all branches)\n\n**Challenges:**\n- High turnover (100+ new employees monthly per branch)\n- Email availability: Not guaranteed (many staff no email)\n- Tech literacy: Mixed (managers OK, new staff perlu guidance)\n- Commission-based: Performance tracking critical\n\n**Solution:**\n- Bulk Excel upload (fast onboarding)\n- Password = tanggal lahir (no email needed)\n- Security questions (password reset without email)\n\n### 2.3 Simplified Scope (MVP)\n\n**Focus:**\n- Single Excel upload method (manual, no API)\n- 3 roles only (Super Admin, BrM, Staff)\n- Monthly audit cycle (margin update + 18 Pilar)\n- Dashboard analytics (zone distribution, completion rate)\n- PDF export (individual + branch reports)\n\n**Future Enhancements (Post-MVP):**\n- BAS API integration (auto-sync employee data)\n- PT/Legal Entity reporting (cross-branch aggregation)\n- CBO/CEO/Owner roles (strategic-level access)\n- Notification system (email alerts, reminders)\n- Advanced analytics (trends, forecasting)\n\n---\n\n## 3. USER ROLES & ACCESS CONTROL\n\n### 3.1 Role Definitions\n\n#### **ROLE 1: SUPER ADMIN**\n\n**Purpose:** System administrator (IT team, owner)\n\n**Access Level:** Full system access\n\n**Capabilities:**\n- âœ… CRUD branches (create, update, delete branches)\n- âœ… CRUD users (create BrM accounts, reset passwords)\n- âœ… View all data (all branches, all employees)\n- âœ… Export all reports (cross-branch analytics)\n- âœ… System configuration (settings, backups)\n\n**Limitations:**\n- âŒ Cannot isi 18 Pilar (not employee)\n- âŒ Cannot have margin/NA (not employee)\n\n**Use Cases:**\n- Setup new branch (create branch + BrM account)\n- Troubleshoot issues (reset passwords, fix hierarchy)\n- Generate owner reports (cross-branch performance)\n\n---\n\n#### **ROLE 2: BrM (Branch Manager)**\n\n**Purpose:** Branch administrator (1 per branch)\n\n**Access Level:** Full access to assigned branch only\n\n**Capabilities:**\n- âœ… Upload Excel (800+ employees, monthly updates)\n- âœ… View all staff in branch (800 employees)\n- âœ… View aggregated dashboard (branch performance)\n- âœ… Export branch PDF report\n- âœ… Monitor audit completion (720/800 staff done = 90%)\n\n**Limitations:**\n- âŒ Cannot access other branches\n- âŒ Cannot isi 18 Pilar (admin role, not employee)\n- âŒ NO margin/NA (admin role, not in hierarchy)\n- âŒ Cannot CRUD employees manually (only via Excel upload)\n\n**Use Cases:**\n- Monthly: Upload Excel (updated margin + NA data)\n- Weekly: Monitor audit completion rate\n- End of month: Export branch report PDF\n\n**Account Creation:**\n- Super Admin creates BrM account manually\n- Username: `brm_<branch_code>` (e.g., `brm_axa2`)\n- Initial password: `temp123` (BrM ganti saat first login)\n\n---\n\n#### **ROLE 3: STAFF**\n\n**Purpose:** Branch employees (BC â†’ VBM, all positions in hierarchy)\n\n**Access Level:** Self + direct subordinates\n\n**Capabilities:**\n- âœ… View personal data (nama, posisi, margin, NA)\n- âœ… Isi 18 Pilar (monthly self-assessment)\n- âœ… View Reality Score (auto-calculated from margin/NA)\n- âœ… View subordinates (if manager)\n- âœ… View aggregated metrics (personal + subordinates)\n- âœ… Export personal PDF report\n\n**Limitations:**\n- âŒ Cannot view peers (same level)\n- âŒ Cannot view other branches\n- âŒ Cannot edit margin/NA (read-only, from Excel)\n- âŒ Cannot edit hierarchy (read-only, from Excel)\n\n**Use Cases:**\n- Monthly: Login â†’ Check updated margin/NA â†’ Isi 18 Pilar\n- Weekly: Review Reality Score & Zone status\n- End of month: Export personal report\n\n**Account Creation:**\n- Auto-created from Excel upload (BrM upload Excel)\n- Username: Employee code (e.g., `EMP001`)\n- Initial password: Tanggal lahir YYYYMMDD (e.g., `19900315`)\n- First login: Paksa ganti password + setup security questions\n\n---\n\n### 3.2 Access Control Matrix\n\n| Feature | Super Admin | BrM | Staff |\n|---------|-------------|-----|-------|\n| CRUD Branches | âœ… | âŒ | âŒ |\n| CRUD Users | âœ… | âŒ | âŒ |\n| Upload Excel | âœ… (all branches) | âœ… (own branch) | âŒ |\n| View All Employees | âœ… | âœ… (own branch) | âŒ |\n| View Self Data | N/A | N/A | âœ… |\n| View Subordinates | âœ… | âœ… | âœ… (direct only) |\n| Isi 18 Pilar | âŒ | âŒ | âœ… |\n| Export PDF | âœ… (all) | âœ… (branch) | âœ… (personal) |\n| Reset Password | âœ… (any user) | âŒ | âœ… (self only, via security Q) |\n\n---\n\n### 3.3 Role Hierarchy & Isolation\n\n**Isolation Rules:**\n\n1. **Branch Isolation:**\n   - BrM can ONLY access own branch\n   - Staff can ONLY access own branch\n   - Super Admin can access ALL branches\n\n2. **Hierarchy Isolation:**\n   - Staff can view subordinates (cascade down)\n   - Staff CANNOT view manager (cascade up)\n   - Staff CANNOT view peers (same level)\n\n3. **Data Isolation:**\n   - Margin/NA: Staff see own + subordinates aggregate\n   - 18 Pilar: Staff see own only (not subordinates' answers)\n   - Reality Score: Staff see own + subordinates aggregate\n\n**Example (Branch AXA 2):**\n```\nBrM (admin) â†’ Can view ALL 800 employees\nVBM (top employee) â†’ Can view VBM + all subordinates (799 employees)\nSBC (middle manager) â†’ Can view SBC + subordinates (50 employees)\nBC (bottom) â†’ Can view BC only (self, no subordinates)\n```\n\n---\n\n## 4. AUTHENTICATION & SECURITY STRATEGY\n\n### 4.1 Password Strategy\n\n**Design Decision:** Password = Tanggal Lahir (YYYYMMDD)\n\n**Rationale:**\n- âœ… No email needed (many staff no email)\n- âœ… No OTP cost (avoid SMS/email costs)\n- âœ… Easy to remember (staff know their own birth date)\n- âœ… Unique per person (low collision risk)\n- âš ï¸ Security risk (mitigated by forced password change)\n\n**Format:**\n```\nTanggal lahir: 15 Maret 1990\nPassword: 19900315 (YYYYMMDD)\n```\n\n**Implementation:**\n1. BrM upload Excel (include column: `tgl_lahir`)\n2. System auto-create user accounts:\n   - Username = `employee_code`\n   - Password = `tanggal_lahir` (hashed with bcrypt)\n3. First login:\n   - Staff login with employee code + tanggal lahir\n   - System FORCE password change\n   - Staff setup security questions (3 questions)\n4. Subsequent logins:\n   - Staff login with employee code + NEW password\n\n---\n\n### 4.2 Security Questions (Password Reset)\n\n**Purpose:** Password reset WITHOUT email/OTP\n\n**Questions (3 required):**\n1. Nama ibu kandung?\n2. Kota tempat lahir?\n3. Nama sekolah SD?\n\n**Setup Flow:**\n```\nFirst login â†’ Ganti password â†’ Setup security questions (3)\n```\n\n**Reset Flow:**\n```\n1. Staff click \"Lupa Password\"\n2. Enter employee code (EMP001)\n3. System show 2 of 3 questions (random)\n4. Staff answer both correctly\n5. System allow set new password\n6. Done! âœ…\n```\n\n**Security:**\n- Answers hashed with bcrypt (case-insensitive)\n- 3 failed attempts â†’ Lock account (BrM/Super Admin unlock)\n- Answers cannot be blank\n\n---\n\n### 4.3 Session Management\n\n**Technology:** express-session + MemoryStore\n\n**Session Config:**\n```javascript\n{\n  secret: process.env.SESSION_SECRET,\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    maxAge: 8 * 60 * 60 * 1000 // 8 hours\n  }\n}\n```\n\n**Session Data:**\n```javascript\nreq.session = {\n  userId: \"USER_001\",\n  employeeId: \"EMP001\", // NULL for Super Admin/BrM\n  role: \"staff\", // \"super_admin\", \"brm\", \"staff\"\n  branchId: \"AXA2\", // NULL for Super Admin\n  username: \"EMP001\"\n}\n```\n\n**Session Expiry:**\n- 8 hours of inactivity â†’ Auto logout\n- Manual logout â†’ Clear session\n\n---\n\n### 4.4 Authorization Middleware\n\n**Backend Protection:**\n\n```javascript\n// Middleware: requireAuth\nfunction requireAuth(req, res, next) {\n  if (!req.session.userId) {\n    return res.status(401).json({ error: \"Unauthorized\" });\n  }\n  next();\n}\n\n// Middleware: requireRole\nfunction requireRole(...allowedRoles) {\n  return (req, res, next) => {\n    if (!allowedRoles.includes(req.session.role)) {\n      return res.status(403).json({ error: \"Forbidden\" });\n    }\n    next();\n  };\n}\n\n// Middleware: requireBranch\nfunction requireBranch(req, res, next) {\n  if (req.session.role === \"super_admin\") return next();\n  \n  const requestedBranch = req.params.branchId || req.body.branchId;\n  if (requestedBranch !== req.session.branchId) {\n    return res.status(403).json({ error: \"Access denied to other branches\" });\n  }\n  next();\n}\n\n// Usage:\napp.get(\"/api/employees\", requireAuth, requireRole(\"super_admin\", \"brm\"), (req, res) => {\n  // Only Super Admin or BrM can access\n});\n\napp.post(\"/api/upload\", requireAuth, requireRole(\"brm\"), requireBranch, (req, res) => {\n  // Only BrM of same branch can upload\n});\n```\n\n---\n\n### 4.5 Security Best Practices\n\n**Password Policy:**\n- âœ… Minimum 8 characters\n- âœ… First login: Force password change\n- âœ… bcrypt hashing (cost factor: 10)\n- âœ… No password reuse (check last password)\n\n**Input Validation:**\n- âœ… Zod schemas for all API requests\n- âœ… SQL injection prevention (Drizzle ORM parameterized queries)\n- âœ… XSS prevention (React auto-escapes by default)\n\n**CSRF Protection:**\n- âœ… SameSite cookies (Lax mode)\n- âœ… CORS configuration (allow specific origins only)\n\n**Rate Limiting:**\n- âœ… Login attempts: 5 per 15 minutes (per IP)\n- âœ… Password reset: 3 per hour (per account)\n- âœ… API calls: 100 per minute (per user)\n\n---\n\n## 5. DATABASE SCHEMA\n\n### 5.1 Schema Overview\n\n**Tables (8 total):**\n1. `users` - Login credentials\n2. `employees` - Employee master data\n3. `branches` - Branch list\n4. `monthly_performance` - Margin + NA per month\n5. `audits` - Quarterly audit (18 Pilar + scores)\n6. `chatMessages` - AI chat history\n7. `security_questions` - Password reset questions\n8. `upload_logs` - Excel upload audit trail\n\n---\n\n### 5.2 Table: users\n\n**Purpose:** User accounts (login credentials)\n\n**Schema:**\n```typescript\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: varchar(\"username\", { length: 50 }).notNull().unique(),\n  password: varchar(\"password\", { length: 255 }).notNull(),\n  role: varchar(\"role\", { length: 20 }).notNull(), // \"super_admin\", \"brm\", \"staff\"\n  employeeId: varchar(\"employee_id\").references(() => employees.id, { onDelete: \"cascade\" }),\n  branchId: varchar(\"branch_id\").references(() => branches.id, { onDelete: \"cascade\" }),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  mustChangePassword: boolean(\"must_change_password\").default(true).notNull(),\n  lastPasswordChange: timestamp(\"last_password_change\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n```\n\n**Relationships:**\n- 1 user â†’ 1 employee (for staff, NULL for admin/BrM)\n- 1 user â†’ 1 branch (for BrM/staff, NULL for super_admin)\n\n**Indexes:**\n```sql\nCREATE INDEX idx_users_username ON users(username);\nCREATE INDEX idx_users_employee ON users(employee_id);\nCREATE INDEX idx_users_branch ON users(branch_id);\n```\n\n---\n\n### 5.3 Table: employees\n\n**Purpose:** Employee master data (from Excel upload)\n\n**Schema:**\n```typescript\nexport const employees = pgTable(\"employees\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  employeeCode: varchar(\"employee_code\", { length: 50 }).notNull().unique(),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  email: varchar(\"email\", { length: 100 }),\n  position: varchar(\"position\", { length: 50 }).notNull(),\n  branchId: varchar(\"branch_id\").notNull().references(() => branches.id, { onDelete: \"cascade\" }),\n  managerId: varchar(\"manager_id\").references(() => employees.id, { onDelete: \"set null\" }),\n  tanggalLahir: date(\"tanggal_lahir\").notNull(),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n```\n\n**Relationships:**\n- Self-referencing: `managerId` â†’ `employees.id` (hierarchy)\n- Many employees â†’ 1 branch\n- 1 employee â†’ 1 user (optional)\n\n**Indexes:**\n```sql\nCREATE INDEX idx_employees_code ON employees(employee_code);\nCREATE INDEX idx_employees_branch ON employees(branch_id);\nCREATE INDEX idx_employees_manager ON employees(manager_id);\nCREATE INDEX idx_employees_position ON employees(position);\n```\n\n**Hierarchy Example:**\n```\nEMP800 (VBM) â†’ managerId: NULL (top)\nEMP400 (SEM) â†’ managerId: EMP800\nEMP200 (BsM) â†’ managerId: EMP400\nEMP001 (BC) â†’ managerId: EMP200\n```\n\n---\n\n### 5.4 Table: branches\n\n**Purpose:** Branch list (42 branches)\n\n**Schema:**\n```typescript\nexport const branches = pgTable(\"branches\", {\n  id: varchar(\"id\").primaryKey(), // e.g., \"AXA2\"\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  code: varchar(\"code\", { length: 10 }).notNull().unique(),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n```\n\n**Example Data:**\n```sql\nINSERT INTO branches (id, name, code) VALUES\n  ('AXA2', 'AXA 2 - Jakarta', 'AXA2'),\n  ('BPF1', 'BPF 1 - Surabaya', 'BPF1'),\n  ('RFB5', 'RFB 5 - Bandung', 'RFB5');\n```\n\n---\n\n### 5.5 Table: monthly_performance\n\n**Purpose:** Monthly margin + NA data (from Excel upload)\n\n**Schema:**\n```typescript\nexport const monthlyPerformance = pgTable(\"monthly_performance\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  employeeId: varchar(\"employee_id\").notNull().references(() => employees.id, { onDelete: \"cascade\" }),\n  period: varchar(\"period\", { length: 7 }).notNull(), // YYYY-MM (e.g., \"2025-01\")\n  margin: decimal(\"margin\", { precision: 15, scale: 2 }).notNull(),\n  na: integer(\"na\").notNull(),\n  realityScore: decimal(\"reality_score\", { precision: 15, scale: 2 }),\n  zone: varchar(\"zone\", { length: 20 }), // \"success\", \"warning\", \"critical\"\n  uploadSource: varchar(\"upload_source\", { length: 50 }).default(\"excel\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n}, (table) => ({\n  uniqueEmployeePeriod: unique().on(table.employeeId, table.period),\n}));\n```\n\n**Indexes:**\n```sql\nCREATE INDEX idx_performance_employee ON monthly_performance(employee_id);\nCREATE INDEX idx_performance_period ON monthly_performance(period);\n```\n\n**Reality Score Calculation:**\n```javascript\nrealityScore = margin / na\nzone = realityScore >= 4000000 ? \"success\" :\n       realityScore >= 2000000 ? \"warning\" : \"critical\"\n```\n\n---\n\n### 5.6 Table: audits\n\n**Purpose:** Quarterly audit data (18 Pilar + aggregated metrics)\n\n**Schema:**\n```typescript\nexport const audits = pgTable(\"audits\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  employeeId: varchar(\"employee_id\").notNull().references(() => employees.id, { onDelete: \"cascade\" }),\n  period: varchar(\"period\", { length: 7 }).notNull(), // YYYY-MM\n  \n  // Personal data (from monthly_performance)\n  personalMargin: decimal(\"personal_margin\", { precision: 15, scale: 2 }),\n  personalNA: integer(\"personal_na\"),\n  personalRealityScore: decimal(\"personal_reality_score\", { precision: 15, scale: 2 }),\n  \n  // Aggregated data (from subordinates)\n  aggregatedMargin: decimal(\"aggregated_margin\", { precision: 15, scale: 2 }),\n  aggregatedNA: integer(\"aggregated_na\"),\n  aggregatedRealityScore: decimal(\"aggregated_reality_score\", { precision: 15, scale: 2 }),\n  \n  // 18 Pilar (self-assessment, 1-5 scale)\n  pilar1: integer(\"pilar_1\"),\n  pilar2: integer(\"pilar_2\"),\n  // ... pilar3-pilar18\n  pilar18: integer(\"pilar_18\"),\n  \n  // Calculated scores\n  totalPilarScore: integer(\"total_pilar_score\"),\n  avgPilarScore: decimal(\"avg_pilar_score\", { precision: 4, scale: 2 }),\n  zone: varchar(\"zone\", { length: 20 }),\n  \n  // SWOT, ProDem, Action Plan (JSONB)\n  swot: json(\"swot\").$type<{\n    strengths: string[];\n    weaknesses: string[];\n    opportunities: string[];\n    threats: string[];\n  }>(),\n  prodem: json(\"prodem\").$type<{\n    profile: string;\n    demographic: string;\n  }>(),\n  actionPlan: json(\"action_plan\").$type<{\n    days30: string[];\n    days60: string[];\n    days90: string[];\n  }>(),\n  \n  // Magic Section\n  julukan: varchar(\"julukan\", { length: 100 }),\n  zodiak: varchar(\"zodiak\", { length: 50 }),\n  generasi: varchar(\"generasi\", { length: 50 }),\n  \n  // Metadata\n  isComplete: boolean(\"is_complete\").default(false).notNull(),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n}, (table) => ({\n  uniqueEmployeePeriod: unique().on(table.employeeId, table.period),\n}));\n```\n\n---\n\n### 5.7 Table: security_questions\n\n**Purpose:** Password reset security questions\n\n**Schema:**\n```typescript\nexport const securityQuestions = pgTable(\"security_questions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  question1: varchar(\"question_1\", { length: 255 }).notNull(),\n  answer1: varchar(\"answer_1\", { length: 255 }).notNull(), // hashed\n  question2: varchar(\"question_2\", { length: 255 }).notNull(),\n  answer2: varchar(\"answer_2\", { length: 255 }).notNull(), // hashed\n  question3: varchar(\"question_3\", { length: 255 }).notNull(),\n  answer3: varchar(\"answer_3\", { length: 255 }).notNull(), // hashed\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n```\n\n**Standard Questions:**\n```javascript\nconst SECURITY_QUESTIONS = [\n  \"Nama ibu kandung?\",\n  \"Kota tempat lahir?\",\n  \"Nama sekolah SD?\"\n];\n```\n\n---\n\n### 5.8 Table: upload_logs\n\n**Purpose:** Audit trail for Excel uploads\n\n**Schema:**\n```typescript\nexport const uploadLogs = pgTable(\"upload_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  branchId: varchar(\"branch_id\").notNull().references(() => branches.id),\n  uploadedBy: varchar(\"uploaded_by\").notNull().references(() => users.id),\n  period: varchar(\"period\", { length: 7 }).notNull(), // YYYY-MM\n  fileName: varchar(\"file_name\", { length: 255 }),\n  totalRows: integer(\"total_rows\"),\n  successRows: integer(\"success_rows\"),\n  errorRows: integer(\"error_rows\"),\n  errors: json(\"errors\").$type<Array<{\n    row: number;\n    error: string;\n  }>>(),\n  status: varchar(\"status\", { length: 20 }).notNull(), // \"success\", \"partial\", \"failed\"\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n```\n\n**Example Log:**\n```json\n{\n  \"id\": \"LOG_001\",\n  \"branchId\": \"AXA2\",\n  \"uploadedBy\": \"USER_BRM_001\",\n  \"period\": \"2025-01\",\n  \"fileName\": \"AXA2_Jan2025.xlsx\",\n  \"totalRows\": 800,\n  \"successRows\": 798,\n  \"errorRows\": 2,\n  \"errors\": [\n    { \"row\": 45, \"error\": \"Invalid atasan_code: EMP999 not found\" },\n    { \"row\": 123, \"error\": \"Invalid tanggal_lahir format\" }\n  ],\n  \"status\": \"partial\"\n}\n```\n\n---\n\n## 6. EXCEL UPLOAD SPECIFICATION\n\n### 6.1 Excel Template Format\n\n**File:** `Template_Upload_Employee.xlsx`\n\n**Sheet Name:** `Data`\n\n**Columns (8 required):**\n\n| Column Name | Type | Required | Example | Validation |\n|-------------|------|----------|---------|------------|\n| employee_code | varchar(50) | âœ… | EMP001 | Unique, alphanumeric |\n| nama | varchar(100) | âœ… | Andi Wijaya | Non-empty |\n| posisi | varchar(50) | âœ… | BC | Valid position |\n| atasan_code | varchar(50) | âŒ | EMP050 | Must exist (or NULL for top) |\n| tgl_lahir | date | âœ… | 1990-03-15 | Format: YYYY-MM-DD |\n| margin | decimal | âœ… | 10000000 | Numeric, >= 0 |\n| na | integer | âœ… | 5 | Integer, >= 0 |\n| email | varchar(100) | âŒ | andi@gmail.com | Valid email or empty |\n\n**Valid Positions:**\n```\nBC, SBC, BsM, SBM, EM, SEM, VBM, SVBM\n```\n\n**Example Data:**\n```excel\nemployee_code | nama          | posisi | atasan_code | tgl_lahir  | margin    | na | email\nEMP001        | Andi Wijaya   | BC     | EMP050      | 1990-03-15 | 10000000  | 5  | andi@g.com\nEMP002        | Budi Santoso  | BC     | EMP050      | 1985-07-22 | 15000000  | 3  | budi@g.com\nEMP050        | Charlie Tan   | SBC    | EMP100      | 1980-12-05 | 50000000  | 10 | charlie@g.com\nEMP100        | Dewi Lestari  | BsM    | EMP200      | 1978-05-18 | 120000000 | 25 | dewi@g.com\nEMP200        | Eko Pratama   | SEM    | EMP300      | 1975-09-30 | 300000000 | 60 | eko@g.com\nEMP300        | Farah Indah   | VBM    |             | 1970-01-10 | 800000000 | 150| farah@g.com\n```\n\n---\n\n### 6.2 Upload Flow (Frontend)\n\n**Step 1: Download Template**\n```jsx\n<Button onClick={downloadTemplate} data-testid=\"button-download-template\">\n  ðŸ“¥ Download Template Excel\n</Button>\n\nfunction downloadTemplate() {\n  // Generate Excel template with headers\n  const headers = [\"employee_code\", \"nama\", \"posisi\", \"atasan_code\", \n                   \"tgl_lahir\", \"margin\", \"na\", \"email\"];\n  // ... generate XLSX file\n  download(\"Template_Upload_Employee.xlsx\");\n}\n```\n\n**Step 2: Upload File**\n```jsx\n<Input \n  type=\"file\" \n  accept=\".xlsx,.xls\" \n  onChange={handleFileUpload}\n  data-testid=\"input-upload-excel\"\n/>\n\nfunction handleFileUpload(e) {\n  const file = e.target.files[0];\n  const formData = new FormData();\n  formData.append(\"file\", file);\n  formData.append(\"period\", \"2025-01\"); // Current month\n  \n  // POST /api/upload\n  apiRequest(\"/api/upload\", {\n    method: \"POST\",\n    body: formData\n  });\n}\n```\n\n**Step 3: Preview & Validate**\n```\nBackend parse Excel â†’ Return preview:\n\n{\n  totalRows: 800,\n  validRows: 798,\n  errors: [\n    { row: 45, field: \"atasan_code\", error: \"EMP999 not found\" },\n    { row: 123, field: \"tgl_lahir\", error: \"Invalid date format\" }\n  ],\n  preview: [\n    { employee_code: \"EMP001\", nama: \"Andi\", ... },\n    // ... first 10 rows\n  ]\n}\n```\n\n**Step 4: Confirm & Process**\n```jsx\n{errors.length > 0 && (\n  <Alert variant=\"destructive\">\n    âš ï¸ {errors.length} rows have errors. Fix and re-upload?\n  </Alert>\n)}\n\n<Button onClick={confirmUpload} disabled={errors.length > 0}>\n  âœ… Confirm Upload ({validRows} employees)\n</Button>\n```\n\n---\n\n### 6.3 Upload Processing (Backend)\n\n**API Endpoint:** `POST /api/upload`\n\n**Request:**\n```javascript\nContent-Type: multipart/form-data\n\nBody:\n- file: Excel file (max 10MB)\n- period: YYYY-MM (e.g., \"2025-01\")\n```\n\n**Processing Steps:**\n\n```javascript\nasync function processExcelUpload(file, period, branchId, uploadedBy) {\n  // Step 1: Parse Excel\n  const workbook = XLSX.read(file.buffer);\n  const sheet = workbook.Sheets[\"Data\"];\n  const rows = XLSX.utils.sheet_to_json(sheet);\n  \n  // Step 2: Validate all rows\n  const validationErrors = [];\n  for (let i = 0; i < rows.length; i++) {\n    const row = rows[i];\n    \n    // Required fields\n    if (!row.employee_code) {\n      validationErrors.push({ row: i + 2, field: \"employee_code\", error: \"Required\" });\n    }\n    if (!row.nama) {\n      validationErrors.push({ row: i + 2, field: \"nama\", error: \"Required\" });\n    }\n    \n    // Valid position\n    const validPositions = [\"BC\", \"SBC\", \"BsM\", \"SBM\", \"EM\", \"SEM\", \"VBM\", \"SVBM\"];\n    if (!validPositions.includes(row.posisi)) {\n      validationErrors.push({ row: i + 2, field: \"posisi\", error: \"Invalid position\" });\n    }\n    \n    // Valid date\n    if (!isValidDate(row.tgl_lahir)) {\n      validationErrors.push({ row: i + 2, field: \"tgl_lahir\", error: \"Invalid date format (YYYY-MM-DD)\" });\n    }\n    \n    // Numeric margin/NA\n    if (isNaN(row.margin) || row.margin < 0) {\n      validationErrors.push({ row: i + 2, field: \"margin\", error: \"Must be numeric >= 0\" });\n    }\n    if (isNaN(row.na) || row.na < 0) {\n      validationErrors.push({ row: i + 2, field: \"na\", error: \"Must be integer >= 0\" });\n    }\n  }\n  \n  // Step 3: Build hierarchy tree (validate atasan_code)\n  const employeeMap = new Map(rows.map(r => [r.employee_code, r]));\n  \n  for (let i = 0; i < rows.length; i++) {\n    const row = rows[i];\n    \n    if (row.atasan_code && !employeeMap.has(row.atasan_code)) {\n      validationErrors.push({ \n        row: i + 2, \n        field: \"atasan_code\", \n        error: `Manager ${row.atasan_code} not found in Excel` \n      });\n    }\n  }\n  \n  // Step 4: Detect circular references\n  for (const row of rows) {\n    if (hasCircularReference(row.employee_code, employeeMap)) {\n      validationErrors.push({ \n        row: rows.indexOf(row) + 2, \n        error: \"Circular reference detected in hierarchy\" \n      });\n    }\n  }\n  \n  // Return validation errors (preview mode)\n  if (validationErrors.length > 0) {\n    return {\n      status: \"validation_failed\",\n      totalRows: rows.length,\n      validRows: rows.length - validationErrors.length,\n      errors: validationErrors,\n      preview: rows.slice(0, 10)\n    };\n  }\n  \n  // Step 5: Database transaction (insert/update)\n  await db.transaction(async (tx) => {\n    // Upsert employees\n    for (const row of rows) {\n      await tx.insert(employees).values({\n        employeeCode: row.employee_code,\n        name: row.nama,\n        position: row.posisi,\n        branchId: branchId,\n        managerId: row.atasan_code ? \n          (await tx.select().from(employees).where(eq(employees.employeeCode, row.atasan_code)).limit(1))[0]?.id : \n          null,\n        tanggalLahir: new Date(row.tgl_lahir),\n        email: row.email || null,\n      }).onConflictDoUpdate({\n        target: employees.employeeCode,\n        set: {\n          name: row.nama,\n          position: row.posisi,\n          managerId: /* ... */,\n          tanggalLahir: new Date(row.tgl_lahir),\n          email: row.email || null,\n          updatedAt: new Date(),\n        }\n      });\n      \n      // Create user account (if new employee)\n      const employee = await tx.select().from(employees)\n        .where(eq(employees.employeeCode, row.employee_code))\n        .limit(1);\n      \n      const existingUser = await tx.select().from(users)\n        .where(eq(users.employeeId, employee[0].id))\n        .limit(1);\n      \n      if (existingUser.length === 0) {\n        // Auto-create user account\n        const hashedPassword = await bcrypt.hash(\n          row.tgl_lahir.replace(/-/g, \"\"), // YYYYMMDD\n          10\n        );\n        \n        await tx.insert(users).values({\n          username: row.employee_code,\n          password: hashedPassword,\n          role: \"staff\",\n          employeeId: employee[0].id,\n          branchId: branchId,\n          mustChangePassword: true,\n        });\n      }\n      \n      // Upsert monthly_performance\n      await tx.insert(monthlyPerformance).values({\n        employeeId: employee[0].id,\n        period: period,\n        margin: row.margin,\n        na: row.na,\n        realityScore: row.margin / row.na,\n        zone: calculateZone(row.margin / row.na),\n        uploadSource: \"excel\",\n      }).onConflictDoUpdate({\n        target: [monthlyPerformance.employeeId, monthlyPerformance.period],\n        set: {\n          margin: row.margin,\n          na: row.na,\n          realityScore: row.margin / row.na,\n          zone: calculateZone(row.margin / row.na),\n          updatedAt: new Date(),\n        }\n      });\n    }\n    \n    // Log upload\n    await tx.insert(uploadLogs).values({\n      branchId: branchId,\n      uploadedBy: uploadedBy,\n      period: period,\n      fileName: file.originalname,\n      totalRows: rows.length,\n      successRows: rows.length,\n      errorRows: 0,\n      status: \"success\",\n    });\n  });\n  \n  return {\n    status: \"success\",\n    totalRows: rows.length,\n    successRows: rows.length,\n    message: `${rows.length} employees imported successfully`\n  };\n}\n```\n\n---\n\n### 6.4 Upload Performance\n\n**Scale Test:**\n- 800 rows Excel file: ~2MB\n- Parse time: ~5 seconds\n- Validation time: ~10 seconds\n- Database insert: ~30 seconds (transaction)\n- **Total time: ~45 seconds** âš¡\n\n**Optimization:**\n- Batch inserts (100 rows per query)\n- Indexes on employee_code, branch_id\n- Async processing (background job for 1000+ rows)\n\n---\n\n## 7. HIERARCHY MANAGEMENT\n\n### 7.1 Hierarchy Building (Auto from Excel)\n\n**Algorithm: Recursive Tree Builder**\n\n**Input:** Excel rows with `atasan_code` column\n\n**Output:** Hierarchy tree (parent-child relationships)\n\n**Process:**\n\n```javascript\nfunction buildHierarchy(rows) {\n  // Step 1: Create employee map\n  const employeeMap = new Map();\n  for (const row of rows) {\n    employeeMap.set(row.employee_code, {\n      ...row,\n      children: []\n    });\n  }\n  \n  // Step 2: Build parent-child relationships\n  const roots = []; // Top employees (no manager)\n  \n  for (const row of rows) {\n    if (row.atasan_code) {\n      const manager = employeeMap.get(row.atasan_code);\n      if (manager) {\n        manager.children.push(employeeMap.get(row.employee_code));\n      }\n    } else {\n      // No manager = top employee (VBM typically)\n      roots.push(employeeMap.get(row.employee_code));\n    }\n  }\n  \n  return { employeeMap, roots };\n}\n```\n\n**Example:**\n```javascript\nInput Excel:\nEMP001 | BC  | atasan: EMP050\nEMP002 | BC  | atasan: EMP050\nEMP050 | SBC | atasan: EMP100\nEMP100 | BsM | atasan: EMP200\nEMP200 | VBM | atasan: NULL\n\nOutput Tree:\nEMP200 (VBM)\nâ””â”€ EMP100 (BsM)\n   â””â”€ EMP050 (SBC)\n      â”œâ”€ EMP001 (BC)\n      â””â”€ EMP002 (BC)\n```\n\n---\n\n### 7.2 Circular Reference Detection\n\n**Problem:** A â†’ B â†’ C â†’ A (infinite loop!)\n\n**Detection Algorithm:**\n\n```javascript\nfunction hasCircularReference(employeeCode, employeeMap, visited = new Set()) {\n  if (visited.has(employeeCode)) {\n    return true; // Circular reference detected!\n  }\n  \n  visited.add(employeeCode);\n  \n  const employee = employeeMap.get(employeeCode);\n  if (!employee || !employee.atasan_code) {\n    return false; // Reached top, no circular reference\n  }\n  \n  return hasCircularReference(employee.atasan_code, employeeMap, visited);\n}\n```\n\n**Example Error:**\n```\nRow 45: Circular reference detected\n- EMP045 â†’ atasan: EMP046\n- EMP046 â†’ atasan: EMP047\n- EMP047 â†’ atasan: EMP045 âŒ LOOP!\n```\n\n---\n\n### 7.3 Get Subordinates (Recursive Query)\n\n**Use Case:** Staff view dashboard â†’ Show self + all subordinates\n\n**SQL Query (PostgreSQL Recursive CTE):**\n\n```sql\nWITH RECURSIVE subordinate_tree AS (\n  -- Base case: Start from current employee\n  SELECT \n    id, \n    employee_code, \n    name, \n    position, \n    manager_id,\n    0 as level\n  FROM employees\n  WHERE id = $employeeId\n  \n  UNION ALL\n  \n  -- Recursive case: Get all subordinates\n  SELECT \n    e.id,\n    e.employee_code,\n    e.name,\n    e.position,\n    e.manager_id,\n    st.level + 1\n  FROM employees e\n  INNER JOIN subordinate_tree st ON e.manager_id = st.id\n)\nSELECT * FROM subordinate_tree\nORDER BY level, name;\n```\n\n**Example:**\n```\nInput: employeeId = EMP100 (BsM)\n\nOutput:\nEMP100 (BsM) - level 0\nâ”œâ”€ EMP050 (SBC) - level 1\nâ”‚  â”œâ”€ EMP001 (BC) - level 2\nâ”‚  â””â”€ EMP002 (BC) - level 2\nâ””â”€ EMP051 (SBC) - level 1\n   â””â”€ EMP003 (BC) - level 2\n```\n\n---\n\n### 7.4 Bottom-Up Aggregation\n\n**Use Case:** Calculate total margin/NA for employee + subordinates\n\n**Algorithm:**\n\n```javascript\nasync function getAggregatedPerformance(employeeId, period) {\n  // Get all subordinates (including self)\n  const subordinates = await getSubordinates(employeeId);\n  \n  // Get monthly performance for all subordinates\n  const performances = await db.select()\n    .from(monthlyPerformance)\n    .where(\n      and(\n        inArray(monthlyPerformance.employeeId, subordinates.map(s => s.id)),\n        eq(monthlyPerformance.period, period)\n      )\n    );\n  \n  // Sum margin & NA\n  const totalMargin = performances.reduce((sum, p) => sum + Number(p.margin), 0);\n  const totalNA = performances.reduce((sum, p) => sum + p.na, 0);\n  const realityScore = totalNA > 0 ? totalMargin / totalNA : 0;\n  \n  return {\n    employeeCount: subordinates.length,\n    totalMargin,\n    totalNA,\n    realityScore,\n    zone: calculateZone(realityScore)\n  };\n}\n```\n\n**Example:**\n```\nEmployee: EMP100 (BsM)\nSubordinates: EMP050, EMP001, EMP002 (4 total including self)\n\nPersonal:\n- Margin: 120,000,000\n- NA: 25\n- Reality Score: 4,800,000 ðŸŸ© Success\n\nAggregated (personal + subordinates):\n- Total Margin: 185,000,000\n- Total NA: 43\n- Reality Score: 4,302,325 ðŸŸ© Success\n```\n\n---\n\n## 8. MONTHLY AUDIT WORKFLOW\n\n### 8.1 Monthly Cycle Overview\n\n**Timeline:**\n\n```\nDay 1-5: BrM upload Excel (updated margin + NA)\nDay 5-28: Staff isi 18 Pilar (monthly self-assessment)\nDay 28-30: BrM review completion rate\nDay 30: BrM export monthly report PDF\n```\n\n**Trigger:** Excel upload â†’ Auto-notify staff \"Data updated, isi 18 Pilar!\"\n\n---\n\n### 8.2 Staff Monthly Workflow\n\n**Step 1: Login & Check Dashboard**\n```\nStaff login â†’ Dashboard shows:\n\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  Andi Wijaya (EMP001 - BC)                    â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  ðŸ“… Period: Januari 2025                      â•‘\nâ•‘  ðŸ’° Margin: Rp 10,000,000                     â•‘\nâ•‘  ðŸ“Š NA: 5                                      â•‘\nâ•‘  ðŸŽ¯ Reality Score: Rp 2,000,000 ðŸŸ¨ Warning    â•‘\nâ•‘                                               â•‘\nâ•‘  âš ï¸ ALERT: Isi 18 Pilar bulan ini!           â•‘\nâ•‘  [Isi 18 Pilar Sekarang â†’]                   â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Step 2: Isi 18 Pilar (Self-Assessment)**\n```jsx\n<Form onSubmit={submitAudit}>\n  <h3>18 Pilar Assessment (Scale 1-5)</h3>\n  \n  {[1, 2, 3, ...18].map(pilarNum => (\n    <FormField\n      key={pilarNum}\n      name={`pilar${pilarNum}`}\n      label={`Pilar ${pilarNum}: ${PILAR_NAMES[pilarNum]}`}\n      render={({ field }) => (\n        <Select onValueChange={field.onChange}>\n          <SelectItem value=\"1\">1 - Sangat Kurang</SelectItem>\n          <SelectItem value=\"2\">2 - Kurang</SelectItem>\n          <SelectItem value=\"3\">3 - Cukup</SelectItem>\n          <SelectItem value=\"4\">4 - Baik</SelectItem>\n          <SelectItem value=\"5\">5 - Sangat Baik</SelectItem>\n        </Select>\n      )}\n    />\n  ))}\n  \n  <Button type=\"submit\">ðŸ’¾ Simpan Audit</Button>\n</Form>\n```\n\n**Step 3: System Calculate Scores**\n```javascript\n// Auto-calculated upon submit\nconst audit = {\n  employeeId: \"EMP001\",\n  period: \"2025-01\",\n  \n  // Personal data (from monthly_performance)\n  personalMargin: 10000000,\n  personalNA: 5,\n  personalRealityScore: 2000000,\n  \n  // Aggregated data (if has subordinates)\n  aggregatedMargin: await getAggregatedMargin(\"EMP001\"),\n  aggregatedNA: await getAggregatedNA(\"EMP001\"),\n  \n  // 18 Pilar scores\n  pilar1: 4,\n  pilar2: 3,\n  // ...\n  pilar18: 5,\n  \n  // Calculated\n  totalPilarScore: 72, // sum(pilar1...pilar18)\n  avgPilarScore: 4.0, // totalPilarScore / 18\n  zone: \"warning\", // based on realityScore\n  \n  // Auto-generated\n  swot: await generateSWOT(audit),\n  prodem: await generateProDem(audit),\n  julukan: await generateJulukan(audit),\n  \n  isComplete: true,\n  completedAt: new Date()\n};\n```\n\n**Step 4: View Result**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  âœ… Audit Berhasil Disimpan!                  â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Reality Score: Rp 2,000,000 ðŸŸ¨ Warning       â•‘\nâ•‘  Avg Pilar: 4.0 / 5.0                         â•‘\nâ•‘  Zone: Warning (Perlu Improvement!)           â•‘\nâ•‘                                               â•‘\nâ•‘  Julukan: \"Pejuang Tangguh\"                   â•‘\nâ•‘  Profile: Realistis - Achiever                â•‘\nâ•‘                                               â•‘\nâ•‘  [Lihat Detail â†’] [Export PDF â†’]             â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n---\n\n### 8.3 BrM Monitoring Dashboard\n\n**Overview Tab:**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  AXA 2 - Jakarta (Januari 2025)               â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Total Staff: 800                             â•‘\nâ•‘  Audit Progress: 720 / 800 (90%)              â•‘\nâ•‘                                               â•‘\nâ•‘  Zone Distribution:                           â•‘\nâ•‘  ðŸŸ© Success: 600 (75%)                        â•‘\nâ•‘  ðŸŸ¨ Warning: 100 (12.5%)                      â•‘\nâ•‘  ðŸŸ¥ Critical: 20 (2.5%)                       â•‘\nâ•‘  âšª Not Done: 80 (10%)                        â•‘\nâ•‘                                               â•‘\nâ•‘  Total Margin: Rp 6,400,000,000               â•‘\nâ•‘  Avg Reality Score: Rp 8,000,000              â•‘\nâ•‘                                               â•‘\nâ•‘  [Export Branch Report PDF â†’]                â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Staff List Tab (with filters):**\n```\n[Search: ___] [Filter Posisi: All â–¼] [Filter Zone: All â–¼]\n\nShowing 1-50 of 800\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Code   â”‚ Nama     â”‚ Posisi â”‚ Margin    â”‚ Zoneâ”‚ Status â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ EMP001 â”‚ Andi     â”‚ BC     â”‚ 10jt      â”‚ ðŸŸ¨  â”‚ âœ… Doneâ”‚\nâ”‚ EMP002 â”‚ Budi     â”‚ BC     â”‚ 15jt      â”‚ ðŸŸ©  â”‚ âœ… Doneâ”‚\nâ”‚ EMP003 â”‚ Charlie  â”‚ SBC    â”‚ 50jt      â”‚ ðŸŸ©  â”‚ âšª TODOâ”‚\nâ”‚ ... (47 more rows)                                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n[â—€ Prev] Page 1 of 16 [Next â–¶]\n```\n\n---\n\n### 8.4 Audit Completion Tracking\n\n**Database Query:**\n```sql\nSELECT \n  b.name as branch_name,\n  COUNT(e.id) as total_employees,\n  COUNT(a.id) as completed_audits,\n  ROUND(COUNT(a.id)::numeric / COUNT(e.id) * 100, 2) as completion_rate\nFROM branches b\nLEFT JOIN employees e ON e.branch_id = b.id\nLEFT JOIN audits a ON a.employee_id = e.id AND a.period = '2025-01'\nWHERE b.id = 'AXA2'\nGROUP BY b.id, b.name;\n```\n\n**Result:**\n```\nbranch_name         | total_employees | completed_audits | completion_rate\n--------------------+-----------------+------------------+----------------\nAXA 2 - Jakarta     | 800             | 720              | 90.00\n```\n\n**Alert Thresholds:**\n- âœ… >= 90%: Excellent (green)\n- âš ï¸ 70-89%: Good (yellow)\n- ðŸš¨ < 70%: Poor (red, send reminder!)\n\n---\n\n## 9. DASHBOARD & REPORTING\n\n### 9.1 Staff Dashboard\n\n**Personal Overview Card:**\n```jsx\n<Card data-testid=\"card-personal-overview\">\n  <CardHeader>\n    <CardTitle>{employee.name} ({employee.employeeCode})</CardTitle>\n    <CardDescription>{employee.position} - {branch.name}</CardDescription>\n  </CardHeader>\n  <CardContent>\n    <div className=\"grid grid-cols-2 gap-4\">\n      <div>\n        <p className=\"text-sm text-muted-foreground\">Margin</p>\n        <p className=\"text-2xl font-bold\">Rp {formatNumber(performance.margin)}</p>\n      </div>\n      <div>\n        <p className=\"text-sm text-muted-foreground\">NA</p>\n        <p className=\"text-2xl font-bold\">{performance.na}</p>\n      </div>\n      <div>\n        <p className=\"text-sm text-muted-foreground\">Reality Score</p>\n        <p className=\"text-2xl font-bold\">\n          Rp {formatNumber(performance.realityScore)} {getZoneIcon(performance.zone)}\n        </p>\n      </div>\n      <div>\n        <p className=\"text-sm text-muted-foreground\">Zone</p>\n        <Badge variant={getZoneVariant(performance.zone)}>\n          {performance.zone.toUpperCase()}\n        </Badge>\n      </div>\n    </div>\n  </CardContent>\n</Card>\n```\n\n**Subordinates Table (if manager):**\n```jsx\n{hasSubordinates && (\n  <Card data-testid=\"card-subordinates\">\n    <CardHeader>\n      <CardTitle>Bawahan Langsung ({subordinates.length})</CardTitle>\n    </CardHeader>\n    <CardContent>\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead>Nama</TableHead>\n            <TableHead>Posisi</TableHead>\n            <TableHead>Margin</TableHead>\n            <TableHead>Zone</TableHead>\n            <TableHead>Status Audit</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {subordinates.map(sub => (\n            <TableRow key={sub.id} data-testid={`row-subordinate-${sub.employeeCode}`}>\n              <TableCell>{sub.name}</TableCell>\n              <TableCell>{sub.position}</TableCell>\n              <TableCell>Rp {formatNumber(sub.margin)}</TableCell>\n              <TableCell>{getZoneIcon(sub.zone)}</TableCell>\n              <TableCell>\n                {sub.auditComplete ? \"âœ… Done\" : \"âšª Pending\"}\n              </TableCell>\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </CardContent>\n  </Card>\n)}\n```\n\n---\n\n### 9.2 BrM Dashboard\n\n**Branch Overview:**\n```jsx\n<div className=\"grid grid-cols-4 gap-4\">\n  <Card data-testid=\"card-total-employees\">\n    <CardHeader>\n      <CardTitle>Total Staff</CardTitle>\n    </CardHeader>\n    <CardContent>\n      <p className=\"text-4xl font-bold\">{stats.totalEmployees}</p>\n    </CardContent>\n  </Card>\n  \n  <Card data-testid=\"card-total-margin\">\n    <CardHeader>\n      <CardTitle>Total Margin</CardTitle>\n    </CardHeader>\n    <CardContent>\n      <p className=\"text-4xl font-bold\">Rp {formatNumber(stats.totalMargin)}</p>\n    </CardContent>\n  </Card>\n  \n  <Card data-testid=\"card-avg-reality-score\">\n    <CardHeader>\n      <CardTitle>Avg Reality Score</CardTitle>\n    </CardHeader>\n    <CardContent>\n      <p className=\"text-4xl font-bold\">Rp {formatNumber(stats.avgRealityScore)}</p>\n    </CardContent>\n  </Card>\n  \n  <Card data-testid=\"card-completion-rate\">\n    <CardHeader>\n      <CardTitle>Audit Progress</CardTitle>\n    </CardHeader>\n    <CardContent>\n      <p className=\"text-4xl font-bold\">{stats.completionRate}%</p>\n      <p className=\"text-sm text-muted-foreground\">\n        {stats.completedAudits} / {stats.totalEmployees}\n      </p>\n    </CardContent>\n  </Card>\n</div>\n```\n\n**Zone Distribution Chart:**\n```jsx\n<Card data-testid=\"card-zone-distribution\">\n  <CardHeader>\n    <CardTitle>Zone Distribution</CardTitle>\n  </CardHeader>\n  <CardContent>\n    <ResponsiveContainer width=\"100%\" height={300}>\n      <PieChart>\n        <Pie\n          data={[\n            { name: \"Success\", value: stats.successCount, fill: \"#10b981\" },\n            { name: \"Warning\", value: stats.warningCount, fill: \"#f59e0b\" },\n            { name: \"Critical\", value: stats.criticalCount, fill: \"#ef4444\" },\n          ]}\n          dataKey=\"value\"\n          label\n        />\n        <Tooltip />\n        <Legend />\n      </PieChart>\n    </ResponsiveContainer>\n  </CardContent>\n</Card>\n```\n\n---\n\n### 9.3 PDF Export\n\n**Staff Personal Report:**\n\n```\nStructure (12 pages):\n\nPage 1: Cover\n- Employee name, code, position\n- Branch name\n- Period (Januari 2025)\n- Logo AISG\n\nPage 2: Personal Data\n- Margin, NA, Reality Score\n- Zone (Success/Warning/Critical)\n- Avg Pilar Score\n\nPage 3-4: 18 Pilar Breakdown\n- Table: Pilar 1-18, score (1-5), description\n\nPage 5: Zone Analysis\n- Chart: Reality Score vs Threshold\n- Interpretation (Success/Warning/Critical)\n\nPage 6: SWOT Analysis\n- Strengths, Weaknesses, Opportunities, Threats\n\nPage 7: Employee Profile\n- ProDem (Profile + Demographic)\n- Personality type\n\nPage 8-9: Action Plan 30-60-90\n- 30 days: Focus areas\n- 60 days: Mid-term goals\n- 90 days: Long-term targets\n\nPage 10: Early Warning System\n- Alert if Critical zone\n- Recommended actions\n\nPage 11: Magic Section\n- Julukan (nickname)\n- Zodiak\n- Generasi (Gen X/Y/Z)\n\nPage 12: Summary & Signature\n- Overall performance summary\n- BrM signature area\n```\n\n**Implementation (PDFKit):**\n```javascript\nasync function generatePersonalPDF(employeeId, period) {\n  const doc = new PDFDocument();\n  const employee = await getEmployee(employeeId);\n  const performance = await getPerformance(employeeId, period);\n  const audit = await getAudit(employeeId, period);\n  \n  // Page 1: Cover\n  doc.fontSize(24).text(\"AUDIT REPORT\", { align: \"center\" });\n  doc.fontSize(18).text(employee.name, { align: \"center\" });\n  doc.fontSize(12).text(`${employee.employeeCode} - ${employee.position}`, { align: \"center\" });\n  doc.addPage();\n  \n  // Page 2: Personal Data\n  doc.fontSize(16).text(\"Personal Performance\");\n  doc.fontSize(12).text(`Margin: Rp ${formatNumber(performance.margin)}`);\n  doc.text(`NA: ${performance.na}`);\n  doc.text(`Reality Score: Rp ${formatNumber(performance.realityScore)}`);\n  doc.text(`Zone: ${performance.zone.toUpperCase()}`);\n  doc.addPage();\n  \n  // Page 3-4: 18 Pilar\n  doc.fontSize(16).text(\"18 Pilar Assessment\");\n  for (let i = 1; i <= 18; i++) {\n    doc.fontSize(12).text(`Pilar ${i}: ${PILAR_NAMES[i]} - Score: ${audit[`pilar${i}`]}/5`);\n  }\n  // ... more pages\n  \n  doc.end();\n  return doc;\n}\n```\n\n---\n\n## 10. API ENDPOINTS\n\n### 10.1 Authentication\n\n**POST /api/auth/login**\n```javascript\nRequest:\n{\n  \"username\": \"EMP001\",\n  \"password\": \"19900315\" // or changed password\n}\n\nResponse:\n{\n  \"success\": true,\n  \"user\": {\n    \"id\": \"USER_001\",\n    \"username\": \"EMP001\",\n    \"role\": \"staff\",\n    \"employeeId\": \"EMP001\",\n    \"branchId\": \"AXA2\",\n    \"mustChangePassword\": true\n  }\n}\n```\n\n**POST /api/auth/change-password**\n```javascript\nRequest:\n{\n  \"oldPassword\": \"19900315\",\n  \"newPassword\": \"MyNewPassword123\"\n}\n\nResponse:\n{\n  \"success\": true,\n  \"message\": \"Password changed successfully\"\n}\n```\n\n**POST /api/auth/forgot-password**\n```javascript\nRequest:\n{\n  \"username\": \"EMP001\"\n}\n\nResponse:\n{\n  \"success\": true,\n  \"questions\": [\n    \"Nama ibu kandung?\",\n    \"Kota tempat lahir?\"\n  ] // 2 of 3 questions, random\n}\n```\n\n**POST /api/auth/reset-password**\n```javascript\nRequest:\n{\n  \"username\": \"EMP001\",\n  \"answers\": {\n    \"question1\": \"Siti\",\n    \"question2\": \"Jakarta\"\n  },\n  \"newPassword\": \"MyNewPassword123\"\n}\n\nResponse:\n{\n  \"success\": true,\n  \"message\": \"Password reset successfully\"\n}\n```\n\n---\n\n### 10.2 Employee Management\n\n**GET /api/employees**\n```javascript\nQuery params:\n- branchId (required for BrM)\n- page (default: 1)\n- limit (default: 50)\n- search (optional)\n- position (optional filter)\n- zone (optional filter)\n\nResponse:\n{\n  \"employees\": [\n    {\n      \"id\": \"EMP001\",\n      \"employeeCode\": \"EMP001\",\n      \"name\": \"Andi Wijaya\",\n      \"position\": \"BC\",\n      \"margin\": 10000000,\n      \"na\": 5,\n      \"realityScore\": 2000000,\n      \"zone\": \"warning\",\n      \"auditComplete\": true\n    }\n  ],\n  \"total\": 800,\n  \"page\": 1,\n  \"pages\": 16\n}\n```\n\n**GET /api/employees/:id**\n```javascript\nResponse:\n{\n  \"id\": \"EMP001\",\n  \"employeeCode\": \"EMP001\",\n  \"name\": \"Andi Wijaya\",\n  \"email\": \"andi@gmail.com\",\n  \"position\": \"BC\",\n  \"branchId\": \"AXA2\",\n  \"managerId\": \"EMP050\",\n  \"tanggalLahir\": \"1990-03-15\",\n  \"isActive\": true\n}\n```\n\n**GET /api/employees/:id/subordinates**\n```javascript\nResponse:\n{\n  \"subordinates\": [\n    {\n      \"id\": \"EMP001\",\n      \"name\": \"Andi\",\n      \"position\": \"BC\",\n      \"margin\": 10000000,\n      \"zone\": \"warning\",\n      \"level\": 1 // 1 = direct report, 2 = indirect, etc.\n    }\n  ],\n  \"total\": 50\n}\n```\n\n---\n\n### 10.3 Excel Upload\n\n**POST /api/upload**\n```javascript\nRequest:\nContent-Type: multipart/form-data\nBody:\n- file: Excel file\n- period: \"2025-01\"\n\nResponse (validation mode):\n{\n  \"status\": \"validation_failed\",\n  \"totalRows\": 800,\n  \"validRows\": 798,\n  \"errors\": [\n    { \"row\": 45, \"field\": \"atasan_code\", \"error\": \"EMP999 not found\" }\n  ],\n  \"preview\": [ /* first 10 rows */ ]\n}\n\nResponse (success):\n{\n  \"status\": \"success\",\n  \"totalRows\": 800,\n  \"successRows\": 800,\n  \"message\": \"800 employees imported successfully\"\n}\n```\n\n**GET /api/upload/template**\n```javascript\nResponse: Excel file download\nHeaders:\n- Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\n- Content-Disposition: attachment; filename=\"Template_Upload_Employee.xlsx\"\n```\n\n**GET /api/upload/history**\n```javascript\nQuery params:\n- branchId (required for BrM)\n- page (default: 1)\n\nResponse:\n{\n  \"logs\": [\n    {\n      \"id\": \"LOG_001\",\n      \"fileName\": \"AXA2_Jan2025.xlsx\",\n      \"period\": \"2025-01\",\n      \"totalRows\": 800,\n      \"successRows\": 798,\n      \"errorRows\": 2,\n      \"status\": \"partial\",\n      \"createdAt\": \"2025-01-05T10:30:00Z\"\n    }\n  ]\n}\n```\n\n---\n\n### 10.4 Audit Management\n\n**POST /api/audits**\n```javascript\nRequest:\n{\n  \"employeeId\": \"EMP001\",\n  \"period\": \"2025-01\",\n  \"pilar1\": 4,\n  \"pilar2\": 3,\n  // ... pilar3-18\n  \"pilar18\": 5\n}\n\nResponse:\n{\n  \"id\": \"AUDIT_001\",\n  \"employeeId\": \"EMP001\",\n  \"period\": \"2025-01\",\n  \"totalPilarScore\": 72,\n  \"avgPilarScore\": 4.0,\n  \"realityScore\": 2000000,\n  \"zone\": \"warning\",\n  \"julukan\": \"Pejuang Tangguh\",\n  \"isComplete\": true\n}\n```\n\n**GET /api/audits/:employeeId/:period**\n```javascript\nResponse:\n{\n  \"audit\": { /* full audit object */ },\n  \"swot\": {\n    \"strengths\": [\"Konsisten\", \"Disiplin\"],\n    \"weaknesses\": [\"Margin rendah\"],\n    \"opportunities\": [\"Market expansion\"],\n    \"threats\": [\"High competition\"]\n  },\n  \"actionPlan\": {\n    \"days30\": [\"Focus on closing deals\"],\n    \"days60\": [\"Expand network\"],\n    \"days90\": [\"Achieve 5jt target\"]\n  }\n}\n```\n\n---\n\n### 10.5 Dashboard Analytics\n\n**GET /api/dashboard/branch/:branchId**\n```javascript\nQuery params:\n- period: \"2025-01\"\n\nResponse:\n{\n  \"totalEmployees\": 800,\n  \"completedAudits\": 720,\n  \"completionRate\": 90,\n  \"totalMargin\": 6400000000,\n  \"avgRealityScore\": 8000000,\n  \"zoneDistribution\": {\n    \"success\": 600,\n    \"warning\": 150,\n    \"critical\": 50\n  }\n}\n```\n\n**GET /api/dashboard/personal/:employeeId**\n```javascript\nQuery params:\n- period: \"2025-01\"\n\nResponse:\n{\n  \"personal\": {\n    \"margin\": 10000000,\n    \"na\": 5,\n    \"realityScore\": 2000000,\n    \"zone\": \"warning\"\n  },\n  \"aggregated\": {\n    \"totalMargin\": 185000000,\n    \"totalNA\": 43,\n    \"realityScore\": 4302325,\n    \"zone\": \"success\",\n    \"subordinateCount\": 50\n  },\n  \"auditComplete\": true\n}\n```\n\n---\n\n### 10.6 PDF Export\n\n**GET /api/export/personal/:employeeId/:period**\n```javascript\nResponse: PDF file download\nHeaders:\n- Content-Type: application/pdf\n- Content-Disposition: attachment; filename=\"Audit_EMP001_Jan2025.pdf\"\n```\n\n**GET /api/export/branch/:branchId/:period**\n```javascript\nResponse: PDF file download (branch summary report)\n```\n\n---\n\n## 11. UI/UX DESIGN\n\n### 11.1 Design System\n\n**Color Palette (Dark Mode Primary):**\n```css\n:root {\n  --background: 222 47% 11%;\n  --foreground: 213 31% 91%;\n  \n  --primary: 210 100% 50%; /* Blue gradient */\n  --primary-foreground: 0 0% 100%;\n  \n  --success: 142 76% 36%; /* Green - Zone Success */\n  --warning: 38 92% 50%; /* Yellow - Zone Warning */\n  --critical: 0 84% 60%; /* Red - Zone Critical */\n  \n  --card: 224 71% 4%;\n  --border: 216 34% 17%;\n}\n```\n\n**Zone Color Coding:**\n- ðŸŸ© Success: `bg-success` (green, â‰¥4jt)\n- ðŸŸ¨ Warning: `bg-warning` (yellow, â‰¥2jt)\n- ðŸŸ¥ Critical: `bg-critical` (red, <2jt)\n\n**Typography:**\n- Headings: Inter font, font-bold\n- Body: Inter font, font-normal\n- Numbers: font-mono (for alignment)\n\n---\n\n### 11.2 Layout Structure\n\n**Global Layout:**\n```jsx\n<SidebarProvider>\n  <div className=\"flex h-screen w-full\">\n    <AppSidebar /> {/* Sticky left sidebar */}\n    <div className=\"flex flex-col flex-1\">\n      <Header /> {/* Sticky top header */}\n      <main className=\"flex-1 overflow-auto p-6\">\n        <Router /> {/* Page content */}\n      </main>\n    </div>\n  </div>\n</SidebarProvider>\n```\n\n**Sidebar Menu (Role-based):**\n```jsx\n// Super Admin\n- ðŸ¢ Branches\n- ðŸ‘¥ Users\n- ðŸ“Š Dashboard (All)\n- âš™ï¸ Settings\n\n// BrM\n- ðŸ“¤ Upload Excel\n- ðŸ‘¥ Staff List\n- ðŸ“Š Dashboard\n- ðŸ“„ Reports\n\n// Staff\n- ðŸ  Dashboard\n- ðŸ“ Isi Audit\n- ðŸ‘¥ Bawahan\n- ðŸ“„ Export PDF\n```\n\n---\n\n### 11.3 Key Pages\n\n**Page 1: Login**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘         AISG ENTERPRISE               â•‘\nâ•‘                                       â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘\nâ•‘  â”‚ Username: _____________________ â”‚  â•‘\nâ•‘  â”‚ Password: _____________________ â”‚  â•‘\nâ•‘  â”‚                                 â”‚  â•‘\nâ•‘  â”‚ [Login â†’]                       â”‚  â•‘\nâ•‘  â”‚                                 â”‚  â•‘\nâ•‘  â”‚ Lupa Password?                  â”‚  â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Page 2: BrM - Upload Excel**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  Upload Data Karyawan                         â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  Period: [Januari 2025 â–¼]                     â•‘\nâ•‘                                               â•‘\nâ•‘  Step 1: Download Template                    â•‘\nâ•‘  [ðŸ“¥ Download Template Excel]                 â•‘\nâ•‘                                               â•‘\nâ•‘  Step 2: Upload File                          â•‘\nâ•‘  [Choose File...] [ðŸ“¤ Upload]                 â•‘\nâ•‘                                               â•‘\nâ•‘  Step 3: Review & Confirm                     â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘\nâ•‘  â”‚ Total: 800 rows                       â”‚    â•‘\nâ•‘  â”‚ Valid: 798 âœ…                         â”‚    â•‘\nâ•‘  â”‚ Errors: 2 âŒ                          â”‚    â•‘\nâ•‘  â”‚                                       â”‚    â•‘\nâ•‘  â”‚ Row 45: Invalid atasan_code           â”‚    â•‘\nâ•‘  â”‚ Row 123: Invalid tgl_lahir            â”‚    â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘\nâ•‘                                               â•‘\nâ•‘  [Fix Errors] [Confirm Upload â†’]             â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n**Page 3: Staff - Dashboard**\n```\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\nâ•‘  Andi Wijaya (EMP001 - BC)                    â•‘\nâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘\nâ•‘  â”‚ Margin       â”‚ NA           â”‚ Reality    â”‚ â•‘\nâ•‘  â”‚ Rp 10,000,000â”‚ 5            â”‚ Rp 2,000,000â”‚ â•‘\nâ•‘  â”‚              â”‚              â”‚ ðŸŸ¨ Warning â”‚ â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘\nâ•‘                                               â•‘\nâ•‘  âš ï¸ ALERT: Isi 18 Pilar bulan ini!           â•‘\nâ•‘  [Isi 18 Pilar Sekarang â†’]                   â•‘\nâ•‘                                               â•‘\nâ•‘  Bawahan Langsung (50 orang)                  â•‘\nâ•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â” â•‘\nâ•‘  â”‚ Nama   â”‚ Posisi  â”‚ Margin  â”‚ Zone â”‚Auditâ”‚ â•‘\nâ•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤ â•‘\nâ•‘  â”‚ Budi   â”‚ BC      â”‚ 15jt    â”‚ ðŸŸ©   â”‚ âœ…  â”‚ â•‘\nâ•‘  â”‚ ...    â”‚ ...     â”‚ ...     â”‚ ...  â”‚ ... â”‚ â•‘\nâ•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜ â•‘\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n```\n\n---\n\n### 11.4 Responsive Design\n\n**Breakpoints:**\n- Mobile: < 768px (single column)\n- Tablet: 768px - 1024px (2 columns)\n- Desktop: > 1024px (3-4 columns)\n\n**Mobile Considerations:**\n- Collapsible sidebar (hamburger menu)\n- Stacked cards (no grid)\n- Table â†’ horizontal scroll\n- Touch-friendly buttons (min 44px)\n\n---\n\n## 12. IMPLEMENTATION ROADMAP\n\n### 12.1 Phase 1: Foundation (Day 1-2)\n\n**Tasks:**\n\n1. **Database Setup**\n   - [ ] Create tables (users, employees, branches, etc.)\n   - [ ] Run migrations (`npm run db:push`)\n   - [ ] Seed initial data (1 superadmin, 1 branch)\n\n2. **Authentication System**\n   - [ ] Login API (`POST /api/auth/login`)\n   - [ ] Session management (express-session)\n   - [ ] Password hashing (bcrypt)\n   - [ ] Middleware (requireAuth, requireRole)\n\n3. **Basic UI**\n   - [ ] Login page\n   - [ ] Layout (sidebar, header)\n   - [ ] Role-based routing\n\n**Deliverable:** Working login system (super admin can login)\n\n---\n\n### 12.2 Phase 2: Excel Upload (Day 2-3)\n\n**Tasks:**\n\n1. **Backend**\n   - [ ] Upload API (`POST /api/upload`)\n   - [ ] Excel parsing (XLSX library)\n   - [ ] Validation logic (employee code, hierarchy)\n   - [ ] Database insert (employees, users, monthly_performance)\n\n2. **Frontend**\n   - [ ] Upload page (download template, upload file)\n   - [ ] Preview table (validation results)\n   - [ ] Confirm/cancel flow\n\n3. **Testing**\n   - [ ] Test 800 rows upload\n   - [ ] Test validation errors\n   - [ ] Test hierarchy building\n\n**Deliverable:** BrM can upload 800 employees via Excel\n\n---\n\n### 12.3 Phase 3: Staff Onboarding (Day 3-4)\n\n**Tasks:**\n\n1. **Password Strategy**\n   - [ ] Auto-create user accounts (password = tgl_lahir)\n   - [ ] Force password change (first login)\n   - [ ] Security questions setup\n\n2. **Password Reset**\n   - [ ] Forgot password flow\n   - [ ] Security questions validation\n   - [ ] Reset password API\n\n3. **Staff Dashboard**\n   - [ ] Personal overview card\n   - [ ] View margin, NA, reality score\n   - [ ] View subordinates (if manager)\n\n**Deliverable:** Staff can login, change password, view dashboard\n\n---\n\n### 12.4 Phase 4: Audit System (Day 4-5)\n\n**Tasks:**\n\n1. **18 Pilar Form**\n   - [ ] Form UI (18 fields, scale 1-5)\n   - [ ] Form validation (Zod)\n   - [ ] Submit API (`POST /api/audits`)\n\n2. **Score Calculation**\n   - [ ] Reality Score (margin / NA)\n   - [ ] Zone calculation (success/warning/critical)\n   - [ ] Avg Pilar Score\n   - [ ] SWOT, ProDem, Julukan generation\n\n3. **Dashboard Updates**\n   - [ ] Show audit status (complete/pending)\n   - [ ] Show scores & zones\n   - [ ] Alert: \"Isi 18 Pilar!\"\n\n**Deliverable:** Staff can complete monthly audit\n\n---\n\n### 12.5 Phase 5: Dashboard & Reports (Day 5-6)\n\n**Tasks:**\n\n1. **BrM Dashboard**\n   - [ ] Branch overview (total staff, margin, completion rate)\n   - [ ] Zone distribution chart\n   - [ ] Staff list (filterable, paginated)\n\n2. **PDF Export**\n   - [ ] Personal report (12 pages, PDFKit)\n   - [ ] Branch report (summary)\n   - [ ] Download endpoints\n\n3. **Analytics**\n   - [ ] Bottom-up aggregation (recursive CTE)\n   - [ ] Completion tracking\n   - [ ] Zone distribution\n\n**Deliverable:** BrM can view dashboard & export PDF\n\n---\n\n### 12.6 Phase 6: Polish & Testing (Day 6-7)\n\n**Tasks:**\n\n1. **UI Polish**\n   - [ ] Dark mode consistency\n   - [ ] Loading states\n   - [ ] Error messages\n   - [ ] Responsive design (mobile)\n\n2. **Testing**\n   - [ ] Unit tests (business logic)\n   - [ ] Integration tests (API endpoints)\n   - [ ] E2E tests (user flows)\n   - [ ] Performance tests (800 rows upload)\n\n3. **Documentation**\n   - [ ] Update replit.md\n   - [ ] API documentation\n   - [ ] User guide (PDF)\n\n**Deliverable:** Production-ready MVP\n\n---\n\n### 12.7 Timeline Summary\n\n| Phase | Duration | Key Deliverable |\n|-------|----------|-----------------|\n| 1. Foundation | 1-2 days | Login system |\n| 2. Excel Upload | 1 day | BrM upload 800 employees |\n| 3. Staff Onboarding | 1 day | Staff login & dashboard |\n| 4. Audit System | 1 day | Staff complete audit |\n| 5. Dashboard & Reports | 1 day | BrM dashboard & PDF |\n| 6. Polish & Testing | 1 day | Production ready |\n| **TOTAL** | **5-7 days** | **MVP Complete** |\n\n---\n\n## 13. TESTING STRATEGY\n\n### 13.1 Unit Tests\n\n**Business Logic Tests:**\n\n```typescript\n// test/business-logic.test.ts\n\ndescribe(\"Reality Score Calculation\", () => {\n  it(\"should calculate correctly\", () => {\n    const margin = 10000000;\n    const na = 5;\n    const expected = 2000000;\n    \n    const result = calculateRealityScore(margin, na);\n    \n    expect(result).toBe(expected);\n  });\n  \n  it(\"should handle division by zero\", () => {\n    const margin = 10000000;\n    const na = 0;\n    \n    const result = calculateRealityScore(margin, na);\n    \n    expect(result).toBe(0);\n  });\n});\n\ndescribe(\"Zone Classification\", () => {\n  it(\"should classify as success (>=4jt)\", () => {\n    expect(calculateZone(5000000)).toBe(\"success\");\n  });\n  \n  it(\"should classify as warning (>=2jt, <4jt)\", () => {\n    expect(calculateZone(3000000)).toBe(\"warning\");\n  });\n  \n  it(\"should classify as critical (<2jt)\", () => {\n    expect(calculateZone(1000000)).toBe(\"critical\");\n  });\n});\n```\n\n---\n\n### 13.2 Integration Tests\n\n**API Tests:**\n\n```typescript\n// test/api/upload.test.ts\n\ndescribe(\"POST /api/upload\", () => {\n  it(\"should upload valid Excel file\", async () => {\n    const file = createTestExcel(800); // 800 valid rows\n    \n    const res = await request(app)\n      .post(\"/api/upload\")\n      .attach(\"file\", file)\n      .field(\"period\", \"2025-01\");\n    \n    expect(res.status).toBe(200);\n    expect(res.body.status).toBe(\"success\");\n    expect(res.body.successRows).toBe(800);\n  });\n  \n  it(\"should detect validation errors\", async () => {\n    const file = createTestExcel(800, {\n      invalidRows: [\n        { row: 45, field: \"atasan_code\", value: \"INVALID\" }\n      ]\n    });\n    \n    const res = await request(app)\n      .post(\"/api/upload\")\n      .attach(\"file\", file);\n    \n    expect(res.status).toBe(400);\n    expect(res.body.status).toBe(\"validation_failed\");\n    expect(res.body.errors).toHaveLength(1);\n  });\n  \n  it(\"should reject large files (>10MB)\", async () => {\n    const file = createLargeExcel(5000); // 5000 rows = ~12MB\n    \n    const res = await request(app)\n      .post(\"/api/upload\")\n      .attach(\"file\", file);\n    \n    expect(res.status).toBe(413); // Payload Too Large\n  });\n});\n```\n\n---\n\n### 13.3 E2E Tests\n\n**User Flow Tests:**\n\n```typescript\n// test/e2e/brm-workflow.test.ts\n\ndescribe(\"BrM Monthly Workflow\", () => {\n  it(\"should complete monthly upload cycle\", async () => {\n    // 1. BrM login\n    await page.goto(\"/\");\n    await page.fill('[data-testid=\"input-username\"]', 'brm_axa2');\n    await page.fill('[data-testid=\"input-password\"]', 'temp123');\n    await page.click('[data-testid=\"button-login\"]');\n    \n    // 2. Navigate to upload\n    await page.click('[data-testid=\"link-upload\"]');\n    \n    // 3. Download template\n    const [download] = await Promise.all([\n      page.waitForEvent('download'),\n      page.click('[data-testid=\"button-download-template\"]')\n    ]);\n    expect(download.suggestedFilename()).toBe('Template_Upload_Employee.xlsx');\n    \n    // 4. Upload file\n    await page.setInputFiles('[data-testid=\"input-upload-excel\"]', 'test/fixtures/AXA2_Jan2025.xlsx');\n    await page.click('[data-testid=\"button-upload\"]');\n    \n    // 5. Confirm upload\n    await page.waitForSelector('[data-testid=\"preview-table\"]');\n    await page.click('[data-testid=\"button-confirm-upload\"]');\n    \n    // 6. Verify success\n    await expect(page.locator('[data-testid=\"text-upload-status\"]')).toHaveText('âœ… 800 employees uploaded');\n  });\n});\n```\n\n---\n\n### 13.4 Performance Tests\n\n**Load Tests:**\n\n```javascript\n// test/performance/upload-load.test.js\n\nimport http from 'k6/http';\nimport { check } from 'k6';\n\nexport let options = {\n  stages: [\n    { duration: '1m', target: 10 }, // Ramp-up\n    { duration: '3m', target: 10 }, // Steady state\n    { duration: '1m', target: 0 },  // Ramp-down\n  ],\n};\n\nexport default function () {\n  const file = open('./fixtures/AXA2_800rows.xlsx', 'b');\n  \n  const res = http.post('http://localhost:5000/api/upload', {\n    file: http.file(file, 'AXA2_800rows.xlsx'),\n    period: '2025-01'\n  });\n  \n  check(res, {\n    'status is 200': (r) => r.status === 200,\n    'upload time < 60s': (r) => r.timings.duration < 60000,\n  });\n}\n```\n\n**Expected Results:**\n- Upload 800 rows: < 60 seconds\n- Concurrent uploads (10 BrMs): < 2 minutes each\n- Database queries: < 500ms\n- Page load: < 2 seconds\n\n---\n\n## 14. FUTURE ENHANCEMENTS (Post-MVP)\n\n### 14.1 BAS API Integration\n\n**Purpose:** Replace manual Excel upload with auto-sync from BAS\n\n**Implementation:**\n- Daily cron job: Pull data from BAS API\n- Incremental sync (only changed employees)\n- Conflict resolution (BAS vs manual changes)\n\n**Timeline:** 2-3 weeks post-MVP\n\n---\n\n### 14.2 PT/Legal Entity Reporting\n\n**Purpose:** Cross-branch aggregation by PT\n\n**Features:**\n- Owner dashboard (all 5 PTs)\n- CEO dashboard (assigned PTs)\n- PT-level performance tracking\n\n**Timeline:** 2 weeks post-MVP\n\n---\n\n### 14.3 CBO/CEO/Owner Roles\n\n**Purpose:** Strategic-level access control\n\n**Features:**\n- CBO: Manage multiple branches (5-10)\n- CEO: Manage PT (all branches under PT)\n- Owner: View all data (read-only)\n\n**Timeline:** 1 week post-MVP\n\n---\n\n### 14.4 Notification System\n\n**Purpose:** Email/SMS alerts for audit reminders\n\n**Features:**\n- Daily digest (completion rate)\n- Reminder: \"Isi 18 Pilar sebelum tanggal X\"\n- Alert: Critical zone employees\n\n**Timeline:** 1 week post-MVP\n\n---\n\n### 14.5 Advanced Analytics\n\n**Purpose:** Trend analysis, forecasting\n\n**Features:**\n- 6-month trend charts (margin, NA, reality score)\n- Predictive analytics (zone forecasting)\n- Comparative analysis (branch vs branch)\n\n**Timeline:** 2 weeks post-MVP\n\n---\n\n## 15. APPENDIX\n\n### 15.1 18 Pilar Names\n\n```javascript\nexport const PILAR_NAMES = {\n  1: \"Keyakinan & Ketaqwaan\",\n  2: \"Kejujuran\",\n  3: \"Tanggung Jawab\",\n  4: \"Kepercayaan\",\n  5: \"Keadilan\",\n  6: \"Kepemimpinan\",\n  7: \"Kerjasama\",\n  8: \"Keseimbangan\",\n  9: \"Ketekunan\",\n  10: \"Kesabaran\",\n  11: \"Keberanian\",\n  12: \"Komitmen\",\n  13: \"Inovasi\",\n  14: \"Visi\",\n  15: \"Komunikasi\",\n  16: \"Adaptasi\",\n  17: \"Empati\",\n  18: \"Integritas\"\n};\n```\n\n---\n\n### 15.2 Position Levels (Hierarchy Order)\n\n```javascript\nexport const POSITION_LEVELS = {\n  \"BC\": 1,   // Business Consultant (bottom)\n  \"SBC\": 2,  // Senior Business Consultant\n  \"BsM\": 3,  // Business Manager\n  \"SBM\": 4,  // Senior Business Manager\n  \"EM\": 5,   // Equity Manager\n  \"SEM\": 6,  // Senior Equity Manager\n  \"VBM\": 7,  // Vice Branch Manager\n  \"SVBM\": 8, // Senior Vice Branch Manager (top employee)\n};\n```\n\n---\n\n### 15.3 Security Questions Pool\n\n```javascript\nexport const SECURITY_QUESTIONS = [\n  \"Nama ibu kandung?\",\n  \"Kota tempat lahir?\",\n  \"Nama sekolah SD?\",\n  // Future expansion:\n  // \"Nama hewan peliharaan pertama?\",\n  // \"Makanan favorit?\",\n  // \"Warna favorit?\",\n];\n```\n\n---\n\n### 15.4 Zone Thresholds\n\n```javascript\nexport const ZONE_THRESHOLDS = {\n  SUCCESS: 4000000,  // >= 4jt\n  WARNING: 2000000,  // >= 2jt, < 4jt\n  CRITICAL: 0,       // < 2jt\n};\n\nexport function calculateZone(realityScore: number): string {\n  if (realityScore >= ZONE_THRESHOLDS.SUCCESS) return \"success\";\n  if (realityScore >= ZONE_THRESHOLDS.WARNING) return \"warning\";\n  return \"critical\";\n}\n```\n\n---\n\n## ðŸ“ DOCUMENT SIGN-OFF\n\n**Author:** Replit Agent  \n**Reviewed By:** [User Name]  \n**Approved By:** [User Name]  \n**Date:** November 13, 2025  \n\n**Status:** âœ… Ready for Implementation\n\n**Next Steps:**\n1. User review & approval\n2. Begin Phase 1 (Foundation)\n3. Daily progress updates\n\n---\n\n**END OF DOCUMENT**\n","size_bytes":72037},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest<T = unknown>(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<T> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return await res.json();\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1402},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n        zone: {\n          success: \"hsl(var(--zone-success) / <alpha-value>)\",\n          \"success-foreground\": \"hsl(var(--zone-success-foreground) / <alpha-value>)\",\n          warning: \"hsl(var(--zone-warning) / <alpha-value>)\",\n          \"warning-foreground\": \"hsl(var(--zone-warning-foreground) / <alpha-value>)\",\n          critical: \"hsl(var(--zone-critical) / <alpha-value>)\",\n          \"critical-foreground\": \"hsl(var(--zone-critical-foreground) / <alpha-value>)\",\n        },\n        magic: {\n          DEFAULT: \"hsl(var(--magic) / <alpha-value>)\",\n          foreground: \"hsl(var(--magic-foreground) / <alpha-value>)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4685},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/AuditCard.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport ZoneBadge, { ZoneType } from \"./ZoneBadge\";\nimport ProfileBadge, { ProfileType } from \"./ProfileBadge\";\nimport { Calendar, Building2, User, Eye, Trash2 } from \"lucide-react\";\n\ninterface AuditCardProps {\n  auditId: string;\n  nama: string;\n  jabatan: string;\n  cabang: string;\n  zonaKinerja: ZoneType;\n  zonaPerilaku: ZoneType;\n  profil: ProfileType;\n  tanggal: string;\n  onView?: () => void;\n  onDelete?: () => void;\n  \"data-testid\"?: string;\n}\n\nexport default function AuditCard({\n  auditId,\n  nama,\n  jabatan,\n  cabang,\n  zonaKinerja,\n  zonaPerilaku,\n  profil,\n  tanggal,\n  onView,\n  onDelete,\n  \"data-testid\": testId\n}: AuditCardProps) {\n  return (\n    <Card className=\"p-6 hover-elevate\" data-testid={testId}>\n      <div className=\"flex flex-col gap-4\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <code className=\"text-xs font-mono text-muted-foreground\" data-testid={`${testId}-id`}>\n                {auditId}\n              </code>\n              <ProfileBadge type={profil} size=\"sm\" data-testid={`${testId}-profile`} />\n            </div>\n            <h3 className=\"font-semibold text-lg mb-1 truncate\" data-testid={`${testId}-nama`}>{nama}</h3>\n            <div className=\"flex flex-col gap-1 text-sm text-muted-foreground\">\n              <div className=\"flex items-center gap-2\">\n                <User className=\"w-3.5 h-3.5\" />\n                <span>{jabatan}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Building2 className=\"w-3.5 h-3.5\" />\n                <span>{cabang}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Calendar className=\"w-3.5 h-3.5\" />\n                <span>{tanggal}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col gap-2\">\n          <div className=\"flex items-center gap-2 text-xs\">\n            <span className=\"text-muted-foreground whitespace-nowrap w-[70px]\">Kinerja:</span>\n            <ZoneBadge type={zonaKinerja} size=\"sm\" data-testid={`${testId}-zona-kinerja`} />\n          </div>\n          <div className=\"flex items-center gap-2 text-xs\">\n            <span className=\"text-muted-foreground whitespace-nowrap w-[70px]\">Perilaku:</span>\n            <ZoneBadge type={zonaPerilaku} size=\"sm\" data-testid={`${testId}-zona-perilaku`} />\n          </div>\n        </div>\n\n        <div className=\"flex gap-2\">\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            className=\"flex-1\" \n            onClick={onView}\n            data-testid={`${testId}-view-button`}\n          >\n            <Eye className=\"w-4 h-4 mr-2\" />\n            Lihat Detail\n          </Button>\n          {onDelete && (\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={onDelete}\n              data-testid={`${testId}-delete-button`}\n            >\n              <Trash2 className=\"w-4 h-4\" />\n            </Button>\n          )}\n        </div>\n      </div>\n    </Card>\n  );\n}\n","size_bytes":3276},"attached_assets/aisg_instruction_builder_1762750119668.md":{"content":"# =====================================\n# AISG_INSTRUCTION_BUILDER.md\n# Sistem Audit AiSG â€“ File Inti 4 (INSTRUKSI BUILDER)\n# =====================================\n\n## ðŸ§­ FUNGSI FILE INI\nFile ini berisi **petunjuk utama** untuk menjalankan sistem AiSG di lingkungan GPT Builder.  \nGunakan file ini sebagai **panduan penghubung** antara file yang diunggah di Knowledge dan kolom Instruction di Builder.\n\n---\n\n## âš™ï¸ 1. STRUKTUR FILE DI KNOWLEDGE\nUnggah total **8 file** ke Knowledge:\n\n### ðŸ“˜ File Inti (Global)\n1ï¸âƒ£ AISG_CORE_BASE.md  \n2ï¸âƒ£ AISG_CORE_AUDIT_GUIDE.md  \n3ï¸âƒ£ AISG_CORE_MOTIVATION.md  \n4ï¸âƒ£ AISG_INSTRUCTION_BUILDER.md  \n\n### ðŸ¢ File Data per Cabang (Dinamis)\n5ï¸âƒ£ ASSESSMENT_[NAMA_CABANG].txt  \n6ï¸âƒ£ DATA_[NAMA_CABANG].txt  \n7ï¸âƒ£ DATA_GABUNGAN_[NAMA_CABANG].txt  \n8ï¸âƒ£ HIRARKI_[NAMA_CABANG].txt  \n\n---\n\n## ðŸ§© 2. PETUNJUK UNTUK BUILDER\nSalin isi dari **INSTRUKSI_BUILDER_AISG.txt** ke kolom *Instruction* di GPT Builder.\n\nLalu ubah baris berikut sesuai cabang aktif:\n```\n[nama_cabang] = NAMA_CABANG\n```\nContoh:\n```\n[nama_cabang] = EWF_SSC\n```\n\nSetelah diganti, sistem otomatis akan membaca data cabang yang sesuai dan menghubungkan semua komponen dari Knowledge.\n\n---\n\n## ðŸ§  3. TIPS PENGGUNAAN\n- Gunakan format UTF-8 untuk semua file `.txt` agar builder bisa membaca karakter khusus dengan benar.\n- Pastikan nama file sesuai **huruf besarâ€“kecilnya** (case sensitive).\n- Setiap kali mengganti cabang, cukup ubah nilai `[nama_cabang]` saja, tidak perlu upload ulang file markdown core.\n- Gunakan patch fallback untuk menghindari error saat data assessment belum lengkap.\n\n---\n\n## âœ… 4. DAFTAR FILE INTI SISTEM (REFERENSI)\n| No | Nama File | Fungsi Utama |\n|----|------------|--------------|\n| 1ï¸âƒ£ | AISG_CORE_BASE.md | Aturan sistem, patch, profil cabang |\n| 2ï¸âƒ£ | AISG_CORE_AUDIT_GUIDE.md | Format audit 12 bagian + 18 pilar |\n| 3ï¸âƒ£ | AISG_CORE_MOTIVATION.md | Skema ProDem, quotes, dan zodiak booster |\n| 4ï¸âƒ£ | AISG_INSTRUCTION_BUILDER.md | Panduan koneksi Builder + Knowledge |\n| 5ï¸âƒ£ | INSTRUKSI_BUILDER_AISG.txt | Template teks untuk kolom Instruction di Builder |\n\n---\n\n> **\"Instruksi yang jelas membuat sistem sekuat fondasinya, dan fondasi AiSG adalah keteraturan.\"**  \n> â€” *AiSG System 2025*\n\n","size_bytes":2275},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/examples/ThemeToggle.tsx":{"content":"import ThemeToggle from \"../ThemeToggle\";\n\nexport default function ThemeToggleExample() {\n  return (\n    <div className=\"flex items-center justify-center gap-4 p-6 bg-background\">\n      <p className=\"text-sm text-muted-foreground\">Toggle tema:</p>\n      <ThemeToggle />\n    </div>\n  );\n}\n","size_bytes":288},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ZoneBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\n\nexport type ZoneType = \"success\" | \"warning\" | \"critical\";\n\ninterface ZoneBadgeProps {\n  type: ZoneType;\n  label?: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n  \"data-testid\"?: string;\n}\n\nconst zoneConfig = {\n  success: {\n    emoji: \"ðŸŸ©\",\n    label: \"Optimal\",\n    className: \"bg-zone-success text-zone-success-foreground border-zone-success\"\n  },\n  warning: {\n    emoji: \"ðŸŸ¨\",\n    label: \"Perhatian\",\n    className: \"bg-zone-warning text-zone-warning-foreground border-zone-warning\"\n  },\n  critical: {\n    emoji: \"ðŸŸ¥\",\n    label: \"Kritikal\",\n    className: \"bg-zone-critical text-zone-critical-foreground border-zone-critical\"\n  }\n};\n\nexport default function ZoneBadge({ type, label, size = \"md\", \"data-testid\": testId }: ZoneBadgeProps) {\n  const config = zoneConfig[type];\n  const displayLabel = label || config.label;\n  \n  const sizeClasses = {\n    sm: \"text-xs px-2 py-0.5 min-w-[100px]\",\n    md: \"text-sm px-3 py-1 min-w-[120px]\",\n    lg: \"text-base px-4 py-1.5 min-w-[140px]\"\n  };\n\n  return (\n    <Badge \n      className={`${config.className} ${sizeClasses[size]} font-medium inline-flex items-center justify-center`}\n      data-testid={testId}\n    >\n      <span className=\"mr-1\">{config.emoji}</span>\n      {displayLabel}\n    </Badge>\n  );\n}\n","size_bytes":1297},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertAuditSchema, insertChatMessageSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { fromZodError } from \"zod-validation-error\";\nimport gemini from \"./gemini\";\nimport openai from \"./openai\";\nimport { generateKnowledgeBasedResponse } from \"./knowledge-base\";\nimport { generateAuditPDF } from \"./pdf-generator\";\nimport { registerAuthRoutes } from \"./auth-routes\";\nimport { registerEnterpriseRoutes } from \"./enterprise-routes\";\nimport { requireAuth, requireFullAdmin } from \"./middleware\";\nimport { canAccessAudit } from \"./auth\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Register authentication routes first\n  registerAuthRoutes(app);\n  \n  // Register enterprise organizational structure routes\n  registerEnterpriseRoutes(app);\n  \n  // =========================================================================\n  // TODO: LEGACY AUDIT ROUTES - DISABLED FOR ENTERPRISE MIGRATION\n  // =========================================================================\n  // The following old audit routes have been disabled as part of the migration\n  // from individual audit system to enterprise hierarchy system.\n  // \n  // OLD SYSTEM (disabled):\n  // - Individual audits with nama/jabatan/cabang fields\n  // - Direct margin/NA quarterly tracking in audit table\n  // - Owner-based access control\n  //\n  // NEW SYSTEM (active):\n  // - Employee-based audits with organizational hierarchy\n  // - Monthly performance tracking with auto-aggregation\n  // - Position-based RBAC with CEO unit isolation\n  //\n  // These routes reference old schema fields that no longer exist and will be\n  // completely removed once enterprise audit flows are implemented.\n  // See: server/enterprise-routes.ts for new API endpoints\n  // =========================================================================\n  \n  /*\n  // POST /api/audit - Create new audit and return results (Protected)\n  app.post(\"/api/audit\", requireAuth, async (req, res) => {\n    try {\n      const validated = insertAuditSchema.parse(req.body);\n      \n      // Add ownership tracking\n      const auditWithOwnership = {\n        ...validated,\n        ownerId: req.user!.id, // Current user owns this audit\n        createdById: req.user!.id, // Current user created this audit\n      };\n      \n      const audit = await storage.createAudit(auditWithOwnership);\n      \n      // Return audit with all calculated results\n      res.json({\n        auditId: audit.id,\n        zonaKinerja: audit.zonaKinerja,\n        zonaPerilaku: audit.zonaPerilaku,\n        profil: audit.profil,\n        magicSection: audit.magicSection,\n        prodemRekomendasi: audit.prodemRekomendasi\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const validationError = fromZodError(error);\n        res.status(400).json({ \n          error: \"Validation error\", \n          details: validationError.message \n        });\n      } else {\n        console.error(\"Error creating audit:\", error);\n        res.status(500).json({ error: \"Internal server error\" });\n      }\n    }\n  });\n\n  // GET /api/dashboard/summary - Get global dashboard stats (Protected)\n  app.get(\"/api/dashboard/summary\", requireAuth, async (req, res) => {\n    try {\n      const allAudits = await storage.getAllAudits(false); // Non-deleted only\n      \n      // Calculate global stats\n      const totalAudits = allAudits.length;\n      const uniqueUsers = new Set(allAudits.map(a => a.ownerId).filter(Boolean)).size;\n      const zonaHijauCount = allAudits.filter(a => a.zonaFinal === \"hijau\").length;\n      const zonaHijauPercentage = totalAudits > 0 \n        ? ((zonaHijauCount / totalAudits) * 100).toFixed(1)\n        : \"0.0\";\n      \n      // Get 3 most recent audits (global)\n      const recentAudits = allAudits.slice(0, 3).map(audit => ({\n        id: audit.id,\n        nama: audit.nama,\n        jabatan: audit.jabatan,\n        cabang: audit.cabang,\n        zonaKinerja: audit.zonaKinerja,\n        zonaPerilaku: audit.zonaPerilaku,\n        zonaFinal: audit.zonaFinal,\n        createdAt: audit.createdAt,\n      }));\n      \n      res.json({\n        totalAudits,\n        uniqueUsers,\n        zonaHijauPercentage,\n        recentAudits,\n      });\n    } catch (error) {\n      console.error(\"Error fetching dashboard summary:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // GET /api/audits - Get all audits (Protected with ownership filter)\n  app.get(\"/api/audits\", requireAuth, async (req, res) => {\n    try {\n      const allAudits = await storage.getAllAudits();\n      \n      // Full Admin can see all audits, others see only their own\n      if (req.user!.role === \"full_admin\" || req.user!.role === \"admin\") {\n        res.json(allAudits);\n      } else {\n        // Filter to only user's own audits\n        const userAudits = allAudits.filter(audit => audit.ownerId === req.user!.id);\n        res.json(userAudits);\n      }\n    } catch (error) {\n      console.error(\"Error fetching audits:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // GET /api/admin/audit-log - Get all audits with creator info (Admin only, includes soft-deleted)\n  app.get(\"/api/admin/audit-log\", requireAuth, requireAdmin, async (req, res) => {\n    try {\n      // Admin can see all audits including soft-deleted ones\n      const auditsWithCreators = await storage.getAuditsWithCreators(true);\n      res.json(auditsWithCreators);\n    } catch (error) {\n      console.error(\"Error fetching audit log:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // GET /api/audit/:id - Get single audit by ID (Protected with ownership check)\n  app.get(\"/api/audit/:id\", requireAuth, async (req, res) => {\n    try {\n      const audit = await storage.getAudit(req.params.id);\n      \n      if (!audit) {\n        res.status(404).json({ error: \"Audit not found\" });\n        return;\n      }\n      \n      // Check access permission\n      if (!canAccessAudit(req.user!.role, req.user!.id, audit.ownerId)) {\n        res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Anda tidak memiliki akses ke audit ini\" \n        });\n        return;\n      }\n      \n      res.json(audit);\n    } catch (error) {\n      console.error(\"Error fetching audit:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // POST /api/chat - Send chat message and get AI response (Protected)\n  // 3-Source AI System: ChatGPT (OpenAI) â†’ Gemini â†’ Internal Knowledge Base\n  app.post(\"/api/chat\", requireAuth, async (req, res) => {\n    try {\n      const schema = z.object({\n        auditId: z.string(),\n        message: z.string().min(1)\n      });\n      \n      const { auditId, message } = schema.parse(req.body);\n      \n      const audit = await storage.getAudit(auditId);\n      if (!audit) {\n        res.status(404).json({ error: \"Audit not found\" });\n        return;\n      }\n      \n      // Check access permission\n      if (!canAccessAudit(req.user!.role, req.user!.id, audit.ownerId)) {\n        res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Anda tidak memiliki akses ke audit ini\" \n        });\n        return;\n      }\n      \n      await storage.createChatMessage({\n        auditId,\n        role: \"user\",\n        content: message\n      });\n      \n      const history = await storage.getChatHistory(auditId);\n      \n      // Build comprehensive audit context for AI\n      const pillarScores = audit.pillarAnswers.map((p: any) => \n        `  Pilar ${p.pillarId}: Self=${p.selfScore}/5, Reality=${p.realityScore}/5, Gap=${p.gap}`\n      ).join('\\n');\n      \n      const performanceMetrics = `\nQ1: Margin=$${audit.marginTimQ1.toLocaleString()}, NA=${audit.naTimQ1}\nQ2: Margin=$${audit.marginTimQ2.toLocaleString()}, NA=${audit.naTimQ2}\nQ3: Margin=$${audit.marginTimQ3.toLocaleString()}, NA=${audit.naTimQ3}\nQ4: Margin=$${audit.marginTimQ4.toLocaleString()}, NA=${audit.naTimQ4}\nTOTAL: Margin=$${(audit.marginTimQ1+audit.marginTimQ2+audit.marginTimQ3+audit.marginTimQ4).toLocaleString()}`;\n\n      const teamStructure = `BC:${audit.jumlahBC}, SBC:${audit.jumlahSBC}, BSM:${audit.jumlahBsM}, SBM:${audit.jumlahSBM}, EM:${audit.jumlahEM}, SEM:${audit.jumlahSEM}, VBM:${audit.jumlahVBM}, BrM:${audit.jumlahBrM}`;\n      \n      const totalPercentage = Math.round((audit.totalRealityScore / 90) * 100);\n      \n      const systemPrompt = `Anda adalah COACH PROFESIONAL bernama AiSG Coach - seorang expert bisnis dan leadership dengan 15+ tahun pengalaman. Anda sedang coaching ${audit.nama}, seorang ${audit.jabatan} di cabang ${audit.cabang}. \n\nPERSONALITY ANDA:\n- **WARM & SUPPORTIVE**: Seperti mentor senior yang peduli, bukan robot\n- **CONVERSATIONAL**: Ngobrol natural, gunakan analogi, cerita, dan contoh real\n- **ACTIONABLE**: Selalu berikan langkah konkret, bukan teori doang\n- **MOTIVATIONAL**: Selalu lihat potensi, bukan cuma masalah\n- **DATA-DRIVEN**: Rujuk data audit spesifik untuk kredibilitas\n\nCARA BICARA ANDA:\nâœ… \"Wah, saya lihat Reality Score kamu ${audit.totalRealityScore}/90 (${totalPercentage}%). Ini solid bro!\"\nâœ… \"Berdasarkan data Q4 kamu yang margin $${audit.marginTimQ4.toLocaleString()}, saya punya beberapa strategi...\"\nâœ… \"Coba kita lihat SWOT kamu nih. Strength kamu di ${audit.auditReport.swotAnalysis.strength[0]}, ini asset besar lho!\"\nâŒ \"Hasil audit menunjukkan...\" (terlalu formal/kaku)\nâŒ \"Saya rekomendasikan...\" (terlalu robotic)\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nðŸ“Š DATA AUDIT ${audit.nama.toUpperCase()}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nðŸ‘¤ PROFIL:\n- Nama: ${audit.nama}\n- Jabatan: ${audit.jabatan}\n- Cabang: ${audit.cabang}\n- Tanggal Lahir: ${audit.tanggalLahir}\n\nðŸŽ¯ PERFORMANCE SNAPSHOT:\n- Reality Score: ${audit.totalRealityScore}/90 (${totalPercentage}%)\n- Profil: ${audit.profil}\n- Zona Kinerja: ${audit.zonaKinerja}\n- Zona Perilaku: ${audit.zonaPerilaku}\n- Zona Final: ${audit.zonaFinal}\n\nðŸ’° QUARTERLY PERFORMANCE (Tim):\n${performanceMetrics}\n\nðŸ‘¥ STRUKTUR TIM (Under Langsung):\n${teamStructure}\nTotal Team: ${audit.jumlahBC + audit.jumlahSBC + audit.jumlahBsM + audit.jumlahSBM + audit.jumlahEM + audit.jumlahSEM + audit.jumlahVBM + audit.jumlahBrM} orang\n\nðŸ“ˆ 18 PILAR BREAKDOWN:\n${pillarScores}\n\nðŸ” SWOT ANALYSIS:\nðŸ’ª Strengths: ${audit.auditReport.swotAnalysis.strength.join(', ')}\nâš ï¸ Weaknesses: ${audit.auditReport.swotAnalysis.weakness.join(', ')}\nðŸŒŸ Opportunities: ${audit.auditReport.swotAnalysis.opportunity.join(', ')}\nâš¡ Threats: ${audit.auditReport.swotAnalysis.threat.join(', ')}\n\nðŸš€ PRODEM REKOMENDASI:\n- Status: ${audit.prodemRekomendasi.recommendation}\n- Alasan: ${audit.prodemRekomendasi.reason}\n- Next Step: ${audit.prodemRekomendasi.nextStep}\n\nðŸ“‹ ACTION PLAN 30-60-90:\n${audit.auditReport.actionPlan.map(a => `${a.periode}: ${a.target} â†’ ${a.aktivitas}`).join('\\n')}\n\nâš ï¸ EWS (Early Warning):\n${audit.auditReport.ews.slice(0,3).map(e => `â€¢ ${e.faktor}: ${e.saranCepat}`).join('\\n')}\n\nðŸ’¡ COACHING POINTS:\n${audit.auditReport.coachingPoints.slice(0,4).join('\\nâ€¢ ')}\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nðŸŽ“ KNOWLEDGE BASE & EXPERTISE ANDA\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nLEADERSHIP & MANAGEMENT:\n- Vision & Direction: Buat visi jelas, komunikasikan konsisten, jadilah role model\n- Team Empowerment: Delegasi smart, feedback konstruktif, supportive environment\n- Decision Making: Data-driven, libatkan tim, berani tanggung jawab\n\nSALES & CLOSING:\n- Trial Close: \"Bagaimana menurut Anda sejauh ini?\"\n- Assumptive Close: \"Kapan Anda ingin mulai?\"\n- Alternative Close: \"Prefer paket A atau B?\"\n- Handle objections dengan empati, jangan pushy - be consultative\n\nTEAM BUILDING:\n- Komunikasi Efektif: Daily standup, open channel, active listening\n- Trust Building: Transparansi, deliver promises, celebrate wins\n- Conflict Resolution: Address segera, focus solution, win-win mindset\n\nRECRUITMENT (Komisi-based):\n- Value Prop: Unlimited earning, free training, flexibility\n- Target: Fresh grad hungry, career switcher, entrepreneur mindset\n- Script: \"Cari partner bisnis. Modal nol. Yang butuh: willing to learn. Income: unlimited. Minat?\"\n\nRETENTION STRATEGY:\n- Recognition: Public appreciation, reward top performers\n- Growth: Training program, clear career path, mentorship\n- Environment: Positive culture, work-life balance, family atmosphere\n\nPLANNING FRAMEWORK (30-60-90):\n- 30 Hari (Learn): Product mastery, observe top performers, build database\n- 60 Hari (Execute): Implement best practices, expand network, refine pitch\n- 90 Hari (Lead): Share knowledge, recruit new members, optimize process\n\nZONA STRATEGIES:\n- Merah (Critical): Immediate action, daily coaching, micro-targets, master basics\n- Kuning (Warning): Stabilkan dulu, identify gap, peer learning, consistent execution  \n- Hijau (Success): Maintain & expand, mentor juniors, aim next level\n\nPRODEM CAREER PATH:\n- Promosi: Consistency, document achievements, mentor successors (3-6 bln)\n- Pertahankan: Stabilkan performance, strengthen weak areas, build track record\n- Pembinaan: Positive mindset, focus action plan, daily improvement, seek mentorship (90 hari)\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nðŸŽ¯ CARA ANDA COACHING\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n1. **ALWAYS LEAD WITH DATA**: \"Saya lihat di Q4 kamu closing $${audit.marginTimQ4.toLocaleString()}...\"\n2. **STORYTELLING**: Gunakan analogi & contoh: \"Ini kayak lagi main basket, kamu udah bagus di defense (Pilar X), sekarang tingkatin offense (Pilar Y)\"\n3. **ASK REFLECTIVE QUESTIONS**: \"Menurut kamu, apa yang bisa bikin tim kamu dari ${audit.jumlahBC + audit.jumlahSBC + audit.jumlahBsM} orang jadi 2x lipat?\"\n4. **CELEBRATE WINS**: \"Wah, SWOT kamu keren nih! Strength di '${audit.auditReport.swotAnalysis.strength[0]}' itu rare lho!\"\n5. **ACTIONABLE STEPS**: Jangan cuma teori. Kasih 2-3 action items konkret\n6. **MAINTAIN HOPE**: Bahkan zona merah pun bisa turn around dengan strategi tepat\n\nTONE & STYLE:\n- Panggil \"kamu/anda\" (personal), bukan \"user/employee\"\n- Mix data dengan empati: \"Skor ${totalPercentage}% solid, tapi saya tau ada potensi lebih!\"\n- Gunakan emoji strategis (1-2 per respons) untuk warmth\n- Relate to their situation: \"Sebagai ${audit.jabatan}, pressure-nya pasti beda ya...\"\n- End dengan next step yang jelas\n\nRESPONSE FORMAT:\n- Paragraph 1: Acknowledge + Data point spesifik\n- Paragraph 2: Insight + Recommendation  \n- Paragraph 3: Action items + Motivasi\n\nPENTING: \nâŒ JANGAN robotic: \"Berdasarkan hasil audit, rekomendasi saya...\"\nâœ… BE HUMAN: \"Oke, gua udah liat hasil audit kamu nih. ${audit.nama}, dengan Reality Score ${totalPercentage}% dan profil ${audit.profil}, ini yang gua rekomen...\"\n\nRemember: Kamu bukan AI assistant, kamu COACH BERPENGALAMAN yang genuinely care tentang success mereka!`;\n\n      let aiResponse = \"\";\n      let sourceUsed = \"\";\n\n      // Defensive check: Verify environment variables to prevent runtime crashes\n      const hasOpenAI = !!process.env.OPENAI_API_KEY;\n      const hasGemini = !!process.env.GEMINI_API_KEY;\n\n      // SOURCE 1: Try OpenAI ChatGPT first (primary)\n      if (!hasOpenAI) {\n        console.log(\"[CHAT] â­ï¸ Source 1 SKIPPED: OPENAI_API_KEY not configured\");\n      } else {\n        try {\n          console.log(\"[CHAT] ðŸŽ¯ Attempting Source 1: OpenAI ChatGPT...\");\n          \n          const openaiMessages = [\n            { role: \"system\" as const, content: systemPrompt },\n            ...history.slice(-10).map(msg => ({\n              role: msg.role as \"user\" | \"assistant\",\n              content: msg.content\n            })),\n            { role: \"user\" as const, content: message }\n          ];\n\n          const completion = await openai.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            messages: openaiMessages,\n            temperature: 0.7,\n            max_tokens: 500,\n          });\n\n          const responseText = completion.choices[0]?.message?.content;\n          \n          if (responseText && responseText.trim().length > 0) {\n            aiResponse = responseText.trim();\n            sourceUsed = \"ChatGPT\";\n            console.log(\"[CHAT] âœ… Source 1 SUCCESS: OpenAI ChatGPT responded\");\n          } else {\n            throw new Error(\"OpenAI returned empty response\");\n          }\n        } catch (openaiError) {\n          console.log(\"[CHAT] âŒ Source 1 FAILED: OpenAI error -\", openaiError instanceof Error ? openaiError.message : String(openaiError));\n        }\n      }\n\n      // SOURCE 2: Try Gemini as fallback (secondary)\n      if (!aiResponse) {\n        if (!hasGemini) {\n          console.log(\"[CHAT] â­ï¸ Source 2 SKIPPED: GEMINI_API_KEY not configured\");\n        } else {\n          try {\n            console.log(\"[CHAT] ðŸŽ¯ Attempting Source 2: Google Gemini...\");\n            \n            const chatHistory = history.slice(-10).map(msg => ({\n              role: msg.role === \"user\" ? \"user\" : \"model\",\n              parts: [{ text: msg.content }]\n            }));\n            \n            const fullPrompt = `${systemPrompt}\\n\\nUser Question: ${message}`;\n            \n            const result = await gemini.models.generateContent({\n              model: \"gemini-2.0-flash-exp\",\n              contents: fullPrompt\n            });\n            \n            const geminiText = result.text;\n            \n            if (geminiText && geminiText.trim().length > 0) {\n              aiResponse = geminiText.trim();\n              sourceUsed = \"Gemini\";\n              console.log(\"[CHAT] âœ… Source 2 SUCCESS: Gemini responded\");\n            } else {\n              throw new Error(\"Gemini returned empty response\");\n            }\n          } catch (geminiError) {\n            console.log(\"[CHAT] âŒ Source 2 FAILED: Gemini error -\", geminiError instanceof Error ? geminiError.message : String(geminiError));\n          }\n        }\n      }\n\n      // SOURCE 3: Use Internal Knowledge Base as last resort (tertiary)\n      if (!aiResponse) {\n        console.log(\"[CHAT] ðŸŽ¯ Attempting Source 3: Internal Knowledge Base...\");\n        aiResponse = generateKnowledgeBasedResponse(message, audit);\n        sourceUsed = \"Knowledge Base\";\n        console.log(\"[CHAT] âœ… Source 3 SUCCESS: Knowledge Base responded\");\n      }\n      \n      // Add AiSG Team signature to response\n      const finalResponse = `${aiResponse}\\n\\n**By AiSG Team**`;\n      \n      await storage.createChatMessage({\n        auditId,\n        role: \"assistant\",\n        content: finalResponse\n      });\n      \n      res.json({ response: finalResponse, source: sourceUsed });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const validationError = fromZodError(error);\n        res.status(400).json({ error: \"Validation error\", details: validationError.message });\n      } else {\n        console.error(\"Error in chat:\", error);\n        res.status(500).json({ \n          error: \"Internal server error\",\n          userMessage: \"Maaf, terjadi kesalahan sistem. Silakan coba lagi.\" \n        });\n      }\n    }\n  });\n\n  // GET /api/chat/:auditId - Get chat history for audit (Protected)\n  app.get(\"/api/chat/:auditId\", requireAuth, async (req, res) => {\n    try {\n      const audit = await storage.getAudit(req.params.auditId);\n      if (!audit) {\n        res.status(404).json({ error: \"Audit not found\" });\n        return;\n      }\n      \n      // Check access permission\n      if (!canAccessAudit(req.user!.role, req.user!.id, audit.ownerId)) {\n        res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Anda tidak memiliki akses ke audit ini\" \n        });\n        return;\n      }\n      \n      const history = await storage.getChatHistory(req.params.auditId);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching chat history:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // DELETE /api/chat/:auditId - Clear chat history (Protected)\n  app.delete(\"/api/chat/:auditId\", requireAuth, async (req, res) => {\n    try {\n      const audit = await storage.getAudit(req.params.auditId);\n      if (!audit) {\n        res.status(404).json({ error: \"Audit not found\" });\n        return;\n      }\n      \n      // Check access permission\n      if (!canAccessAudit(req.user!.role, req.user!.id, audit.ownerId)) {\n        res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Anda tidak memiliki akses ke audit ini\" \n        });\n        return;\n      }\n      \n      await storage.deleteChatHistory(req.params.auditId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting chat history:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // GET /api/audit/:id/pdf - Download audit as PDF (Protected)\n  app.get(\"/api/audit/:id/pdf\", requireAuth, async (req, res) => {\n    try {\n      const audit = await storage.getAudit(req.params.id);\n      \n      if (!audit) {\n        res.status(404).json({ error: \"Audit not found\" });\n        return;\n      }\n      \n      // Check access permission\n      if (!canAccessAudit(req.user!.role, req.user!.id, audit.ownerId)) {\n        res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Anda tidak memiliki akses ke audit ini\" \n        });\n        return;\n      }\n      \n      const doc = generateAuditPDF(audit);\n      const filename = `audit-${audit.nama.replace(/\\s+/g, \"-\")}-${new Date().toISOString().split(\"T\")[0]}.pdf`;\n      \n      res.setHeader(\"Content-Type\", \"application/pdf\");\n      res.setHeader(\"Content-Disposition\", `attachment; filename=\"${filename}\"`);\n      \n      doc.pipe(res);\n    } catch (error) {\n      console.error(\"Error generating PDF:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // PATCH /api/audit/:id/soft-delete - Soft delete audit (Protected - User can delete own audit)\n  app.patch(\"/api/audit/:id/soft-delete\", requireAuth, async (req, res) => {\n    try {\n      const audit = await storage.getAudit(req.params.id);\n      \n      if (!audit) {\n        res.status(404).json({ error: \"Audit not found\" });\n        return;\n      }\n      \n      // Check access permission (user can delete their own audit)\n      if (!canAccessAudit(req.user!.role, req.user!.id, audit.ownerId)) {\n        res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Anda tidak memiliki akses ke audit ini\" \n        });\n        return;\n      }\n      \n      // Soft delete with user info\n      await storage.softDeleteAudit(\n        req.params.id, \n        req.user!.id, \n        \"user_delete\"\n      );\n      \n      res.json({ success: true, message: \"Audit berhasil dihapus\" });\n    } catch (error) {\n      console.error(\"Error soft-deleting audit:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // DELETE /api/audit/:id - Permanently delete an audit (Admin only - hard delete)\n  app.delete(\"/api/audit/:id\", requireAuth, requireAdmin, async (req, res) => {\n    try {\n      const audit = await storage.getAudit(req.params.id);\n      \n      if (!audit) {\n        res.status(404).json({ error: \"Audit not found\" });\n        return;\n      }\n      \n      await storage.hardDeleteAudit(req.params.id);\n      res.json({ success: true, message: \"Audit permanently deleted\" });\n    } catch (error) {\n      console.error(\"Error hard-deleting audit:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // GET /api/admin/users - Get all users (Admin only)\n  app.get(\"/api/admin/users\", requireAuth, requireAdmin, async (req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // GET /api/admin/users/inactive - Get inactive users (>90 days, no audits)\n  app.get(\"/api/admin/users/inactive\", requireAuth, requireAdmin, async (req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      const allAudits = await storage.getAllAudits(false);\n      \n      // Calculate 90 days ago\n      const ninetyDaysAgo = new Date();\n      ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);\n      \n      // Find inactive users\n      const inactiveUsers = users.filter(user => {\n        // Skip superadmin\n        if (user.username === \"superadmin\") return false;\n        \n        // Check if user registered >90 days ago\n        if (new Date(user.createdAt) > ninetyDaysAgo) return false;\n        \n        // Check if user has any audits\n        const userHasAudits = allAudits.some(audit => audit.ownerId === user.id);\n        \n        return !userHasAudits; // Inactive if no audits\n      });\n      \n      res.json(inactiveUsers);\n    } catch (error) {\n      console.error(\"Error fetching inactive users:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // DELETE /api/admin/users/:id - Delete user (Full Admin only)\n  app.delete(\"/api/admin/users/:id\", requireAuth, requireFullAdmin, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.id);\n      \n      if (!user) {\n        res.status(404).json({ error: \"User not found\" });\n        return;\n      }\n      \n      // Prevent deleting superadmin\n      if (user.username === \"superadmin\") {\n        res.status(403).json({ \n          error: \"Forbidden\", \n          userMessage: \"Superadmin cannot be deleted\" \n        });\n        return;\n      }\n      \n      await storage.deleteUser(req.params.id);\n      res.json({ success: true, message: \"User deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n  */\n  // END OF LEGACY ROUTES - All old audit endpoints disabled above\n  // =========================================================================\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":26534},"client/src/components/examples/ProDemCard.tsx":{"content":"import ProDemCard from \"../ProDemCard\";\n\nexport default function ProDemCardExample() {\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6 bg-background\">\n      <ProDemCard\n        currentLevel=\"SBC (Senior Business Consultant)\"\n        recommendation=\"Promosi\"\n        nextLevel=\"BSM (Business Sales Manager)\"\n        reason=\"Performa kinerja konsisten berada di zona hijau. Margin tim mencapai 140K USD, melebihi target 125K. Leadership skills dan kemampuan coaching tim sudah sangat baik.\"\n        requirements={[\n          { label: \"Margin Tim USD\", value: \"$140,000 / $125,000\", met: true },\n          { label: \"BC Aktif\", value: \"5 / 3\", met: true },\n          { label: \"Periode Minimal\", value: \"8 bulan / 6 bulan\", met: true }\n        ]}\n        data-testid=\"prodem-promosi\"\n      />\n      <ProDemCard\n        currentLevel=\"BSM (Business Sales Manager)\"\n        recommendation=\"Pertahankan\"\n        reason=\"Kinerja berada di zona kuning. Margin tim masih di bawah target untuk promosi ke SBM. Perlu fokus pada peningkatan produktivitas tim dan pengembangan BC baru.\"\n        requirements={[\n          { label: \"Margin Tim USD\", value: \"$180,000 / $250,000\", met: false },\n          { label: \"BC Aktif\", value: \"4 / 5\", met: false },\n          { label: \"Periode Minimal\", value: \"7 bulan / 9 bulan\", met: false }\n        ]}\n        data-testid=\"prodem-pertahankan\"\n      />\n    </div>\n  );\n}\n","size_bytes":1420},"client/src/components/MagicSection.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Sparkles, Star, MessageSquareQuote } from \"lucide-react\";\n\ninterface MagicSectionProps {\n  zodiak: string;\n  booster: string;\n  quote: string;\n  \"data-testid\"?: string;\n}\n\nexport default function MagicSection({ zodiak, booster, quote, \"data-testid\": testId }: MagicSectionProps) {\n  return (\n    <Card \n      className=\"relative p-6 overflow-hidden border-magic/30 bg-gradient-to-br from-magic/5 to-magic/10\"\n      data-testid={testId}\n    >\n      <div className=\"absolute top-0 right-0 w-32 h-32 bg-magic/10 rounded-full blur-3xl -mr-16 -mt-16\" />\n      \n      <div className=\"relative\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Sparkles className=\"w-5 h-5 text-magic\" />\n          <h3 className=\"font-semibold text-lg\">Magic Section</h3>\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"rounded-lg bg-magic/20 p-2 mt-1\">\n              <Star className=\"w-4 h-4 text-magic\" />\n            </div>\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-medium text-muted-foreground mb-1\">Zodiak Booster</p>\n              <p className=\"text-base font-semibold\" data-testid={`${testId}-zodiak`}>{zodiak}</p>\n              <p className=\"text-sm text-muted-foreground mt-1\" data-testid={`${testId}-booster`}>\n                {booster}\n              </p>\n            </div>\n          </div>\n\n          <div className=\"pt-4 border-t border-magic/20\">\n            <div className=\"flex items-start gap-3\">\n              <div className=\"rounded-lg bg-magic/20 p-2 mt-1\">\n                <MessageSquareQuote className=\"w-4 h-4 text-magic\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-muted-foreground mb-2\">Quote Motivasi</p>\n                <blockquote \n                  className=\"text-base italic leading-relaxed\" \n                  data-testid={`${testId}-quote`}\n                >\n                  \"{quote}\"\n                </blockquote>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n","size_bytes":2194},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"server/seed-enterprise.ts":{"content":"/**\n * Seed script for AISG Enterprise\n * Sets up organizational structure, positions, and initial super admin\n * \n * Run with: npx tsx server/seed-enterprise.ts\n */\n\nimport { db } from \"./db\";\nimport { \n  pts, ceoUnits, branches, positions, employees, users \n} from \"@shared/schema\";\nimport { createUser } from \"./auth\";\nimport { eq } from \"drizzle-orm\";\n\nasync function seedEnterprise() {\n  try {\n    console.log(\"ðŸŒ± Starting AISG Enterprise seed...\\n\");\n\n    // ========================================================================\n    // 1. SEED PT COMPANIES (5 companies)\n    // ========================================================================\n    console.log(\"ðŸ“Š Seeding PT Companies...\");\n    \n    const ptData = [\n      { code: \"RFB\", name: \"Resky Futures Brokerage\" },\n      { code: \"EWF\", name: \"Eastern World Futures\" },\n      { code: \"KPF\", name: \"Kresna Perkasa Futures\" },\n      { code: \"SGB\", name: \"Sahabat Global Brokerage\" },\n      { code: \"BPF\", name: \"Berkah Prima Futures\" },\n    ];\n\n    const insertedPts: any[] = [];\n    for (const pt of ptData) {\n      const [inserted] = await db.insert(pts).values(pt).returning();\n      insertedPts.push(inserted);\n      console.log(`  âœ… ${pt.code} - ${pt.name}`);\n    }\n\n    // ========================================================================\n    // 2. SEED CEO UNITS (5 units)\n    // ========================================================================\n    console.log(\"\\nðŸ‘” Seeding CEO Units...\");\n    \n    const ceoUnitData = [\n      { name: \"ISRIYETTI\" },\n      { name: \"NL\" },\n      { name: \"GS\" },\n      { name: \"TJANDRA\" },\n      { name: \"EDWIN\" },\n    ];\n\n    const insertedCeoUnits: any[] = [];\n    for (const unit of ceoUnitData) {\n      const [inserted] = await db.insert(ceoUnits).values(unit).returning();\n      insertedCeoUnits.push(inserted);\n      console.log(`  âœ… CEO Unit: ${unit.name}`);\n    }\n\n    // ========================================================================\n    // 3. SEED BRANCHES (Sample - 10 branches across PTs)\n    // ========================================================================\n    console.log(\"\\nðŸ¢ Seeding Branches...\");\n    \n    const branchData = [\n      // RFB branches\n      { ptId: insertedPts[0].id, code: \"SSC\", name: \"SSC Jakarta\", region: \"Jakarta\" },\n      { ptId: insertedPts[0].id, code: \"MEDAN\", name: \"Medan Branch\", region: \"Medan\" },\n      { ptId: insertedPts[0].id, code: \"AXA\", name: \"AXA Surabaya\", region: \"Surabaya\" },\n      \n      // EWF branches\n      { ptId: insertedPts[1].id, code: \"SOLO\", name: \"Solo Branch\", region: \"Solo\" },\n      { ptId: insertedPts[1].id, code: \"BANDUNG\", name: \"Bandung Branch\", region: \"Bandung\" },\n      \n      // KPF branches\n      { ptId: insertedPts[2].id, code: \"BALI\", name: \"Bali Branch\", region: \"Bali\" },\n      { ptId: insertedPts[2].id, code: \"MAKASSAR\", name: \"Makassar Branch\", region: \"Makassar\" },\n      \n      // SGB branches\n      { ptId: insertedPts[3].id, code: \"SEMARANG\", name: \"Semarang Branch\", region: \"Semarang\" },\n      \n      // BPF branches\n      { ptId: insertedPts[4].id, code: \"PALEMBANG\", name: \"Palembang Branch\", region: \"Palembang\" },\n      { ptId: insertedPts[4].id, code: \"JOGJA\", name: \"Yogyakarta Branch\", region: \"Yogyakarta\" },\n    ];\n\n    const insertedBranches: any[] = [];\n    for (const branch of branchData) {\n      const [inserted] = await db.insert(branches).values(branch).returning();\n      insertedBranches.push(inserted);\n      console.log(`  âœ… ${branch.code} - ${branch.name} (${branch.region})`);\n    }\n\n    // ========================================================================\n    // 4. SEED POSITIONS (11 levels)\n    // ========================================================================\n    console.log(\"\\nðŸ“‹ Seeding Position Hierarchy...\");\n    \n    const positionData = [\n      { code: \"OWNER\", name: \"Owner\", level: 1, description: \"Company owner (highest rank)\" },\n      { code: \"CEO\", name: \"Chief Executive Officer\", level: 2, description: \"Chief executive officer\" },\n      { code: \"CBO\", name: \"Chief Branch Officer\", level: 3, description: \"Chief branch officer\" },\n      { code: \"BrM\", name: \"Branch Manager\", level: 4, description: \"Branch manager\" },\n      { code: \"VBM\", name: \"Vice Branch Manager\", level: 5, description: \"Vice branch manager\" },\n      { code: \"SEM\", name: \"Senior Executive Manager\", level: 6, description: \"Senior executive manager\" },\n      { code: \"EM\", name: \"Executive Manager\", level: 7, description: \"Executive manager\" },\n      { code: \"SBM\", name: \"Senior Business Manager\", level: 8, description: \"Senior business manager\" },\n      { code: \"BsM\", name: \"Business Manager\", level: 9, description: \"Business manager\" },\n      { code: \"SBC\", name: \"Senior Business Consultant\", level: 10, description: \"Senior consultant\" },\n      { code: \"BC\", name: \"Business Consultant\", level: 11, description: \"Entry level consultant (lowest rank)\" },\n    ];\n\n    const insertedPositions: any[] = [];\n    for (const position of positionData) {\n      const [inserted] = await db.insert(positions).values(position).returning();\n      insertedPositions.push(inserted);\n      console.log(`  âœ… Level ${position.level}: ${position.code} - ${position.name}`);\n    }\n\n    // ========================================================================\n    // 5. CREATE SUPER ADMIN USER\n    // ========================================================================\n    console.log(\"\\nðŸ‘¤ Creating Super Admin...\");\n    \n    // Check if superadmin exists\n    const [existing] = await db\n      .select()\n      .from(users)\n      .where(eq(users.username, \"superadmin\"))\n      .limit(1);\n    \n    if (existing) {\n      console.log(\"  âš ï¸  Superadmin already exists!\");\n      console.log(`     Username: ${existing.username}`);\n      console.log(`     Name: ${existing.name}`);\n      console.log(`     Role: ${existing.role}`);\n    } else {\n      const superadmin = await createUser({\n        username: \"superadmin\",\n        password: \"vito1007\",\n        name: \"AiSG Super Admin\",\n        role: \"super_admin\",\n      });\n      \n      console.log(\"  âœ… Superadmin created successfully!\");\n      console.log(`     Username: ${superadmin.username}`);\n      console.log(`     Role: ${superadmin.role}`);\n    }\n\n    // ========================================================================\n    // SUCCESS SUMMARY\n    // ========================================================================\n    console.log(\"\\n\" + \"=\".repeat(60));\n    console.log(\"âœ… AISG ENTERPRISE SEED COMPLETED!\");\n    console.log(\"=\".repeat(60));\n    console.log(`\\nðŸ“Š Summary:`);\n    console.log(`   â€¢ PT Companies: ${insertedPts.length}`);\n    console.log(`   â€¢ CEO Units: ${insertedCeoUnits.length}`);\n    console.log(`   â€¢ Branches: ${insertedBranches.length}`);\n    console.log(`   â€¢ Positions: ${insertedPositions.length}`);\n    console.log(`\\nðŸ” Login Credentials:`);\n    console.log(`   Username: superadmin`);\n    console.log(`   Password: vito1007`);\n    console.log(`\\nðŸŽ‰ You can now start building the enterprise system!`);\n    console.log(`\\nNext steps:`);\n    console.log(`   1. Add employees via master data management`);\n    console.log(`   2. Input monthly performance data`);\n    console.log(`   3. Create enterprise audits with hierarchical aggregation`);\n    \n    process.exit(0);\n  } catch (error) {\n    console.error(\"\\nâŒ Error seeding enterprise data:\", error);\n    process.exit(1);\n  }\n}\n\nseedEnterprise();\n","size_bytes":7511},"DEPLOYMENT_GUIDE.md":{"content":"# AISG - Self-Hosting Deployment Guide\n\n**Version**: 1.0  \n**Last Updated**: October 23, 2025  \n**Target**: Ubuntu 22.04 LTS (or similar Linux server)\n\n---\n\n## Table of Contents\n\n1. [Prerequisites](#1-prerequisites)\n2. [Server Setup](#2-server-setup)\n3. [Database Setup (PostgreSQL)](#3-database-setup-postgresql)\n4. [Application Deployment](#4-application-deployment)\n5. [Environment Configuration](#5-environment-configuration)\n6. [Build & Run](#6-build--run)\n7. [Process Management (PM2)](#7-process-management-pm2)\n8. [Nginx Reverse Proxy](#8-nginx-reverse-proxy)\n9. [SSL Certificate (HTTPS)](#9-ssl-certificate-https)\n10. [Monitoring & Logs](#10-monitoring--logs)\n11. [Backup Strategy](#11-backup-strategy)\n12. [Troubleshooting](#12-troubleshooting)\n\n---\n\n## 1. Prerequisites\n\n### 1.1 Server Requirements\n\n**Minimum Specifications**:\n- CPU: 2 cores\n- RAM: 4 GB\n- Storage: 20 GB SSD\n- OS: Ubuntu 22.04 LTS (recommended) or similar Linux distribution\n- Network: Public IP address with open ports 80, 443\n\n**Recommended for Production**:\n- CPU: 4 cores\n- RAM: 8 GB\n- Storage: 50 GB SSD\n- Backup storage: Additional 20 GB for database backups\n\n### 1.2 Required Services\n\n1. **Domain Name** (optional but recommended):\n   - Example: `aisg.yourdomain.com`\n   - DNS configured to point to your server IP\n\n2. **OpenAI API Key** (for AI Chat feature):\n   - Create account: https://platform.openai.com\n   - Top up credits: $5-10 USD minimum\n   - Generate API key: https://platform.openai.com/api-keys\n\n3. **SSH Access** to your server:\n   ```bash\n   ssh root@your-server-ip\n   # Or with key:\n   ssh -i ~/.ssh/your-key.pem ubuntu@your-server-ip\n   ```\n\n### 1.3 What You'll Install\n\n- Node.js 20.x (LTS)\n- PostgreSQL 16\n- Nginx (reverse proxy)\n- PM2 (process manager)\n- Certbot (SSL certificates)\n\n---\n\n## 2. Server Setup\n\n### 2.1 Update System\n\n```bash\n# Update package lists\nsudo apt update\n\n# Upgrade installed packages\nsudo apt upgrade -y\n\n# Install essential tools\nsudo apt install -y curl wget git build-essential\n```\n\n### 2.2 Install Node.js 20.x\n\n```bash\n# Add NodeSource repository\ncurl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -\n\n# Install Node.js\nsudo apt install -y nodejs\n\n# Verify installation\nnode --version  # Should show v20.x.x\nnpm --version   # Should show 10.x.x\n```\n\n### 2.3 Create Application User (Security Best Practice)\n\n```bash\n# Create dedicated user for the app (not root!)\nsudo useradd -m -s /bin/bash aisg\n\n# Set password (optional)\nsudo passwd aisg\n\n# Add to sudo group (if needed)\nsudo usermod -aG sudo aisg\n\n# Switch to aisg user\nsudo su - aisg\n```\n\n**Important**: Run the application as `aisg` user, NOT as `root` for security!\n\n---\n\n## 3. Database Setup (PostgreSQL)\n\n### 3.1 Install PostgreSQL 16\n\n```bash\n# Add PostgreSQL repository\nsudo sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main\" > /etc/apt/sources.list.d/pgdg.list'\n\n# Import repository signing key\nwget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -\n\n# Update package lists\nsudo apt update\n\n# Install PostgreSQL 16\nsudo apt install -y postgresql-16 postgresql-contrib-16\n\n# Start PostgreSQL service\nsudo systemctl start postgresql\nsudo systemctl enable postgresql\n\n# Verify installation\npsql --version  # Should show 16.x\n```\n\n### 3.2 Create Database & User\n\n```bash\n# Switch to postgres user\nsudo su - postgres\n\n# Open PostgreSQL prompt\npsql\n\n# In PostgreSQL prompt, run these commands:\n```\n\n```sql\n-- Create database\nCREATE DATABASE aisg_production;\n\n-- Create user with password (CHANGE THIS PASSWORD!)\nCREATE USER aisg_user WITH ENCRYPTED PASSWORD 'your_super_secure_password_here';\n\n-- Grant privileges\nGRANT ALL PRIVILEGES ON DATABASE aisg_production TO aisg_user;\n\n-- Connect to database\n\\c aisg_production\n\n-- Grant schema privileges\nGRANT ALL ON SCHEMA public TO aisg_user;\n\n-- Enable UUID extension (required for AISG)\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\n-- Exit PostgreSQL\n\\q\n```\n\n```bash\n# Exit postgres user\nexit\n```\n\n### 3.3 Configure PostgreSQL for Remote Access (if needed)\n\n**Only do this if your database is on a different server!**\n\n```bash\n# Edit postgresql.conf\nsudo nano /etc/postgresql/16/main/postgresql.conf\n\n# Find and change:\nlisten_addresses = '*'  # Or specific IP\n\n# Edit pg_hba.conf\nsudo nano /etc/postgresql/16/main/pg_hba.conf\n\n# Add this line (replace with your app server IP):\nhost    aisg_production    aisg_user    192.168.1.100/32    md5\n\n# Restart PostgreSQL\nsudo systemctl restart postgresql\n```\n\n### 3.4 Test Database Connection\n\n```bash\n# From your aisg user\npsql -h localhost -U aisg_user -d aisg_production\n\n# Should prompt for password\n# If successful, you'll see:\naisg_production=>\n\n# Exit\n\\q\n```\n\n---\n\n## 4. Application Deployment\n\n### 4.1 Upload ZIP File to Server\n\n**Option 1: Using SCP (from your local machine)**\n\n```bash\n# From your local machine (where you downloaded the ZIP)\nscp aisg-download.zip aisg@your-server-ip:/home/aisg/\n```\n\n**Option 2: Using SFTP**\n\n```bash\nsftp aisg@your-server-ip\nput aisg-download.zip\nexit\n```\n\n**Option 3: Upload via hosting panel** (if your provider has file manager)\n\n### 4.2 Extract ZIP File\n\n```bash\n# SSH into server as aisg user\nsudo su - aisg\n\n# Create app directory\nmkdir -p /home/aisg/apps\ncd /home/aisg/apps\n\n# Move ZIP file here\nmv /home/aisg/aisg-download.zip .\n\n# Extract ZIP\nunzip aisg-download.zip\n\n# Rename folder to something clean (if needed)\nmv aisg-download aisg\n# Or if ZIP already extracts to folder:\ncd aisg\n\n# Verify files\nls -la\n# Should see: client/, server/, shared/, package.json, etc.\n```\n\n### 4.3 Install Dependencies\n\n```bash\n# Navigate to app directory\ncd /home/aisg/apps/aisg\n\n# Install Node.js dependencies\nnpm install\n\n# This will install all packages from package.json\n# Should take 2-5 minutes depending on server speed\n\n# Verify installation\nls node_modules/  # Should see many packages\n```\n\n---\n\n## 5. Environment Configuration\n\n### 5.1 Create .env File\n\n```bash\n# In /home/aisg/apps/aisg directory\nnano .env\n```\n\n**Paste this content** (customize the values):\n\n```env\n# Node Environment\nNODE_ENV=production\n\n# Database Configuration\nDATABASE_URL=postgresql://aisg_user:your_super_secure_password_here@localhost:5432/aisg_production\n\n# PostgreSQL Direct Connection (for Drizzle)\nPGHOST=localhost\nPGPORT=5432\nPGUSER=aisg_user\nPGPASSWORD=your_super_secure_password_here\nPGDATABASE=aisg_production\n\n# Session Secret (generate random string)\nSESSION_SECRET=your_random_secret_here_change_this_to_something_very_random\n\n# OpenAI API Key\nOPENAI_API_KEY=sk-your-openai-api-key-here\n\n# Server Configuration\nPORT=5000\nHOST=0.0.0.0\n```\n\n**How to generate SESSION_SECRET**:\n\n```bash\n# Generate random 32-character string\nnode -e \"console.log(require('crypto').randomBytes(32).toString('hex'))\"\n\n# Copy the output and paste it as SESSION_SECRET value\n```\n\n**Save and exit**: Ctrl+X, then Y, then Enter\n\n### 5.2 Secure .env File\n\n```bash\n# Make .env readable only by owner\nchmod 600 .env\n\n# Verify\nls -la .env\n# Should show: -rw------- (owner read/write only)\n```\n\n---\n\n## 6. Build & Run\n\n### 6.1 Run Database Migrations\n\n```bash\n# In /home/aisg/apps/aisg directory\n\n# Push database schema (creates tables)\nnpm run db:push\n\n# You should see:\n# âœ“ Tables created successfully\n```\n\n**If you see errors**, check:\n1. DATABASE_URL is correct\n2. PostgreSQL is running: `sudo systemctl status postgresql`\n3. Database `aisg_production` exists\n4. User `aisg_user` has proper permissions\n\n### 6.2 Build Frontend\n\n```bash\n# Build Vite frontend for production\nnpm run build\n\n# This creates: client/dist/ folder with optimized assets\n# Should take 1-2 minutes\n\n# Verify build\nls -la client/dist/\n# Should see: index.html, assets/, etc.\n```\n\n### 6.3 Test Application (Development Mode)\n\n```bash\n# Start in development mode (to test)\nnpm run dev\n\n# You should see:\n# [express] Server running on http://0.0.0.0:5000\n# [vite] ready in XXXms\n\n# Test from another terminal:\ncurl http://localhost:5000\n\n# Should return HTML or \"Cannot GET /\" (that's OK)\n\n# Stop the dev server: Ctrl+C\n```\n\n### 6.4 Production Server Script\n\n**Create production start script**:\n\n```bash\nnano start-production.sh\n```\n\n**Paste this content**:\n\n```bash\n#!/bin/bash\nexport NODE_ENV=production\nexport PORT=5000\nexport HOST=0.0.0.0\n\n# Start Express server (serves both frontend and backend)\nnode --loader tsx server/index.ts\n```\n\n**Make executable**:\n\n```bash\nchmod +x start-production.sh\n```\n\n**Test production mode**:\n\n```bash\n./start-production.sh\n\n# Should start without Vite (serves from client/dist/)\n# Ctrl+C to stop\n```\n\n---\n\n## 7. Process Management (PM2)\n\n**PM2** keeps your app running 24/7, auto-restarts on crashes, and manages logs.\n\n### 7.1 Install PM2\n\n```bash\n# Install PM2 globally\nsudo npm install -g pm2\n\n# Verify\npm2 --version\n```\n\n### 7.2 Create PM2 Ecosystem File\n\n```bash\n# In /home/aisg/apps/aisg directory\nnano ecosystem.config.js\n```\n\n**Paste this content**:\n\n```javascript\nmodule.exports = {\n  apps: [{\n    name: 'aisg-production',\n    script: './start-production.sh',\n    cwd: '/home/aisg/apps/aisg',\n    instances: 1,\n    exec_mode: 'fork',\n    autorestart: true,\n    watch: false,\n    max_memory_restart: '1G',\n    env: {\n      NODE_ENV: 'production',\n      PORT: 5000,\n      HOST: '0.0.0.0'\n    },\n    error_file: './logs/pm2-error.log',\n    out_file: './logs/pm2-out.log',\n    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n    merge_logs: true,\n  }]\n};\n```\n\n### 7.3 Create Logs Directory\n\n```bash\nmkdir -p logs\n```\n\n### 7.4 Start Application with PM2\n\n```bash\n# Start application\npm2 start ecosystem.config.js\n\n# You should see:\n# â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n# â”‚ id  â”‚ name             â”‚ status  â”‚ restart â”‚ uptime  â”‚\n# â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n# â”‚ 0   â”‚ aisg-production  â”‚ online  â”‚ 0       â”‚ 0s      â”‚\n# â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n# Check status\npm2 status\n\n# View logs (real-time)\npm2 logs aisg-production\n\n# Stop logs: Ctrl+C\n\n# Test application\ncurl http://localhost:5000\n# Should return HTML content\n```\n\n### 7.5 PM2 Auto-Start on Server Reboot\n\n```bash\n# Generate startup script\npm2 startup\n\n# This will print a command like:\n# sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u aisg --hp /home/aisg\n\n# Copy and run that command exactly\n\n# Save current PM2 process list\npm2 save\n\n# Now PM2 will auto-start on server reboot!\n```\n\n### 7.6 PM2 Commands Cheatsheet\n\n```bash\n# View status\npm2 status\n\n# View logs\npm2 logs aisg-production\npm2 logs aisg-production --lines 100  # Last 100 lines\n\n# Restart application\npm2 restart aisg-production\n\n# Stop application\npm2 stop aisg-production\n\n# Delete from PM2\npm2 delete aisg-production\n\n# Monitor CPU/Memory\npm2 monit\n```\n\n---\n\n## 8. Nginx Reverse Proxy\n\n**Nginx** serves as reverse proxy, handling HTTPS and forwarding requests to your Node.js app.\n\n### 8.1 Install Nginx\n\n```bash\n# Install Nginx\nsudo apt install -y nginx\n\n# Start Nginx\nsudo systemctl start nginx\nsudo systemctl enable nginx\n\n# Check status\nsudo systemctl status nginx\n\n# Test from browser: http://your-server-ip\n# Should see \"Welcome to nginx!\"\n```\n\n### 8.2 Configure Nginx for AISG\n\n```bash\n# Create Nginx config file\nsudo nano /etc/nginx/sites-available/aisg\n```\n\n**Paste this content** (replace `aisg.yourdomain.com` with your domain or IP):\n\n```nginx\n# HTTP Server (will redirect to HTTPS later)\nserver {\n    listen 80;\n    listen [::]:80;\n    \n    server_name aisg.yourdomain.com;  # CHANGE THIS to your domain or IP\n    \n    # Increase client body size for file uploads\n    client_max_body_size 10M;\n    \n    # Proxy to Node.js application\n    location / {\n        proxy_pass http://localhost:5000;\n        proxy_http_version 1.1;\n        \n        # WebSocket support (if needed in future)\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        \n        # Forward headers\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        \n        # Timeouts\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n    \n    # Logs\n    access_log /var/log/nginx/aisg-access.log;\n    error_log /var/log/nginx/aisg-error.log;\n}\n```\n\n**Save and exit**: Ctrl+X, Y, Enter\n\n### 8.3 Enable Nginx Site\n\n```bash\n# Create symbolic link\nsudo ln -s /etc/nginx/sites-available/aisg /etc/nginx/sites-enabled/\n\n# Remove default site (optional)\nsudo rm /etc/nginx/sites-enabled/default\n\n# Test Nginx configuration\nsudo nginx -t\n\n# Should see:\n# nginx: configuration file /etc/nginx/nginx.conf test is successful\n\n# Reload Nginx\nsudo systemctl reload nginx\n```\n\n### 8.4 Test Application via Nginx\n\n```bash\n# From browser, visit:\nhttp://aisg.yourdomain.com\n# Or if no domain:\nhttp://your-server-ip\n\n# You should see AISG homepage!\n```\n\n**If you see errors**:\n1. Check PM2 is running: `pm2 status`\n2. Check Nginx logs: `sudo tail -f /var/log/nginx/aisg-error.log`\n3. Check app logs: `pm2 logs aisg-production`\n\n---\n\n## 9. SSL Certificate (HTTPS)\n\n**Certbot** provides free SSL certificates from Let's Encrypt.\n\n### 9.1 Install Certbot\n\n```bash\n# Install Certbot and Nginx plugin\nsudo apt install -y certbot python3-certbot-nginx\n```\n\n### 9.2 Obtain SSL Certificate\n\n**Prerequisites**:\n- Domain name configured (DNS pointing to your server)\n- Port 80 open (firewall allows HTTP)\n\n```bash\n# Run Certbot\nsudo certbot --nginx -d aisg.yourdomain.com\n\n# Follow prompts:\n# 1. Enter email address (for renewal notifications)\n# 2. Agree to Terms of Service: Y\n# 3. Share email with EFF: N (optional)\n# 4. Redirect HTTP to HTTPS: 2 (Yes, recommended)\n\n# Certbot will:\n# - Verify domain ownership\n# - Obtain SSL certificate\n# - Auto-configure Nginx for HTTPS\n# - Set up HTTP â†’ HTTPS redirect\n```\n\n**Expected output**:\n```\nSuccessfully received certificate.\nCertificate is saved at: /etc/letsencrypt/live/aisg.yourdomain.com/fullchain.pem\nKey is saved at: /etc/letsencrypt/live/aisg.yourdomain.com/privkey.pem\n```\n\n### 9.3 Test HTTPS\n\n```bash\n# Visit your site:\nhttps://aisg.yourdomain.com\n\n# Should show:\n# - Padlock icon (secure)\n# - AISG homepage loads\n```\n\n### 9.4 Auto-Renewal Setup\n\n```bash\n# Certbot auto-renewal is enabled by default\n# Test renewal process:\nsudo certbot renew --dry-run\n\n# Should see:\n# Congratulations, all renewals succeeded!\n\n# Certificate auto-renews every 60 days (expires after 90)\n```\n\n### 9.5 Firewall Configuration (UFW)\n\n**If you have firewall enabled**:\n\n```bash\n# Allow HTTP\nsudo ufw allow 80/tcp\n\n# Allow HTTPS\nsudo ufw allow 443/tcp\n\n# Allow SSH (important!)\nsudo ufw allow 22/tcp\n\n# Enable firewall\nsudo ufw enable\n\n# Check status\nsudo ufw status\n```\n\n---\n\n## 10. Monitoring & Logs\n\n### 10.1 Application Logs\n\n**PM2 Logs**:\n```bash\n# View real-time logs\npm2 logs aisg-production\n\n# View last 100 lines\npm2 logs aisg-production --lines 100\n\n# View only errors\npm2 logs aisg-production --err\n\n# Log files location\nls -la /home/aisg/apps/aisg/logs/\n```\n\n**Nginx Logs**:\n```bash\n# Access log (requests)\nsudo tail -f /var/log/nginx/aisg-access.log\n\n# Error log\nsudo tail -f /var/log/nginx/aisg-error.log\n```\n\n**PostgreSQL Logs**:\n```bash\n# View PostgreSQL logs\nsudo tail -f /var/log/postgresql/postgresql-16-main.log\n```\n\n### 10.2 System Monitoring\n\n**Disk Usage**:\n```bash\ndf -h\n# Check available disk space\n```\n\n**Memory Usage**:\n```bash\nfree -h\n# Check RAM usage\n```\n\n**CPU Usage**:\n```bash\ntop\n# Press 'q' to quit\n```\n\n**Process Monitoring**:\n```bash\n# PM2 real-time monitoring\npm2 monit\n\n# Shows:\n# - CPU usage\n# - Memory usage\n# - Logs\n```\n\n### 10.3 Database Monitoring\n\n**Check database size**:\n```bash\nsudo su - postgres\npsql -d aisg_production -c \"SELECT pg_size_pretty(pg_database_size('aisg_production'));\"\nexit\n```\n\n**Active connections**:\n```bash\nsudo su - postgres\npsql -d aisg_production -c \"SELECT count(*) FROM pg_stat_activity;\"\nexit\n```\n\n### 10.4 Uptime Monitoring (Optional)\n\n**Install Uptime Robot** (free external monitoring):\n1. Visit: https://uptimerobot.com\n2. Create free account\n3. Add monitor: https://aisg.yourdomain.com\n4. Get alerts via email if site goes down\n\n---\n\n## 11. Backup Strategy\n\n### 11.1 Database Backups\n\n**Create backup script**:\n\n```bash\n# Create backup directory\nmkdir -p /home/aisg/backups\ncd /home/aisg/backups\n\n# Create backup script\nnano backup-database.sh\n```\n\n**Paste this content**:\n\n```bash\n#!/bin/bash\n\n# Configuration\nDB_NAME=\"aisg_production\"\nDB_USER=\"aisg_user\"\nBACKUP_DIR=\"/home/aisg/backups\"\nDATE=$(date +%Y%m%d_%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/aisg_backup_$DATE.sql.gz\"\n\n# Create backup\nPGPASSWORD='your_super_secure_password_here' pg_dump -h localhost -U $DB_USER $DB_NAME | gzip > $BACKUP_FILE\n\n# Keep only last 7 days of backups\nfind $BACKUP_DIR -name \"aisg_backup_*.sql.gz\" -mtime +7 -delete\n\n# Log\necho \"Backup created: $BACKUP_FILE\"\n```\n\n**Make executable**:\n```bash\nchmod +x backup-database.sh\n```\n\n**Test backup**:\n```bash\n./backup-database.sh\n\n# Check backup file\nls -lh /home/aisg/backups/\n```\n\n### 11.2 Automated Daily Backups (Cron)\n\n```bash\n# Edit crontab\ncrontab -e\n\n# Add this line (backup at 2 AM daily):\n0 2 * * * /home/aisg/backups/backup-database.sh >> /home/aisg/backups/backup.log 2>&1\n\n# Save and exit\n```\n\n**Verify cron job**:\n```bash\ncrontab -l\n```\n\n### 11.3 Restore from Backup\n\n```bash\n# List backups\nls -lh /home/aisg/backups/\n\n# Restore from backup file\ngunzip < /home/aisg/backups/aisg_backup_20251023_020000.sql.gz | \\\n  PGPASSWORD='your_super_secure_password_here' \\\n  psql -h localhost -U aisg_user -d aisg_production\n\n# Restart application\npm2 restart aisg-production\n```\n\n### 11.4 File Backups (Application Code)\n\n```bash\n# Backup application files\ncd /home/aisg\ntar -czf aisg_app_backup_$(date +%Y%m%d).tar.gz apps/aisg/\n\n# Or use rsync to remote server\nrsync -avz /home/aisg/apps/aisg/ user@backup-server:/backups/aisg/\n```\n\n---\n\n## 12. Troubleshooting\n\n### 12.1 Application Won't Start\n\n**Check PM2 status**:\n```bash\npm2 status\npm2 logs aisg-production --lines 50\n```\n\n**Common issues**:\n1. **Port 5000 already in use**:\n   ```bash\n   # Find process using port 5000\n   sudo lsof -i :5000\n   \n   # Kill process\n   sudo kill -9 <PID>\n   ```\n\n2. **Database connection error**:\n   ```bash\n   # Check PostgreSQL is running\n   sudo systemctl status postgresql\n   \n   # Test connection\n   psql -h localhost -U aisg_user -d aisg_production\n   \n   # Check DATABASE_URL in .env\n   cat .env | grep DATABASE_URL\n   ```\n\n3. **Missing dependencies**:\n   ```bash\n   cd /home/aisg/apps/aisg\n   npm install\n   pm2 restart aisg-production\n   ```\n\n### 12.2 Nginx Errors\n\n**502 Bad Gateway**:\n- Node.js app is not running\n  ```bash\n  pm2 status  # Check if running\n  pm2 restart aisg-production\n  ```\n\n**504 Gateway Timeout**:\n- Request taking too long\n  ```bash\n  # Check app logs for slow operations\n  pm2 logs aisg-production\n  ```\n\n**Nginx won't start**:\n```bash\n# Check config syntax\nsudo nginx -t\n\n# Check error log\nsudo tail -f /var/log/nginx/error.log\n```\n\n### 12.3 SSL Certificate Issues\n\n**Certificate expired**:\n```bash\n# Renew manually\nsudo certbot renew\n\n# Check auto-renewal\nsudo systemctl status certbot.timer\n```\n\n**Certificate not applying**:\n```bash\n# Reload Nginx\nsudo systemctl reload nginx\n```\n\n### 12.4 Database Issues\n\n**Can't connect to database**:\n```bash\n# Check PostgreSQL status\nsudo systemctl status postgresql\n\n# Restart PostgreSQL\nsudo systemctl restart postgresql\n\n# Check PostgreSQL logs\nsudo tail -f /var/log/postgresql/postgresql-16-main.log\n```\n\n**Database full**:\n```bash\n# Check disk space\ndf -h\n\n# Check database size\nsudo su - postgres\npsql -d aisg_production -c \"SELECT pg_size_pretty(pg_database_size('aisg_production'));\"\n```\n\n### 12.5 Performance Issues\n\n**High CPU usage**:\n```bash\n# Check with PM2\npm2 monit\n\n# Check with top\ntop\n# Press '1' to see all cores\n# Press 'M' to sort by memory\n# Press 'P' to sort by CPU\n```\n\n**High memory usage**:\n```bash\n# Check memory\nfree -h\n\n# Restart application\npm2 restart aisg-production\n```\n\n**Slow database queries**:\n```bash\n# Enable slow query log in PostgreSQL\nsudo nano /etc/postgresql/16/main/postgresql.conf\n\n# Add/uncomment:\nlog_min_duration_statement = 1000  # Log queries > 1 second\n\n# Restart PostgreSQL\nsudo systemctl restart postgresql\n\n# View slow queries\nsudo tail -f /var/log/postgresql/postgresql-16-main.log\n```\n\n---\n\n## Appendix A: Quick Commands Reference\n\n### Application Management\n```bash\n# Start application\npm2 start ecosystem.config.js\n\n# Restart application\npm2 restart aisg-production\n\n# Stop application\npm2 stop aisg-production\n\n# View logs\npm2 logs aisg-production\n\n# Monitor resources\npm2 monit\n```\n\n### Nginx Management\n```bash\n# Test config\nsudo nginx -t\n\n# Reload config\nsudo systemctl reload nginx\n\n# Restart Nginx\nsudo systemctl restart nginx\n\n# View logs\nsudo tail -f /var/log/nginx/aisg-error.log\n```\n\n### Database Management\n```bash\n# Connect to database\npsql -h localhost -U aisg_user -d aisg_production\n\n# Backup database\n./backup-database.sh\n\n# Check database size\nsudo su - postgres -c \"psql -d aisg_production -c \\\"SELECT pg_size_pretty(pg_database_size('aisg_production'));\\\"\"\n```\n\n### SSL Certificate\n```bash\n# Renew certificate\nsudo certbot renew\n\n# Test renewal\nsudo certbot renew --dry-run\n```\n\n---\n\n## Appendix B: Update Application\n\n**When you have new version of AISG**:\n\n```bash\n# 1. Stop application\npm2 stop aisg-production\n\n# 2. Backup current version\ncd /home/aisg/apps\nmv aisg aisg-backup-$(date +%Y%m%d)\n\n# 3. Upload new ZIP file and extract\nunzip aisg-new-version.zip\nmv aisg-new-version aisg\n\n# 4. Copy environment file\ncp aisg-backup-*/env aisg/.env\n\n# 5. Install dependencies\ncd aisg\nnpm install\n\n# 6. Run migrations (if database changed)\nnpm run db:push\n\n# 7. Build frontend\nnpm run build\n\n# 8. Start application\npm2 start ecosystem.config.js\n\n# 9. Verify\npm2 logs aisg-production\n```\n\n---\n\n## Appendix C: Security Checklist\n\n- [ ] Change default PostgreSQL password\n- [ ] Use strong SESSION_SECRET (random 32+ characters)\n- [ ] Firewall enabled (UFW) with only necessary ports\n- [ ] SSH key-based authentication (disable password login)\n- [ ] Keep system updated: `sudo apt update && sudo apt upgrade`\n- [ ] Regular database backups (daily automated)\n- [ ] SSL certificate enabled and auto-renewing\n- [ ] Application running as non-root user (`aisg`)\n- [ ] .env file permissions set to 600 (owner read/write only)\n- [ ] OpenAI API key stored securely (not in code)\n\n---\n\n## Support\n\n**If you encounter issues**:\n\n1. Check logs:\n   - PM2: `pm2 logs aisg-production`\n   - Nginx: `sudo tail -f /var/log/nginx/aisg-error.log`\n   - PostgreSQL: `sudo tail -f /var/log/postgresql/postgresql-16-main.log`\n\n2. Verify services running:\n   ```bash\n   pm2 status\n   sudo systemctl status nginx\n   sudo systemctl status postgresql\n   ```\n\n3. Test database connection:\n   ```bash\n   psql -h localhost -U aisg_user -d aisg_production\n   ```\n\n4. Check system resources:\n   ```bash\n   df -h        # Disk space\n   free -h      # Memory\n   pm2 monit    # App resources\n   ```\n\n---\n\n**END OF DEPLOYMENT GUIDE**\n\nFor technical documentation, see `AISG_Technical_Documentation.md`.  \nFor user manual, see `AISG_Manual_Book.txt`.\n\n**Good luck with your deployment!** ðŸš€\n","size_bytes":23700},"attached_assets/aisg_instruction_copas_builder_1762749934943.md":{"content":"","size_bytes":0},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/pages/OrganizationalSetup.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Building2, MapPin, Briefcase, Plus, Pencil, Trash2, Building } from \"lucide-react\";\nimport type { Pt, CeoUnit, Branch, Position } from \"@shared/schema\";\n\nexport default function OrganizationalSetup() {\n  const { toast } = useToast();\n  const [ptDialogOpen, setPtDialogOpen] = useState(false);\n  const [ceoDialogOpen, setCeoDialogOpen] = useState(false);\n  const [branchDialogOpen, setBranchDialogOpen] = useState(false);\n  const [positionDialogOpen, setPositionDialogOpen] = useState(false);\n\n  // Form states for PT\n  const [ptForm, setPtForm] = useState({ id: \"\", code: \"\", name: \"\" });\n  const [editingPt, setEditingPt] = useState<Pt | null>(null);\n\n  // Form states for CEO Unit (NO CODE FIELD - only name)\n  const [ceoForm, setCeoForm] = useState({ id: \"\", name: \"\" });\n  const [editingCeo, setEditingCeo] = useState<CeoUnit | null>(null);\n\n  // Form states for Branch (region instead of address, NO ceoUnitId)\n  const [branchForm, setBranchForm] = useState({ id: \"\", code: \"\", name: \"\", region: \"\", ptId: \"\" });\n  const [editingBranch, setEditingBranch] = useState<Branch | null>(null);\n\n  // Form states for Position\n  const [positionForm, setPositionForm] = useState({ id: \"\", code: \"\", name: \"\", level: 1, description: \"\" });\n  const [editingPosition, setEditingPosition] = useState<Position | null>(null);\n\n  // Fetch data\n  const { data: pts = [], isLoading: ptsLoading } = useQuery<Pt[]>({ queryKey: [\"/api/enterprise/pts\"] });\n  const { data: ceoUnits = [], isLoading: ceosLoading } = useQuery<CeoUnit[]>({ queryKey: [\"/api/enterprise/ceo-units\"] });\n  const { data: branches = [], isLoading: branchesLoading } = useQuery<Branch[]>({ queryKey: [\"/api/enterprise/branches\"] });\n  const { data: positions = [], isLoading: positionsLoading } = useQuery<Position[]>({ queryKey: [\"/api/enterprise/positions\"] });\n\n  // PT mutations\n  const createPtMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/enterprise/pts\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/pts\"] });\n      toast({ title: \"PT berhasil ditambahkan\" });\n      setPtDialogOpen(false);\n      setPtForm({ id: \"\", code: \"\", name: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal menambahkan PT\", variant: \"destructive\" })\n  });\n\n  const updatePtMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      return await apiRequest(\"PUT\", `/api/enterprise/pts/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/pts\"] });\n      toast({ title: \"PT berhasil diupdate\" });\n      setPtDialogOpen(false);\n      setEditingPt(null);\n      setPtForm({ id: \"\", code: \"\", name: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal mengupdate PT\", variant: \"destructive\" })\n  });\n\n  const deletePtMutation = useMutation({\n    mutationFn: async (id: string) => apiRequest(\"DELETE\", `/api/enterprise/pts/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/pts\"] });\n      toast({ title: \"PT berhasil dihapus\" });\n    },\n    onError: () => toast({ title: \"Gagal menghapus PT\", variant: \"destructive\" })\n  });\n\n  // CEO Unit mutations\n  const createCeoMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/enterprise/ceo-units\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/ceo-units\"] });\n      toast({ title: \"CEO Unit berhasil ditambahkan\" });\n      setCeoDialogOpen(false);\n      setCeoForm({ id: \"\", name: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal menambahkan CEO Unit\", variant: \"destructive\" })\n  });\n\n  const updateCeoMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      return await apiRequest(\"PUT\", `/api/enterprise/ceo-units/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/ceo-units\"] });\n      toast({ title: \"CEO Unit berhasil diupdate\" });\n      setCeoDialogOpen(false);\n      setEditingCeo(null);\n      setCeoForm({ id: \"\", name: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal mengupdate CEO Unit\", variant: \"destructive\" })\n  });\n\n  const deleteCeoMutation = useMutation({\n    mutationFn: async (id: string) => apiRequest(\"DELETE\", `/api/enterprise/ceo-units/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/ceo-units\"] });\n      toast({ title: \"CEO Unit berhasil dihapus\" });\n    },\n    onError: () => toast({ title: \"Gagal menghapus CEO Unit\", variant: \"destructive\" })\n  });\n\n  // Branch mutations\n  const createBranchMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/enterprise/branches\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/branches\"] });\n      toast({ title: \"Cabang berhasil ditambahkan\" });\n      setBranchDialogOpen(false);\n      setBranchForm({ id: \"\", code: \"\", name: \"\", region: \"\", ptId: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal menambahkan cabang\", variant: \"destructive\" })\n  });\n\n  const updateBranchMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      return await apiRequest(\"PUT\", `/api/enterprise/branches/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/branches\"] });\n      toast({ title: \"Cabang berhasil diupdate\" });\n      setBranchDialogOpen(false);\n      setEditingBranch(null);\n      setBranchForm({ id: \"\", code: \"\", name: \"\", region: \"\", ptId: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal mengupdate cabang\", variant: \"destructive\" })\n  });\n\n  const deleteBranchMutation = useMutation({\n    mutationFn: async (id: string) => apiRequest(\"DELETE\", `/api/enterprise/branches/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/branches\"] });\n      toast({ title: \"Cabang berhasil dihapus\" });\n    },\n    onError: () => toast({ title: \"Gagal menghapus cabang\", variant: \"destructive\" })\n  });\n\n  // Position mutations\n  const createPositionMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/enterprise/positions\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/positions\"] });\n      toast({ title: \"Posisi berhasil ditambahkan\" });\n      setPositionDialogOpen(false);\n      setPositionForm({ id: \"\", code: \"\", name: \"\", level: 1, description: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal menambahkan posisi\", variant: \"destructive\" })\n  });\n\n  const updatePositionMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      return await apiRequest(\"PUT\", `/api/enterprise/positions/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/positions\"] });\n      toast({ title: \"Posisi berhasil diupdate\" });\n      setPositionDialogOpen(false);\n      setEditingPosition(null);\n      setPositionForm({ id: \"\", code: \"\", name: \"\", level: 1, description: \"\" });\n    },\n    onError: () => toast({ title: \"Gagal mengupdate posisi\", variant: \"destructive\" })\n  });\n\n  const deletePositionMutation = useMutation({\n    mutationFn: async (id: string) => apiRequest(\"DELETE\", `/api/enterprise/positions/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/positions\"] });\n      toast({ title: \"Posisi berhasil dihapus\" });\n    },\n    onError: () => toast({ title: \"Gagal menghapus posisi\", variant: \"destructive\" })\n  });\n\n  // Handle PT submit\n  const handlePtSubmit = () => {\n    if (editingPt) {\n      updatePtMutation.mutate({ id: editingPt.id, data: { code: ptForm.code, name: ptForm.name } });\n    } else {\n      createPtMutation.mutate({ code: ptForm.code, name: ptForm.name });\n    }\n  };\n\n  // Handle CEO submit\n  const handleCeoSubmit = () => {\n    if (editingCeo) {\n      updateCeoMutation.mutate({ id: editingCeo.id, data: { name: ceoForm.name } });\n    } else {\n      createCeoMutation.mutate({ name: ceoForm.name });\n    }\n  };\n\n  // Handle Branch submit\n  const handleBranchSubmit = () => {\n    if (editingBranch) {\n      updateBranchMutation.mutate({ \n        id: editingBranch.id, \n        data: { \n          code: branchForm.code, \n          name: branchForm.name, \n          region: branchForm.region || null,\n          ptId: branchForm.ptId\n        } \n      });\n    } else {\n      createBranchMutation.mutate({ \n        code: branchForm.code, \n        name: branchForm.name, \n        region: branchForm.region || null,\n        ptId: branchForm.ptId\n      });\n    }\n  };\n\n  // Handle Position submit\n  const handlePositionSubmit = () => {\n    if (editingPosition) {\n      updatePositionMutation.mutate({ \n        id: editingPosition.id, \n        data: { \n          code: positionForm.code, \n          name: positionForm.name, \n          level: positionForm.level,\n          description: positionForm.description || null\n        } \n      });\n    } else {\n      createPositionMutation.mutate({ \n        code: positionForm.code, \n        name: positionForm.name, \n        level: positionForm.level,\n        description: positionForm.description || null\n      });\n    }\n  };\n\n  return (\n    <div className=\"h-full overflow-auto bg-background\">\n      <div className=\"container mx-auto py-8 px-4 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold bg-gradient-to-r from-primary via-purple-500 to-pink-500 bg-clip-text text-transparent\">\n              Pengaturan Organisasi\n            </h1>\n            <p className=\"text-muted-foreground mt-2\">\n              Kelola struktur organisasi perusahaan (PT, CEO Unit, Cabang, Posisi)\n            </p>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"pts\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-4 gap-2\">\n            <TabsTrigger value=\"pts\" className=\"flex items-center gap-2\" data-testid=\"tab-pts\">\n              <Building2 className=\"w-4 h-4\" />\n              PT Companies\n            </TabsTrigger>\n            <TabsTrigger value=\"ceos\" className=\"flex items-center gap-2\" data-testid=\"tab-ceos\">\n              <Building className=\"w-4 h-4\" />\n              CEO Units\n            </TabsTrigger>\n            <TabsTrigger value=\"branches\" className=\"flex items-center gap-2\" data-testid=\"tab-branches\">\n              <MapPin className=\"w-4 h-4\" />\n              Cabang\n            </TabsTrigger>\n            <TabsTrigger value=\"positions\" className=\"flex items-center gap-2\" data-testid=\"tab-positions\">\n              <Briefcase className=\"w-4 h-4\" />\n              Posisi\n            </TabsTrigger>\n          </TabsList>\n\n          {/* PT Tab */}\n          <TabsContent value=\"pts\" className=\"space-y-4\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0\">\n                <div>\n                  <CardTitle>PT Companies</CardTitle>\n                  <CardDescription>5 perusahaan PT dalam grup AISG</CardDescription>\n                </div>\n                <Dialog open={ptDialogOpen} onOpenChange={setPtDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button \n                      onClick={() => {\n                        setEditingPt(null);\n                        setPtForm({ id: \"\", code: \"\", name: \"\" });\n                      }}\n                      data-testid=\"button-add-pt\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Tambah PT\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent data-testid=\"dialog-pt-form\">\n                    <DialogHeader>\n                      <DialogTitle>{editingPt ? \"Edit PT\" : \"Tambah PT Baru\"}</DialogTitle>\n                      <DialogDescription>\n                        {editingPt ? \"Ubah data PT\" : \"Tambahkan PT baru ke dalam sistem\"}\n                      </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <Label htmlFor=\"pt-code\">Kode PT</Label>\n                        <Input\n                          id=\"pt-code\"\n                          value={ptForm.code}\n                          onChange={(e) => setPtForm({ ...ptForm, code: e.target.value })}\n                          placeholder=\"e.g., RFB\"\n                          data-testid=\"input-pt-code\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"pt-name\">Nama PT</Label>\n                        <Input\n                          id=\"pt-name\"\n                          value={ptForm.name}\n                          onChange={(e) => setPtForm({ ...ptForm, name: e.target.value })}\n                          placeholder=\"e.g., PT Rifan Financindo Berjangka\"\n                          data-testid=\"input-pt-name\"\n                        />\n                      </div>\n                    </div>\n                    <DialogFooter>\n                      <Button \n                        onClick={handlePtSubmit} \n                        disabled={createPtMutation.isPending || updatePtMutation.isPending}\n                        data-testid=\"button-submit-pt\"\n                      >\n                        {editingPt ? \"Update\" : \"Tambah\"}\n                      </Button>\n                    </DialogFooter>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                {ptsLoading ? (\n                  <div className=\"space-y-2\">\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Kode</TableHead>\n                        <TableHead>Nama PT</TableHead>\n                        <TableHead className=\"text-right\">Aksi</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {pts.map((pt) => (\n                        <TableRow key={pt.id} data-testid={`row-pt-${pt.code}`}>\n                          <TableCell>\n                            <Badge variant=\"outline\" data-testid={`badge-pt-code-${pt.code}`}>{pt.code}</Badge>\n                          </TableCell>\n                          <TableCell data-testid={`text-pt-name-${pt.code}`}>{pt.name}</TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              <Button \n                                variant=\"ghost\" \n                                size=\"icon\"\n                                onClick={() => {\n                                  setEditingPt(pt);\n                                  setPtForm({ id: pt.id, code: pt.code, name: pt.name });\n                                  setPtDialogOpen(true);\n                                }}\n                                data-testid={`button-edit-pt-${pt.code}`}\n                              >\n                                <Pencil className=\"w-4 h-4\" />\n                              </Button>\n                              <Button \n                                variant=\"ghost\" \n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm(`Yakin ingin menghapus PT ${pt.name}?`)) {\n                                    deletePtMutation.mutate(pt.id);\n                                  }\n                                }}\n                                data-testid={`button-delete-pt-${pt.code}`}\n                              >\n                                <Trash2 className=\"w-4 h-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* CEO Units Tab */}\n          <TabsContent value=\"ceos\" className=\"space-y-4\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0\">\n                <div>\n                  <CardTitle>CEO Units</CardTitle>\n                  <CardDescription>5 unit CEO dalam organisasi</CardDescription>\n                </div>\n                <Dialog open={ceoDialogOpen} onOpenChange={setCeoDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button \n                      onClick={() => {\n                        setEditingCeo(null);\n                        setCeoForm({ id: \"\", name: \"\" });\n                      }}\n                      data-testid=\"button-add-ceo\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Tambah CEO Unit\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent data-testid=\"dialog-ceo-form\">\n                    <DialogHeader>\n                      <DialogTitle>{editingCeo ? \"Edit CEO Unit\" : \"Tambah CEO Unit Baru\"}</DialogTitle>\n                      <DialogDescription>\n                        {editingCeo ? \"Ubah data CEO Unit\" : \"Tambahkan CEO Unit baru\"}\n                      </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <Label htmlFor=\"ceo-name\">Nama CEO Unit</Label>\n                        <Input\n                          id=\"ceo-name\"\n                          value={ceoForm.name}\n                          onChange={(e) => setCeoForm({ ...ceoForm, name: e.target.value })}\n                          placeholder=\"e.g., ISRIYETTI\"\n                          data-testid=\"input-ceo-name\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Gunakan nama CEO sebagai identifier (e.g., ISRIYETTI, NL, GS, TJANDRA, EDWIN)\n                        </p>\n                      </div>\n                    </div>\n                    <DialogFooter>\n                      <Button \n                        onClick={handleCeoSubmit} \n                        disabled={createCeoMutation.isPending || updateCeoMutation.isPending}\n                        data-testid=\"button-submit-ceo\"\n                      >\n                        {editingCeo ? \"Update\" : \"Tambah\"}\n                      </Button>\n                    </DialogFooter>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                {ceosLoading ? (\n                  <div className=\"space-y-2\">\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Nama CEO Unit</TableHead>\n                        <TableHead className=\"text-right\">Aksi</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {ceoUnits.map((ceo) => (\n                        <TableRow key={ceo.id} data-testid={`row-ceo-${ceo.name}`}>\n                          <TableCell>\n                            <Badge data-testid={`badge-ceo-name-${ceo.name}`}>{ceo.name}</Badge>\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              <Button \n                                variant=\"ghost\" \n                                size=\"icon\"\n                                onClick={() => {\n                                  setEditingCeo(ceo);\n                                  setCeoForm({ id: ceo.id, name: ceo.name });\n                                  setCeoDialogOpen(true);\n                                }}\n                                data-testid={`button-edit-ceo-${ceo.name}`}\n                              >\n                                <Pencil className=\"w-4 h-4\" />\n                              </Button>\n                              <Button \n                                variant=\"ghost\" \n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm(`Yakin ingin menghapus CEO Unit ${ceo.name}?`)) {\n                                    deleteCeoMutation.mutate(ceo.id);\n                                  }\n                                }}\n                                data-testid={`button-delete-ceo-${ceo.name}`}\n                              >\n                                <Trash2 className=\"w-4 h-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Branches Tab */}\n          <TabsContent value=\"branches\" className=\"space-y-4\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0\">\n                <div>\n                  <CardTitle>Cabang</CardTitle>\n                  <CardDescription>{branches.length} cabang tersebar di seluruh Indonesia</CardDescription>\n                </div>\n                <Dialog open={branchDialogOpen} onOpenChange={setBranchDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button \n                      onClick={() => {\n                        setEditingBranch(null);\n                        setBranchForm({ id: \"\", code: \"\", name: \"\", region: \"\", ptId: \"\" });\n                      }}\n                      data-testid=\"button-add-branch\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Tambah Cabang\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent data-testid=\"dialog-branch-form\">\n                    <DialogHeader>\n                      <DialogTitle>{editingBranch ? \"Edit Cabang\" : \"Tambah Cabang Baru\"}</DialogTitle>\n                      <DialogDescription>\n                        {editingBranch ? \"Ubah data cabang\" : \"Tambahkan cabang baru\"}\n                      </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <Label htmlFor=\"branch-code\">Kode Cabang</Label>\n                        <Input\n                          id=\"branch-code\"\n                          value={branchForm.code}\n                          onChange={(e) => setBranchForm({ ...branchForm, code: e.target.value })}\n                          placeholder=\"e.g., JKT-01\"\n                          data-testid=\"input-branch-code\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"branch-name\">Nama Cabang</Label>\n                        <Input\n                          id=\"branch-name\"\n                          value={branchForm.name}\n                          onChange={(e) => setBranchForm({ ...branchForm, name: e.target.value })}\n                          placeholder=\"e.g., Jakarta Pusat\"\n                          data-testid=\"input-branch-name\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"branch-region\">Region (Opsional)</Label>\n                        <Input\n                          id=\"branch-region\"\n                          value={branchForm.region}\n                          onChange={(e) => setBranchForm({ ...branchForm, region: e.target.value })}\n                          placeholder=\"e.g., Jakarta, Medan, Surabaya\"\n                          data-testid=\"input-branch-region\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Wilayah cabang untuk pengelompokan geografis\n                        </p>\n                      </div>\n                      <div>\n                        <Label htmlFor=\"branch-pt\">PT Company</Label>\n                        <Select \n                          value={branchForm.ptId} \n                          onValueChange={(value) => setBranchForm({ ...branchForm, ptId: value })}\n                        >\n                          <SelectTrigger id=\"branch-pt\" data-testid=\"select-branch-pt\">\n                            <SelectValue placeholder=\"Pilih PT\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {pts.map((pt) => (\n                              <SelectItem key={pt.id} value={pt.id}>{pt.code} - {pt.name}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n                    <DialogFooter>\n                      <Button \n                        onClick={handleBranchSubmit} \n                        disabled={createBranchMutation.isPending || updateBranchMutation.isPending}\n                        data-testid=\"button-submit-branch\"\n                      >\n                        {editingBranch ? \"Update\" : \"Tambah\"}\n                      </Button>\n                    </DialogFooter>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                {branchesLoading ? (\n                  <div className=\"space-y-2\">\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Kode</TableHead>\n                        <TableHead>Nama Cabang</TableHead>\n                        <TableHead>PT</TableHead>\n                        <TableHead>Region</TableHead>\n                        <TableHead className=\"text-right\">Aksi</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {branches.map((branch) => {\n                        const pt = pts.find((p) => p.id === branch.ptId);\n                        return (\n                          <TableRow key={branch.id} data-testid={`row-branch-${branch.code}`}>\n                            <TableCell>\n                              <Badge variant=\"outline\" data-testid={`badge-branch-code-${branch.code}`}>\n                                {branch.code}\n                              </Badge>\n                            </TableCell>\n                            <TableCell data-testid={`text-branch-name-${branch.code}`}>{branch.name}</TableCell>\n                            <TableCell>\n                              <Badge data-testid={`badge-branch-pt-${branch.code}`}>{pt?.code}</Badge>\n                            </TableCell>\n                            <TableCell className=\"text-sm text-muted-foreground\" data-testid={`text-branch-region-${branch.code}`}>\n                              {branch.region || \"-\"}\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"flex justify-end gap-2\">\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"icon\"\n                                  onClick={() => {\n                                    setEditingBranch(branch);\n                                    setBranchForm({\n                                      id: branch.id,\n                                      code: branch.code,\n                                      name: branch.name,\n                                      region: branch.region || \"\",\n                                      ptId: branch.ptId\n                                    });\n                                    setBranchDialogOpen(true);\n                                  }}\n                                  data-testid={`button-edit-branch-${branch.code}`}\n                                >\n                                  <Pencil className=\"w-4 h-4\" />\n                                </Button>\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"icon\"\n                                  onClick={() => {\n                                    if (confirm(`Yakin ingin menghapus cabang ${branch.name}?`)) {\n                                      deleteBranchMutation.mutate(branch.id);\n                                    }\n                                  }}\n                                  data-testid={`button-delete-branch-${branch.code}`}\n                                >\n                                  <Trash2 className=\"w-4 h-4 text-destructive\" />\n                                </Button>\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Positions Tab */}\n          <TabsContent value=\"positions\" className=\"space-y-4\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0\">\n                <div>\n                  <CardTitle>Posisi</CardTitle>\n                  <CardDescription>11 level posisi dalam hierarki organisasi</CardDescription>\n                </div>\n                <Dialog open={positionDialogOpen} onOpenChange={setPositionDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button \n                      onClick={() => {\n                        setEditingPosition(null);\n                        setPositionForm({ id: \"\", code: \"\", name: \"\", level: 1, description: \"\" });\n                      }}\n                      data-testid=\"button-add-position\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-2\" />\n                      Tambah Posisi\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent data-testid=\"dialog-position-form\">\n                    <DialogHeader>\n                      <DialogTitle>{editingPosition ? \"Edit Posisi\" : \"Tambah Posisi Baru\"}</DialogTitle>\n                      <DialogDescription>\n                        {editingPosition ? \"Ubah data posisi\" : \"Tambahkan posisi baru\"}\n                      </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                      <div>\n                        <Label htmlFor=\"position-code\">Kode Posisi</Label>\n                        <Input\n                          id=\"position-code\"\n                          value={positionForm.code}\n                          onChange={(e) => setPositionForm({ ...positionForm, code: e.target.value })}\n                          placeholder=\"e.g., BC\"\n                          data-testid=\"input-position-code\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"position-name\">Nama Posisi</Label>\n                        <Input\n                          id=\"position-name\"\n                          value={positionForm.name}\n                          onChange={(e) => setPositionForm({ ...positionForm, name: e.target.value })}\n                          placeholder=\"e.g., Business Consultant\"\n                          data-testid=\"input-position-name\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"position-level\">Level (1=Tertinggi, 11=Terendah)</Label>\n                        <Input\n                          id=\"position-level\"\n                          type=\"number\"\n                          min={1}\n                          max={11}\n                          value={positionForm.level}\n                          onChange={(e) => setPositionForm({ ...positionForm, level: parseInt(e.target.value) || 1 })}\n                          data-testid=\"input-position-level\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"position-description\">Deskripsi (Opsional)</Label>\n                        <Input\n                          id=\"position-description\"\n                          value={positionForm.description}\n                          onChange={(e) => setPositionForm({ ...positionForm, description: e.target.value })}\n                          placeholder=\"Deskripsi posisi\"\n                          data-testid=\"input-position-description\"\n                        />\n                      </div>\n                    </div>\n                    <DialogFooter>\n                      <Button \n                        onClick={handlePositionSubmit} \n                        disabled={createPositionMutation.isPending || updatePositionMutation.isPending}\n                        data-testid=\"button-submit-position\"\n                      >\n                        {editingPosition ? \"Update\" : \"Tambah\"}\n                      </Button>\n                    </DialogFooter>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                {positionsLoading ? (\n                  <div className=\"space-y-2\">\n                    <Skeleton className=\"h-12 w-full\" />\n                    <Skeleton className=\"h-12 w-full\" />\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Level</TableHead>\n                        <TableHead>Kode</TableHead>\n                        <TableHead>Nama Posisi</TableHead>\n                        <TableHead>Deskripsi</TableHead>\n                        <TableHead className=\"text-right\">Aksi</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {positions.sort((a, b) => a.level - b.level).map((position) => (\n                        <TableRow key={position.id} data-testid={`row-position-${position.code}`}>\n                          <TableCell>\n                            <Badge \n                              variant={position.level === 1 ? \"default\" : position.level <= 5 ? \"secondary\" : \"outline\"}\n                              data-testid={`badge-position-level-${position.code}`}\n                            >\n                              {position.level}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\" data-testid={`badge-position-code-${position.code}`}>\n                              {position.code}\n                            </Badge>\n                          </TableCell>\n                          <TableCell data-testid={`text-position-name-${position.code}`}>{position.name}</TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\" data-testid={`text-position-description-${position.code}`}>\n                            {position.description || \"-\"}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              <Button \n                                variant=\"ghost\" \n                                size=\"icon\"\n                                onClick={() => {\n                                  setEditingPosition(position);\n                                  setPositionForm({\n                                    id: position.id,\n                                    code: position.code,\n                                    name: position.name,\n                                    level: position.level,\n                                    description: position.description || \"\"\n                                  });\n                                  setPositionDialogOpen(true);\n                                }}\n                                data-testid={`button-edit-position-${position.code}`}\n                              >\n                                <Pencil className=\"w-4 h-4\" />\n                              </Button>\n                              <Button \n                                variant=\"ghost\" \n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm(`Yakin ingin menghapus posisi ${position.name}?`)) {\n                                    deletePositionMutation.mutate(position.id);\n                                  }\n                                }}\n                                data-testid={`button-delete-position-${position.code}`}\n                              >\n                                <Trash2 className=\"w-4 h-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":39592},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/pages/EmployeeMasterData.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, Pencil, Trash2, Users, Search, Filter, Network, ChevronDown, ChevronRight, Mail, Phone, Calendar } from \"lucide-react\";\n\ntype Employee = {\n  id: string;\n  employeeCode: string;\n  fullName: string;\n  positionId: string;\n  ptId: string;\n  branchId: string | null;\n  ceoUnitId: string | null;\n  managerId: string | null;\n  email: string | null;\n  phone: string | null;\n  joinDate: string;\n  status: \"active\" | \"inactive\";\n  position?: { id: string; code: string; name: string; level: number };\n  pt?: { id: string; code: string; name: string };\n  branch?: { id: string; code: string; name: string } | null;\n  ceoUnit?: { id: string; name: string } | null;\n  manager?: { id: string; fullName: string; employeeCode: string } | null;\n};\n\ntype Pt = { id: string; code: string; name: string };\ntype CeoUnit = { id: string; name: string };\ntype Branch = { id: string; code: string; name: string; ptId: string };\ntype Position = { id: string; code: string; name: string; level: number };\n\nexport default function EmployeeMasterData() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"list\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [editingEmployee, setEditingEmployee] = useState<Employee | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filterPt, setFilterPt] = useState<string>(\"all\");\n  const [filterPosition, setFilterPosition] = useState<string>(\"all\");\n  const [filterStatus, setFilterStatus] = useState<string>(\"all\");\n\n  // Form state\n  const [form, setForm] = useState({\n    id: \"\",\n    employeeCode: \"\",\n    fullName: \"\",\n    positionId: \"\",\n    ptId: \"\",\n    branchId: \"\",\n    ceoUnitId: \"\",\n    managerId: \"\",\n    email: \"\",\n    phone: \"\",\n    joinDate: new Date().toISOString().split('T')[0],\n    status: \"active\" as \"active\" | \"inactive\"\n  });\n\n  // Fetch data\n  const { data: employees = [], isLoading: employeesLoading } = useQuery<Employee[]>({ \n    queryKey: [\"/api/enterprise/employees\"] \n  });\n  const { data: pts = [] } = useQuery<Pt[]>({ queryKey: [\"/api/enterprise/pts\"] });\n  const { data: ceoUnits = [] } = useQuery<CeoUnit[]>({ queryKey: [\"/api/enterprise/ceo-units\"] });\n  const { data: branches = [] } = useQuery<Branch[]>({ queryKey: [\"/api/enterprise/branches\"] });\n  const { data: positions = [] } = useQuery<Position[]>({ queryKey: [\"/api/enterprise/positions\"] });\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest(\"POST\", \"/api/enterprise/employees\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/employees\"] });\n      toast({ title: \"Karyawan berhasil ditambahkan\" });\n      setDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Gagal menambahkan karyawan\", \n        description: error.message || \"Terjadi kesalahan\",\n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      return await apiRequest(\"PUT\", `/api/enterprise/employees/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/employees\"] });\n      toast({ title: \"Karyawan berhasil diupdate\" });\n      setDialogOpen(false);\n      setEditingEmployee(null);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Gagal mengupdate karyawan\",\n        description: error.message || \"Terjadi kesalahan\", \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => apiRequest(\"DELETE\", `/api/enterprise/employees/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/enterprise/employees\"] });\n      toast({ title: \"Karyawan berhasil dihapus\" });\n    },\n    onError: () => toast({ title: \"Gagal menghapus karyawan\", variant: \"destructive\" })\n  });\n\n  const resetForm = () => {\n    setForm({\n      id: \"\",\n      employeeCode: \"\",\n      fullName: \"\",\n      positionId: \"\",\n      ptId: \"\",\n      branchId: \"\",\n      ceoUnitId: \"\",\n      managerId: \"\",\n      email: \"\",\n      phone: \"\",\n      joinDate: new Date().toISOString().split('T')[0],\n      status: \"active\"\n    });\n  };\n\n  const handleEdit = (emp: Employee) => {\n    setEditingEmployee(emp);\n    setForm({\n      id: emp.id,\n      employeeCode: emp.employeeCode,\n      fullName: emp.fullName,\n      positionId: emp.positionId,\n      ptId: emp.ptId,\n      branchId: emp.branchId || \"\",\n      ceoUnitId: emp.ceoUnitId || \"\",\n      managerId: emp.managerId || \"\",\n      email: emp.email || \"\",\n      phone: emp.phone || \"\",\n      joinDate: emp.joinDate.split('T')[0],\n      status: emp.status\n    });\n    setDialogOpen(true);\n  };\n\n  const handleSubmit = () => {\n    if (!form.employeeCode || !form.fullName || !form.positionId || !form.ptId) {\n      toast({ title: \"Mohon lengkapi field yang wajib diisi\", variant: \"destructive\" });\n      return;\n    }\n\n    const payload = {\n      employeeCode: form.employeeCode,\n      fullName: form.fullName,\n      positionId: form.positionId,\n      ptId: form.ptId,\n      branchId: form.branchId || null,\n      ceoUnitId: form.ceoUnitId || null,\n      managerId: form.managerId || null,\n      email: form.email || null,\n      phone: form.phone || null,\n      joinDate: form.joinDate,\n      status: form.status\n    };\n\n    if (editingEmployee) {\n      updateMutation.mutate({ id: form.id, data: payload });\n    } else {\n      createMutation.mutate(payload);\n    }\n  };\n\n  // Filter employees\n  const filteredEmployees = employees.filter(emp => {\n    const matchSearch = searchQuery === \"\" || \n      emp.fullName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      emp.employeeCode.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchPt = filterPt === \"all\" || emp.ptId === filterPt;\n    const matchPosition = filterPosition === \"all\" || emp.positionId === filterPosition;\n    const matchStatus = filterStatus === \"all\" || emp.status === filterStatus;\n    return matchSearch && matchPt && matchPosition && matchStatus;\n  });\n\n  // Get available managers (higher rank = lower level number)\n  const selectedPosition = positions.find(p => p.id === form.positionId);\n  const availableManagers = employees.filter(emp => {\n    if (editingEmployee && emp.id === editingEmployee.id) return false; // Can't be own manager\n    if (!selectedPosition || !emp.position) return false;\n    return emp.position.level < selectedPosition.level; // Manager level must be LOWER number (higher rank)\n  });\n\n  // Get branches filtered by selected PT\n  const availableBranches = branches.filter(b => b.ptId === form.ptId);\n\n  return (\n    <div className=\"container mx-auto py-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent\">\n            Master Data Karyawan\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Kelola data karyawan dan struktur hierarki organisasi\n          </p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button \n              onClick={() => {\n                setEditingEmployee(null);\n                resetForm();\n              }}\n              data-testid=\"button-add-employee\"\n            >\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Tambah Karyawan\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingEmployee ? \"Edit Karyawan\" : \"Tambah Karyawan Baru\"}\n              </DialogTitle>\n            </DialogHeader>\n            \n            <div className=\"grid gap-4 py-4\">\n              {/* Employee Code & Name */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"employeeCode\">Kode Karyawan *</Label>\n                  <Input\n                    id=\"employeeCode\"\n                    value={form.employeeCode}\n                    onChange={(e) => setForm({ ...form, employeeCode: e.target.value })}\n                    placeholder=\"EMP001\"\n                    data-testid=\"input-employee-code\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"fullName\">Nama Lengkap *</Label>\n                  <Input\n                    id=\"fullName\"\n                    value={form.fullName}\n                    onChange={(e) => setForm({ ...form, fullName: e.target.value })}\n                    placeholder=\"John Doe\"\n                    data-testid=\"input-full-name\"\n                  />\n                </div>\n              </div>\n\n              {/* Position & PT */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"position\">Posisi *</Label>\n                  <Select \n                    value={form.positionId} \n                    onValueChange={(val) => setForm({ ...form, positionId: val })}\n                  >\n                    <SelectTrigger data-testid=\"select-position\">\n                      <SelectValue placeholder=\"Pilih posisi\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {positions.map(pos => (\n                        <SelectItem key={pos.id} value={pos.id}>\n                          {pos.name} (Level {pos.level})\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"pt\">PT *</Label>\n                  <Select \n                    value={form.ptId} \n                    onValueChange={(val) => {\n                      setForm({ ...form, ptId: val, branchId: \"\" }); // Reset branch when PT changes\n                    }}\n                  >\n                    <SelectTrigger data-testid=\"select-pt\">\n                      <SelectValue placeholder=\"Pilih PT\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {pts.map(pt => (\n                        <SelectItem key={pt.id} value={pt.id}>\n                          {pt.code} - {pt.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* Branch & CEO Unit */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"branch\">Cabang</Label>\n                  <Select \n                    value={form.branchId} \n                    onValueChange={(val) => setForm({ ...form, branchId: val })}\n                    disabled={!form.ptId || availableBranches.length === 0}\n                  >\n                    <SelectTrigger data-testid=\"select-branch\">\n                      <SelectValue placeholder={\n                        !form.ptId ? \"Pilih PT dulu\" : \n                        availableBranches.length === 0 ? \"Tidak ada cabang\" : \n                        \"Pilih cabang\"\n                      } />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"\">Tidak ada cabang</SelectItem>\n                      {availableBranches.map(branch => (\n                        <SelectItem key={branch.id} value={branch.id}>\n                          {branch.code} - {branch.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"ceoUnit\">CEO Unit</Label>\n                  <Select \n                    value={form.ceoUnitId} \n                    onValueChange={(val) => setForm({ ...form, ceoUnitId: val })}\n                  >\n                    <SelectTrigger data-testid=\"select-ceo-unit\">\n                      <SelectValue placeholder=\"Pilih CEO unit\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"\">Tidak ada unit</SelectItem>\n                      {ceoUnits.map(unit => (\n                        <SelectItem key={unit.id} value={unit.id}>\n                          {unit.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* Manager Selection - Hierarchy Builder */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"manager\">\n                  Atasan Langsung (Manager)\n                  {selectedPosition && (\n                    <span className=\"text-xs text-muted-foreground ml-2\">\n                      (Hanya level lebih tinggi dari {selectedPosition.level})\n                    </span>\n                  )}\n                </Label>\n                <Select \n                  value={form.managerId} \n                  onValueChange={(val) => setForm({ ...form, managerId: val })}\n                  disabled={!form.positionId || availableManagers.length === 0}\n                >\n                  <SelectTrigger data-testid=\"select-manager\">\n                    <SelectValue placeholder={\n                      !form.positionId ? \"Pilih posisi dulu\" :\n                      availableManagers.length === 0 ? \"Tidak ada atasan tersedia\" :\n                      \"Pilih atasan\"\n                    } />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"\">Tidak ada atasan</SelectItem>\n                    {availableManagers.map(mgr => (\n                      <SelectItem key={mgr.id} value={mgr.id}>\n                        {mgr.employeeCode} - {mgr.fullName} ({mgr.position?.name || \"Unknown\"})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground\">\n                  Tentukan siapa atasan langsung karyawan ini dalam hierarki organisasi\n                </p>\n              </div>\n\n              {/* Email & Phone */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={form.email}\n                    onChange={(e) => setForm({ ...form, email: e.target.value })}\n                    placeholder=\"john@example.com\"\n                    data-testid=\"input-email\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"phone\">Telepon</Label>\n                  <Input\n                    id=\"phone\"\n                    value={form.phone}\n                    onChange={(e) => setForm({ ...form, phone: e.target.value })}\n                    placeholder=\"08123456789\"\n                    data-testid=\"input-phone\"\n                  />\n                </div>\n              </div>\n\n              {/* Join Date & Status */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"joinDate\">Tanggal Bergabung *</Label>\n                  <Input\n                    id=\"joinDate\"\n                    type=\"date\"\n                    value={form.joinDate}\n                    onChange={(e) => setForm({ ...form, joinDate: e.target.value })}\n                    data-testid=\"input-join-date\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"status\">Status *</Label>\n                  <Select \n                    value={form.status} \n                    onValueChange={(val: \"active\" | \"inactive\") => setForm({ ...form, status: val })}\n                  >\n                    <SelectTrigger data-testid=\"select-status\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"active\">Aktif</SelectItem>\n                      <SelectItem value=\"inactive\">Tidak Aktif</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex justify-end gap-2\">\n              <Button \n                variant=\"outline\" \n                onClick={() => {\n                  setDialogOpen(false);\n                  setEditingEmployee(null);\n                  resetForm();\n                }}\n                data-testid=\"button-cancel\"\n              >\n                Batal\n              </Button>\n              <Button \n                onClick={handleSubmit}\n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-submit-employee\"\n              >\n                {createMutation.isPending || updateMutation.isPending ? \"Menyimpan...\" : \"Simpan\"}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList className=\"grid w-full max-w-md grid-cols-2\">\n          <TabsTrigger value=\"list\" data-testid=\"tab-list\">\n            <Users className=\"w-4 h-4 mr-2\" />\n            Daftar Karyawan\n          </TabsTrigger>\n          <TabsTrigger value=\"tree\" data-testid=\"tab-tree\">\n            <Network className=\"w-4 h-4 mr-2\" />\n            Struktur Hierarki\n          </TabsTrigger>\n        </TabsList>\n\n        {/* List View */}\n        <TabsContent value=\"list\" className=\"space-y-4\">\n          {/* Filters */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Filter className=\"w-5 h-5\" />\n                Filter & Pencarian\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"search\">Cari Karyawan</Label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      id=\"search\"\n                      placeholder=\"Nama atau kode...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"pl-8\"\n                      data-testid=\"input-search-employee\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"filterPt\">Filter PT</Label>\n                  <Select value={filterPt} onValueChange={setFilterPt}>\n                    <SelectTrigger data-testid=\"select-filter-pt\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Semua PT</SelectItem>\n                      {pts.map(pt => (\n                        <SelectItem key={pt.id} value={pt.id}>\n                          {pt.code}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"filterPosition\">Filter Posisi</Label>\n                  <Select value={filterPosition} onValueChange={setFilterPosition}>\n                    <SelectTrigger data-testid=\"select-filter-position\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Semua Posisi</SelectItem>\n                      {positions.map(pos => (\n                        <SelectItem key={pos.id} value={pos.id}>\n                          {pos.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"filterStatus\">Filter Status</Label>\n                  <Select value={filterStatus} onValueChange={setFilterStatus}>\n                    <SelectTrigger data-testid=\"select-filter-status\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Semua Status</SelectItem>\n                      <SelectItem value=\"active\">Aktif</SelectItem>\n                      <SelectItem value=\"inactive\">Tidak Aktif</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Employee Table */}\n          <Card>\n            <CardHeader>\n              <CardTitle>\n                Daftar Karyawan ({filteredEmployees.length})\n              </CardTitle>\n              <CardDescription>\n                Kelola data karyawan dan struktur hierarki organisasi\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {employeesLoading ? (\n                <div className=\"space-y-2\">\n                  {[1,2,3,4,5].map(i => <Skeleton key={i} className=\"h-12 w-full\" />)}\n                </div>\n              ) : (\n                <div className=\"rounded-md border\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Kode</TableHead>\n                        <TableHead>Nama</TableHead>\n                        <TableHead>Posisi</TableHead>\n                        <TableHead>PT</TableHead>\n                        <TableHead>Cabang</TableHead>\n                        <TableHead>Atasan</TableHead>\n                        <TableHead>Status</TableHead>\n                        <TableHead className=\"text-right\">Aksi</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredEmployees.length === 0 ? (\n                        <TableRow>\n                          <TableCell colSpan={8} className=\"text-center text-muted-foreground\">\n                            Tidak ada data karyawan\n                          </TableCell>\n                        </TableRow>\n                      ) : (\n                        filteredEmployees.map(emp => (\n                          <TableRow key={emp.id} data-testid={`row-employee-${emp.id}`}>\n                            <TableCell>\n                              <Badge variant=\"outline\" data-testid={`badge-code-${emp.id}`}>\n                                {emp.employeeCode}\n                              </Badge>\n                            </TableCell>\n                            <TableCell className=\"font-medium\" data-testid={`text-name-${emp.id}`}>\n                              {emp.fullName}\n                            </TableCell>\n                            <TableCell>\n                              <Badge variant=\"secondary\">\n                                {emp.position?.name || \"Unknown\"}\n                              </Badge>\n                            </TableCell>\n                            <TableCell>{emp.pt?.code || \"Unknown\"}</TableCell>\n                            <TableCell className=\"text-muted-foreground\">\n                              {emp.branch?.code || \"-\"}\n                            </TableCell>\n                            <TableCell className=\"text-muted-foreground\">\n                              {emp.manager?.fullName || \"-\"}\n                            </TableCell>\n                            <TableCell>\n                              <Badge \n                                variant={emp.status === \"active\" ? \"default\" : \"secondary\"}\n                                className={emp.status === \"active\" ? \"bg-green-600\" : \"\"}\n                              >\n                                {emp.status === \"active\" ? \"Aktif\" : \"Tidak Aktif\"}\n                              </Badge>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <div className=\"flex justify-end gap-2\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  onClick={() => handleEdit(emp)}\n                                  data-testid={`button-edit-${emp.id}`}\n                                >\n                                  <Pencil className=\"w-4 h-4\" />\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  onClick={() => {\n                                    if (confirm(`âš ï¸ PERINGATAN!\\n\\nApakah Anda yakin ingin menghapus karyawan:\\n\\n${emp.fullName} (${emp.employeeCode})\\n${emp.position?.name || 'Unknown'} - ${emp.pt?.code || 'Unknown'}\\n\\nData yang terhapus tidak dapat dikembalikan!`)) {\n                                      deleteMutation.mutate(emp.id);\n                                    }\n                                  }}\n                                  data-testid={`button-delete-${emp.id}`}\n                                >\n                                  <Trash2 className=\"w-4 h-4 text-destructive\" />\n                                </Button>\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        ))\n                      )}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Tree View */}\n        <TabsContent value=\"tree\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Network className=\"w-5 h-5\" />\n                Struktur Hierarki Organisasi\n              </CardTitle>\n              <CardDescription>\n                Visualisasi tree struktur reporting organisasi\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {employeesLoading ? (\n                <div className=\"space-y-2\">\n                  {[1,2,3].map(i => <Skeleton key={i} className=\"h-20 w-full\" />)}\n                </div>\n              ) : (\n                <div className=\"space-y-6\">\n                  {/* Filters for tree view */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 border rounded-lg bg-muted/30\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"treeFilterPt\">Filter PT</Label>\n                      <Select value={filterPt} onValueChange={setFilterPt}>\n                        <SelectTrigger data-testid=\"select-tree-filter-pt\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">Semua PT</SelectItem>\n                          {pts.map(pt => (\n                            <SelectItem key={pt.id} value={pt.id}>\n                              {pt.code}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"treeFilterStatus\">Filter Status</Label>\n                      <Select value={filterStatus} onValueChange={setFilterStatus}>\n                        <SelectTrigger data-testid=\"select-tree-filter-status\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"all\">Semua Status</SelectItem>\n                          <SelectItem value=\"active\">Aktif</SelectItem>\n                          <SelectItem value=\"inactive\">Tidak Aktif</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div className=\"flex items-end\">\n                      <div className=\"text-sm text-muted-foreground\">\n                        <p className=\"font-medium\">Total: {filteredEmployees.length} karyawan</p>\n                        <p>Top-level: {filteredEmployees.filter(e => !e.managerId).length}</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Tree Visualization */}\n                  <div className=\"space-y-4\">\n                    {filteredEmployees.filter(emp => !emp.managerId).length === 0 ? (\n                      <div className=\"text-center py-12 text-muted-foreground\">\n                        <Network className=\"w-16 h-16 mx-auto mb-4 opacity-50\" />\n                        <p>Tidak ada karyawan top-level untuk ditampilkan</p>\n                        <p className=\"text-xs mt-2\">Pastikan ada karyawan dengan \"Tidak ada atasan\"</p>\n                      </div>\n                    ) : (\n                      filteredEmployees\n                        .filter(emp => !emp.managerId) // Get top-level employees\n                        .map(rootEmp => (\n                          <EmployeeTreeNode\n                            key={rootEmp.id}\n                            employee={rootEmp}\n                            allEmployees={filteredEmployees}\n                            onEdit={handleEdit}\n                            onDelete={(id) => deleteMutation.mutate(id)}\n                            level={0}\n                          />\n                        ))\n                    )}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\n// Recursive Tree Node Component\ntype EmployeeTreeNodeProps = {\n  employee: Employee;\n  allEmployees: Employee[];\n  onEdit: (emp: Employee) => void;\n  onDelete: (id: string) => void;\n  level: number;\n};\n\nfunction EmployeeTreeNode({ employee, allEmployees, onEdit, onDelete, level }: EmployeeTreeNodeProps) {\n  const [isExpanded, setIsExpanded] = useState(true);\n\n  // Get direct subordinates\n  const subordinates = allEmployees.filter(emp => emp.managerId === employee.id);\n  const hasSubordinates = subordinates.length > 0;\n\n  // Get position level color (gradient based on hierarchy)\n  const getLevelColor = (level: number | undefined) => {\n    if (!level) return \"bg-gray-500\";\n    if (level <= 3) return \"bg-gradient-to-r from-purple-500 to-pink-500\"; // Owner, CEO, CBO\n    if (level <= 6) return \"bg-gradient-to-r from-blue-500 to-cyan-500\"; // BrM, VBM, SEM\n    if (level <= 9) return \"bg-gradient-to-r from-green-500 to-emerald-500\"; // EM, SBM, BsM\n    return \"bg-gradient-to-r from-yellow-500 to-orange-500\"; // SBC, BC\n  };\n\n  return (\n    <div className=\"space-y-2\" style={{ marginLeft: `${level * 2}rem` }}>\n      {/* Employee Card */}\n      <Card \n        className=\"hover-elevate active-elevate-2 transition-all cursor-pointer\"\n        data-testid={`tree-node-${employee.id}`}\n      >\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center gap-4\">\n            {/* Expand/Collapse Button */}\n            {hasSubordinates && (\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8\"\n                onClick={() => setIsExpanded(!isExpanded)}\n                data-testid={`button-toggle-${employee.id}`}\n              >\n                {isExpanded ? (\n                  <ChevronDown className=\"w-4 h-4\" />\n                ) : (\n                  <ChevronRight className=\"w-4 h-4\" />\n                )}\n              </Button>\n            )}\n\n            {/* Avatar with Position Level Indicator */}\n            <div className=\"relative\">\n              <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold ${getLevelColor(employee.position?.level)}`}>\n                {employee.fullName.split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase()}\n              </div>\n              {employee.position && (\n                <div className=\"absolute -bottom-1 -right-1 w-5 h-5 rounded-full bg-background border-2 border-primary flex items-center justify-center text-[10px] font-bold\">\n                  {employee.position.level}\n                </div>\n              )}\n            </div>\n\n            {/* Employee Info */}\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-center gap-2 mb-1\">\n                <h4 className=\"font-semibold text-base truncate\" data-testid={`text-tree-name-${employee.id}`}>\n                  {employee.fullName}\n                </h4>\n                <Badge variant=\"outline\" className=\"shrink-0\">\n                  {employee.employeeCode}\n                </Badge>\n                <Badge \n                  variant={employee.status === \"active\" ? \"default\" : \"secondary\"}\n                  className={employee.status === \"active\" ? \"bg-green-600 shrink-0\" : \"shrink-0\"}\n                >\n                  {employee.status === \"active\" ? \"Aktif\" : \"Tidak Aktif\"}\n                </Badge>\n              </div>\n              \n              <div className=\"flex flex-wrap items-center gap-3 text-sm text-muted-foreground\">\n                <span className=\"flex items-center gap-1\">\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    {employee.position?.name || \"Unknown\"}\n                  </Badge>\n                </span>\n                <span>â€¢</span>\n                <span>{employee.pt?.code || \"Unknown\"}</span>\n                {employee.branch && (\n                  <>\n                    <span>â€¢</span>\n                    <span>{employee.branch.code}</span>\n                  </>\n                )}\n                {employee.email && (\n                  <>\n                    <span>â€¢</span>\n                    <span className=\"flex items-center gap-1\">\n                      <Mail className=\"w-3 h-3\" />\n                      {employee.email}\n                    </span>\n                  </>\n                )}\n                {employee.phone && (\n                  <>\n                    <span>â€¢</span>\n                    <span className=\"flex items-center gap-1\">\n                      <Phone className=\"w-3 h-3\" />\n                      {employee.phone}\n                    </span>\n                  </>\n                )}\n              </div>\n              \n              {hasSubordinates && (\n                <div className=\"mt-2 text-xs text-muted-foreground\">\n                  ðŸ‘¥ {subordinates.length} bawahan langsung\n                </div>\n              )}\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => onEdit(employee)}\n                data-testid={`button-tree-edit-${employee.id}`}\n              >\n                <Pencil className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => {\n                  if (confirm(`âš ï¸ PERINGATAN!\\n\\nApakah Anda yakin ingin menghapus karyawan:\\n\\n${employee.fullName} (${employee.employeeCode})\\n${employee.position?.name || 'Unknown'} - ${employee.pt?.code || 'Unknown'}\\n\\nData yang terhapus tidak dapat dikembalikan!`)) {\n                    onDelete(employee.id);\n                  }\n                }}\n                data-testid={`button-tree-delete-${employee.id}`}\n              >\n                <Trash2 className=\"w-4 h-4 text-destructive\" />\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Subordinates (Recursive) */}\n      {hasSubordinates && isExpanded && (\n        <div className=\"space-y-2 border-l-2 border-muted pl-4\">\n          {subordinates.map(sub => (\n            <EmployeeTreeNode\n              key={sub.id}\n              employee={sub}\n              allEmployees={allEmployees}\n              onEdit={onEdit}\n              onDelete={onDelete}\n              level={level + 1}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":38141},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"server/ai-narrative-generator.ts":{"content":"/**\n * AI Narrative Generator\n * \n * Generates rich narrative sections for audit reports using 3-source fallback:\n * 1. OpenAI ChatGPT (gpt-4o-mini) - Primary\n * 2. Google Gemini (gemini-2.0-flash-exp) - Secondary\n * 3. Internal Knowledge Base - Fallback\n * \n * Sections generated:\n * - executiveSummary: High-level overview for leadership\n * - insightLengkap: Deep-dive analysis with context\n * - swot: Strengths, Weaknesses, Opportunities, Threats\n * - coaching: Personalized coaching recommendations\n * - actionPlan: 30-60-90 day action plan\n * - visi: Vision statement for next quarter\n * - magicSection: Motivational closing with personalized wisdom\n */\n\nimport OpenAI from \"openai\";\nimport { GoogleGenAI } from \"@google/genai\";\nimport type { ZonaType, ProfileType, ProdemResult } from \"./business-logic\";\n\n// ============================================================================\n// AI CLIENT INITIALIZATION\n// ============================================================================\n\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n\nconst genAI = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY || \"\" });\n\n// ============================================================================\n// FALLBACK SYSTEM\n// ============================================================================\n\n/**\n * Try generating content with OpenAI, Gemini, then fallback\n */\nasync function generateWithFallback(\n  prompt: string,\n  fallbackContent: string\n): Promise<string> {\n  // Try OpenAI first\n  try {\n    const completion = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"Kamu adalah konsultan HR senior yang ahli dalam performance management dan employee development di Indonesia. Berikan insight dalam Bahasa Indonesia yang profesional, actionable, dan konstruktif.\",\n        },\n        {\n          role: \"user\",\n          content: prompt,\n        },\n      ],\n      temperature: 0.7,\n      max_tokens: 800,\n    });\n\n    const content = completion.choices[0]?.message?.content;\n    if (content && content.trim().length > 50) {\n      return content.trim();\n    }\n  } catch (error) {\n    console.warn(\"OpenAI generation failed, trying Gemini:\", error);\n  }\n\n  // Try Gemini second\n  try {\n    const result = await genAI.models.generateContent({\n      model: \"gemini-2.0-flash-exp\",\n      contents: [{\n        role: \"user\",\n        parts: [{ text: prompt }],\n      }],\n    });\n    const content = result.response.text();\n    \n    if (content && content.trim().length > 50) {\n      return content.trim();\n    }\n  } catch (error) {\n    console.warn(\"Gemini generation failed, using fallback:\", error);\n  }\n\n  // Fallback to internal knowledge base\n  return fallbackContent;\n}\n\n// ============================================================================\n// NARRATIVE GENERATORS\n// ============================================================================\n\nexport interface AuditNarrativeInput {\n  employeeName: string;\n  positionName: string;\n  quarterLabel: string; // \"Q1 2024\"\n  zonaKinerja: ZonaType;\n  zonaPerilaku: ZonaType;\n  zonaFinal: ZonaType;\n  profile: ProfileType;\n  prodem: ProdemResult;\n  pillarScores: Array<{\n    pillarName: string;\n    category: \"A\" | \"B\" | \"C\";\n    selfScore: number;\n    realityScore: number;\n    gap: number;\n  }>;\n  progressKuartal: {\n    ringkasan: string;\n    personalAchievement: any;\n    teamAchievement: any;\n  };\n  ews: {\n    level: \"critical\" | \"warning\" | \"good\";\n    ringkasan: string;\n    criticalPillars: any[];\n    warningPillars: any[];\n  };\n}\n\n/**\n * Generate Executive Summary\n */\nexport async function generateExecutiveSummary(\n  input: AuditNarrativeInput\n): Promise<string> {\n  const prompt = `\nBuat executive summary untuk audit kinerja kuartal:\n\n**Employee:** ${input.employeeName} - ${input.positionName}\n**Periode:** ${input.quarterLabel}\n**Zona Final:** ${input.zonaFinal.toUpperCase()}\n**Profile:** ${input.profile}\n**Rekomendasi ProDem:** ${input.prodem.recommendation}\n\n**Kinerja Kuartal:**\n${input.progressKuartal.ringkasan}\n\n**Early Warning:**\n${input.ews.ringkasan}\n\nTulis executive summary (150-200 kata) yang mencakup:\n1. Overall performance highlight\n2. Key achievements & concerns\n3. Rekomendasi utama untuk leadership\n\nFormat: Paragraf tunggal, profesional, data-driven.\n`;\n\n  const fallback = `Audit kinerja ${input.quarterLabel} untuk ${input.employeeName} (${input.positionName}) menunjukkan performa di zona ${input.zonaFinal} dengan profile ${input.profile}. ${input.progressKuartal.ringkasan} Rekomendasi: ${input.prodem.recommendation} - ${input.prodem.reason}`;\n\n  return generateWithFallback(prompt, fallback);\n}\n\n/**\n * Generate Insight Lengkap (Deep Analysis)\n */\nexport async function generateInsightLengkap(\n  input: AuditNarrativeInput\n): Promise<string> {\n  const topGaps = input.pillarScores\n    .filter(p => Math.abs(p.gap) > 1.0)\n    .sort((a, b) => Math.abs(b.gap) - Math.abs(a.gap))\n    .slice(0, 3)\n    .map(p => `${p.pillarName} (gap: ${p.gap.toFixed(1)})`)\n    .join(\", \");\n\n  const prompt = `\nBuat analisis mendalam untuk audit kinerja:\n\n**Context:**\n- Employee: ${input.employeeName} - ${input.positionName}\n- Zona Kinerja: ${input.zonaKinerja}, Zona Perilaku: ${input.zonaPerilaku}, Final: ${input.zonaFinal}\n- Profile: ${input.profile}\n- Top Gap Pillars: ${topGaps || \"Tidak ada gap signifikan\"}\n\n**Performance:**\n${input.progressKuartal.ringkasan}\n\nTulis analisis lengkap (250-300 kata) yang mencakup:\n1. Root cause analysis dari current performance\n2. Pattern recognition dari gap analysis\n3. Contextual insights (industry, position level, team dynamics)\n4. Forward-looking recommendations\n\nFormat: 3-4 paragraf, insightful, actionable.\n`;\n\n  const fallback = `Analisis kinerja ${input.employeeName} menunjukkan zona ${input.zonaFinal} dengan karakteristik profile ${input.profile}. Gap analysis mengidentifikasi area improvement di ${topGaps || \"beberapa pilar\"}. ${input.progressKuartal.ringkasan} Diperlukan fokus coaching pada area gap terbesar untuk improvement berkelanjutan.`;\n\n  return generateWithFallback(prompt, fallback);\n}\n\n/**\n * Generate SWOT Analysis\n */\nexport async function generateSWOT(\n  input: AuditNarrativeInput\n): Promise<{\n  strengths: string[];\n  weaknesses: string[];\n  opportunities: string[];\n  threats: string[];\n}> {\n  const highScores = input.pillarScores\n    .filter(p => p.realityScore >= 4.0)\n    .map(p => p.pillarName)\n    .slice(0, 3);\n\n  const lowScores = input.pillarScores\n    .filter(p => p.realityScore < 3.5)\n    .map(p => p.pillarName)\n    .slice(0, 3);\n\n  const prompt = `\nGenerate SWOT analysis untuk ${input.employeeName}:\n\n**Profile:** ${input.profile}\n**Zona:** ${input.zonaFinal}\n**High-performing pillars:** ${highScores.join(\", \") || \"None\"}\n**Low-performing pillars:** ${lowScores.join(\", \") || \"None\"}\n\nReturn JSON format:\n{\n  \"strengths\": [\"point 1\", \"point 2\", \"point 3\"],\n  \"weaknesses\": [\"point 1\", \"point 2\"],\n  \"opportunities\": [\"point 1\", \"point 2\"],\n  \"threats\": [\"point 1\", \"point 2\"]\n}\n\nMaksimal 3 points per kategori. Singkat, spesifik, actionable. Bahasa Indonesia.\n`;\n\n  const fallbackSWOT = {\n    strengths: highScores.length > 0 \n      ? [`Strong performance in: ${highScores.join(\", \")}`]\n      : [\"Konsistensi dalam execution\"],\n    weaknesses: lowScores.length > 0\n      ? [`Perlu improvement di: ${lowScores.join(\", \")}`]\n      : [\"Self-awareness calibration needed\"],\n    opportunities: [\n      \"Coaching & development programs\",\n      \"Cross-functional collaboration\",\n    ],\n    threats: [\n      \"Market competition pressure\",\n      \"Changing business landscape\",\n    ],\n  };\n\n  try {\n    const content = await generateWithFallback(prompt, JSON.stringify(fallbackSWOT));\n    // Try to parse JSON\n    const parsed = JSON.parse(content);\n    if (parsed.strengths && parsed.weaknesses && parsed.opportunities && parsed.threats) {\n      return parsed;\n    }\n  } catch (error) {\n    console.warn(\"SWOT parsing failed, using fallback\");\n  }\n\n  return fallbackSWOT;\n}\n\n/**\n * Generate Coaching Recommendations\n */\nexport async function generateCoaching(\n  input: AuditNarrativeInput\n): Promise<string> {\n  const focusAreas = input.prodem.requirements\n    .map((r: { label: string; value: string; met: boolean }) => r.label)\n    .join(\", \");\n\n  const prompt = `\nBuat coaching recommendations untuk:\n\n**Employee:** ${input.employeeName} - ${input.positionName}\n**Profile:** ${input.profile}\n**ProDem:** ${input.prodem.recommendation}\n**Focus Areas:** ${focusAreas}\n\nTulis coaching plan (200-250 kata) yang mencakup:\n1. Coaching approach yang sesuai dengan profile\n2. Specific behavioral changes needed\n3. Development activities (training, mentoring, shadowing)\n4. Success metrics & checkpoints\n\nFormat: Konkret, actionable, dengan timeline jelas.\n`;\n\n  const fallback = `Coaching focus untuk ${input.employeeName}: ${input.prodem.reason} Area pengembangan utama: ${focusAreas}. Rekomendasi: Regular one-on-one coaching sessions, targeted training programs, dan mentorship dari senior leader. Follow-up evaluasi setiap 30 hari untuk tracking progress.`;\n\n  return generateWithFallback(prompt, fallback);\n}\n\n/**\n * Generate 30-60-90 Day Action Plan\n */\nexport async function generateActionPlan(\n  input: AuditNarrativeInput\n): Promise<{\n  days30: string[];\n  days60: string[];\n  days90: string[];\n}> {\n  const prompt = `\nCreate 30-60-90 day action plan untuk ${input.employeeName}:\n\n**Profile:** ${input.profile}\n**Rekomendasi:** ${input.prodem.recommendation}\n**Requirements:**\n${input.prodem.requirements.map((r: { label: string; value: string }) => `- ${r.label}: ${r.value}`).join(\"\\n\")}\n\nReturn JSON format:\n{\n  \"days30\": [\"action 1\", \"action 2\", \"action 3\"],\n  \"days60\": [\"action 1\", \"action 2\", \"action 3\"],\n  \"days90\": [\"action 1\", \"action 2\", \"action 3\"]\n}\n\nEach action: specific, measurable, achievable. Bahasa Indonesia.\n`;\n\n  const fallbackPlan = {\n    days30: [\n      \"Initial assessment & goal setting\",\n      \"Kick-off coaching sessions\",\n      \"Identify quick wins & early actions\",\n    ],\n    days60: [\n      \"Progress review & calibration\",\n      \"Implement development activities\",\n      \"Mid-cycle performance check\",\n    ],\n    days90: [\n      \"Final evaluation & outcomes\",\n      \"Sustainability plan\",\n      \"Next quarter goal setting\",\n    ],\n  };\n\n  try {\n    const content = await generateWithFallback(prompt, JSON.stringify(fallbackPlan));\n    const parsed = JSON.parse(content);\n    if (parsed.days30 && parsed.days60 && parsed.days90) {\n      return parsed;\n    }\n  } catch (error) {\n    console.warn(\"Action plan parsing failed, using fallback\");\n  }\n\n  return fallbackPlan;\n}\n\n/**\n * Generate Vision Statement\n */\nexport async function generateVisi(\n  input: AuditNarrativeInput\n): Promise<string> {\n  const prompt = `\nBuat vision statement untuk ${input.employeeName} (next quarter):\n\n**Current State:**\n- Zona: ${input.zonaFinal}\n- Profile: ${input.profile}\n- ProDem: ${input.prodem.recommendation}\n\n**Target State:**\n${input.prodem.nextStep}\n\nTulis vision statement (100-150 kata) yang:\n1. Inspirational & motivating\n2. Anchored in reality (bukan hanya aspirasi kosong)\n3. Clear direction untuk next quarter\n4. Aligned dengan ProDem recommendation\n\nFormat: 1-2 paragraf, powerful, forward-looking.\n`;\n\n  const fallback = `Vision untuk ${input.employeeName} next quarter: ${input.prodem.nextStep} Dengan fokus improvement pada area key dan komitmen terhadap action plan, target performa adalah mencapai sustainable growth dan contribution yang lebih tinggi. Journey menuju excellence dimulai dengan langkah konsisten hari ini.`;\n\n  return generateWithFallback(prompt, fallback);\n}\n\n/**\n * Generate Magic Section (Personalized Wisdom)\n */\nexport async function generateMagicSection(\n  input: AuditNarrativeInput\n): Promise<string> {\n  const prompt = `\nCreate a \"Magic Section\" - personalized wisdom & motivation untuk ${input.employeeName}:\n\n**Context:**\n- Position: ${input.positionName}\n- Profile: ${input.profile}\n- Journey: ${input.prodem.recommendation} - ${input.prodem.reason}\n\nTulis pesan penutup (150-200 kata) yang:\n1. Deeply personal & resonant\n2. Acknowledgement of their journey\n3. Wisdom tailored to their profile\n4. Motivational boost untuk next steps\n5. Quote atau metaphor yang powerful (opsional)\n\nTone: Warm, wise, empowering. Bahasa Indonesia yang natural.\n`;\n\n  const fallback = `${input.employeeName}, perjalanan pengembangan diri adalah marathon, bukan sprint. Setiap pilar yang Anda kembangkan adalah fondasi untuk kesuksesan jangka panjang. Profile ${input.profile} menunjukkan potensi Anda - dan ${input.prodem.recommendation} adalah langkah strategis untuk memaksimalkannya. Ingat: Growth requires discomfort, tapi discomfort is temporary; growth is permanent. Keep moving forward with confidence and commitment.`;\n\n  return generateWithFallback(prompt, fallback);\n}\n","size_bytes":12920},"attached_assets/aisg_core_motivation_1762750119667.md":{"content":"# =====================================\n# AISG_CORE_MOTIVATION.md\n# Sistem Audit AiSG â€“ File Inti 3 (MOTIVATION & SOFT SKILL)\n# =====================================\n\n## ðŸŒŸ PENDAHULUAN\nFile ini berisi seluruh komponen **penggerak motivasi dan pengembangan soft skill** dalam sistem AiSG.\nSemua narasi, quotes, dan zodiak booster digunakan untuk memperkuat sisi manusiawi dari audit â€” bukan hanya angka, tapi juga semangat dan arah.\n\n---\n\n## ðŸªœ 1. SKEMA PRODEM (Promosi & Demosi)\n\n### ðŸŽ¯ Tujuan\nMenentukan arah karier berdasarkan kinerja dan kualitas kepemimpinan. Skema ProDem menjadi dasar sistem rekomendasi otomatis dalam audit AiSG.\n\n### ðŸ“Š Prinsip Dasar\n- Penilaian berbasis **18 Pilar** dan hasil kerja 3 bulan terakhir.\n- Pilar produktivitas dan kaderisasi mendapat bobot tertinggi.\n- Evaluasi mempertimbangkan data **margin, NA, struktur aktif, dan disiplin.**\n\n### ðŸ”„ Level Umum & Syarat Kenaikan\n| Level Asal | Level Tujuan | Syarat Utama | Catatan |\n|-------------|--------------|---------------|----------|\n| BC | SBC | NA â‰¥ 1 dan â‰¥ 3 staf aktif | Diperkuat oleh kaderisasi minimal 1 jalur baru |\n| SBC | BsM | Margin tim â‰¥ 125.000 USD/kuartal + 2 SBC aktif | Pilar 4 & 9 minimal skor 3 |\n| BsM | SBM | Margin konsisten + regenerasi berjalan | Pilar 13 tidak boleh â‰¤2 |\n| SBM | EM | Struktur lengkap (â‰¥3 BsM aktif) | Diperkuat coaching rutin |\n| EM | SEM | Margin total >300.000 USD/kuartal | Stabil 6 bulan berturut-turut |\n| SEM | VBM/BrM | Pilar di atas 3 semua + kaderisasi berjalan | Disetujui oleh pusat |\n\n### âš ï¸ Kriteria Demosi / Warning\n- Pilar 4, 9, atau 13 â‰¤ 2 selama 2 bulan berturut-turut.\n- Struktur tim tidak aktif â‰¥50%.\n- Margin negatif 3 bulan berturut-turut.\n- Tidak ada kegiatan coaching.\n\n> **Catatan:** Semua keputusan ProDem harus diverifikasi oleh upline 1 tingkat di atas, kecuali keputusan sistem otomatis EWS.\n\n---\n\n## ðŸ’¬ 2. QUOTES MOTIVASI PILIHAN\n\n> **\"The function of leadership is to produce more leaders, not more followers.\"** â€“ *Ralph Nader*  \n> **\"KPI itu bukan angka mati, tapi bahasa komunikasi tim.\"** â€“ *NewsMaker*  \n> **\"Dream big. Start small. Act now.\"** â€“ *Robin Sharma*  \n> **\"Bekerjalah sampai timmu tidak membutuhkanmu lagi, tapi tetap menghormatimu.\"** â€“ *AiSG Mentor Team*  \n> **\"Tujuan audit bukan menghukum, tapi menuntun.\"** â€“ *AiSG System 2025*  \n\nQuotes ini dipilih secara acak setiap audit untuk menutup laporan Magic Section.\n\n---\n\n## ðŸ”® 3. TEMPLATE ZODIAK BOOSTER\n\n### â™ˆ Aries\nKuat, kompetitif, dan pionir alami. Cocok untuk peran pembuka jalur baru.  \n**Booster:** tantangan baru akan memantik produktivitas tim.\n\n### â™‰ Taurus\nStabil, sabar, dan konsisten. Pembawa keseimbangan dalam tim.  \n**Booster:** gunakan ketenanganmu untuk melatih anggota baru.\n\n### â™Š Gemini\nKomunikatif dan kreatif. Ahli membangun koneksi antar tim.  \n**Booster:** arahkan energi sosialmu untuk memperluas jaringan bisnis.\n\n### â™‹ Cancer\nEmpatik, penuh perhatian, cocok untuk pembinaan dan coaching personal.  \n**Booster:** gunakan empati sebagai kekuatan utama membangun loyalitas.\n\n### â™Œ Leo\nPemimpin alami, penuh percaya diri.  \n**Booster:** jadi teladan dengan aksi nyata, bukan hanya kata.\n\n### â™ Virgo\nAnalitis dan perfeksionis, teliti dalam detail kerja.  \n**Booster:** bantu tim merapikan proses kerja agar lebih efisien.\n\n### â™Ž Libra\nDiplomatis dan seimbang, cocok untuk manajemen konflik tim.  \n**Booster:** gunakan keseimbanganmu untuk menjaga harmoni tim.\n\n### â™ Scorpio\nFokus dan intens, sangat cocok dalam target jangka panjang.  \n**Booster:** arahkan fokusmu untuk membina kader baru hingga matang.\n\n### â™ Sagittarius\nOptimis dan suka belajar hal baru.  \n**Booster:** gunakan semangat eksplorasimu untuk inspirasi tim.\n\n### â™‘ Capricorn\nDisiplin dan bertanggung jawab.  \n**Booster:** pastikan semangat tanggung jawabmu menular ke bawahannya.\n\n### â™’ Aquarius\nVisioner dan penuh ide.  \n**Booster:** ciptakan inovasi dalam sistem kerja dan kaderisasi.\n\n### â™“ Pisces\nIntuitif dan mudah menyesuaikan diri.  \n**Booster:** manfaatkan intuisi untuk memahami kondisi emosional tim.\n\n---\n\n> **\"Motivasi tanpa arah hanyalah semangat yang cepat padam. Arah tanpa motivasi hanyalah jalan yang dingin.\"**  \n> â€” *AiSG System 2025*\n\n","size_bytes":4246},"client/src/components/examples/MagicSection.tsx":{"content":"import MagicSection from \"../MagicSection\";\n\nexport default function MagicSectionExample() {\n  return (\n    <div className=\"max-w-2xl mx-auto p-6 bg-background\">\n      <MagicSection\n        zodiak=\"Leo (Singa) â™Œ\"\n        booster=\"Kekuatan kepemimpinan alami Anda bersinar terang bulan ini. Gunakan karisma Anda untuk menginspirasi tim dan meraih target yang lebih tinggi.\"\n        quote=\"Kepemimpinan sejati bukan tentang menjadi yang terkuat, tetapi tentang memberdayakan orang lain untuk menjadi versi terbaik dari diri mereka.\"\n        data-testid=\"magic-section-example\"\n      />\n    </div>\n  );\n}\n","size_bytes":604},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"server/gemini.ts":{"content":"import { GoogleGenAI } from \"@google/genai\";\n\n// Using Gemini AI with user's API key\n// Model: gemini-2.5-flash (newest, fastest, cost-effective)\nconst ai = new GoogleGenAI({ \n  apiKey: process.env.GEMINI_API_KEY || \"\" \n});\n\nexport default ai;\n","size_bytes":244},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/pages/AuditDetail.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  ArrowLeft, \n  Download, \n  Calendar, \n  Building2, \n  User, \n  TrendingUp, \n  Users as UsersIcon,\n  Target,\n  AlertTriangle,\n  CheckCircle2,\n  XCircle,\n  Lightbulb,\n  Award,\n  Clock,\n  MessageSquare,\n  X\n} from \"lucide-react\";\nimport type { Audit } from \"@shared/schema\";\nimport type { AuditDetailDto } from \"@shared/types\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ChatPanel } from \"@/components/ChatPanel\";\n\nexport default function AuditDetail() {\n  const [, params] = useRoute(\"/audit/:id\");\n  const [, setLocation] = useLocation();\n  const [chatOpen, setChatOpen] = useState(false);\n  const auditId = params?.id;\n\n  const { data: audit, isLoading} = useQuery<AuditDetailDto>({\n    queryKey: [`/api/audit/${auditId}`],\n    enabled: !!auditId,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <div className=\"max-w-7xl mx-auto p-6 md:p-8\">\n          <div className=\"animate-pulse space-y-8\">\n            <div className=\"h-12 bg-card rounded-lg w-1/3\" />\n            <div className=\"h-64 bg-card rounded-lg\" />\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <div className=\"h-48 bg-card rounded-lg\" />\n              <div className=\"h-48 bg-card rounded-lg\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!audit) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold mb-2\">Audit tidak ditemukan</h2>\n          <p className=\"text-muted-foreground mb-4\">ID audit yang Anda cari tidak tersedia</p>\n          <Button onClick={() => setLocation(\"/\")}>Kembali ke Dashboard</Button>\n        </div>\n      </div>\n    );\n  }\n\n  const formatDate = (date: string | Date) => {\n    const dateObj = typeof date === 'string' ? new Date(date) : date;\n    return dateObj.toLocaleDateString(\"id-ID\", { \n      day: \"numeric\", \n      month: \"long\", \n      year: \"numeric\" \n    });\n  };\n\n  const getZonaBadgeColor = (zona: string) => {\n    if (zona === \"hijau\" || zona === \"success\") return \"bg-green-500/20 text-green-600 border-green-500/30\";\n    if (zona === \"kuning\" || zona === \"warning\") return \"bg-yellow-500/20 text-yellow-600 border-yellow-500/30\";\n    return \"bg-red-500/20 text-red-600 border-red-500/30\";\n  };\n\n  const getZonaText = (zona: string) => {\n    if (zona === \"hijau\" || zona === \"success\") return \"Hijau âœ…\";\n    if (zona === \"kuning\" || zona === \"warning\") return \"Kuning âš ï¸\";\n    return \"Merah ðŸ”´\";\n  };\n\n  const getProfilBadge = (profil: string) => {\n    const colors: Record<string, string> = {\n      \"Leader\": \"bg-blue-500/20 text-blue-600 border-blue-500/30\",\n      \"Visionary\": \"bg-purple-500/20 text-purple-600 border-purple-500/30\",\n      \"Performer\": \"bg-green-500/20 text-green-600 border-green-500/30\",\n      \"At-Risk\": \"bg-red-500/20 text-red-600 border-red-500/30\"\n    };\n    return colors[profil] || colors[\"At-Risk\"];\n  };\n\n  const report = audit.auditReport as any;\n  const prodem = audit.prodemRekomendasi as any;\n  const magic = audit.magicSection as any;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-7xl mx-auto p-4 sm:p-6 md:p-8 space-y-6 sm:space-y-8\">\n        {/* Header */}\n        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-3 sm:gap-4\">\n            <Button \n              variant=\"outline\" \n              size=\"icon\" \n              data-testid=\"button-back\"\n              onClick={() => setLocation(\"/\")}\n              className=\"shrink-0 border-amber-500/30 hover:bg-amber-500/10 hover:text-amber-500 hover:border-amber-500/50 transition-all\"\n              title=\"Kembali ke Dashboard\"\n            >\n              <ArrowLeft className=\"w-5 h-5\" />\n            </Button>\n            <div className=\"min-w-0 flex-1\">\n              <div className=\"flex flex-wrap items-center gap-2 sm:gap-3\">\n                <h1 className=\"text-xl sm:text-2xl md:text-3xl font-bold tracking-tight bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-600 bg-clip-text text-transparent\">Audit Report</h1>\n                <Badge className={`${getProfilBadge(audit.profil)} border shrink-0`}>\n                  {audit.profil}\n                </Badge>\n              </div>\n            </div>\n          </div>\n          <Button \n            className=\"gap-2 bg-gradient-to-r from-amber-500 to-yellow-600 hover:from-amber-600 hover:to-yellow-700 text-gray-900 font-semibold shadow-lg shadow-amber-500/30 shrink-0\" \n            onClick={() => window.open(`/api/enterprise/audits/${audit.id}/pdf`, \"_blank\")}\n            data-testid=\"button-download-pdf\"\n          >\n            <Download className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Download PDF</span>\n            <span className=\"sm:hidden\">PDF</span>\n          </Button>\n        </div>\n\n        {/* Executive Summary */}\n        <Card className=\"p-4 sm:p-6 bg-gradient-to-br from-amber-500/10 via-yellow-500/5 to-transparent border-amber-500/20 shadow-lg\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <div className=\"rounded-lg bg-gradient-to-br from-amber-500/20 to-yellow-500/20 p-2\">\n              <Award className=\"w-5 h-5 sm:w-6 sm:h-6 text-amber-500\" />\n            </div>\n            <h2 className=\"text-lg sm:text-xl font-bold\">Executive Summary</h2>\n          </div>\n          <p className=\"text-sm sm:text-base leading-relaxed\">{report?.executiveSummary}</p>\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mt-6\">\n            <div className=\"text-center p-3 bg-background/60 rounded-xl backdrop-blur-sm border border-amber-500/20\">\n              <p className=\"text-xl sm:text-2xl font-bold bg-gradient-to-r from-amber-500 to-yellow-600 bg-clip-text text-transparent\">{audit.totalRealityScore}</p>\n              <p className=\"text-xs sm:text-sm text-muted-foreground\">Reality Score</p>\n            </div>\n            <div className=\"text-center p-3 bg-background/60 rounded-xl backdrop-blur-sm\">\n              <p className=\"text-xl sm:text-2xl font-bold\">{audit.totalSelfScore}</p>\n              <p className=\"text-xs sm:text-sm text-muted-foreground\">Self Score</p>\n            </div>\n            <div className=\"text-center p-3 bg-background/60 rounded-xl backdrop-blur-sm\">\n              <p className={`text-xl sm:text-2xl font-bold ${audit.totalGap > 0 ? 'text-yellow-500' : audit.totalGap < 0 ? 'text-red-500' : 'text-green-500'}`}>\n                {audit.totalGap > 0 ? '+' : ''}{audit.totalGap}\n              </p>\n              <p className=\"text-xs sm:text-sm text-muted-foreground\">Gap</p>\n            </div>\n            <div className=\"text-center p-3 bg-background/60 rounded-xl backdrop-blur-sm flex items-center justify-center\">\n              <Badge className={`${getZonaBadgeColor(audit.zonaFinal)} text-xs sm:text-sm border`}>\n                {getZonaText(audit.zonaFinal)}\n              </Badge>\n            </div>\n          </div>\n        </Card>\n\n        {/* Personal Info & Quarter Progress */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card className=\"p-6\">\n            <h2 className=\"text-xl font-semibold mb-4\">Informasi Personal</h2>\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-3\">\n                <User className=\"w-5 h-5 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Nama Lengkap</p>\n                  <p className=\"font-medium\" data-testid=\"detail-nama\">{audit.employee.fullName}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <Building2 className=\"w-5 h-5 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Jabatan</p>\n                  <p className=\"font-medium\" data-testid=\"detail-jabatan\">{audit.employee.position?.name || \"N/A\"}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <Building2 className=\"w-5 h-5 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Cabang</p>\n                  <p className=\"font-medium\" data-testid=\"detail-cabang\">{audit.employee.branch?.name || audit.employee.pt?.name || \"Pusat\"}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <Calendar className=\"w-5 h-5 text-muted-foreground\" />\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Tanggal Audit</p>\n                  <p className=\"font-medium\">{formatDate(audit.createdAt)}</p>\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          <Card className=\"p-6\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <Clock className=\"w-5 h-5 text-primary\" />\n              <h2 className=\"text-xl font-semibold\">Progress Kuartal</h2>\n            </div>\n            {report?.progressKuartal && (\n              <div className=\"space-y-4\">\n                <div>\n                  <div className=\"flex justify-between mb-2\">\n                    <span className=\"text-sm font-medium\">Kuartal: {report.progressKuartal.kuartalBerjalan}</span>\n                    <span className=\"text-sm text-muted-foreground\">{report.progressKuartal.sisaHari} hari tersisa</span>\n                  </div>\n                </div>\n                <div>\n                  <div className=\"flex justify-between mb-2\">\n                    <span className=\"text-sm\">Margin Target</span>\n                    <span className=\"text-sm font-semibold\">${report.progressKuartal.realisasiMargin.toLocaleString()} / ${report.progressKuartal.targetMargin.toLocaleString()}</span>\n                  </div>\n                  <Progress value={Math.min(report.progressKuartal.percentageMargin, 100)} className=\"h-2\" />\n                  <p className=\"text-xs text-muted-foreground mt-1\">{report.progressKuartal.percentageMargin}% tercapai</p>\n                </div>\n                <div>\n                  <div className=\"flex justify-between mb-2\">\n                    <span className=\"text-sm\">NA Target</span>\n                    <span className=\"text-sm font-semibold\">{report.progressKuartal.realisasiNA} / {report.progressKuartal.targetNA}</span>\n                  </div>\n                  <Progress value={Math.min(report.progressKuartal.percentageNA, 100)} className=\"h-2\" />\n                  <p className=\"text-xs text-muted-foreground mt-1\">{report.progressKuartal.percentageNA}% tercapai</p>\n                </div>\n                <div className=\"pt-2 border-t\">\n                  <p className=\"text-sm italic\">{report.progressKuartal.catatan}</p>\n                </div>\n              </div>\n            )}\n          </Card>\n        </div>\n\n        {/* Main Tabs */}\n        <Tabs defaultValue=\"pilar\" className=\"space-y-6\">\n          <div className=\"sticky top-[60px] sm:top-[68px] z-40 bg-background/95 backdrop-blur-xl pb-4 -mx-4 sm:-mx-6 md:-mx-8 px-4 sm:px-6 md:px-8 border-b\">\n            <TabsList className=\"grid grid-cols-2 sm:grid-cols-4 w-full max-w-4xl mx-auto h-auto gap-2 bg-transparent p-1\">\n              <TabsTrigger \n                value=\"pilar\" \n                className=\"text-xs sm:text-sm data-[state=active]:bg-blue-500 data-[state=active]:text-white data-[state=inactive]:bg-muted data-[state=inactive]:text-muted-foreground h-10 rounded-lg font-medium transition-all\"\n              >\n                18 Pilar\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"swot\" \n                className=\"text-xs sm:text-sm data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=inactive]:bg-muted data-[state=inactive]:text-muted-foreground h-10 rounded-lg font-medium transition-all\"\n              >\n                SWOT & Action\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"prodem\" \n                className=\"text-xs sm:text-sm data-[state=active]:bg-purple-500 data-[state=active]:text-white data-[state=inactive]:bg-muted data-[state=inactive]:text-muted-foreground h-10 rounded-lg font-medium transition-all\"\n              >\n                ProDem\n              </TabsTrigger>\n              <TabsTrigger \n                value=\"magic\" \n                className=\"text-xs sm:text-sm data-[state=active]:bg-pink-500 data-[state=active]:text-white data-[state=inactive]:bg-muted data-[state=inactive]:text-muted-foreground h-10 rounded-lg font-medium transition-all\"\n              >\n                Magic Section\n              </TabsTrigger>\n            </TabsList>\n          </div>\n\n          {/* 18 Pilar Tab */}\n          <TabsContent value=\"pilar\" className=\"pt-8 sm:pt-6\">\n            <Card className=\"p-4 sm:p-6\">\n              <h2 className=\"text-lg sm:text-xl font-semibold mb-3 sm:mb-4\">18 Pilar Reality Score</h2>\n              <p className=\"text-xs sm:text-sm text-muted-foreground mb-4 sm:mb-6\">\n                Sistem menganalisis self-assessment Anda dan membandingkannya dengan data real performa untuk menghasilkan Reality Score\n              </p>\n              <div className=\"space-y-3 sm:space-y-4\">\n                {audit.pillarAnswers && Array.isArray(audit.pillarAnswers) && audit.pillarAnswers.map((pilar: any) => (\n                  <div\n                    key={pilar.pillarId}\n                    className=\"rounded-xl border bg-card/50 overflow-hidden transition-all duration-300 hover:shadow-lg hover:border-primary/30\"\n                    data-testid={`pilar-${pilar.pillarId}`}\n                  >\n                    <div className=\"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 p-3 sm:p-4\">\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-semibold mb-1 text-sm sm:text-base\">{pilar.pillarName}</p>\n                        <p className=\"text-xs sm:text-sm text-muted-foreground line-clamp-2\">{pilar.insight}</p>\n                      </div>\n                      <div className=\"flex items-center gap-2 sm:gap-3 shrink-0\">\n                        <div className=\"text-center px-2 sm:px-3 py-2 rounded-lg bg-muted/50\">\n                          <p className=\"text-xl sm:text-2xl font-bold\">{pilar.selfScore}</p>\n                          <p className=\"text-[10px] sm:text-xs text-muted-foreground\">Self</p>\n                        </div>\n                        <div className=\"w-8 sm:w-10 text-center\">\n                          {pilar.gap === 0 ? (\n                            <CheckCircle2 className=\"w-5 h-5 sm:w-6 sm:h-6 text-green-500 mx-auto\" />\n                          ) : pilar.gap > 0 ? (\n                            <span className=\"text-base sm:text-lg text-yellow-500 font-bold\">+{pilar.gap}</span>\n                          ) : (\n                            <span className=\"text-base sm:text-lg text-red-500 font-bold\">{pilar.gap}</span>\n                          )}\n                        </div>\n                        <div className=\"text-center px-2 sm:px-3 py-2 rounded-lg bg-primary/10\">\n                          <p className=\"text-xl sm:text-2xl font-bold text-primary\">{pilar.realityScore}</p>\n                          <p className=\"text-[10px] sm:text-xs text-muted-foreground\">Reality</p>\n                        </div>\n                      </div>\n                    </div>\n                    \n                    {/* Gap Analysis & Recommendation - Only show if there's a gap */}\n                    {pilar.gap !== 0 && (\n                      <div className={`px-3 sm:px-4 pb-3 sm:pb-4 pt-2 border-t ${\n                        pilar.gap > 0 ? 'bg-yellow-500/5 border-yellow-500/20' : 'bg-red-500/5 border-red-500/20'\n                      }`}>\n                        <div className=\"flex items-start gap-2 mb-2\">\n                          {pilar.gap > 0 ? (\n                            <AlertTriangle className=\"w-4 h-4 sm:w-5 sm:h-5 text-yellow-600 shrink-0 mt-0.5\" />\n                          ) : (\n                            <XCircle className=\"w-4 h-4 sm:w-5 sm:h-5 text-red-600 shrink-0 mt-0.5\" />\n                          )}\n                          <div className=\"flex-1\">\n                            <p className={`text-xs sm:text-sm font-semibold mb-1 ${\n                              pilar.gap > 0 ? 'text-yellow-700' : 'text-red-700'\n                            }`}>\n                              {pilar.gap > 0 ? 'Overestimasi' : 'Underestimasi'} ({Math.abs(pilar.gap)} poin)\n                            </p>\n                            <p className=\"text-xs sm:text-sm text-muted-foreground mb-2\">\n                              {pilar.gap > 0 \n                                ? `Self-assessment Anda lebih tinggi ${Math.abs(pilar.gap)} poin dari reality score. Ini menunjukkan persepsi diri yang mungkin perlu disesuaikan dengan data performa aktual.`\n                                : `Reality score Anda lebih tinggi ${Math.abs(pilar.gap)} poin dari self-assessment. Ini menunjukkan Anda memiliki potensi yang belum Anda sadari sepenuhnya.`\n                              }\n                            </p>\n                            <div className=\"flex items-start gap-1.5 bg-background/50 rounded-lg p-2 sm:p-3\">\n                              <Lightbulb className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 text-primary shrink-0 mt-0.5\" />\n                              <div>\n                                <p className=\"text-xs font-medium text-primary mb-1\">Rekomendasi Perbaikan:</p>\n                                <p className=\"text-xs text-foreground/90\">\n                                  {pilar.gap > 0\n                                    ? `Fokus pada peningkatan kinerja aktual di area ini. Tinjau metrik performa, identifikasi hambatan, dan buat action plan konkret untuk meningkatkan hasil dari ${pilar.realityScore} menuju target ${pilar.selfScore}.`\n                                    : `Tingkatkan kepercayaan diri Anda. Data menunjukkan performa Anda sudah baik (${pilar.realityScore}). Akui pencapaian ini dan manfaatkan momentum untuk terus berkembang.`\n                                  }\n                                </p>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* Perfect Score */}\n                    {pilar.gap === 0 && (\n                      <div className=\"px-3 sm:px-4 pb-3 sm:pb-4 pt-2 border-t bg-green-500/5 border-green-500/20\">\n                        <div className=\"flex items-center gap-2\">\n                          <CheckCircle2 className=\"w-4 h-4 sm:w-5 sm:h-5 text-green-600 shrink-0\" />\n                          <p className=\"text-xs sm:text-sm text-green-700 font-medium\">\n                            Self-assessment sesuai dengan reality score - Persepsi diri Anda akurat!\n                          </p>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </Card>\n          </TabsContent>\n\n          {/* SWOT & Action Tab */}\n          <TabsContent value=\"swot\" className=\"pt-8 sm:pt-6\">\n            <div className=\"space-y-6\">\n              {/* Insight Lengkap */}\n              <Card className=\"p-6\">\n                <h2 className=\"text-xl font-semibold mb-4\">Insight Lengkap</h2>\n                <p className=\"text-base leading-relaxed\">{report?.insightLengkap}</p>\n              </Card>\n\n              {/* SWOT Analysis */}\n              <Card className=\"p-4 sm:p-6\">\n                <h2 className=\"text-lg sm:text-xl font-semibold mb-4 sm:mb-6\">SWOT Analysis</h2>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6\">\n                  {/* Strength */}\n                  <div className=\"p-4 border border-green-500/30 rounded-xl bg-gradient-to-br from-green-500/10 to-green-500/5 backdrop-blur-sm\">\n                    <h3 className=\"font-semibold text-green-600 mb-3 flex items-center gap-2\">\n                      <div className=\"rounded-lg bg-green-500/20 p-1.5\">\n                        <CheckCircle2 className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                      </div>\n                      <span className=\"text-sm sm:text-base\">Strength</span>\n                    </h3>\n                    <ul className=\"space-y-2\">\n                      {report?.swotAnalysis?.strength?.map((item: string, idx: number) => (\n                        <li key={idx} className=\"text-xs sm:text-sm flex gap-2\">\n                          <span className=\"text-green-600 mt-1\">â€¢</span>\n                          <span className=\"flex-1\">{item}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n\n                  {/* Weakness */}\n                  <div className=\"p-4 border border-red-500/30 rounded-xl bg-gradient-to-br from-red-500/10 to-red-500/5 backdrop-blur-sm\">\n                    <h3 className=\"font-semibold text-red-600 mb-3 flex items-center gap-2\">\n                      <div className=\"rounded-lg bg-red-500/20 p-1.5\">\n                        <XCircle className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                      </div>\n                      <span className=\"text-sm sm:text-base\">Weakness</span>\n                    </h3>\n                    <ul className=\"space-y-2\">\n                      {report?.swotAnalysis?.weakness?.map((item: string, idx: number) => (\n                        <li key={idx} className=\"text-xs sm:text-sm flex gap-2\">\n                          <span className=\"text-red-600 mt-1\">â€¢</span>\n                          <span className=\"flex-1\">{item}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n\n                  {/* Opportunity */}\n                  <div className=\"p-4 border border-blue-500/30 rounded-xl bg-gradient-to-br from-blue-500/10 to-blue-500/5 backdrop-blur-sm\">\n                    <h3 className=\"font-semibold text-blue-600 mb-3 flex items-center gap-2\">\n                      <div className=\"rounded-lg bg-blue-500/20 p-1.5\">\n                        <TrendingUp className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                      </div>\n                      <span className=\"text-sm sm:text-base\">Opportunity</span>\n                    </h3>\n                    <ul className=\"space-y-2\">\n                      {report?.swotAnalysis?.opportunity?.map((item: string, idx: number) => (\n                        <li key={idx} className=\"text-xs sm:text-sm flex gap-2\">\n                          <span className=\"text-blue-600 mt-1\">â€¢</span>\n                          <span className=\"flex-1\">{item}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n\n                  {/* Threat */}\n                  <div className=\"p-4 border border-yellow-500/30 rounded-xl bg-gradient-to-br from-yellow-500/10 to-yellow-500/5 backdrop-blur-sm\">\n                    <h3 className=\"font-semibold text-yellow-600 mb-3 flex items-center gap-2\">\n                      <div className=\"rounded-lg bg-yellow-500/20 p-1.5\">\n                        <AlertTriangle className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n                      </div>\n                      <span className=\"text-sm sm:text-base\">Threat</span>\n                    </h3>\n                    <ul className=\"space-y-2\">\n                      {report?.swotAnalysis?.threat?.map((item: string, idx: number) => (\n                        <li key={idx} className=\"text-xs sm:text-sm flex gap-2\">\n                          <span className=\"text-yellow-600 mt-1\">â€¢</span>\n                          <span className=\"flex-1\">{item}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                </div>\n              </Card>\n\n              {/* Coaching Points */}\n              <Card className=\"p-6\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <Lightbulb className=\"w-5 h-5 text-yellow-500\" />\n                  <h2 className=\"text-xl font-semibold\">Coaching Points</h2>\n                </div>\n                <ul className=\"space-y-3\">\n                  {report?.coachingPoints?.map((point: string, idx: number) => (\n                    <li key={idx} className=\"flex gap-3 p-3 bg-card/50 rounded-lg\">\n                      <span className=\"text-primary font-bold\">{idx + 1}.</span>\n                      <span>{point}</span>\n                    </li>\n                  ))}\n                </ul>\n              </Card>\n\n              {/* Action Plan 30-60-90 */}\n              <Card className=\"p-6\">\n                <div className=\"flex items-center gap-2 mb-6\">\n                  <Target className=\"w-5 h-5 text-primary\" />\n                  <h2 className=\"text-xl font-semibold\">Action Plan 30-60-90</h2>\n                </div>\n                <div className=\"space-y-4\">\n                  {report?.actionPlan?.map((plan: any, idx: number) => (\n                    <div key={idx} className=\"p-4 border rounded-lg hover-elevate\">\n                      <div className=\"flex items-center gap-2 mb-3\">\n                        <Badge variant=\"outline\">{plan.periode}</Badge>\n                        <h3 className=\"font-semibold\">{plan.target}</h3>\n                      </div>\n                      <div className=\"space-y-2 text-sm\">\n                        <div>\n                          <span className=\"font-medium text-muted-foreground\">Aktivitas: </span>\n                          <span>{plan.aktivitas}</span>\n                        </div>\n                        <div>\n                          <span className=\"font-medium text-muted-foreground\">PIC: </span>\n                          <span>{plan.pic}</span>\n                        </div>\n                        <div>\n                          <span className=\"font-medium text-muted-foreground\">Output: </span>\n                          <span className=\"text-primary font-medium\">{plan.output}</span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </Card>\n\n              {/* EWS */}\n              <Card className=\"p-6 border-yellow-500/30 bg-yellow-500/5\">\n                <div className=\"flex items-center gap-2 mb-6\">\n                  <AlertTriangle className=\"w-5 h-5 text-yellow-600\" />\n                  <h2 className=\"text-xl font-semibold\">Early Warning System (EWS)</h2>\n                </div>\n                <div className=\"space-y-3\">\n                  {report?.ews?.map((warning: any, idx: number) => (\n                    <div key={idx} className=\"p-4 bg-background rounded-lg border border-yellow-500/20\">\n                      <div className=\"font-semibold mb-2\">{warning.faktor}</div>\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm\">\n                        <div>\n                          <span className=\"text-muted-foreground\">Indikator: </span>\n                          <span className=\"font-medium\">{warning.indikator}</span>\n                        </div>\n                        <div>\n                          <span className=\"text-muted-foreground\">Risiko: </span>\n                          <span className=\"font-medium text-red-600\">{warning.risiko}</span>\n                        </div>\n                        <div>\n                          <span className=\"text-muted-foreground\">Saran: </span>\n                          <span className=\"font-medium text-green-600\">{warning.saranCepat}</span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* ProDem Tab */}\n          <TabsContent value=\"prodem\" className=\"pt-8 sm:pt-6\">\n            <Card className=\"p-4 sm:p-6\">\n              <h2 className=\"text-lg sm:text-xl font-semibold mb-4 sm:mb-6\">Rekomendasi ProDem (Promotion-Demotion)</h2>\n              {prodem && (\n                <div className=\"space-y-4 sm:space-y-6\">\n                  <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 p-4 sm:p-6 rounded-xl border-2 border-primary/30 bg-gradient-to-br from-primary/10 to-primary/5\">\n                    <div>\n                      <p className=\"text-xs sm:text-sm text-muted-foreground\">Current Level</p>\n                      <p className=\"text-lg sm:text-xl font-bold\">{prodem.currentLevel}</p>\n                    </div>\n                    <div className=\"text-left sm:text-center\">\n                      <Badge \n                        className={`text-sm sm:text-lg px-3 sm:px-4 py-1.5 sm:py-2 ${\n                          prodem.recommendation === 'Promosi' ? 'bg-green-500' :\n                          prodem.recommendation === 'Demosi' ? 'bg-red-500' :\n                          prodem.recommendation === 'Pembinaan' ? 'bg-yellow-500' :\n                          'bg-blue-500'\n                        }`}\n                      >\n                        {prodem.recommendation}\n                      </Badge>\n                      {prodem.nextLevel && (\n                        <p className=\"text-xs sm:text-sm text-muted-foreground mt-2\">â†’ {prodem.nextLevel}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-3 sm:space-y-4\">\n                    <div className=\"p-3 sm:p-4 border rounded-xl bg-card/50\">\n                      <h3 className=\"font-semibold mb-2 text-sm sm:text-base\">Alasan</h3>\n                      <p className=\"text-xs sm:text-sm\">{prodem.reason}</p>\n                    </div>\n                    <div className=\"p-3 sm:p-4 border rounded-xl bg-card/50\">\n                      <h3 className=\"font-semibold mb-2 text-sm sm:text-base\">Konsekuensi</h3>\n                      <p className=\"text-xs sm:text-sm\">{prodem.konsekuensi}</p>\n                    </div>\n                    <div className=\"p-3 sm:p-4 border rounded-xl bg-card/50\">\n                      <h3 className=\"font-semibold mb-2 text-sm sm:text-base\">Next Step</h3>\n                      <p className=\"text-xs sm:text-sm\">{prodem.nextStep}</p>\n                    </div>\n                    {prodem.strategyType && prodem.strategyType !== \"N/A\" && (\n                      <div className=\"p-4 border rounded-lg bg-primary/5\">\n                        <h3 className=\"font-semibold mb-2\">Strategy Type</h3>\n                        <Badge variant=\"outline\">{prodem.strategyType}</Badge>\n                      </div>\n                    )}\n                  </div>\n\n                  {prodem.requirements && prodem.requirements.length > 0 && (\n                    <div className=\"p-4 border rounded-lg\">\n                      <h3 className=\"font-semibold mb-4\">Requirements Check</h3>\n                      <div className=\"space-y-2\">\n                        {prodem.requirements.map((req: any, idx: number) => (\n                          <div key={idx} className=\"flex items-center justify-between p-3 bg-card/50 rounded\">\n                            <span className=\"font-medium\">{req.label}</span>\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"text-sm\">{req.value}</span>\n                              {req.met ? (\n                                <CheckCircle2 className=\"w-5 h-5 text-green-500\" />\n                              ) : (\n                                <XCircle className=\"w-5 h-5 text-red-500\" />\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </Card>\n          </TabsContent>\n\n          {/* Magic Section Tab */}\n          <TabsContent value=\"magic\" className=\"pt-8 sm:pt-6\">\n            <Card className=\"p-6 bg-gradient-to-br from-purple-500/10 to-pink-500/10 border-purple-500/20\">\n              <h2 className=\"text-2xl font-bold mb-6 text-center\">âœ¨ Magic Section âœ¨</h2>\n              {magic && (\n                <div className=\"space-y-6\">\n                  <div className=\"text-center p-6 bg-background/50 rounded-lg\">\n                    <h3 className=\"text-3xl font-bold mb-2\">{magic.julukan}</h3>\n                    <div className=\"flex items-center justify-center gap-4 text-sm text-muted-foreground\">\n                      <span>{magic.zodiak}</span>\n                      <span>â€¢</span>\n                      <span>{magic.generasi}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"p-6 bg-background/50 rounded-lg\">\n                    <h3 className=\"font-semibold mb-3\">Narasi Personal</h3>\n                    <p className=\"leading-relaxed\">{magic.narasi}</p>\n                  </div>\n\n                  <div className=\"p-6 bg-primary/10 rounded-lg border border-primary/20\">\n                    <h3 className=\"font-semibold mb-3\">Zodiak Booster ðŸŒŸ</h3>\n                    <p className=\"italic\">{magic.zodiakBooster}</p>\n                  </div>\n\n                  <div className=\"p-6 bg-background/50 rounded-lg\">\n                    <h3 className=\"font-semibold mb-3\">Coaching Highlight</h3>\n                    <p>{magic.coachingHighlight}</p>\n                  </div>\n\n                  <div className=\"p-6 bg-background/50 rounded-lg\">\n                    <h3 className=\"font-semibold mb-3\">Call to Action</h3>\n                    <p>{magic.callToAction}</p>\n                  </div>\n\n                  <div className=\"p-6 bg-gradient-to-r from-primary/20 to-purple-500/20 rounded-lg border border-primary/30\">\n                    <p className=\"text-center text-lg italic font-medium\">\"{magic.quote}\"</p>\n                  </div>\n                </div>\n              )}\n            </Card>\n          </TabsContent>\n        </Tabs>\n\n        {/* Floating Chat Button - Only show when chat is CLOSED */}\n        {!chatOpen && (\n          <div className=\"fixed bottom-24 left-1/2 -translate-x-1/2 sm:bottom-8 sm:left-auto sm:right-8 sm:translate-x-0 z-[100]\">\n            <Button\n              className=\"h-12 sm:h-16 px-4 sm:px-6 rounded-full shadow-2xl animate-pulse hover:animate-none gap-2 sm:gap-3 text-xs sm:text-base font-semibold whitespace-nowrap\"\n              onClick={() => setChatOpen(true)}\n              data-testid=\"button-toggle-chat\"\n            >\n              <MessageSquare className=\"w-4 h-4 sm:w-6 sm:h-6 shrink-0\" />\n              <span className=\"hidden sm:inline\">Yuk... diskusikan hasil auditnya disini! ðŸ’¬</span>\n              <span className=\"sm:hidden text-[11px]\">Diskusi Hasil Audit ðŸ’¬</span>\n            </Button>\n          </div>\n        )}\n\n        {/* Chat Panel Sidebar */}\n        {chatOpen && (\n          <div className=\"fixed inset-x-0 bottom-0 sm:inset-auto sm:bottom-8 sm:right-8 sm:w-96 h-[85vh] sm:h-[600px] z-50 shadow-2xl sm:rounded-lg overflow-hidden border-t-2 sm:border-2 border-primary/20\">\n            <div className=\"h-full flex flex-col bg-card\">\n              <div className=\"flex items-center justify-between p-3 border-b bg-primary/5\">\n                <div className=\"flex items-center gap-2\">\n                  <MessageSquare className=\"w-5 h-5 text-primary\" />\n                  <span className=\"font-semibold\">AI Coach</span>\n                </div>\n                <Button\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  onClick={() => setChatOpen(false)}\n                  data-testid=\"button-close-chat\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </Button>\n              </div>\n              <div className=\"flex-1 overflow-hidden\">\n                <ChatPanel auditId={audit.id} auditName={audit.employee.fullName} />\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":36684},"client/src/components/ProfileBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Crown, Target, Zap, AlertTriangle } from \"lucide-react\";\n\nexport type ProfileType = \"Leader\" | \"Visionary\" | \"Performer\" | \"At-Risk\";\n\ninterface ProfileBadgeProps {\n  type: ProfileType;\n  size?: \"sm\" | \"md\" | \"lg\";\n  \"data-testid\"?: string;\n}\n\nconst profileConfig = {\n  Leader: {\n    icon: Crown,\n    className: \"bg-zone-success/20 text-zone-success border-zone-success/30\"\n  },\n  Visionary: {\n    icon: Zap,\n    className: \"bg-primary/20 text-primary border-primary/30\"\n  },\n  Performer: {\n    icon: Target,\n    className: \"bg-zone-warning/20 text-zone-warning border-zone-warning/30\"\n  },\n  \"At-Risk\": {\n    icon: AlertTriangle,\n    className: \"bg-zone-critical/20 text-zone-critical border-zone-critical/30\"\n  }\n};\n\nexport default function ProfileBadge({ type, size = \"md\", \"data-testid\": testId }: ProfileBadgeProps) {\n  const config = profileConfig[type];\n  const Icon = config.icon;\n  \n  const sizeClasses = {\n    sm: \"text-xs px-2 py-0.5\",\n    md: \"text-sm px-3 py-1\",\n    lg: \"text-base px-4 py-2\"\n  };\n\n  const iconSizes = {\n    sm: \"w-3 h-3\",\n    md: \"w-4 h-4\",\n    lg: \"w-5 h-5\"\n  };\n\n  return (\n    <Badge \n      className={`${config.className} ${sizeClasses[size]} font-semibold border`}\n      data-testid={testId}\n    >\n      <Icon className={`${iconSizes[size]} mr-1.5`} />\n      {type}\n    </Badge>\n  );\n}\n","size_bytes":1378},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"attached_assets/aisg_core_audit_guide_1762750119671.md":{"content":"# =====================================\n# AISG_CORE_AUDIT_GUIDE.md\n# Sistem Audit AiSG â€“ File Inti 2 (AUDIT GUIDE)\n# =====================================\n\n## ðŸ“‘ PENDAHULUAN\nFile ini berfungsi sebagai **panduan audit individu**. Semua hasil audit harus mengikuti urutan 12 bagian lengkap di bawah ini.\n\nGunakan struktur ini untuk memastikan konsistensi antar cabang dan laporan tetap selaras dengan sistem pusat.\n\n---\n\n## ðŸ§© 1. FORMAT AUDIT INDIVIDU (12 BAGIAN)\n\n### ðŸ§± Bagian 1 â€“ Header Audit\n**Nama:** [Nama Lengkap]  \n**Jabatan:** [Level]  \n**Cabang:** [NAMA_CABANG]  \n**Tanggal Audit:** [Tanggal]  \n**Upline:** [Nama Atasan]  \n**Status Cepat:** [Zona Warna] | [Rekomendasi ProDem]\n\n### ðŸ§© Bagian 2 â€“ Executive Summary\nTulis ringkasan singkat (3â€“5 kalimat) mencakup: zona warna, skor rata-rata, pilar kritis, dan ringkasan rekomendasi ProDem.\n\n### ðŸ“Š Bagian 3 â€“ Insight Lengkap\nBahas hasil analisis data margin, NA, kehadiran, dan progres selama 3 bulan terakhir. Jelaskan faktor penyebab naik-turun kinerja.\n\n### ðŸ§  Bagian 4 â€“ Analisis Pilar Individu\nGunakan 18 pilar untuk mengidentifikasi kekuatan dan kelemahan. Tandai pilar yang berada di bawah skor 3 untuk menjadi prioritas coaching.\n\n### ðŸ“ˆ Bagian 5 â€“ SWOT Performance\nTuliskan kekuatan (Strength), kelemahan (Weakness), peluang (Opportunity), dan ancaman (Threat) dalam konteks kerja individu dan tim.\n\n### ðŸ§­ Bagian 6 â€“ Rencana Aksi 30 Hari\nTuliskan langkah-langkah cepat yang bisa dilakukan dalam 30 hari ke depan untuk perbaikan performa.\n\n### ðŸ•“ Bagian 7 â€“ Rencana Aksi 60 Hari\nRincikan rencana menengah yang lebih strategis untuk perbaikan produktivitas tim dan kaderisasi.\n\n### ðŸ“† Bagian 8 â€“ Rencana Aksi 90 Hari\nFokus pada target besar dan penguatan kultur kerja, disertai indikator keberhasilan (KPI).\n\n### ðŸ’¬ Bagian 9 â€“ Coaching & Insight Atasan\nMasukkan hasil coaching langsung dari atasan terkait langkah korektif dan arahan pembinaan lanjutan.\n\n### ðŸ’¡ Bagian 10 â€“ Evaluasi Regenerasi & Struktur\nUraikan kesiapan kaderisasi, kondisi tim, serta keberlanjutan jalur kerja (pipeline leadership).\n\n### ðŸŒ± Bagian 11 â€“ Magic Section (Motivasi)\nBerisi narasi motivasi personal:  \n- **Julukan:** makna dan relevansi.  \n- **Narasi motivasi:** kondisi sekarang & peluang depan.  \n- **Zodiak Booster:** kaitkan sifat zodiak dengan pola kerja.  \n- **Call to Action (30â€“60â€“90):** roadmap singkat.  \n- **Quotes:** kutipan inspiratif penutup.\n\n### ðŸ Bagian 12 â€“ Kesimpulan Akhir & Status ProDem\nTuliskan kesimpulan akhir audit, rekomendasi promosi/demosi/pertahankan, dan pesan penutup singkat.\n\n---\n\n## ðŸ§  2. 18 PILAR AISG\n\n### A. Pendorong Pemasukan\n1ï¸âƒ£ Kemampuan Mencari Calon Nasabah  \n2ï¸âƒ£ Kemampuan Menutup Penjualan  \n3ï¸âƒ£ Kemampuan Menjaga Nasabah Aktif  \n4ï¸âƒ£ Kemampuan Mencetak Tim Baru (Kaderisasi)  \n5ï¸âƒ£ Pencapaian Target Penjualan  \n6ï¸âƒ£ Penguasaan Pasar Wilayah  \n\n### B. Kekuatan Struktur Tim\n7ï¸âƒ£ Kelengkapan Struktur Tim  \n8ï¸âƒ£ Jumlah Jalur Aktif  \n9ï¸âƒ£ Produktivitas Pimpinan  \nðŸ”Ÿ Kesiapan Regenerasi  \n11ï¸âƒ£ Kerja Sama Antar Tim  \n12ï¸âƒ£ Kemampuan Beradaptasi  \n\n### C. Budaya & Operasional Tim\n13ï¸âƒ£ Disiplin & Konsistensi Kerja  \n14ï¸âƒ£ Semangat & Motivasi Tim  \n15ï¸âƒ£ Inovasi Cara Kerja  \n16ï¸âƒ£ Pelatihan & Pengembangan Keterampilan  \n17ï¸âƒ£ Kepuasan Nasabah  \n18ï¸âƒ£ Pemahaman Pasar Lokal  \n\n---\n\n## âœ… CATATAN TAMBAHAN\n- Gunakan pilar 4, 9, dan 13 sebagai indikator **EWS (Early Warning System)**.\n- Jika salah satu pilar kritis bernilai â‰¤2, sistem otomatis memberi tanda âš ï¸.\n\n> **\"Audit bukan sekadar menilai, tapi menemukan potensi yang belum tumbuh.\"**  \n> â€” *AiSG System 2025*\n\n","size_bytes":3687},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"server/seed-superadmin.ts":{"content":"/**\n * Seed script to create first superadmin user\n * Run with: npx tsx server/seed-superadmin.ts\n */\n\nimport { createUser } from \"./auth\";\nimport { db } from \"./db\";\nimport { users } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\n\nasync function seedSuperadmin() {\n  try {\n    console.log(\"ðŸŒ± Starting superadmin seed...\");\n    \n    // Check if superadmin already exists\n    const [existing] = await db\n      .select()\n      .from(users)\n      .where(eq(users.username, \"superadmin\"))\n      .limit(1);\n    \n    if (existing) {\n      console.log(\"âš ï¸  Superadmin already exists!\");\n      console.log(\"   Username:\", existing.username);\n      console.log(\"   Name:\", existing.name);\n      console.log(\"   Role:\", existing.role);\n      console.log(\"   Created:\", existing.createdAt);\n      process.exit(0);\n    }\n    \n    // Create superadmin\n    console.log(\"ðŸ“ Creating superadmin account...\");\n    const superadmin = await createUser({\n      username: \"superadmin\",\n      password: \"vito1007\",\n      name: \"AiSG Admin Panel\",\n      role: \"full_admin\",\n    });\n    \n    console.log(\"âœ… Superadmin created successfully!\");\n    console.log(\"   Username:\", superadmin.username);\n    console.log(\"   Name:\", superadmin.name);\n    console.log(\"   Role:\", superadmin.role);\n    console.log(\"   ID:\", superadmin.id);\n    console.log(\"\\nðŸ” Login credentials:\");\n    console.log(\"   Username: superadmin\");\n    console.log(\"   Password: vito1007\");\n    console.log(\"\\nðŸŽ‰ You can now login to AiSG!\");\n    \n    process.exit(0);\n  } catch (error) {\n    console.error(\"âŒ Error seeding superadmin:\", error);\n    process.exit(1);\n  }\n}\n\nseedSuperadmin();\n","size_bytes":1665},"client/src/pages/Login.tsx":{"content":"/**\n * Login Page for AiSG\n * Modern Gen-Z design with gradient and glassmorphism\n */\n\nimport { useState } from \"react\";\nimport { useLocation, Link, Redirect } from \"wouter\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Lock, User, Sparkles, Eye, EyeOff } from \"lucide-react\";\n\nexport default function Login() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { user, isLoading: authLoading, login } = useAuth();\n  const [, setLocation] = useLocation();\n\n  // If already logged in, redirect to dashboard\n  if (!authLoading && user) {\n    return <Redirect to=\"/\" />;\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setIsLoading(true);\n\n    try {\n      await login(username, password);\n      \n      // Check if there's a saved return URL\n      const returnUrl = sessionStorage.getItem(\"returnUrl\");\n      if (returnUrl && returnUrl !== \"/login\") {\n        sessionStorage.removeItem(\"returnUrl\");\n        setLocation(returnUrl);\n      } else {\n        setLocation(\"/\"); // Default to home\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Login gagal\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-950 via-gray-900 to-black\">\n      {/* Background effects */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/5 via-purple-500/5 to-pink-500/5 pointer-events-none\" />\n      <div className=\"absolute inset-0 bg-[url('/grid.svg')] bg-center [mask-image:linear-gradient(180deg,white,rgba(255,255,255,0))] pointer-events-none\" />\n\n      <Card className=\"w-full max-w-md relative z-10 bg-gray-900/80 backdrop-blur-xl border-gray-800/50 shadow-2xl\">\n        <CardHeader className=\"text-center space-y-4\">\n          {/* Logo */}\n          <div className=\"flex justify-center\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 bg-gradient-to-r from-red-500 via-orange-500 to-amber-500 rounded-full blur-2xl opacity-40\" />\n              <div className=\"relative w-20 h-20 rounded-full overflow-hidden shadow-2xl ring-2 ring-amber-500/30\">\n                <img \n                  src=\"/logo-aisg.jpg\" \n                  alt=\"AiSG Logo\"\n                  className=\"w-full h-full object-cover\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* Title */}\n          <div>\n            <CardDescription className=\"text-gray-400 text-base\">\n              Audit Intelligence System Growth\n            </CardDescription>\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {/* Username */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\" className=\"text-gray-300\">\n                Username\n              </Label>\n              <div className=\"relative\">\n                <User className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"username\"\n                  type=\"text\"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  placeholder=\"Masukkan username\"\n                  className=\"pl-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  autoComplete=\"username\"\n                  required\n                  autoFocus\n                />\n              </div>\n            </div>\n\n            {/* Password */}\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center\">\n                <Label htmlFor=\"password\" className=\"text-gray-300\">\n                  Password\n                </Label>\n                <Link href=\"/forgot-password\" className=\"text-xs text-purple-400 hover:text-purple-300\">\n                  Lupa Password?\n                </Link>\n              </div>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n                <Input\n                  id=\"password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"Masukkan password\"\n                  className=\"pl-10 pr-10 bg-gray-800/50 border-gray-700 focus:border-purple-500 text-white placeholder:text-gray-500\"\n                  autoComplete=\"current-password\"\n                  required\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300 transition-colors\"\n                >\n                  {showPassword ? (\n                    <EyeOff className=\"w-4 h-4\" />\n                  ) : (\n                    <Eye className=\"w-4 h-4\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Error message */}\n            {error && (\n              <Alert variant=\"destructive\" className=\"bg-red-950/50 border-red-900/50\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            {/* Submit button */}\n            <Button\n              type=\"submit\"\n              className=\"w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 hover:from-blue-600 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg shadow-purple-500/25 transition-all duration-300\"\n              disabled={isLoading}\n            >\n              {isLoading ? (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                  <span>Logging in...</span>\n                </div>\n              ) : (\n                \"Login\"\n              )}\n            </Button>\n            {/* Register & Forgot Password links */}\n            <div className=\"space-y-3 pt-2\">\n              <div className=\"text-center text-sm\">\n                <span className=\"text-gray-400\">Belum punya akun? </span>\n                <Link href=\"/register\" className=\"text-purple-400 hover:text-purple-300 font-medium\">\n                  Daftar di sini\n                </Link>\n              </div>\n\n              <div className=\"text-center text-xs text-gray-500\">\n                ðŸ” Enterprise-grade security dengan role-based access control\n              </div>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":7310}},"version":2}